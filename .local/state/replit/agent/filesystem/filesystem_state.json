{"file_contents":{"client/src/components/ui/table.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Table = React.forwardRef<\n  HTMLTableElement,\n  React.HTMLAttributes<HTMLTableElement>\n>(({ className, ...props }, ref) => (\n  <div className=\"relative w-full overflow-auto\">\n    <table\n      ref={ref}\n      className={cn(\"w-full caption-bottom text-sm\", className)}\n      {...props}\n    />\n  </div>\n))\nTable.displayName = \"Table\"\n\nconst TableHeader = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <thead ref={ref} className={cn(\"[&_tr]:border-b\", className)} {...props} />\n))\nTableHeader.displayName = \"TableHeader\"\n\nconst TableBody = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tbody\n    ref={ref}\n    className={cn(\"[&_tr:last-child]:border-0\", className)}\n    {...props}\n  />\n))\nTableBody.displayName = \"TableBody\"\n\nconst TableFooter = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tfoot\n    ref={ref}\n    className={cn(\n      \"border-t bg-muted/50 font-medium [&>tr]:last:border-b-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableFooter.displayName = \"TableFooter\"\n\nconst TableRow = React.forwardRef<\n  HTMLTableRowElement,\n  React.HTMLAttributes<HTMLTableRowElement>\n>(({ className, ...props }, ref) => (\n  <tr\n    ref={ref}\n    className={cn(\n      \"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nTableRow.displayName = \"TableRow\"\n\nconst TableHead = React.forwardRef<\n  HTMLTableCellElement,\n  React.ThHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <th\n    ref={ref}\n    className={cn(\n      \"h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableHead.displayName = \"TableHead\"\n\nconst TableCell = React.forwardRef<\n  HTMLTableCellElement,\n  React.TdHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <td\n    ref={ref}\n    className={cn(\"p-4 align-middle [&:has([role=checkbox])]:pr-0\", className)}\n    {...props}\n  />\n))\nTableCell.displayName = \"TableCell\"\n\nconst TableCaption = React.forwardRef<\n  HTMLTableCaptionElement,\n  React.HTMLAttributes<HTMLTableCaptionElement>\n>(({ className, ...props }, ref) => (\n  <caption\n    ref={ref}\n    className={cn(\"mt-4 text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nTableCaption.displayName = \"TableCaption\"\n\nexport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableFooter,\n  TableHead,\n  TableRow,\n  TableCell,\n  TableCaption,\n}\n","path":null,"size_bytes":2765,"size_tokens":null},"client/src/components/ui/scroll-area.tsx":{"content":"import * as React from \"react\"\nimport * as ScrollAreaPrimitive from \"@radix-ui/react-scroll-area\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ScrollArea = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <ScrollAreaPrimitive.Root\n    ref={ref}\n    className={cn(\"relative overflow-hidden\", className)}\n    {...props}\n  >\n    <ScrollAreaPrimitive.Viewport className=\"h-full w-full rounded-[inherit]\">\n      {children}\n    </ScrollAreaPrimitive.Viewport>\n    <ScrollBar />\n    <ScrollAreaPrimitive.Corner />\n  </ScrollAreaPrimitive.Root>\n))\nScrollArea.displayName = ScrollAreaPrimitive.Root.displayName\n\nconst ScrollBar = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>\n>(({ className, orientation = \"vertical\", ...props }, ref) => (\n  <ScrollAreaPrimitive.ScrollAreaScrollbar\n    ref={ref}\n    orientation={orientation}\n    className={cn(\n      \"flex touch-none select-none transition-colors\",\n      orientation === \"vertical\" &&\n        \"h-full w-2.5 border-l border-l-transparent p-[1px]\",\n      orientation === \"horizontal\" &&\n        \"h-2.5 flex-col border-t border-t-transparent p-[1px]\",\n      className\n    )}\n    {...props}\n  >\n    <ScrollAreaPrimitive.ScrollAreaThumb className=\"relative flex-1 rounded-full bg-border\" />\n  </ScrollAreaPrimitive.ScrollAreaScrollbar>\n))\nScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName\n\nexport { ScrollArea, ScrollBar }\n","path":null,"size_bytes":1642,"size_tokens":null},"client/src/components/ui/form.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport {\n  Controller,\n  FormProvider,\n  useFormContext,\n  type ControllerProps,\n  type FieldPath,\n  type FieldValues,\n} from \"react-hook-form\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Label } from \"@/components/ui/label\"\n\nconst Form = FormProvider\n\ntype FormFieldContextValue<\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n> = {\n  name: TName\n}\n\nconst FormFieldContext = React.createContext<FormFieldContextValue>(\n  {} as FormFieldContextValue\n)\n\nconst FormField = <\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n>({\n  ...props\n}: ControllerProps<TFieldValues, TName>) => {\n  return (\n    <FormFieldContext.Provider value={{ name: props.name }}>\n      <Controller {...props} />\n    </FormFieldContext.Provider>\n  )\n}\n\nconst useFormField = () => {\n  const fieldContext = React.useContext(FormFieldContext)\n  const itemContext = React.useContext(FormItemContext)\n  const { getFieldState, formState } = useFormContext()\n\n  const fieldState = getFieldState(fieldContext.name, formState)\n\n  if (!fieldContext) {\n    throw new Error(\"useFormField should be used within <FormField>\")\n  }\n\n  const { id } = itemContext\n\n  return {\n    id,\n    name: fieldContext.name,\n    formItemId: `${id}-form-item`,\n    formDescriptionId: `${id}-form-item-description`,\n    formMessageId: `${id}-form-item-message`,\n    ...fieldState,\n  }\n}\n\ntype FormItemContextValue = {\n  id: string\n}\n\nconst FormItemContext = React.createContext<FormItemContextValue>(\n  {} as FormItemContextValue\n)\n\nconst FormItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const id = React.useId()\n\n  return (\n    <FormItemContext.Provider value={{ id }}>\n      <div ref={ref} className={cn(\"space-y-2\", className)} {...props} />\n    </FormItemContext.Provider>\n  )\n})\nFormItem.displayName = \"FormItem\"\n\nconst FormLabel = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  const { error, formItemId } = useFormField()\n\n  return (\n    <Label\n      ref={ref}\n      className={cn(error && \"text-destructive\", className)}\n      htmlFor={formItemId}\n      {...props}\n    />\n  )\n})\nFormLabel.displayName = \"FormLabel\"\n\nconst FormControl = React.forwardRef<\n  React.ElementRef<typeof Slot>,\n  React.ComponentPropsWithoutRef<typeof Slot>\n>(({ ...props }, ref) => {\n  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()\n\n  return (\n    <Slot\n      ref={ref}\n      id={formItemId}\n      aria-describedby={\n        !error\n          ? `${formDescriptionId}`\n          : `${formDescriptionId} ${formMessageId}`\n      }\n      aria-invalid={!!error}\n      {...props}\n    />\n  )\n})\nFormControl.displayName = \"FormControl\"\n\nconst FormDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => {\n  const { formDescriptionId } = useFormField()\n\n  return (\n    <p\n      ref={ref}\n      id={formDescriptionId}\n      className={cn(\"text-sm text-muted-foreground\", className)}\n      {...props}\n    />\n  )\n})\nFormDescription.displayName = \"FormDescription\"\n\nconst FormMessage = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, children, ...props }, ref) => {\n  const { error, formMessageId } = useFormField()\n  const body = error ? String(error?.message ?? \"\") : children\n\n  if (!body) {\n    return null\n  }\n\n  return (\n    <p\n      ref={ref}\n      id={formMessageId}\n      className={cn(\"text-sm font-medium text-destructive\", className)}\n      {...props}\n    >\n      {body}\n    </p>\n  )\n})\nFormMessage.displayName = \"FormMessage\"\n\nexport {\n  useFormField,\n  Form,\n  FormItem,\n  FormLabel,\n  FormControl,\n  FormDescription,\n  FormMessage,\n  FormField,\n}\n","path":null,"size_bytes":4120,"size_tokens":null},"client/src/components/ui/chart.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as RechartsPrimitive from \"recharts\"\n\nimport { cn } from \"@/lib/utils\"\n\n// Format: { THEME_NAME: CSS_SELECTOR }\nconst THEMES = { light: \"\", dark: \".dark\" } as const\n\nexport type ChartConfig = {\n  [k in string]: {\n    label?: React.ReactNode\n    icon?: React.ComponentType\n  } & (\n    | { color?: string; theme?: never }\n    | { color?: never; theme: Record<keyof typeof THEMES, string> }\n  )\n}\n\ntype ChartContextProps = {\n  config: ChartConfig\n}\n\nconst ChartContext = React.createContext<ChartContextProps | null>(null)\n\nfunction useChart() {\n  const context = React.useContext(ChartContext)\n\n  if (!context) {\n    throw new Error(\"useChart must be used within a <ChartContainer />\")\n  }\n\n  return context\n}\n\nconst ChartContainer = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    config: ChartConfig\n    children: React.ComponentProps<\n      typeof RechartsPrimitive.ResponsiveContainer\n    >[\"children\"]\n  }\n>(({ id, className, children, config, ...props }, ref) => {\n  const uniqueId = React.useId()\n  const chartId = `chart-${id || uniqueId.replace(/:/g, \"\")}`\n\n  return (\n    <ChartContext.Provider value={{ config }}>\n      <div\n        data-chart={chartId}\n        ref={ref}\n        className={cn(\n          \"flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none\",\n          className\n        )}\n        {...props}\n      >\n        <ChartStyle id={chartId} config={config} />\n        <RechartsPrimitive.ResponsiveContainer>\n          {children}\n        </RechartsPrimitive.ResponsiveContainer>\n      </div>\n    </ChartContext.Provider>\n  )\n})\nChartContainer.displayName = \"Chart\"\n\nconst ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {\n  const colorConfig = Object.entries(config).filter(\n    ([, config]) => config.theme || config.color\n  )\n\n  if (!colorConfig.length) {\n    return null\n  }\n\n  return (\n    <style\n      dangerouslySetInnerHTML={{\n        __html: Object.entries(THEMES)\n          .map(\n            ([theme, prefix]) => `\n${prefix} [data-chart=${id}] {\n${colorConfig\n  .map(([key, itemConfig]) => {\n    const color =\n      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||\n      itemConfig.color\n    return color ? `  --color-${key}: ${color};` : null\n  })\n  .join(\"\\n\")}\n}\n`\n          )\n          .join(\"\\n\"),\n      }}\n    />\n  )\n}\n\nconst ChartTooltip = RechartsPrimitive.Tooltip\n\nconst ChartTooltipContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<typeof RechartsPrimitive.Tooltip> &\n    React.ComponentProps<\"div\"> & {\n      hideLabel?: boolean\n      hideIndicator?: boolean\n      indicator?: \"line\" | \"dot\" | \"dashed\"\n      nameKey?: string\n      labelKey?: string\n    }\n>(\n  (\n    {\n      active,\n      payload,\n      className,\n      indicator = \"dot\",\n      hideLabel = false,\n      hideIndicator = false,\n      label,\n      labelFormatter,\n      labelClassName,\n      formatter,\n      color,\n      nameKey,\n      labelKey,\n    },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    const tooltipLabel = React.useMemo(() => {\n      if (hideLabel || !payload?.length) {\n        return null\n      }\n\n      const [item] = payload\n      const key = `${labelKey || item?.dataKey || item?.name || \"value\"}`\n      const itemConfig = getPayloadConfigFromPayload(config, item, key)\n      const value =\n        !labelKey && typeof label === \"string\"\n          ? config[label as keyof typeof config]?.label || label\n          : itemConfig?.label\n\n      if (labelFormatter) {\n        return (\n          <div className={cn(\"font-medium\", labelClassName)}>\n            {labelFormatter(value, payload)}\n          </div>\n        )\n      }\n\n      if (!value) {\n        return null\n      }\n\n      return <div className={cn(\"font-medium\", labelClassName)}>{value}</div>\n    }, [\n      label,\n      labelFormatter,\n      payload,\n      hideLabel,\n      labelClassName,\n      config,\n      labelKey,\n    ])\n\n    if (!active || !payload?.length) {\n      return null\n    }\n\n    const nestLabel = payload.length === 1 && indicator !== \"dot\"\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl\",\n          className\n        )}\n      >\n        {!nestLabel ? tooltipLabel : null}\n        <div className=\"grid gap-1.5\">\n          {payload.map((item, index) => {\n            const key = `${nameKey || item.name || item.dataKey || \"value\"}`\n            const itemConfig = getPayloadConfigFromPayload(config, item, key)\n            const indicatorColor = color || item.payload.fill || item.color\n\n            return (\n              <div\n                key={item.dataKey}\n                className={cn(\n                  \"flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground\",\n                  indicator === \"dot\" && \"items-center\"\n                )}\n              >\n                {formatter && item?.value !== undefined && item.name ? (\n                  formatter(item.value, item.name, item, index, item.payload)\n                ) : (\n                  <>\n                    {itemConfig?.icon ? (\n                      <itemConfig.icon />\n                    ) : (\n                      !hideIndicator && (\n                        <div\n                          className={cn(\n                            \"shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]\",\n                            {\n                              \"h-2.5 w-2.5\": indicator === \"dot\",\n                              \"w-1\": indicator === \"line\",\n                              \"w-0 border-[1.5px] border-dashed bg-transparent\":\n                                indicator === \"dashed\",\n                              \"my-0.5\": nestLabel && indicator === \"dashed\",\n                            }\n                          )}\n                          style={\n                            {\n                              \"--color-bg\": indicatorColor,\n                              \"--color-border\": indicatorColor,\n                            } as React.CSSProperties\n                          }\n                        />\n                      )\n                    )}\n                    <div\n                      className={cn(\n                        \"flex flex-1 justify-between leading-none\",\n                        nestLabel ? \"items-end\" : \"items-center\"\n                      )}\n                    >\n                      <div className=\"grid gap-1.5\">\n                        {nestLabel ? tooltipLabel : null}\n                        <span className=\"text-muted-foreground\">\n                          {itemConfig?.label || item.name}\n                        </span>\n                      </div>\n                      {item.value && (\n                        <span className=\"font-mono font-medium tabular-nums text-foreground\">\n                          {item.value.toLocaleString()}\n                        </span>\n                      )}\n                    </div>\n                  </>\n                )}\n              </div>\n            )\n          })}\n        </div>\n      </div>\n    )\n  }\n)\nChartTooltipContent.displayName = \"ChartTooltip\"\n\nconst ChartLegend = RechartsPrimitive.Legend\n\nconst ChartLegendContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> &\n    Pick<RechartsPrimitive.LegendProps, \"payload\" | \"verticalAlign\"> & {\n      hideIcon?: boolean\n      nameKey?: string\n    }\n>(\n  (\n    { className, hideIcon = false, payload, verticalAlign = \"bottom\", nameKey },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    if (!payload?.length) {\n      return null\n    }\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"flex items-center justify-center gap-4\",\n          verticalAlign === \"top\" ? \"pb-3\" : \"pt-3\",\n          className\n        )}\n      >\n        {payload.map((item) => {\n          const key = `${nameKey || item.dataKey || \"value\"}`\n          const itemConfig = getPayloadConfigFromPayload(config, item, key)\n\n          return (\n            <div\n              key={item.value}\n              className={cn(\n                \"flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground\"\n              )}\n            >\n              {itemConfig?.icon && !hideIcon ? (\n                <itemConfig.icon />\n              ) : (\n                <div\n                  className=\"h-2 w-2 shrink-0 rounded-[2px]\"\n                  style={{\n                    backgroundColor: item.color,\n                  }}\n                />\n              )}\n              {itemConfig?.label}\n            </div>\n          )\n        })}\n      </div>\n    )\n  }\n)\nChartLegendContent.displayName = \"ChartLegend\"\n\n// Helper to extract item config from a payload.\nfunction getPayloadConfigFromPayload(\n  config: ChartConfig,\n  payload: unknown,\n  key: string\n) {\n  if (typeof payload !== \"object\" || payload === null) {\n    return undefined\n  }\n\n  const payloadPayload =\n    \"payload\" in payload &&\n    typeof payload.payload === \"object\" &&\n    payload.payload !== null\n      ? payload.payload\n      : undefined\n\n  let configLabelKey: string = key\n\n  if (\n    key in payload &&\n    typeof payload[key as keyof typeof payload] === \"string\"\n  ) {\n    configLabelKey = payload[key as keyof typeof payload] as string\n  } else if (\n    payloadPayload &&\n    key in payloadPayload &&\n    typeof payloadPayload[key as keyof typeof payloadPayload] === \"string\"\n  ) {\n    configLabelKey = payloadPayload[\n      key as keyof typeof payloadPayload\n    ] as string\n  }\n\n  return configLabelKey in config\n    ? config[configLabelKey]\n    : config[key as keyof typeof config]\n}\n\nexport {\n  ChartContainer,\n  ChartTooltip,\n  ChartTooltipContent,\n  ChartLegend,\n  ChartLegendContent,\n  ChartStyle,\n}\n","path":null,"size_bytes":10481,"size_tokens":null},"client/src/pages/purchases.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useForm } from \"react-hook-form\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Badge } from \"@/components/ui/badge\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport {\n  Form,\n  FormControl,\n  FormField,\n  FormItem,\n  FormLabel,\n  FormMessage,\n} from \"@/components/ui/form\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport {\n  Plus,\n  Search,\n  ShoppingCart,\n  Trash2,\n  X,\n} from \"lucide-react\";\nimport type { Vendor, Vehicle, Product, Purchase } from \"@shared/schema\";\nimport { z } from \"zod\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\n\ninterface PurchaseLineItem {\n  productId: string;\n  productName: string;\n  quantity: number;\n  unitPrice: number;\n  total: number;\n}\n\nconst purchaseFormSchema = z.object({\n  vendorId: z.string().min(1, \"Please select a vendor\"),\n  vehicleId: z.string().optional(),\n  date: z.string().min(1, \"Please select a date\"),\n});\n\ntype PurchaseFormData = z.infer<typeof purchaseFormSchema>;\n\nexport default function Purchases() {\n  const { toast } = useToast();\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [isDialogOpen, setIsDialogOpen] = useState(false);\n  const [lineItems, setLineItems] = useState<PurchaseLineItem[]>([]);\n  const [selectedProduct, setSelectedProduct] = useState(\"\");\n  const [itemQuantity, setItemQuantity] = useState(\"\");\n  const [itemPrice, setItemPrice] = useState(\"\");\n\n  const { data: vendors = [], isLoading: vendorsLoading } = useQuery<Vendor[]>({\n    queryKey: [\"/api/vendors\"],\n  });\n\n  const { data: vehicles = [] } = useQuery<Vehicle[]>({\n    queryKey: [\"/api/vehicles\"],\n  });\n\n  const { data: products = [] } = useQuery<Product[]>({\n    queryKey: [\"/api/products\"],\n  });\n\n  const { data: purchases = [], isLoading: purchasesLoading } = useQuery<Purchase[]>({\n    queryKey: [\"/api/purchases\"],\n  });\n\n  const form = useForm<PurchaseFormData>({\n    resolver: zodResolver(purchaseFormSchema),\n    defaultValues: {\n      vendorId: \"\",\n      vehicleId: \"\",\n      date: new Date().toISOString().split(\"T\")[0],\n    },\n  });\n\n  const createMutation = useMutation({\n    mutationFn: async (data: PurchaseFormData & { items: PurchaseLineItem[] }) => {\n      return apiRequest(\"POST\", \"/api/purchases\", {\n        ...data,\n        totalAmount: data.items.reduce((acc, item) => acc + item.total, 0),\n        items: data.items.map((item) => ({\n          productId: item.productId,\n          quantity: item.quantity,\n          unitPrice: item.unitPrice,\n          total: item.total,\n        })),\n      });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/purchases\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/products\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/stock-movements\"] });\n      setIsDialogOpen(false);\n      setLineItems([]);\n      form.reset();\n      toast({ title: \"Purchase order created successfully\" });\n    },\n    onError: () => {\n      toast({ title: \"Failed to create purchase order\", variant: \"destructive\" });\n    },\n  });\n\n  const addLineItem = () => {\n    if (!selectedProduct || !itemQuantity || !itemPrice) {\n      toast({ title: \"Please fill all item fields\", variant: \"destructive\" });\n      return;\n    }\n\n    const product = products.find((p) => p.id === selectedProduct);\n    if (!product) return;\n\n    const quantity = parseFloat(itemQuantity);\n    const unitPrice = parseFloat(itemPrice);\n\n    if (isNaN(quantity) || isNaN(unitPrice) || quantity <= 0 || unitPrice <= 0) {\n      toast({ title: \"Please enter valid quantity and price\", variant: \"destructive\" });\n      return;\n    }\n\n    setLineItems([\n      ...lineItems,\n      {\n        productId: product.id,\n        productName: product.name,\n        quantity,\n        unitPrice,\n        total: quantity * unitPrice,\n      },\n    ]);\n\n    setSelectedProduct(\"\");\n    setItemQuantity(\"\");\n    setItemPrice(\"\");\n  };\n\n  const removeLineItem = (index: number) => {\n    setLineItems(lineItems.filter((_, i) => i !== index));\n  };\n\n  const totalAmount = lineItems.reduce((acc, item) => acc + item.total, 0);\n\n  const onSubmit = (data: PurchaseFormData) => {\n    if (lineItems.length === 0) {\n      toast({ title: \"Please add at least one item\", variant: \"destructive\" });\n      return;\n    }\n\n    createMutation.mutate({ ...data, items: lineItems });\n  };\n\n  const openCreateDialog = () => {\n    form.reset({\n      vendorId: \"\",\n      vehicleId: \"\",\n      date: new Date().toISOString().split(\"T\")[0],\n    });\n    setLineItems([]);\n    setIsDialogOpen(true);\n  };\n\n  const filteredPurchases = purchases.filter((purchase) => {\n    const vendor = vendors.find((v) => v.id === purchase.vendorId);\n    return (\n      vendor?.name.toLowerCase().includes(searchQuery.toLowerCase()) ||\n      purchase.id.toLowerCase().includes(searchQuery.toLowerCase())\n    );\n  });\n\n  const isLoading = vendorsLoading || purchasesLoading;\n\n  if (isLoading) {\n    return (\n      <div className=\"p-6 space-y-6\">\n        <div className=\"flex items-center justify-between gap-4\">\n          <Skeleton className=\"h-8 w-32\" />\n          <Skeleton className=\"h-9 w-32\" />\n        </div>\n        <Card>\n          <CardContent className=\"p-6\">\n            <div className=\"space-y-4\">\n              {[1, 2, 3].map((i) => (\n                <Skeleton key={i} className=\"h-16 w-full\" />\n              ))}\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"p-6 space-y-6\">\n      <div className=\"flex items-center justify-between gap-4 flex-wrap\">\n        <div>\n          <h1 className=\"text-2xl font-semibold\" data-testid=\"text-page-title\">Purchases</h1>\n          <p className=\"text-sm text-muted-foreground\">\n            Manage purchase orders from vendors\n          </p>\n        </div>\n        <Button onClick={openCreateDialog} data-testid=\"button-new-purchase\">\n          <Plus className=\"h-4 w-4 mr-2\" />\n          New Purchase\n        </Button>\n      </div>\n\n      <Card>\n        <CardHeader>\n          <div className=\"flex items-center gap-4\">\n            <div className=\"relative flex-1 max-w-sm\">\n              <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n              <Input\n                placeholder=\"Search purchases...\"\n                value={searchQuery}\n                onChange={(e) => setSearchQuery(e.target.value)}\n                className=\"pl-9\"\n                data-testid=\"input-search-purchases\"\n              />\n            </div>\n          </div>\n        </CardHeader>\n        <CardContent>\n          {filteredPurchases.length === 0 ? (\n            <div className=\"flex flex-col items-center justify-center py-12 text-muted-foreground\">\n              <ShoppingCart className=\"h-12 w-12 mb-4\" />\n              <p className=\"text-lg font-medium\">No purchases found</p>\n              <p className=\"text-sm\">\n                {searchQuery\n                  ? \"Try a different search term\"\n                  : \"Create your first purchase order\"}\n              </p>\n              {!searchQuery && (\n                <Button\n                  variant=\"outline\"\n                  className=\"mt-4\"\n                  onClick={openCreateDialog}\n                >\n                  <Plus className=\"h-4 w-4 mr-2\" />\n                  New Purchase\n                </Button>\n              )}\n            </div>\n          ) : (\n            <Table>\n              <TableHeader>\n                <TableRow>\n                  <TableHead>Purchase ID</TableHead>\n                  <TableHead>Vendor</TableHead>\n                  <TableHead>Date</TableHead>\n                  <TableHead className=\"text-right\">Amount</TableHead>\n                  <TableHead>Status</TableHead>\n                </TableRow>\n              </TableHeader>\n              <TableBody>\n                {filteredPurchases.map((purchase) => {\n                  const vendor = vendors.find((v) => v.id === purchase.vendorId);\n                  return (\n                    <TableRow key={purchase.id} data-testid={`row-purchase-${purchase.id}`}>\n                      <TableCell className=\"font-mono text-sm\">\n                        {purchase.id.slice(0, 8)}...\n                      </TableCell>\n                      <TableCell className=\"font-medium\">\n                        {vendor?.name || \"Unknown\"}\n                      </TableCell>\n                      <TableCell>{purchase.date}</TableCell>\n                      <TableCell className=\"text-right font-mono\">\n                        ₹{purchase.totalAmount.toLocaleString(\"en-IN\", { minimumFractionDigits: 2 })}\n                      </TableCell>\n                      <TableCell>\n                        <Badge\n                          variant={purchase.status === \"completed\" ? \"default\" : \"secondary\"}\n                          className=\"text-xs\"\n                        >\n                          {purchase.status}\n                        </Badge>\n                      </TableCell>\n                    </TableRow>\n                  );\n                })}\n              </TableBody>\n            </Table>\n          )}\n        </CardContent>\n      </Card>\n\n      <Dialog open={isDialogOpen} onOpenChange={setIsDialogOpen}>\n        <DialogContent className=\"max-w-3xl max-h-[90vh] overflow-y-auto\">\n          <DialogHeader>\n            <DialogTitle>New Purchase Order</DialogTitle>\n          </DialogHeader>\n          <Form {...form}>\n            <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-6\">\n              <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n                <FormField\n                  control={form.control}\n                  name=\"vendorId\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Vendor *</FormLabel>\n                      <Select onValueChange={field.onChange} value={field.value}>\n                        <FormControl>\n                          <SelectTrigger data-testid=\"select-vendor\">\n                            <SelectValue placeholder=\"Select vendor\" />\n                          </SelectTrigger>\n                        </FormControl>\n                        <SelectContent>\n                          {vendors.map((vendor) => (\n                            <SelectItem key={vendor.id} value={vendor.id}>\n                              {vendor.name}\n                            </SelectItem>\n                          ))}\n                        </SelectContent>\n                      </Select>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                <FormField\n                  control={form.control}\n                  name=\"vehicleId\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Vehicle</FormLabel>\n                      <Select\n                        onValueChange={field.onChange}\n                        value={field.value || \"\"}\n                      >\n                        <FormControl>\n                          <SelectTrigger data-testid=\"select-vehicle\">\n                            <SelectValue placeholder=\"Select vehicle\" />\n                          </SelectTrigger>\n                        </FormControl>\n                        <SelectContent>\n                          <SelectItem value=\"none\">None</SelectItem>\n                          {vehicles.map((vehicle) => (\n                            <SelectItem key={vehicle.id} value={vehicle.id}>\n                              {vehicle.number} - {vehicle.type}\n                            </SelectItem>\n                          ))}\n                        </SelectContent>\n                      </Select>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                <FormField\n                  control={form.control}\n                  name=\"date\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Date *</FormLabel>\n                      <FormControl>\n                        <Input type=\"date\" {...field} data-testid=\"input-purchase-date\" />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n              </div>\n\n              <Card>\n                <CardHeader>\n                  <CardTitle className=\"text-base\">Add Items</CardTitle>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                  <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n                    <div>\n                      <label className=\"text-sm font-medium\">Product</label>\n                      <Select value={selectedProduct} onValueChange={setSelectedProduct}>\n                        <SelectTrigger data-testid=\"select-item-product\">\n                          <SelectValue placeholder=\"Select product\" />\n                        </SelectTrigger>\n                        <SelectContent>\n                          {products.map((product) => (\n                            <SelectItem key={product.id} value={product.id}>\n                              {product.name} ({product.unit})\n                            </SelectItem>\n                          ))}\n                        </SelectContent>\n                      </Select>\n                    </div>\n                    <div>\n                      <label className=\"text-sm font-medium\">Quantity</label>\n                      <Input\n                        type=\"number\"\n                        step=\"0.01\"\n                        placeholder=\"0\"\n                        value={itemQuantity}\n                        onChange={(e) => setItemQuantity(e.target.value)}\n                        data-testid=\"input-item-quantity\"\n                      />\n                    </div>\n                    <div>\n                      <label className=\"text-sm font-medium\">Unit Price</label>\n                      <Input\n                        type=\"number\"\n                        step=\"0.01\"\n                        placeholder=\"0.00\"\n                        value={itemPrice}\n                        onChange={(e) => setItemPrice(e.target.value)}\n                        data-testid=\"input-item-price\"\n                      />\n                    </div>\n                    <div className=\"flex items-end\">\n                      <Button\n                        type=\"button\"\n                        onClick={addLineItem}\n                        className=\"w-full\"\n                        data-testid=\"button-add-item\"\n                      >\n                        <Plus className=\"h-4 w-4 mr-2\" />\n                        Add\n                      </Button>\n                    </div>\n                  </div>\n\n                  {lineItems.length > 0 && (\n                    <Table>\n                      <TableHeader>\n                        <TableRow>\n                          <TableHead>Product</TableHead>\n                          <TableHead className=\"text-right\">Qty</TableHead>\n                          <TableHead className=\"text-right\">Price</TableHead>\n                          <TableHead className=\"text-right\">Total</TableHead>\n                          <TableHead></TableHead>\n                        </TableRow>\n                      </TableHeader>\n                      <TableBody>\n                        {lineItems.map((item, index) => (\n                          <TableRow key={index}>\n                            <TableCell>{item.productName}</TableCell>\n                            <TableCell className=\"text-right font-mono\">\n                              {item.quantity}\n                            </TableCell>\n                            <TableCell className=\"text-right font-mono\">\n                              ₹{item.unitPrice.toFixed(2)}\n                            </TableCell>\n                            <TableCell className=\"text-right font-mono\">\n                              ₹{item.total.toFixed(2)}\n                            </TableCell>\n                            <TableCell>\n                              <Button\n                                type=\"button\"\n                                variant=\"ghost\"\n                                size=\"icon\"\n                                onClick={() => removeLineItem(index)}\n                              >\n                                <X className=\"h-4 w-4\" />\n                              </Button>\n                            </TableCell>\n                          </TableRow>\n                        ))}\n                      </TableBody>\n                    </Table>\n                  )}\n                </CardContent>\n              </Card>\n\n              <div className=\"flex items-center justify-between p-4 bg-muted/50 rounded-md\">\n                <span className=\"font-medium\">Total Amount</span>\n                <span className=\"text-2xl font-semibold font-mono\" data-testid=\"text-purchase-total\">\n                  ₹{totalAmount.toLocaleString(\"en-IN\", { minimumFractionDigits: 2 })}\n                </span>\n              </div>\n\n              <div className=\"flex justify-end gap-2\">\n                <Button\n                  type=\"button\"\n                  variant=\"outline\"\n                  onClick={() => setIsDialogOpen(false)}\n                >\n                  Cancel\n                </Button>\n                <Button\n                  type=\"submit\"\n                  disabled={createMutation.isPending || lineItems.length === 0}\n                  data-testid=\"button-submit-purchase\"\n                >\n                  {createMutation.isPending ? \"Creating...\" : \"Create Purchase\"}\n                </Button>\n              </div>\n            </form>\n          </Form>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":18483,"size_tokens":null},"client/src/pages/print.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { Label } from \"@/components/ui/label\";\nimport { Printer, FileText, Truck } from \"lucide-react\";\nimport type { Invoice, InvoiceItem, Customer, Product, CompanySettings } from \"@shared/schema\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\n\nexport default function PrintCenter() {\n  const [selectedInvoice, setSelectedInvoice] = useState<string>(\"\");\n  const [documentType, setDocumentType] = useState<\"invoice\" | \"challan\">(\"invoice\");\n\n  const { data: invoices = [], isLoading: invoicesLoading } = useQuery<Invoice[]>({\n    queryKey: [\"/api/invoices\"],\n  });\n\n  const { data: customers = [] } = useQuery<Customer[]>({\n    queryKey: [\"/api/customers\"],\n  });\n\n  const { data: products = [] } = useQuery<Product[]>({\n    queryKey: [\"/api/products\"],\n  });\n\n  const { data: companySettings } = useQuery<CompanySettings | null>({\n    queryKey: [\"/api/company-settings\"],\n  });\n\n  const { data: invoiceItems = [] } = useQuery<InvoiceItem[]>({\n    queryKey: [\"/api/invoices\", selectedInvoice, \"items\"],\n    enabled: !!selectedInvoice,\n  });\n\n  const getCustomerName = (id: string) => customers.find((c) => c.id === id)?.name || \"Unknown\";\n  const getCustomer = (id: string) => customers.find((c) => c.id === id);\n  const getProductName = (id: string) => products.find((p) => p.id === id)?.name || \"Unknown\";\n  const getProductUnit = (id: string) => products.find((p) => p.id === id)?.unit || \"\";\n\n  const selectedInvoiceData = invoices.find((i) => i.id === selectedInvoice);\n  const customer = selectedInvoiceData ? getCustomer(selectedInvoiceData.customerId) : null;\n\n  const handlePrint = () => {\n    window.print();\n  };\n\n  if (invoicesLoading) {\n    return (\n      <div className=\"p-6 space-y-6\">\n        <Skeleton className=\"h-8 w-48\" />\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n          <Skeleton className=\"h-32\" />\n          <Skeleton className=\"h-32\" />\n          <Skeleton className=\"h-32\" />\n        </div>\n        <Skeleton className=\"h-96\" />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"p-6 space-y-6\">\n      <div className=\"flex items-center justify-between gap-4 flex-wrap print:hidden\">\n        <h1 className=\"text-2xl font-semibold\" data-testid=\"text-page-title\">\n          Print Center\n        </h1>\n      </div>\n\n      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4 print:hidden\">\n        <div className=\"space-y-2\">\n          <Label>Document Type</Label>\n          <Select value={documentType} onValueChange={(v) => setDocumentType(v as \"invoice\" | \"challan\")}>\n            <SelectTrigger data-testid=\"select-document-type\">\n              <SelectValue placeholder=\"Select type\" />\n            </SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"invoice\">Tax Invoice</SelectItem>\n              <SelectItem value=\"challan\">Delivery Challan</SelectItem>\n            </SelectContent>\n          </Select>\n        </div>\n\n        <div className=\"space-y-2\">\n          <Label>Select Invoice</Label>\n          <Select value={selectedInvoice} onValueChange={setSelectedInvoice}>\n            <SelectTrigger data-testid=\"select-invoice\">\n              <SelectValue placeholder=\"Select invoice\" />\n            </SelectTrigger>\n            <SelectContent>\n              {invoices.map((invoice) => (\n                <SelectItem key={invoice.id} value={invoice.id}>\n                  {invoice.invoiceNumber} - {getCustomerName(invoice.customerId)}\n                </SelectItem>\n              ))}\n            </SelectContent>\n          </Select>\n        </div>\n\n        <div className=\"space-y-2 flex items-end\">\n          <Button onClick={handlePrint} disabled={!selectedInvoice} data-testid=\"button-print\">\n            <Printer className=\"h-4 w-4 mr-2\" />\n            Print Document\n          </Button>\n        </div>\n      </div>\n\n      {selectedInvoiceData && (\n        <Card className=\"print:shadow-none print:border-none\">\n          <CardContent className=\"p-8\">\n            <div className=\"border border-border rounded-md p-6 space-y-6\">\n              <div className=\"flex justify-between items-start border-b border-border pb-4\">\n                <div>\n                  <h2 className=\"text-xl font-bold\" data-testid=\"text-company-name\">\n                    {companySettings?.name || \"VegWholesale\"}\n                  </h2>\n                  {companySettings?.address && (\n                    <p className=\"text-sm text-muted-foreground\">{companySettings.address}</p>\n                  )}\n                  {companySettings?.phone && (\n                    <p className=\"text-sm text-muted-foreground\">Phone: {companySettings.phone}</p>\n                  )}\n                  {companySettings?.gstNumber && (\n                    <p className=\"text-sm font-medium\">GSTIN: {companySettings.gstNumber}</p>\n                  )}\n                </div>\n                <div className=\"text-right\">\n                  <div className=\"flex items-center gap-2 justify-end mb-2\">\n                    {documentType === \"invoice\" ? (\n                      <FileText className=\"h-5 w-5\" />\n                    ) : (\n                      <Truck className=\"h-5 w-5\" />\n                    )}\n                    <h3 className=\"text-lg font-bold uppercase\">\n                      {documentType === \"invoice\" ? \"Tax Invoice\" : \"Delivery Challan\"}\n                    </h3>\n                  </div>\n                  <p className=\"text-sm\">\n                    <span className=\"font-medium\">No:</span> {selectedInvoiceData.invoiceNumber}\n                  </p>\n                  <p className=\"text-sm\">\n                    <span className=\"font-medium\">Date:</span> {selectedInvoiceData.date}\n                  </p>\n                </div>\n              </div>\n\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div>\n                  <h4 className=\"text-sm font-semibold mb-1 uppercase text-muted-foreground\">Bill To</h4>\n                  <div className=\"border border-border rounded-md p-3\">\n                    <p className=\"font-medium\">{customer?.name}</p>\n                    {customer?.address && (\n                      <p className=\"text-sm text-muted-foreground\">{customer.address}</p>\n                    )}\n                    {customer?.phone && (\n                      <p className=\"text-sm text-muted-foreground\">Phone: {customer.phone}</p>\n                    )}\n                  </div>\n                </div>\n                {documentType === \"challan\" && (\n                  <div>\n                    <h4 className=\"text-sm font-semibold mb-1 uppercase text-muted-foreground\">Ship To</h4>\n                    <div className=\"border border-border rounded-md p-3\">\n                      <p className=\"font-medium\">{customer?.name}</p>\n                      {customer?.address && (\n                        <p className=\"text-sm text-muted-foreground\">{customer.address}</p>\n                      )}\n                    </div>\n                  </div>\n                )}\n              </div>\n\n              <div>\n                <table className=\"w-full border-collapse\">\n                  <thead>\n                    <tr className=\"bg-muted/50\">\n                      <th className=\"border border-border px-3 py-2 text-left text-sm font-semibold\">#</th>\n                      <th className=\"border border-border px-3 py-2 text-left text-sm font-semibold\">Item</th>\n                      <th className=\"border border-border px-3 py-2 text-right text-sm font-semibold\">Qty</th>\n                      <th className=\"border border-border px-3 py-2 text-right text-sm font-semibold\">Unit</th>\n                      {documentType === \"invoice\" && (\n                        <>\n                          <th className=\"border border-border px-3 py-2 text-right text-sm font-semibold\">Rate</th>\n                          <th className=\"border border-border px-3 py-2 text-right text-sm font-semibold\">Amount</th>\n                        </>\n                      )}\n                    </tr>\n                  </thead>\n                  <tbody>\n                    {invoiceItems.map((item, idx) => (\n                      <tr key={item.id}>\n                        <td className=\"border border-border px-3 py-2 text-sm\">{idx + 1}</td>\n                        <td className=\"border border-border px-3 py-2 text-sm\">{getProductName(item.productId)}</td>\n                        <td className=\"border border-border px-3 py-2 text-right text-sm font-mono\">{item.quantity}</td>\n                        <td className=\"border border-border px-3 py-2 text-right text-sm\">{getProductUnit(item.productId)}</td>\n                        {documentType === \"invoice\" && (\n                          <>\n                            <td className=\"border border-border px-3 py-2 text-right text-sm font-mono\">\n                              {item.unitPrice.toLocaleString(\"en-IN\", { style: \"currency\", currency: \"INR\" })}\n                            </td>\n                            <td className=\"border border-border px-3 py-2 text-right text-sm font-mono\">\n                              {item.total.toLocaleString(\"en-IN\", { style: \"currency\", currency: \"INR\" })}\n                            </td>\n                          </>\n                        )}\n                      </tr>\n                    ))}\n                  </tbody>\n                </table>\n              </div>\n\n              {documentType === \"invoice\" && (\n                <div className=\"flex justify-end\">\n                  <div className=\"w-64 space-y-1\">\n                    <div className=\"flex justify-between text-sm\">\n                      <span>Subtotal</span>\n                      <span className=\"font-mono\">\n                        {selectedInvoiceData.subtotal.toLocaleString(\"en-IN\", { style: \"currency\", currency: \"INR\" })}\n                      </span>\n                    </div>\n                    {selectedInvoiceData.includeHamaliCharge && (\n                      <div className=\"flex justify-between text-sm\">\n                        <span>Hamali Charge ({selectedInvoiceData.totalKgWeight || 0} KG x {selectedInvoiceData.hamaliRatePerKg || 0}/KG)</span>\n                        <span className=\"font-mono\">\n                          {(selectedInvoiceData.hamaliChargeAmount || 0).toLocaleString(\"en-IN\", { style: \"currency\", currency: \"INR\" })}\n                        </span>\n                      </div>\n                    )}\n                    <div className=\"flex justify-between text-base font-bold border-t border-border pt-2 mt-2\">\n                      <span>Grand Total</span>\n                      <span className=\"font-mono\">\n                        {selectedInvoiceData.grandTotal.toLocaleString(\"en-IN\", { style: \"currency\", currency: \"INR\" })}\n                      </span>\n                    </div>\n                  </div>\n                </div>\n              )}\n\n              <div className=\"grid grid-cols-2 gap-8 pt-8 mt-8 border-t border-border\">\n                <div className=\"text-center\">\n                  <div className=\"h-16\"></div>\n                  <p className=\"text-sm border-t border-border pt-2\">Customer Signature</p>\n                </div>\n                <div className=\"text-center\">\n                  <div className=\"h-16\"></div>\n                  <p className=\"text-sm border-t border-border pt-2\">Authorized Signature</p>\n                </div>\n              </div>\n\n              {companySettings?.bankDetails && documentType === \"invoice\" && (\n                <div className=\"text-sm text-muted-foreground border-t border-border pt-4\">\n                  <p className=\"font-medium mb-1\">Bank Details:</p>\n                  <p className=\"whitespace-pre-wrap\">{companySettings.bankDetails}</p>\n                </div>\n              )}\n            </div>\n          </CardContent>\n        </Card>\n      )}\n\n      {!selectedInvoice && (\n        <Card>\n          <CardContent className=\"py-16 text-center\">\n            <FileText className=\"h-12 w-12 mx-auto text-muted-foreground mb-4\" />\n            <p className=\"text-muted-foreground\">\n              Select an invoice to preview and print\n            </p>\n          </CardContent>\n        </Card>\n      )}\n    </div>\n  );\n}\n","path":null,"size_bytes":12522,"size_tokens":null},"client/src/components/ui/textarea.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Textarea = React.forwardRef<\n  HTMLTextAreaElement,\n  React.ComponentProps<\"textarea\">\n>(({ className, ...props }, ref) => {\n  return (\n    <textarea\n      className={cn(\n        \"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  )\n})\nTextarea.displayName = \"Textarea\"\n\nexport { Textarea }\n","path":null,"size_bytes":689,"size_tokens":null},"client/src/components/ui/skeleton.tsx":{"content":"import { cn } from \"@/lib/utils\"\n\nfunction Skeleton({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) {\n  return (\n    <div\n      className={cn(\"animate-pulse rounded-md bg-muted\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Skeleton }\n","path":null,"size_bytes":261,"size_tokens":null},"client/src/components/ui/breadcrumb.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Breadcrumb = React.forwardRef<\n  HTMLElement,\n  React.ComponentPropsWithoutRef<\"nav\"> & {\n    separator?: React.ReactNode\n  }\n>(({ ...props }, ref) => <nav ref={ref} aria-label=\"breadcrumb\" {...props} />)\nBreadcrumb.displayName = \"Breadcrumb\"\n\nconst BreadcrumbList = React.forwardRef<\n  HTMLOListElement,\n  React.ComponentPropsWithoutRef<\"ol\">\n>(({ className, ...props }, ref) => (\n  <ol\n    ref={ref}\n    className={cn(\n      \"flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5\",\n      className\n    )}\n    {...props}\n  />\n))\nBreadcrumbList.displayName = \"BreadcrumbList\"\n\nconst BreadcrumbItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentPropsWithoutRef<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    className={cn(\"inline-flex items-center gap-1.5\", className)}\n    {...props}\n  />\n))\nBreadcrumbItem.displayName = \"BreadcrumbItem\"\n\nconst BreadcrumbLink = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentPropsWithoutRef<\"a\"> & {\n    asChild?: boolean\n  }\n>(({ asChild, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      className={cn(\"transition-colors hover:text-foreground\", className)}\n      {...props}\n    />\n  )\n})\nBreadcrumbLink.displayName = \"BreadcrumbLink\"\n\nconst BreadcrumbPage = React.forwardRef<\n  HTMLSpanElement,\n  React.ComponentPropsWithoutRef<\"span\">\n>(({ className, ...props }, ref) => (\n  <span\n    ref={ref}\n    role=\"link\"\n    aria-disabled=\"true\"\n    aria-current=\"page\"\n    className={cn(\"font-normal text-foreground\", className)}\n    {...props}\n  />\n))\nBreadcrumbPage.displayName = \"BreadcrumbPage\"\n\nconst BreadcrumbSeparator = ({\n  children,\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) => (\n  <li\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"[&>svg]:w-3.5 [&>svg]:h-3.5\", className)}\n    {...props}\n  >\n    {children ?? <ChevronRight />}\n  </li>\n)\nBreadcrumbSeparator.displayName = \"BreadcrumbSeparator\"\n\nconst BreadcrumbEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More</span>\n  </span>\n)\nBreadcrumbEllipsis.displayName = \"BreadcrumbElipssis\"\n\nexport {\n  Breadcrumb,\n  BreadcrumbList,\n  BreadcrumbItem,\n  BreadcrumbLink,\n  BreadcrumbPage,\n  BreadcrumbSeparator,\n  BreadcrumbEllipsis,\n}\n","path":null,"size_bytes":2712,"size_tokens":null},"drizzle.config.ts":{"content":"import { defineConfig } from \"drizzle-kit\";\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\"DATABASE_URL, ensure the database is provisioned\");\n}\n\nexport default defineConfig({\n  out: \"./migrations\",\n  schema: \"./shared/schema.ts\",\n  dialect: \"postgresql\",\n  dbCredentials: {\n    url: process.env.DATABASE_URL,\n  },\n});\n","path":null,"size_bytes":325,"size_tokens":null},"client/src/components/ui/popover.tsx":{"content":"import * as React from \"react\"\nimport * as PopoverPrimitive from \"@radix-ui/react-popover\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Popover = PopoverPrimitive.Root\n\nconst PopoverTrigger = PopoverPrimitive.Trigger\n\nconst PopoverContent = React.forwardRef<\n  React.ElementRef<typeof PopoverPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <PopoverPrimitive.Portal>\n    <PopoverPrimitive.Content\n      ref={ref}\n      align={align}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </PopoverPrimitive.Portal>\n))\nPopoverContent.displayName = PopoverPrimitive.Content.displayName\n\nexport { Popover, PopoverTrigger, PopoverContent }\n","path":null,"size_bytes":1280,"size_tokens":null},"client/src/components/ui/input-otp.tsx":{"content":"import * as React from \"react\"\nimport { OTPInput, OTPInputContext } from \"input-otp\"\nimport { Dot } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst InputOTP = React.forwardRef<\n  React.ElementRef<typeof OTPInput>,\n  React.ComponentPropsWithoutRef<typeof OTPInput>\n>(({ className, containerClassName, ...props }, ref) => (\n  <OTPInput\n    ref={ref}\n    containerClassName={cn(\n      \"flex items-center gap-2 has-[:disabled]:opacity-50\",\n      containerClassName\n    )}\n    className={cn(\"disabled:cursor-not-allowed\", className)}\n    {...props}\n  />\n))\nInputOTP.displayName = \"InputOTP\"\n\nconst InputOTPGroup = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"flex items-center\", className)} {...props} />\n))\nInputOTPGroup.displayName = \"InputOTPGroup\"\n\nconst InputOTPSlot = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\"> & { index: number }\n>(({ index, className, ...props }, ref) => {\n  const inputOTPContext = React.useContext(OTPInputContext)\n  const { char, hasFakeCaret, isActive } = inputOTPContext.slots[index]\n\n  return (\n    <div\n      ref={ref}\n      className={cn(\n        \"relative flex h-10 w-10 items-center justify-center border-y border-r border-input text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md\",\n        isActive && \"z-10 ring-2 ring-ring ring-offset-background\",\n        className\n      )}\n      {...props}\n    >\n      {char}\n      {hasFakeCaret && (\n        <div className=\"pointer-events-none absolute inset-0 flex items-center justify-center\">\n          <div className=\"h-4 w-px animate-caret-blink bg-foreground duration-1000\" />\n        </div>\n      )}\n    </div>\n  )\n})\nInputOTPSlot.displayName = \"InputOTPSlot\"\n\nconst InputOTPSeparator = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ ...props }, ref) => (\n  <div ref={ref} role=\"separator\" {...props}>\n    <Dot />\n  </div>\n))\nInputOTPSeparator.displayName = \"InputOTPSeparator\"\n\nexport { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator }\n","path":null,"size_bytes":2154,"size_tokens":null},"client/src/App.tsx":{"content":"import { Switch, Route } from \"wouter\";\nimport { queryClient } from \"./lib/queryClient\";\nimport { QueryClientProvider } from \"@tanstack/react-query\";\nimport { Toaster } from \"@/components/ui/toaster\";\nimport { TooltipProvider } from \"@/components/ui/tooltip\";\nimport { SidebarProvider, SidebarTrigger } from \"@/components/ui/sidebar\";\nimport { AppSidebar } from \"@/components/app-sidebar\";\nimport { ThemeToggle } from \"@/components/theme-toggle\";\nimport NotFound from \"@/pages/not-found\";\nimport Sell from \"@/pages/sell\";\nimport Dashboard from \"@/pages/dashboard\";\nimport Vendors from \"@/pages/vendors\";\nimport Customers from \"@/pages/customers\";\nimport Vehicles from \"@/pages/vehicles\";\nimport Products from \"@/pages/products\";\nimport Stock from \"@/pages/stock\";\nimport Purchases from \"@/pages/purchases\";\nimport Payments from \"@/pages/payments\";\nimport Reports from \"@/pages/reports\";\nimport PrintCenter from \"@/pages/print\";\nimport Settings from \"@/pages/settings\";\nimport Weighing from \"@/pages/weighing\";\nimport VendorReturns from \"@/pages/vendor-returns\";\n\nfunction Router() {\n  return (\n    <Switch>\n      <Route path=\"/\" component={Dashboard} />\n      <Route path=\"/sell\" component={Sell} />\n      <Route path=\"/vendors\" component={Vendors} />\n      <Route path=\"/customers\" component={Customers} />\n      <Route path=\"/vehicles\" component={Vehicles} />\n      <Route path=\"/products\" component={Products} />\n      <Route path=\"/stock\" component={Stock} />\n      <Route path=\"/purchases\" component={Purchases} />\n      <Route path=\"/vendor-returns\" component={VendorReturns} />\n      <Route path=\"/weighing\" component={Weighing} />\n      <Route path=\"/payments\" component={Payments} />\n      <Route path=\"/reports\" component={Reports} />\n      <Route path=\"/print\" component={PrintCenter} />\n      <Route path=\"/settings\" component={Settings} />\n      <Route component={NotFound} />\n    </Switch>\n  );\n}\n\nfunction App() {\n  const style = {\n    \"--sidebar-width\": \"16rem\",\n    \"--sidebar-width-icon\": \"3rem\",\n  };\n\n  return (\n    <QueryClientProvider client={queryClient}>\n      <TooltipProvider>\n        <SidebarProvider style={style as React.CSSProperties}>\n          <div className=\"flex h-screen w-full\">\n            <AppSidebar />\n            <div className=\"flex flex-col flex-1 overflow-hidden\">\n              <header className=\"flex items-center justify-between gap-2 p-2 border-b h-14 flex-shrink-0\">\n                <SidebarTrigger data-testid=\"button-sidebar-toggle\" />\n                <ThemeToggle />\n              </header>\n              <main className=\"flex-1 overflow-auto\">\n                <Router />\n              </main>\n            </div>\n          </div>\n        </SidebarProvider>\n        <Toaster />\n      </TooltipProvider>\n    </QueryClientProvider>\n  );\n}\n\nexport default App;\n","path":null,"size_bytes":2809,"size_tokens":null},"client/src/components/ui/select.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SelectPrimitive from \"@radix-ui/react-select\"\nimport { Check, ChevronDown, ChevronUp } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Select = SelectPrimitive.Root\n\nconst SelectGroup = SelectPrimitive.Group\n\nconst SelectValue = SelectPrimitive.Value\n\nconst SelectTrigger = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex h-9 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <SelectPrimitive.Icon asChild>\n      <ChevronDown className=\"h-4 w-4 opacity-50\" />\n    </SelectPrimitive.Icon>\n  </SelectPrimitive.Trigger>\n))\nSelectTrigger.displayName = SelectPrimitive.Trigger.displayName\n\nconst SelectScrollUpButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollUpButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronUp className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollUpButton>\n))\nSelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName\n\nconst SelectScrollDownButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollDownButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronDown className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollDownButton>\n))\nSelectScrollDownButton.displayName =\n  SelectPrimitive.ScrollDownButton.displayName\n\nconst SelectContent = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>\n>(({ className, children, position = \"popper\", ...props }, ref) => (\n  <SelectPrimitive.Portal>\n    <SelectPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]\",\n        position === \"popper\" &&\n          \"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1\",\n        className\n      )}\n      position={position}\n      {...props}\n    >\n      <SelectScrollUpButton />\n      <SelectPrimitive.Viewport\n        className={cn(\n          \"p-1\",\n          position === \"popper\" &&\n            \"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]\"\n        )}\n      >\n        {children}\n      </SelectPrimitive.Viewport>\n      <SelectScrollDownButton />\n    </SelectPrimitive.Content>\n  </SelectPrimitive.Portal>\n))\nSelectContent.displayName = SelectPrimitive.Content.displayName\n\nconst SelectLabel = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Label\n    ref={ref}\n    className={cn(\"py-1.5 pl-8 pr-2 text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nSelectLabel.displayName = SelectPrimitive.Label.displayName\n\nconst SelectItem = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <SelectPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </SelectPrimitive.ItemIndicator>\n    </span>\n\n    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>\n  </SelectPrimitive.Item>\n))\nSelectItem.displayName = SelectPrimitive.Item.displayName\n\nconst SelectSeparator = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nSelectSeparator.displayName = SelectPrimitive.Separator.displayName\n\nexport {\n  Select,\n  SelectGroup,\n  SelectValue,\n  SelectTrigger,\n  SelectContent,\n  SelectLabel,\n  SelectItem,\n  SelectSeparator,\n  SelectScrollUpButton,\n  SelectScrollDownButton,\n}\n","path":null,"size_bytes":5741,"size_tokens":null},"client/src/components/ui/dropdown-menu.tsx":{"content":"import * as React from \"react\"\nimport * as DropdownMenuPrimitive from \"@radix-ui/react-dropdown-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst DropdownMenu = DropdownMenuPrimitive.Root\n\nconst DropdownMenuTrigger = DropdownMenuPrimitive.Trigger\n\nconst DropdownMenuGroup = DropdownMenuPrimitive.Group\n\nconst DropdownMenuPortal = DropdownMenuPrimitive.Portal\n\nconst DropdownMenuSub = DropdownMenuPrimitive.Sub\n\nconst DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup\n\nconst DropdownMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto\" />\n  </DropdownMenuPrimitive.SubTrigger>\n))\nDropdownMenuSubTrigger.displayName =\n  DropdownMenuPrimitive.SubTrigger.displayName\n\nconst DropdownMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuSubContent.displayName =\n  DropdownMenuPrimitive.SubContent.displayName\n\nconst DropdownMenuContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <DropdownMenuPrimitive.Portal>\n    <DropdownMenuPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </DropdownMenuPrimitive.Portal>\n))\nDropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName\n\nconst DropdownMenuItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName\n\nconst DropdownMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <DropdownMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.CheckboxItem>\n))\nDropdownMenuCheckboxItem.displayName =\n  DropdownMenuPrimitive.CheckboxItem.displayName\n\nconst DropdownMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.RadioItem>\n))\nDropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName\n\nconst DropdownMenuLabel = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName\n\nconst DropdownMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nDropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName\n\nconst DropdownMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\"ml-auto text-xs tracking-widest opacity-60\", className)}\n      {...props}\n    />\n  )\n}\nDropdownMenuShortcut.displayName = \"DropdownMenuShortcut\"\n\nexport {\n  DropdownMenu,\n  DropdownMenuTrigger,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuCheckboxItem,\n  DropdownMenuRadioItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuShortcut,\n  DropdownMenuGroup,\n  DropdownMenuPortal,\n  DropdownMenuSub,\n  DropdownMenuSubContent,\n  DropdownMenuSubTrigger,\n  DropdownMenuRadioGroup,\n}\n","path":null,"size_bytes":7609,"size_tokens":null},"server/storage.ts":{"content":"import {\n  type User,\n  type UpsertUser,\n  type Vendor,\n  type InsertVendor,\n  type Customer,\n  type InsertCustomer,\n  type Vehicle,\n  type InsertVehicle,\n  type Product,\n  type InsertProduct,\n  type Purchase,\n  type InsertPurchase,\n  type PurchaseItem,\n  type InsertPurchaseItem,\n  type Invoice,\n  type InsertInvoice,\n  type InvoiceItem,\n  type InsertInvoiceItem,\n  type StockMovement,\n  type InsertStockMovement,\n  type VendorPayment,\n  type InsertVendorPayment,\n  type CustomerPayment,\n  type InsertCustomerPayment,\n  type CompanySettings,\n  type InsertCompanySettings,\n  type VehicleInventory,\n  type InsertVehicleInventory,\n  type VehicleInventoryMovement,\n  type InsertVehicleInventoryMovement,\n  type VendorReturn,\n  type InsertVendorReturn,\n  type VendorReturnItem,\n  type InsertVendorReturnItem,\n  type HamaliCashPayment,\n  type InsertHamaliCashPayment,\n  vendors,\n  customers,\n  vehicles,\n  products,\n  purchases,\n  purchaseItems,\n  invoices,\n  invoiceItems,\n  stockMovements,\n  vendorPayments,\n  customerPayments,\n  companySettings,\n  vehicleInventory,\n  vehicleInventoryMovements,\n  vendorReturns,\n  vendorReturnItems,\n  hamaliCashPayments,\n  users,\n} from \"@shared/schema\";\nimport { db } from \"./db\";\nimport { eq, and, gte, lte, sql } from \"drizzle-orm\";\n\nexport interface IStorage {\n  getUser(id: string): Promise<User | undefined>;\n  upsertUser(user: UpsertUser): Promise<User>;\n\n  getVendors(): Promise<Vendor[]>;\n  getVendor(id: string): Promise<Vendor | undefined>;\n  createVendor(vendor: InsertVendor): Promise<Vendor>;\n  updateVendor(id: string, vendor: Partial<InsertVendor>): Promise<Vendor | undefined>;\n  deleteVendor(id: string): Promise<boolean>;\n\n  getCustomers(): Promise<Customer[]>;\n  getCustomer(id: string): Promise<Customer | undefined>;\n  createCustomer(customer: InsertCustomer): Promise<Customer>;\n  updateCustomer(id: string, customer: Partial<InsertCustomer>): Promise<Customer | undefined>;\n  deleteCustomer(id: string): Promise<boolean>;\n\n  getVehicles(): Promise<Vehicle[]>;\n  getVehicle(id: string): Promise<Vehicle | undefined>;\n  createVehicle(vehicle: InsertVehicle): Promise<Vehicle>;\n  updateVehicle(id: string, vehicle: Partial<InsertVehicle>): Promise<Vehicle | undefined>;\n  deleteVehicle(id: string): Promise<boolean>;\n\n  getProducts(): Promise<Product[]>;\n  getProduct(id: string): Promise<Product | undefined>;\n  createProduct(product: InsertProduct): Promise<Product>;\n  updateProduct(id: string, product: Partial<InsertProduct>): Promise<Product | undefined>;\n  deleteProduct(id: string): Promise<boolean>;\n  updateProductStock(id: string, quantity: number, type: 'in' | 'out'): Promise<Product | undefined>;\n\n  getPurchases(): Promise<Purchase[]>;\n  getPurchase(id: string): Promise<Purchase | undefined>;\n  createPurchase(purchase: InsertPurchase, items: InsertPurchaseItem[]): Promise<Purchase>;\n  getPurchaseItems(purchaseId: string): Promise<PurchaseItem[]>;\n\n  getInvoices(): Promise<Invoice[]>;\n  getInvoice(id: string): Promise<Invoice | undefined>;\n  getInvoicesByCustomer(customerId: string): Promise<Invoice[]>;\n  createInvoice(invoice: InsertInvoice, items: InsertInvoiceItem[]): Promise<Invoice>;\n  updateInvoice(id: string, updates: Partial<InsertInvoice>): Promise<Invoice | undefined>;\n  updateInvoiceItem(id: string, updates: { quantity?: number; unitPrice?: number; total?: number }): Promise<InvoiceItem | undefined>;\n  getInvoiceItems(invoiceId: string): Promise<InvoiceItem[]>;\n\n  getStockMovements(startDate?: string, endDate?: string): Promise<StockMovement[]>;\n  createStockMovement(movement: InsertStockMovement): Promise<StockMovement>;\n\n  getVendorPayments(vendorId?: string): Promise<VendorPayment[]>;\n  createVendorPayment(payment: InsertVendorPayment): Promise<VendorPayment>;\n  getVendorBalance(vendorId: string): Promise<{ totalPurchases: number; totalPayments: number; totalReturns: number; balance: number }>;\n\n  getCustomerPayments(customerId?: string): Promise<CustomerPayment[]>;\n  createCustomerPayment(payment: InsertCustomerPayment): Promise<CustomerPayment>;\n  getCustomerBalance(customerId: string): Promise<{ totalInvoices: number; totalPayments: number; balance: number }>;\n\n  getCompanySettings(): Promise<CompanySettings | undefined>;\n  upsertCompanySettings(settings: InsertCompanySettings): Promise<CompanySettings>;\n\n  // Vehicle Inventory\n  getVehicleInventory(vehicleId: string): Promise<VehicleInventory[]>;\n  getAllVehicleInventories(): Promise<VehicleInventory[]>;\n  loadVehicleInventory(vehicleId: string, productId: string, quantity: number, purchaseId?: string): Promise<VehicleInventory>;\n  deductVehicleInventory(vehicleId: string, productId: string, quantity: number, invoiceId?: string): Promise<VehicleInventory | undefined>;\n  getVehicleInventoryMovements(vehicleId: string): Promise<VehicleInventoryMovement[]>;\n  getAllVehicleInventoryMovements(): Promise<VehicleInventoryMovement[]>;\n\n  // Vendor Returns\n  getVendorReturns(vendorId?: string): Promise<VendorReturn[]>;\n  getVendorReturn(id: string): Promise<VendorReturn | undefined>;\n  createVendorReturn(vendorReturn: InsertVendorReturn, items: InsertVendorReturnItem[]): Promise<VendorReturn>;\n  getVendorReturnItems(returnId: string): Promise<VendorReturnItem[]>;\n\n  // Hamali Cash Payments\n  getHamaliCashPayments(): Promise<HamaliCashPayment[]>;\n  createHamaliCashPayment(payment: InsertHamaliCashPayment): Promise<HamaliCashPayment>;\n  deleteHamaliCashPayment(id: string): Promise<boolean>;\n}\n\nexport class DatabaseStorage implements IStorage {\n  async getUser(id: string): Promise<User | undefined> {\n    const [user] = await db.select().from(users).where(eq(users.id, id));\n    return user || undefined;\n  }\n\n  async upsertUser(userData: UpsertUser): Promise<User> {\n    const [user] = await db\n      .insert(users)\n      .values(userData)\n      .onConflictDoUpdate({\n        target: users.id,\n        set: {\n          ...userData,\n          updatedAt: new Date(),\n        },\n      })\n      .returning();\n    return user;\n  }\n\n  async getVendors(): Promise<Vendor[]> {\n    return await db.select().from(vendors);\n  }\n\n  async getVendor(id: string): Promise<Vendor | undefined> {\n    const [vendor] = await db.select().from(vendors).where(eq(vendors.id, id));\n    return vendor || undefined;\n  }\n\n  async createVendor(insertVendor: InsertVendor): Promise<Vendor> {\n    const [vendor] = await db.insert(vendors).values(insertVendor).returning();\n    return vendor;\n  }\n\n  async updateVendor(id: string, updates: Partial<InsertVendor>): Promise<Vendor | undefined> {\n    const [vendor] = await db.update(vendors).set(updates).where(eq(vendors.id, id)).returning();\n    return vendor || undefined;\n  }\n\n  async deleteVendor(id: string): Promise<boolean> {\n    const result = await db.delete(vendors).where(eq(vendors.id, id)).returning();\n    return result.length > 0;\n  }\n\n  async getCustomers(): Promise<Customer[]> {\n    return await db.select().from(customers);\n  }\n\n  async getCustomer(id: string): Promise<Customer | undefined> {\n    const [customer] = await db.select().from(customers).where(eq(customers.id, id));\n    return customer || undefined;\n  }\n\n  async createCustomer(insertCustomer: InsertCustomer): Promise<Customer> {\n    const [customer] = await db.insert(customers).values(insertCustomer).returning();\n    return customer;\n  }\n\n  async updateCustomer(id: string, updates: Partial<InsertCustomer>): Promise<Customer | undefined> {\n    const [customer] = await db.update(customers).set(updates).where(eq(customers.id, id)).returning();\n    return customer || undefined;\n  }\n\n  async deleteCustomer(id: string): Promise<boolean> {\n    const result = await db.delete(customers).where(eq(customers.id, id)).returning();\n    return result.length > 0;\n  }\n\n  async getVehicles(): Promise<Vehicle[]> {\n    return await db.select().from(vehicles);\n  }\n\n  async getVehicle(id: string): Promise<Vehicle | undefined> {\n    const [vehicle] = await db.select().from(vehicles).where(eq(vehicles.id, id));\n    return vehicle || undefined;\n  }\n\n  async createVehicle(insertVehicle: InsertVehicle): Promise<Vehicle> {\n    const [vehicle] = await db.insert(vehicles).values(insertVehicle).returning();\n    return vehicle;\n  }\n\n  async updateVehicle(id: string, updates: Partial<InsertVehicle>): Promise<Vehicle | undefined> {\n    const [vehicle] = await db.update(vehicles).set(updates).where(eq(vehicles.id, id)).returning();\n    return vehicle || undefined;\n  }\n\n  async deleteVehicle(id: string): Promise<boolean> {\n    const result = await db.delete(vehicles).where(eq(vehicles.id, id)).returning();\n    return result.length > 0;\n  }\n\n  async getProducts(): Promise<Product[]> {\n    return await db.select().from(products);\n  }\n\n  async getProduct(id: string): Promise<Product | undefined> {\n    const [product] = await db.select().from(products).where(eq(products.id, id));\n    return product || undefined;\n  }\n\n  async createProduct(insertProduct: InsertProduct): Promise<Product> {\n    const [product] = await db.insert(products).values({\n      ...insertProduct,\n      currentStock: insertProduct.currentStock ?? 0,\n      reorderLevel: insertProduct.reorderLevel ?? 10,\n    }).returning();\n    return product;\n  }\n\n  async updateProduct(id: string, updates: Partial<InsertProduct>): Promise<Product | undefined> {\n    const [product] = await db.update(products).set(updates).where(eq(products.id, id)).returning();\n    return product || undefined;\n  }\n\n  async deleteProduct(id: string): Promise<boolean> {\n    const result = await db.delete(products).where(eq(products.id, id)).returning();\n    return result.length > 0;\n  }\n\n  async updateProductStock(id: string, quantity: number, type: 'in' | 'out'): Promise<Product | undefined> {\n    const product = await this.getProduct(id);\n    if (!product) return undefined;\n\n    const newStock = type === 'in'\n      ? product.currentStock + quantity\n      : product.currentStock - quantity;\n\n    const [updated] = await db.update(products)\n      .set({ currentStock: Math.max(0, newStock) })\n      .where(eq(products.id, id))\n      .returning();\n    return updated || undefined;\n  }\n\n  async getPurchases(): Promise<Purchase[]> {\n    return await db.select().from(purchases);\n  }\n\n  async getPurchase(id: string): Promise<Purchase | undefined> {\n    const [purchase] = await db.select().from(purchases).where(eq(purchases.id, id));\n    return purchase || undefined;\n  }\n\n  async createPurchase(insertPurchase: InsertPurchase, items: InsertPurchaseItem[]): Promise<Purchase> {\n    const [purchase] = await db.insert(purchases).values({\n      ...insertPurchase,\n      status: insertPurchase.status ?? \"completed\",\n    }).returning();\n\n    for (const item of items) {\n      await db.insert(purchaseItems).values({\n        ...item,\n        purchaseId: purchase.id,\n      });\n\n      // Only update product stock if no vehicle is specified\n      // When vehicle is specified, loadVehicleInventory handles stock update\n      if (!insertPurchase.vehicleId) {\n        await this.updateProductStock(item.productId, item.quantity, 'in');\n      }\n\n      await db.insert(stockMovements).values({\n        productId: item.productId,\n        type: 'in',\n        quantity: item.quantity,\n        reason: `Purchase order ${purchase.id.slice(0, 8)}`,\n        date: insertPurchase.date,\n        referenceId: purchase.id,\n      });\n\n      // Load products into vehicle inventory if a vehicle is specified\n      if (insertPurchase.vehicleId) {\n        await this.loadVehicleInventory(\n          insertPurchase.vehicleId,\n          item.productId,\n          item.quantity,\n          purchase.id\n        );\n      }\n    }\n\n    return purchase;\n  }\n\n  async getPurchaseItems(purchaseId: string): Promise<PurchaseItem[]> {\n    return await db.select().from(purchaseItems).where(eq(purchaseItems.purchaseId, purchaseId));\n  }\n\n  async getInvoices(): Promise<Invoice[]> {\n    return await db.select().from(invoices);\n  }\n\n  async getInvoice(id: string): Promise<Invoice | undefined> {\n    const [invoice] = await db.select().from(invoices).where(eq(invoices.id, id));\n    return invoice || undefined;\n  }\n\n  async createInvoice(insertInvoice: InsertInvoice, items: InsertInvoiceItem[]): Promise<Invoice> {\n    const [invoice] = await db.insert(invoices).values({\n      ...insertInvoice,\n      status: insertInvoice.status ?? \"completed\",\n      hamaliRatePerKg: insertInvoice.hamaliRatePerKg ?? 2,\n      hamaliChargeAmount: insertInvoice.hamaliChargeAmount ?? 0,\n      hamaliPaidByCash: insertInvoice.hamaliPaidByCash ?? false,\n      totalKgWeight: insertInvoice.totalKgWeight ?? 0,\n    }).returning();\n\n    for (const item of items) {\n      await db.insert(invoiceItems).values({\n        ...item,\n        invoiceId: invoice.id,\n      });\n\n      // Only update product stock if no vehicle is specified\n      // When vehicle is specified, deductVehicleInventory handles stock update\n      if (!insertInvoice.vehicleId) {\n        await this.updateProductStock(item.productId, item.quantity, 'out');\n      }\n\n      await db.insert(stockMovements).values({\n        productId: item.productId,\n        type: 'out',\n        quantity: item.quantity,\n        reason: `Invoice ${insertInvoice.invoiceNumber}`,\n        date: insertInvoice.date,\n        referenceId: invoice.id,\n      });\n\n      // Deduct from vehicle inventory if a vehicle is specified\n      if (insertInvoice.vehicleId) {\n        const deductResult = await this.deductVehicleInventory(\n          insertInvoice.vehicleId,\n          item.productId,\n          item.quantity,\n          invoice.id\n        );\n        // Log warning if deduction failed (insufficient stock), but don't block invoice creation\n        // as vehicle inventory is a convenience feature, not a hard constraint\n        if (!deductResult) {\n          console.warn(`Failed to deduct ${item.quantity} of product ${item.productId} from vehicle ${insertInvoice.vehicleId}`);\n        }\n      }\n    }\n\n    // Auto-create hamali cash payment if paid by cash\n    if (insertInvoice.includeHamaliCharge && insertInvoice.hamaliPaidByCash && invoice.hamaliChargeAmount && invoice.hamaliChargeAmount > 0) {\n      await db.insert(hamaliCashPayments).values({\n        amount: invoice.hamaliChargeAmount,\n        date: insertInvoice.date,\n        paymentMethod: \"cash\",\n        customerId: insertInvoice.customerId,\n        invoiceId: invoice.id,\n        invoiceNumber: insertInvoice.invoiceNumber,\n        totalBillAmount: invoice.grandTotal,\n        notes: `Auto-recorded from Invoice ${insertInvoice.invoiceNumber}`,\n      });\n    }\n\n    return invoice;\n  }\n\n  async getInvoiceItems(invoiceId: string): Promise<InvoiceItem[]> {\n    return await db.select().from(invoiceItems).where(eq(invoiceItems.invoiceId, invoiceId));\n  }\n\n  async getInvoicesByCustomer(customerId: string): Promise<Invoice[]> {\n    return await db.select().from(invoices).where(eq(invoices.customerId, customerId));\n  }\n\n  async updateInvoice(id: string, updates: Partial<InsertInvoice>): Promise<Invoice | undefined> {\n    const [invoice] = await db.update(invoices).set(updates).where(eq(invoices.id, id)).returning();\n    return invoice || undefined;\n  }\n\n  async updateInvoiceItem(id: string, updates: { quantity?: number; unitPrice?: number; total?: number }): Promise<InvoiceItem | undefined> {\n    const [item] = await db.update(invoiceItems).set(updates).where(eq(invoiceItems.id, id)).returning();\n    return item || undefined;\n  }\n\n  async getStockMovements(startDate?: string, endDate?: string): Promise<StockMovement[]> {\n    if (startDate && endDate) {\n      return await db.select().from(stockMovements)\n        .where(and(gte(stockMovements.date, startDate), lte(stockMovements.date, endDate)));\n    }\n    return await db.select().from(stockMovements);\n  }\n\n  async createStockMovement(insertMovement: InsertStockMovement): Promise<StockMovement> {\n    const [movement] = await db.insert(stockMovements).values(insertMovement).returning();\n    await this.updateProductStock(insertMovement.productId, insertMovement.quantity, insertMovement.type as 'in' | 'out');\n    return movement;\n  }\n\n  async getVendorPayments(vendorId?: string): Promise<VendorPayment[]> {\n    if (vendorId) {\n      return await db.select().from(vendorPayments).where(eq(vendorPayments.vendorId, vendorId));\n    }\n    return await db.select().from(vendorPayments);\n  }\n\n  async createVendorPayment(insertPayment: InsertVendorPayment): Promise<VendorPayment> {\n    const [payment] = await db.insert(vendorPayments).values(insertPayment).returning();\n    return payment;\n  }\n\n  async getVendorBalance(vendorId: string): Promise<{ totalPurchases: number; totalPayments: number; totalReturns: number; balance: number }> {\n    const purchaseResult = await db.select({ total: sql<number>`COALESCE(SUM(${purchases.totalAmount}), 0)` })\n      .from(purchases)\n      .where(eq(purchases.vendorId, vendorId));\n    \n    const paymentResult = await db.select({ total: sql<number>`COALESCE(SUM(${vendorPayments.amount}), 0)` })\n      .from(vendorPayments)\n      .where(eq(vendorPayments.vendorId, vendorId));\n\n    const returnResult = await db.select({ total: sql<number>`COALESCE(SUM(${vendorReturns.totalAmount}), 0)` })\n      .from(vendorReturns)\n      .where(eq(vendorReturns.vendorId, vendorId));\n\n    const totalPurchases = Number(purchaseResult[0]?.total || 0);\n    const totalPayments = Number(paymentResult[0]?.total || 0);\n    const totalReturns = Number(returnResult[0]?.total || 0);\n\n    return {\n      totalPurchases,\n      totalPayments,\n      totalReturns,\n      balance: totalPurchases - totalPayments - totalReturns,\n    };\n  }\n\n  async getCustomerPayments(customerId?: string): Promise<CustomerPayment[]> {\n    if (customerId) {\n      return await db.select().from(customerPayments).where(eq(customerPayments.customerId, customerId));\n    }\n    return await db.select().from(customerPayments);\n  }\n\n  async createCustomerPayment(insertPayment: InsertCustomerPayment): Promise<CustomerPayment> {\n    const [payment] = await db.insert(customerPayments).values(insertPayment).returning();\n    return payment;\n  }\n\n  async getCustomerBalance(customerId: string): Promise<{ totalInvoices: number; totalPayments: number; balance: number }> {\n    const invoiceResult = await db.select({ total: sql<number>`COALESCE(SUM(${invoices.grandTotal}), 0)` })\n      .from(invoices)\n      .where(eq(invoices.customerId, customerId));\n    \n    const paymentResult = await db.select({ total: sql<number>`COALESCE(SUM(${customerPayments.amount}), 0)` })\n      .from(customerPayments)\n      .where(eq(customerPayments.customerId, customerId));\n\n    const totalInvoices = Number(invoiceResult[0]?.total || 0);\n    const totalPayments = Number(paymentResult[0]?.total || 0);\n\n    return {\n      totalInvoices,\n      totalPayments,\n      balance: totalInvoices - totalPayments,\n    };\n  }\n\n  async getCompanySettings(): Promise<CompanySettings | undefined> {\n    const [settings] = await db.select().from(companySettings).limit(1);\n    return settings || undefined;\n  }\n\n  async upsertCompanySettings(insertSettings: InsertCompanySettings): Promise<CompanySettings> {\n    const existing = await this.getCompanySettings();\n    if (existing) {\n      const [updated] = await db.update(companySettings).set(insertSettings).where(eq(companySettings.id, existing.id)).returning();\n      return updated;\n    }\n    const [created] = await db.insert(companySettings).values(insertSettings).returning();\n    return created;\n  }\n\n  // Vehicle Inventory Methods\n  async getVehicleInventory(vehicleId: string): Promise<VehicleInventory[]> {\n    return await db.select().from(vehicleInventory).where(eq(vehicleInventory.vehicleId, vehicleId));\n  }\n\n  async getAllVehicleInventories(): Promise<VehicleInventory[]> {\n    return await db.select().from(vehicleInventory);\n  }\n\n  async getVehicleProductInventory(vehicleId: string, productId: string): Promise<VehicleInventory | undefined> {\n    // Get total quantity for this vehicle+product combination (aggregate all matching rows)\n    const records = await db.select().from(vehicleInventory)\n      .where(and(eq(vehicleInventory.vehicleId, vehicleId), eq(vehicleInventory.productId, productId)));\n    \n    if (records.length === 0) return undefined;\n    \n    // Return first record - we'll ensure only one exists via upsert logic\n    return records[0];\n  }\n\n  async loadVehicleInventory(vehicleId: string, productId: string, quantity: number, purchaseId?: string): Promise<VehicleInventory> {\n    // Check if inventory record exists for this vehicle+product\n    const [existing] = await db.select().from(vehicleInventory)\n      .where(and(eq(vehicleInventory.vehicleId, vehicleId), eq(vehicleInventory.productId, productId)));\n\n    let inventoryRecord: VehicleInventory;\n    \n    if (existing) {\n      // Update existing inventory (upsert pattern)\n      const [updated] = await db.update(vehicleInventory)\n        .set({ quantity: existing.quantity + quantity })\n        .where(and(eq(vehicleInventory.vehicleId, vehicleId), eq(vehicleInventory.productId, productId)))\n        .returning();\n      inventoryRecord = updated;\n    } else {\n      // Create new inventory record\n      const [created] = await db.insert(vehicleInventory)\n        .values({ vehicleId, productId, quantity })\n        .returning();\n      inventoryRecord = created;\n    }\n\n    // Update product's currentStock (increase when loading onto vehicle)\n    await this.updateProductStock(productId, quantity, 'in');\n\n    // Log the movement\n    const today = new Date().toISOString().split(\"T\")[0];\n    await db.insert(vehicleInventoryMovements).values({\n      vehicleId,\n      productId,\n      type: 'load',\n      quantity,\n      referenceId: purchaseId,\n      referenceType: purchaseId ? 'purchase' : undefined,\n      date: today,\n    });\n\n    return inventoryRecord;\n  }\n\n  async deductVehicleInventory(vehicleId: string, productId: string, quantity: number, invoiceId?: string): Promise<VehicleInventory | undefined> {\n    // Find existing inventory\n    const [existing] = await db.select().from(vehicleInventory)\n      .where(and(eq(vehicleInventory.vehicleId, vehicleId), eq(vehicleInventory.productId, productId)));\n\n    // Guard against insufficient stock - return undefined if not enough\n    if (!existing) {\n      console.warn(`Vehicle ${vehicleId} has no inventory for product ${productId}`);\n      return undefined;\n    }\n    \n    if (existing.quantity < quantity) {\n      console.warn(`Insufficient stock: Vehicle ${vehicleId} has ${existing.quantity} but requested ${quantity}`);\n      return undefined;\n    }\n\n    const newQuantity = Math.max(0, existing.quantity - quantity);\n    \n    const [updated] = await db.update(vehicleInventory)\n      .set({ quantity: newQuantity })\n      .where(and(eq(vehicleInventory.vehicleId, vehicleId), eq(vehicleInventory.productId, productId)))\n      .returning();\n\n    // Update product's currentStock (decrease when selling)\n    await this.updateProductStock(productId, quantity, 'out');\n\n    // Log the movement\n    const today = new Date().toISOString().split(\"T\")[0];\n    await db.insert(vehicleInventoryMovements).values({\n      vehicleId,\n      productId,\n      type: 'sale',\n      quantity,\n      referenceId: invoiceId,\n      referenceType: invoiceId ? 'invoice' : undefined,\n      date: today,\n    });\n\n    return updated;\n  }\n\n  async getVehicleInventoryMovements(vehicleId: string): Promise<VehicleInventoryMovement[]> {\n    return await db.select().from(vehicleInventoryMovements).where(eq(vehicleInventoryMovements.vehicleId, vehicleId));\n  }\n\n  async getAllVehicleInventoryMovements(): Promise<VehicleInventoryMovement[]> {\n    return await db.select().from(vehicleInventoryMovements);\n  }\n\n  // Vendor Returns Methods\n  async getVendorReturns(vendorId?: string): Promise<VendorReturn[]> {\n    if (vendorId) {\n      return await db.select().from(vendorReturns).where(eq(vendorReturns.vendorId, vendorId));\n    }\n    return await db.select().from(vendorReturns);\n  }\n\n  async getVendorReturn(id: string): Promise<VendorReturn | undefined> {\n    const [vendorReturn] = await db.select().from(vendorReturns).where(eq(vendorReturns.id, id));\n    return vendorReturn || undefined;\n  }\n\n  async createVendorReturn(insertVendorReturn: InsertVendorReturn, items: InsertVendorReturnItem[]): Promise<VendorReturn> {\n    const [vendorReturn] = await db.insert(vendorReturns).values({\n      ...insertVendorReturn,\n      status: insertVendorReturn.status ?? \"completed\",\n    }).returning();\n\n    for (const item of items) {\n      await db.insert(vendorReturnItems).values({\n        ...item,\n        returnId: vendorReturn.id,\n      });\n\n      // Deduct stock when returning to vendor (stock goes out)\n      await this.updateProductStock(item.productId, item.quantity, 'out');\n\n      // Record stock movement\n      await db.insert(stockMovements).values({\n        productId: item.productId,\n        type: 'out',\n        quantity: item.quantity,\n        reason: `Vendor return: ${item.reason}`,\n        date: insertVendorReturn.date,\n        referenceId: vendorReturn.id,\n      });\n\n      // If vehicle is specified, also deduct from vehicle inventory\n      if (insertVendorReturn.vehicleId) {\n        await this.deductVehicleInventory(\n          insertVendorReturn.vehicleId,\n          item.productId,\n          item.quantity,\n          vendorReturn.id\n        );\n      }\n    }\n\n    return vendorReturn;\n  }\n\n  async getVendorReturnItems(returnId: string): Promise<VendorReturnItem[]> {\n    return await db.select().from(vendorReturnItems).where(eq(vendorReturnItems.returnId, returnId));\n  }\n\n  // Hamali Cash Payments\n  async getHamaliCashPayments(): Promise<HamaliCashPayment[]> {\n    return await db.select().from(hamaliCashPayments);\n  }\n\n  async createHamaliCashPayment(insertPayment: InsertHamaliCashPayment): Promise<HamaliCashPayment> {\n    const [payment] = await db.insert(hamaliCashPayments).values(insertPayment).returning();\n    return payment;\n  }\n\n  async deleteHamaliCashPayment(id: string): Promise<boolean> {\n    const result = await db.delete(hamaliCashPayments).where(eq(hamaliCashPayments.id, id)).returning();\n    return result.length > 0;\n  }\n}\n\nexport const storage = new DatabaseStorage();\n","path":null,"size_bytes":26222,"size_tokens":null},"client/src/components/ui/drawer.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Drawer as DrawerPrimitive } from \"vaul\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Drawer = ({\n  shouldScaleBackground = true,\n  ...props\n}: React.ComponentProps<typeof DrawerPrimitive.Root>) => (\n  <DrawerPrimitive.Root\n    shouldScaleBackground={shouldScaleBackground}\n    {...props}\n  />\n)\nDrawer.displayName = \"Drawer\"\n\nconst DrawerTrigger = DrawerPrimitive.Trigger\n\nconst DrawerPortal = DrawerPrimitive.Portal\n\nconst DrawerClose = DrawerPrimitive.Close\n\nconst DrawerOverlay = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Overlay\n    ref={ref}\n    className={cn(\"fixed inset-0 z-50 bg-black/80\", className)}\n    {...props}\n  />\n))\nDrawerOverlay.displayName = DrawerPrimitive.Overlay.displayName\n\nconst DrawerContent = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DrawerPortal>\n    <DrawerOverlay />\n    <DrawerPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background\",\n        className\n      )}\n      {...props}\n    >\n      <div className=\"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted\" />\n      {children}\n    </DrawerPrimitive.Content>\n  </DrawerPortal>\n))\nDrawerContent.displayName = \"DrawerContent\"\n\nconst DrawerHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"grid gap-1.5 p-4 text-center sm:text-left\", className)}\n    {...props}\n  />\n)\nDrawerHeader.displayName = \"DrawerHeader\"\n\nconst DrawerFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"mt-auto flex flex-col gap-2 p-4\", className)}\n    {...props}\n  />\n)\nDrawerFooter.displayName = \"DrawerFooter\"\n\nconst DrawerTitle = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDrawerTitle.displayName = DrawerPrimitive.Title.displayName\n\nconst DrawerDescription = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDrawerDescription.displayName = DrawerPrimitive.Description.displayName\n\nexport {\n  Drawer,\n  DrawerPortal,\n  DrawerOverlay,\n  DrawerTrigger,\n  DrawerClose,\n  DrawerContent,\n  DrawerHeader,\n  DrawerFooter,\n  DrawerTitle,\n  DrawerDescription,\n}\n","path":null,"size_bytes":3021,"size_tokens":null},"client/src/pages/vendor-returns.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useForm } from \"react-hook-form\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Badge } from \"@/components/ui/badge\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport {\n  Form,\n  FormControl,\n  FormField,\n  FormItem,\n  FormLabel,\n  FormMessage,\n} from \"@/components/ui/form\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport {\n  Plus,\n  Search,\n  RotateCcw,\n  Trash2,\n  X,\n  AlertTriangle,\n} from \"lucide-react\";\nimport type { Vendor, Vehicle, Product, VendorReturn } from \"@shared/schema\";\nimport { z } from \"zod\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\n\ninterface ReturnLineItem {\n  productId: string;\n  productName: string;\n  quantity: number;\n  unitPrice: number;\n  total: number;\n  reason: string;\n}\n\nconst RETURN_REASONS = [\n  \"Damaged\",\n  \"Rotten/Spoiled\",\n  \"Wrong Item\",\n  \"Quality Issue\",\n  \"Excess Stock\",\n  \"Other\",\n];\n\nconst returnFormSchema = z.object({\n  vendorId: z.string().min(1, \"Please select a vendor\"),\n  vehicleId: z.string().optional(),\n  date: z.string().min(1, \"Please select a date\"),\n  notes: z.string().optional(),\n});\n\ntype ReturnFormData = z.infer<typeof returnFormSchema>;\n\nexport default function VendorReturns() {\n  const { toast } = useToast();\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [isDialogOpen, setIsDialogOpen] = useState(false);\n  const [lineItems, setLineItems] = useState<ReturnLineItem[]>([]);\n  const [selectedProduct, setSelectedProduct] = useState(\"\");\n  const [itemQuantity, setItemQuantity] = useState(\"\");\n  const [itemPrice, setItemPrice] = useState(\"\");\n  const [selectedReason, setSelectedReason] = useState(\"\");\n\n  const { data: vendors = [], isLoading: vendorsLoading } = useQuery<Vendor[]>({\n    queryKey: [\"/api/vendors\"],\n  });\n\n  const { data: vehicles = [] } = useQuery<Vehicle[]>({\n    queryKey: [\"/api/vehicles\"],\n  });\n\n  const { data: products = [] } = useQuery<Product[]>({\n    queryKey: [\"/api/products\"],\n  });\n\n  const { data: vendorReturns = [], isLoading: returnsLoading } = useQuery<VendorReturn[]>({\n    queryKey: [\"/api/vendor-returns\"],\n  });\n\n  const form = useForm<ReturnFormData>({\n    resolver: zodResolver(returnFormSchema),\n    defaultValues: {\n      vendorId: \"\",\n      vehicleId: \"\",\n      date: new Date().toISOString().split(\"T\")[0],\n      notes: \"\",\n    },\n  });\n\n  const createMutation = useMutation({\n    mutationFn: async (data: ReturnFormData & { items: ReturnLineItem[] }) => {\n      return apiRequest(\"POST\", \"/api/vendor-returns\", {\n        ...data,\n        vehicleId: data.vehicleId === \"none\" ? undefined : data.vehicleId,\n        totalAmount: data.items.reduce((acc, item) => acc + item.total, 0),\n        items: data.items.map((item) => ({\n          productId: item.productId,\n          quantity: item.quantity,\n          unitPrice: item.unitPrice,\n          total: item.total,\n          reason: item.reason,\n        })),\n      });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/vendor-returns\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/products\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/stock-movements\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/vendors\"] });\n      setIsDialogOpen(false);\n      setLineItems([]);\n      form.reset();\n      toast({ title: \"Vendor return created successfully\" });\n    },\n    onError: () => {\n      toast({ title: \"Failed to create vendor return\", variant: \"destructive\" });\n    },\n  });\n\n  const addLineItem = () => {\n    if (!selectedProduct || !itemQuantity || !itemPrice || !selectedReason) {\n      toast({ title: \"Please fill all item fields including reason\", variant: \"destructive\" });\n      return;\n    }\n\n    const product = products.find((p) => p.id === selectedProduct);\n    if (!product) return;\n\n    const quantity = parseFloat(itemQuantity);\n    const unitPrice = parseFloat(itemPrice);\n\n    if (isNaN(quantity) || isNaN(unitPrice) || quantity <= 0 || unitPrice <= 0) {\n      toast({ title: \"Please enter valid quantity and price\", variant: \"destructive\" });\n      return;\n    }\n\n    if (quantity > product.currentStock) {\n      toast({\n        title: \"Insufficient stock\",\n        description: `Only ${product.currentStock} ${product.unit} available`,\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    setLineItems([\n      ...lineItems,\n      {\n        productId: product.id,\n        productName: product.name,\n        quantity,\n        unitPrice,\n        total: quantity * unitPrice,\n        reason: selectedReason,\n      },\n    ]);\n\n    setSelectedProduct(\"\");\n    setItemQuantity(\"\");\n    setItemPrice(\"\");\n    setSelectedReason(\"\");\n  };\n\n  const removeLineItem = (index: number) => {\n    setLineItems(lineItems.filter((_, i) => i !== index));\n  };\n\n  const totalAmount = lineItems.reduce((acc, item) => acc + item.total, 0);\n\n  const onSubmit = (data: ReturnFormData) => {\n    if (lineItems.length === 0) {\n      toast({ title: \"Please add at least one item\", variant: \"destructive\" });\n      return;\n    }\n\n    createMutation.mutate({ ...data, items: lineItems });\n  };\n\n  const filteredReturns = vendorReturns.filter((ret) => {\n    const vendor = vendors.find((v) => v.id === ret.vendorId);\n    const vendorName = vendor?.name.toLowerCase() || \"\";\n    return vendorName.includes(searchQuery.toLowerCase());\n  });\n\n  const handleProductChange = (productId: string) => {\n    setSelectedProduct(productId);\n    const product = products.find((p) => p.id === productId);\n    if (product) {\n      setItemPrice(product.purchasePrice.toString());\n    }\n  };\n\n  const openDialog = () => {\n    form.reset({\n      vendorId: \"\",\n      vehicleId: \"\",\n      date: new Date().toISOString().split(\"T\")[0],\n      notes: \"\",\n    });\n    setLineItems([]);\n    setIsDialogOpen(true);\n  };\n\n  if (vendorsLoading || returnsLoading) {\n    return (\n      <div className=\"p-6 space-y-6\">\n        <Skeleton className=\"h-10 w-full\" />\n        <Skeleton className=\"h-64 w-full\" />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"p-6 space-y-6\">\n      <div className=\"flex flex-wrap items-center justify-between gap-4\">\n        <div>\n          <h1 className=\"text-2xl font-semibold\">Vendor Returns</h1>\n          <p className=\"text-muted-foreground\">\n            Return defective or unwanted products to vendors\n          </p>\n        </div>\n        <Button onClick={openDialog} data-testid=\"button-create-return\">\n          <Plus className=\"h-4 w-4 mr-2\" />\n          Create Return\n        </Button>\n      </div>\n\n      <Card>\n        <CardHeader>\n          <div className=\"flex flex-wrap items-center justify-between gap-4\">\n            <CardTitle className=\"flex items-center gap-2\">\n              <RotateCcw className=\"h-5 w-5\" />\n              Return History\n            </CardTitle>\n            <div className=\"relative w-64\">\n              <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n              <Input\n                placeholder=\"Search returns...\"\n                className=\"pl-9\"\n                value={searchQuery}\n                onChange={(e) => setSearchQuery(e.target.value)}\n                data-testid=\"input-search-returns\"\n              />\n            </div>\n          </div>\n        </CardHeader>\n        <CardContent>\n          {filteredReturns.length === 0 ? (\n            <div className=\"text-center py-8 text-muted-foreground\">\n              <AlertTriangle className=\"h-12 w-12 mx-auto mb-4 opacity-50\" />\n              <p>No vendor returns found</p>\n              <p className=\"text-sm\">Create a return to get started</p>\n            </div>\n          ) : (\n            <Table>\n              <TableHeader>\n                <TableRow>\n                  <TableHead>Date</TableHead>\n                  <TableHead>Vendor</TableHead>\n                  <TableHead>Vehicle</TableHead>\n                  <TableHead className=\"text-right\">Amount</TableHead>\n                  <TableHead>Status</TableHead>\n                </TableRow>\n              </TableHeader>\n              <TableBody>\n                {filteredReturns.map((ret) => {\n                  const vendor = vendors.find((v) => v.id === ret.vendorId);\n                  const vehicle = vehicles.find((v) => v.id === ret.vehicleId);\n                  return (\n                    <TableRow key={ret.id} data-testid={`row-return-${ret.id}`}>\n                      <TableCell>{ret.date}</TableCell>\n                      <TableCell>{vendor?.name || \"Unknown\"}</TableCell>\n                      <TableCell>{vehicle?.number || \"-\"}</TableCell>\n                      <TableCell className=\"text-right font-mono\">\n                        Rs {ret.totalAmount.toFixed(2)}\n                      </TableCell>\n                      <TableCell>\n                        <Badge variant={ret.status === \"completed\" ? \"default\" : \"secondary\"}>\n                          {ret.status}\n                        </Badge>\n                      </TableCell>\n                    </TableRow>\n                  );\n                })}\n              </TableBody>\n            </Table>\n          )}\n        </CardContent>\n      </Card>\n\n      <Dialog open={isDialogOpen} onOpenChange={setIsDialogOpen}>\n        <DialogContent className=\"max-w-3xl max-h-[90vh] overflow-y-auto\">\n          <DialogHeader>\n            <DialogTitle>Create Vendor Return</DialogTitle>\n          </DialogHeader>\n\n          <Form {...form}>\n            <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-6\">\n              <div className=\"grid grid-cols-2 gap-4\">\n                <FormField\n                  control={form.control}\n                  name=\"vendorId\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Vendor</FormLabel>\n                      <Select onValueChange={field.onChange} value={field.value}>\n                        <FormControl>\n                          <SelectTrigger data-testid=\"select-vendor\">\n                            <SelectValue placeholder=\"Select vendor\" />\n                          </SelectTrigger>\n                        </FormControl>\n                        <SelectContent>\n                          {vendors.map((vendor) => (\n                            <SelectItem key={vendor.id} value={vendor.id}>\n                              {vendor.name}\n                            </SelectItem>\n                          ))}\n                        </SelectContent>\n                      </Select>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"vehicleId\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Vehicle (Optional)</FormLabel>\n                      <Select onValueChange={field.onChange} value={field.value}>\n                        <FormControl>\n                          <SelectTrigger data-testid=\"select-vehicle\">\n                            <SelectValue placeholder=\"Select vehicle\" />\n                          </SelectTrigger>\n                        </FormControl>\n                        <SelectContent>\n                          <SelectItem value=\"none\">None</SelectItem>\n                          {vehicles.map((vehicle) => (\n                            <SelectItem key={vehicle.id} value={vehicle.id}>\n                              {vehicle.number} - {vehicle.driverName}\n                            </SelectItem>\n                          ))}\n                        </SelectContent>\n                      </Select>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"date\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Date</FormLabel>\n                      <FormControl>\n                        <Input type=\"date\" {...field} data-testid=\"input-date\" />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"notes\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Notes (Optional)</FormLabel>\n                      <FormControl>\n                        <Input placeholder=\"Add notes...\" {...field} data-testid=\"input-notes\" />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n              </div>\n\n              <div className=\"border rounded-lg p-4 space-y-4\">\n                <h3 className=\"font-medium\">Add Items to Return</h3>\n                <div className=\"grid grid-cols-5 gap-2\">\n                  <Select value={selectedProduct} onValueChange={handleProductChange}>\n                    <SelectTrigger data-testid=\"select-product\">\n                      <SelectValue placeholder=\"Select product\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      {products.map((product) => (\n                        <SelectItem key={product.id} value={product.id}>\n                          {product.name} ({product.currentStock} {product.unit})\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n\n                  <Input\n                    type=\"number\"\n                    placeholder=\"Quantity\"\n                    value={itemQuantity}\n                    onChange={(e) => setItemQuantity(e.target.value)}\n                    min=\"0\"\n                    step=\"0.01\"\n                    data-testid=\"input-quantity\"\n                  />\n\n                  <Input\n                    type=\"number\"\n                    placeholder=\"Price\"\n                    value={itemPrice}\n                    onChange={(e) => setItemPrice(e.target.value)}\n                    min=\"0\"\n                    step=\"0.01\"\n                    data-testid=\"input-price\"\n                  />\n\n                  <Select value={selectedReason} onValueChange={setSelectedReason}>\n                    <SelectTrigger data-testid=\"select-reason\">\n                      <SelectValue placeholder=\"Reason\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      {RETURN_REASONS.map((reason) => (\n                        <SelectItem key={reason} value={reason}>\n                          {reason}\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n\n                  <Button type=\"button\" onClick={addLineItem} data-testid=\"button-add-item\">\n                    <Plus className=\"h-4 w-4\" />\n                  </Button>\n                </div>\n\n                {lineItems.length > 0 && (\n                  <Table>\n                    <TableHeader>\n                      <TableRow>\n                        <TableHead>Product</TableHead>\n                        <TableHead className=\"text-right\">Qty</TableHead>\n                        <TableHead className=\"text-right\">Price</TableHead>\n                        <TableHead className=\"text-right\">Total</TableHead>\n                        <TableHead>Reason</TableHead>\n                        <TableHead></TableHead>\n                      </TableRow>\n                    </TableHeader>\n                    <TableBody>\n                      {lineItems.map((item, index) => (\n                        <TableRow key={index} data-testid={`row-item-${index}`}>\n                          <TableCell>{item.productName}</TableCell>\n                          <TableCell className=\"text-right font-mono\">\n                            {item.quantity}\n                          </TableCell>\n                          <TableCell className=\"text-right font-mono\">\n                            Rs {item.unitPrice.toFixed(2)}\n                          </TableCell>\n                          <TableCell className=\"text-right font-mono\">\n                            Rs {item.total.toFixed(2)}\n                          </TableCell>\n                          <TableCell>\n                            <Badge variant=\"outline\">{item.reason}</Badge>\n                          </TableCell>\n                          <TableCell>\n                            <Button\n                              type=\"button\"\n                              size=\"icon\"\n                              variant=\"ghost\"\n                              onClick={() => removeLineItem(index)}\n                              data-testid={`button-remove-item-${index}`}\n                            >\n                              <X className=\"h-4 w-4\" />\n                            </Button>\n                          </TableCell>\n                        </TableRow>\n                      ))}\n                    </TableBody>\n                  </Table>\n                )}\n\n                {lineItems.length > 0 && (\n                  <div className=\"flex justify-end\">\n                    <div className=\"text-right\">\n                      <p className=\"text-sm text-muted-foreground\">Total Credit Amount</p>\n                      <p className=\"text-2xl font-bold font-mono\" data-testid=\"text-total-amount\">\n                        Rs {totalAmount.toFixed(2)}\n                      </p>\n                    </div>\n                  </div>\n                )}\n              </div>\n\n              <div className=\"flex justify-end gap-2\">\n                <Button\n                  type=\"button\"\n                  variant=\"outline\"\n                  onClick={() => setIsDialogOpen(false)}\n                >\n                  Cancel\n                </Button>\n                <Button\n                  type=\"submit\"\n                  disabled={createMutation.isPending || lineItems.length === 0}\n                  data-testid=\"button-submit-return\"\n                >\n                  {createMutation.isPending ? \"Creating...\" : \"Create Return\"}\n                </Button>\n              </div>\n            </form>\n          </Form>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":19033,"size_tokens":null},"client/src/components/ui/checkbox.tsx":{"content":"import * as React from \"react\"\nimport * as CheckboxPrimitive from \"@radix-ui/react-checkbox\"\nimport { Check } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Checkbox = React.forwardRef<\n  React.ElementRef<typeof CheckboxPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <CheckboxPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground\",\n      className\n    )}\n    {...props}\n  >\n    <CheckboxPrimitive.Indicator\n      className={cn(\"flex items-center justify-center text-current\")}\n    >\n      <Check className=\"h-4 w-4\" />\n    </CheckboxPrimitive.Indicator>\n  </CheckboxPrimitive.Root>\n))\nCheckbox.displayName = CheckboxPrimitive.Root.displayName\n\nexport { Checkbox }\n","path":null,"size_bytes":1056,"size_tokens":null},"design_guidelines.md":{"content":"# Vegetable Wholesale Business Management System - Design Guidelines\n\n## Design Approach\n**Carbon Design System** - Selected for its excellence in data-heavy enterprise applications. Carbon's structured approach provides the clarity and efficiency needed for managing complex business operations.\n\n## Core Design Principles\n1. **Data Clarity First**: Information hierarchy optimized for quick scanning and decision-making\n2. **Workflow Efficiency**: Minimize clicks, prioritize frequently-used actions\n3. **Professional Restraint**: Clean, business-appropriate aesthetics without unnecessary decoration\n\n## Typography System\n- **Primary Font**: IBM Plex Sans (Carbon's native typeface) via Google Fonts\n- **Headings**: \n  - Dashboard title: text-2xl font-semibold\n  - Section headers: text-lg font-semibold\n  - Card titles: text-base font-medium\n- **Body Text**: text-sm for tables and forms, text-base for descriptions\n- **Data/Numbers**: font-mono for amounts, quantities, invoice numbers\n\n## Layout System\n**Spacing Units**: Tailwind units of 2, 4, 6, and 8 for consistent rhythm\n- Component padding: p-4, p-6\n- Section margins: mb-6, mb-8\n- Form field spacing: space-y-4\n- Table cell padding: px-4 py-3\n\n**Grid Structure**:\n- Dashboard cards: grid-cols-1 md:grid-cols-2 lg:grid-cols-4 (metrics)\n- Tables: Full-width with responsive scroll\n- Forms: Single column on mobile, 2-column (md:grid-cols-2) on desktop\n- Side-by-side views: Split 60/40 for list/detail patterns\n\n## Component Library\n\n### Navigation\n- **Top Navigation Bar**: Fixed header with app logo, main navigation links (Dashboard, Vendors, Customers, Products, Vehicles, Stock, Billing), user profile dropdown\n- **Sidebar** (optional for larger screens): Collapsible left sidebar with icon + text navigation\n- Active state: Subtle background highlight, not color-based\n\n### Dashboard\n- **Metric Cards**: 4-column grid showing Total Stock Value, Active Vendors, Pending Orders, Today's Sales\n- **Recent Activity Table**: Latest 10 transactions with quick filters\n- **Stock Alerts**: Warning indicators for low-stock items\n- **Quick Actions**: Prominent buttons for \"New Purchase Order\" and \"New Invoice\"\n\n### Data Tables\n- **Structure**: Striped rows for readability, sticky headers on scroll\n- **Column Types**: \n  - Text data: left-aligned\n  - Numbers/amounts: right-aligned with monospace font\n  - Actions: right-aligned icon buttons (Edit, Delete, View)\n- **Pagination**: Bottom-aligned with page size selector\n- **Search/Filter**: Top-aligned search bar with filter dropdowns\n- **Empty States**: Centered message with action button to add first item\n\n### Forms\n- **Layout**: Two-column grid for related fields (Name/Phone, Product/Quantity)\n- **Input Fields**: Full-width with clear labels above, helper text below when needed\n- **Required Fields**: Asterisk (*) indicator next to label\n- **Dropdowns**: Searchable selects for Vendors, Customers, Products\n- **Number Inputs**: Steppers for quantities, formatted inputs for currency\n- **Toggle Switches**: For Hamali Charge include/exclude option\n- **Submit Actions**: Primary button (right-aligned), secondary cancel button\n\n### Billing Interface\n- **Invoice Header**: Company info, invoice number, date, customer details in structured layout\n- **Line Items Table**: Product, Quantity, Unit Price, Total columns\n- **Calculations Section**: \n  - Subtotal (right-aligned)\n  - Hamali Charge toggle with amount display\n  - Grand Total (emphasized with larger font)\n- **Action Buttons**: Print, Save, Send to Customer\n\n### Stock Management\n- **Inventory View**: Table with Product Name, Current Stock, Unit, Reorder Level, Last Updated\n- **Color-coded Indicators**: Use neutral backgrounds (not colors) with icons for stock levels\n- **Quick Adjust**: Inline buttons to add/reduce stock with modal for entry details\n\n### Modals & Overlays\n- **Standard Modal**: Centered, max-width-2xl, with header, scrollable content, footer actions\n- **Confirmation Dialogs**: Smaller, focused confirmations for delete/critical actions\n- **Backdrop**: Semi-transparent overlay, click to close for non-critical modals\n\n## Page Layouts\n\n### Dashboard Layout\nFull-width container with metric cards at top, followed by two-column grid (Recent Purchases | Recent Sales), bottom section for stock alerts\n\n### List Pages (Vendors, Customers, Products)\nHeader with title + \"Add New\" button, search/filter bar, data table with pagination\n\n### Detail/Edit Pages\nBreadcrumb navigation, page title, tabbed interface (Details | History | Documents), form or read-only data display\n\n### Billing Page\nThree-column layout: Product selection (left 40%) | Invoice preview (center 40%) | Summary/actions (right 20%)\n\n## Animations\n**Minimal Motion**: \n- Table row hover: subtle background transition (150ms)\n- Modal enter/exit: fade + slight scale (200ms)\n- No scroll-triggered animations\n- Loading states: simple spinner, no skeleton screens\n\n## Accessibility\n- All form inputs have associated labels (not placeholders)\n- Keyboard navigation throughout (Tab order, Enter to submit)\n- Focus indicators on all interactive elements\n- ARIA labels for icon-only buttons\n- Sufficient contrast for all text\n\n## Images\n**No hero images** - This is a business management tool. Visual elements limited to:\n- Company logo in header (simple icon or wordmark)\n- Empty state illustrations (simple line drawings)\n- User avatars (initials fallback)","path":null,"size_bytes":5415,"size_tokens":null},"client/src/hooks/use-mobile.tsx":{"content":"import * as React from \"react\"\n\nconst MOBILE_BREAKPOINT = 768\n\nexport function useIsMobile() {\n  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)\n\n  React.useEffect(() => {\n    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)\n    const onChange = () => {\n      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    }\n    mql.addEventListener(\"change\", onChange)\n    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    return () => mql.removeEventListener(\"change\", onChange)\n  }, [])\n\n  return !!isMobile\n}\n","path":null,"size_bytes":565,"size_tokens":null},"client/src/components/ui/label.tsx":{"content":"import * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst labelVariants = cva(\n  \"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n)\n\nconst Label = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &\n    VariantProps<typeof labelVariants>\n>(({ className, ...props }, ref) => (\n  <LabelPrimitive.Root\n    ref={ref}\n    className={cn(labelVariants(), className)}\n    {...props}\n  />\n))\nLabel.displayName = LabelPrimitive.Root.displayName\n\nexport { Label }\n","path":null,"size_bytes":710,"size_tokens":null},"client/src/components/ui/aspect-ratio.tsx":{"content":"import * as AspectRatioPrimitive from \"@radix-ui/react-aspect-ratio\"\n\nconst AspectRatio = AspectRatioPrimitive.Root\n\nexport { AspectRatio }\n","path":null,"size_bytes":140,"size_tokens":null},"server/vite.ts":{"content":"import { type Express } from \"express\";\nimport { createServer as createViteServer, createLogger } from \"vite\";\nimport { type Server } from \"http\";\nimport viteConfig from \"../vite.config\";\nimport fs from \"fs\";\nimport path from \"path\";\nimport { nanoid } from \"nanoid\";\n\nconst viteLogger = createLogger();\n\nexport async function setupVite(server: Server, app: Express) {\n  const serverOptions = {\n    middlewareMode: true,\n    hmr: { server, path: \"/vite-hmr\" },\n    allowedHosts: true as const,\n  };\n\n  const vite = await createViteServer({\n    ...viteConfig,\n    configFile: false,\n    customLogger: {\n      ...viteLogger,\n      error: (msg, options) => {\n        viteLogger.error(msg, options);\n        process.exit(1);\n      },\n    },\n    server: serverOptions,\n    appType: \"custom\",\n  });\n\n  app.use(vite.middlewares);\n\n  app.use(\"*\", async (req, res, next) => {\n    const url = req.originalUrl;\n\n    try {\n      const clientTemplate = path.resolve(\n        import.meta.dirname,\n        \"..\",\n        \"client\",\n        \"index.html\",\n      );\n\n      // always reload the index.html file from disk incase it changes\n      let template = await fs.promises.readFile(clientTemplate, \"utf-8\");\n      template = template.replace(\n        `src=\"/src/main.tsx\"`,\n        `src=\"/src/main.tsx?v=${nanoid()}\"`,\n      );\n      const page = await vite.transformIndexHtml(url, template);\n      res.status(200).set({ \"Content-Type\": \"text/html\" }).end(page);\n    } catch (e) {\n      vite.ssrFixStacktrace(e as Error);\n      next(e);\n    }\n  });\n}\n","path":null,"size_bytes":1534,"size_tokens":null},"client/src/components/theme-toggle.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Moon, Sun } from \"lucide-react\";\n\nexport function ThemeToggle() {\n  const [theme, setTheme] = useState<\"light\" | \"dark\">(\"light\");\n\n  useEffect(() => {\n    const stored = localStorage.getItem(\"theme\") as \"light\" | \"dark\" | null;\n    if (stored) {\n      setTheme(stored);\n      document.documentElement.classList.toggle(\"dark\", stored === \"dark\");\n    }\n  }, []);\n\n  const toggleTheme = () => {\n    const newTheme = theme === \"light\" ? \"dark\" : \"light\";\n    setTheme(newTheme);\n    localStorage.setItem(\"theme\", newTheme);\n    document.documentElement.classList.toggle(\"dark\", newTheme === \"dark\");\n  };\n\n  return (\n    <Button\n      variant=\"ghost\"\n      size=\"icon\"\n      onClick={toggleTheme}\n      data-testid=\"button-theme-toggle\"\n    >\n      {theme === \"light\" ? (\n        <Moon className=\"h-4 w-4\" />\n      ) : (\n        <Sun className=\"h-4 w-4\" />\n      )}\n    </Button>\n  );\n}\n","path":null,"size_bytes":988,"size_tokens":null},"client/src/hooks/use-auth.ts":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport type { User } from \"@shared/schema\";\n\nasync function fetchUser(): Promise<User | null> {\n  const response = await fetch(\"/api/auth/user\", {\n    credentials: \"include\",\n  });\n  \n  if (response.status === 401) {\n    return null;\n  }\n  \n  if (!response.ok) {\n    throw new Error(\"Failed to fetch user\");\n  }\n  \n  return response.json();\n}\n\nexport function useAuth() {\n  const { data: user, isLoading, error } = useQuery<User | null>({\n    queryKey: [\"/api/auth/user\"],\n    queryFn: fetchUser,\n    retry: false,\n    staleTime: 5 * 60 * 1000,\n    refetchOnWindowFocus: false,\n    refetchInterval: false,\n  });\n\n  const login = () => {\n    window.location.href = \"/api/login\";\n  };\n\n  const logout = () => {\n    window.location.href = \"/api/logout\";\n  };\n\n  return {\n    user: user ?? null,\n    isLoading,\n    isAuthenticated: !!user,\n    error,\n    login,\n    logout,\n  };\n}\n","path":null,"size_bytes":927,"size_tokens":null},"client/src/index.css":{"content":"@tailwind base;\n@tailwind components;\n@tailwind utilities;\n\n/* LIGHT MODE */\n:root {\n  --button-outline: rgba(0,0,0, .10);\n  --badge-outline: rgba(0,0,0, .05);\n  --opaque-button-border-intensity: -8;\n  --elevate-1: rgba(0,0,0, .03);\n  --elevate-2: rgba(0,0,0, .08);\n  --background: 0 0% 100%;\n  --foreground: 0 0% 10%;\n  --border: 0 0% 91%;\n  --card: 0 0% 98%;\n  --card-foreground: 0 0% 10%;\n  --card-border: 0 0% 95%;\n  --sidebar: 0 0% 96%;\n  --sidebar-foreground: 0 0% 10%;\n  --sidebar-border: 0 0% 93%;\n  --sidebar-primary: 142 65% 38%;\n  --sidebar-primary-foreground: 142 65% 98%;\n  --sidebar-accent: 0 0% 92%;\n  --sidebar-accent-foreground: 0 0% 10%;\n  --sidebar-ring: 142 65% 38%;\n  --popover: 0 0% 97%;\n  --popover-foreground: 0 0% 10%;\n  --popover-border: 0 0% 94%;\n  --primary: 142 65% 38%;\n  --primary-foreground: 142 65% 98%;\n  --secondary: 0 0% 94%;\n  --secondary-foreground: 0 0% 10%;\n  --muted: 0 0% 93%;\n  --muted-foreground: 0 0% 35%;\n  --accent: 142 18% 92%;\n  --accent-foreground: 142 18% 15%;\n  --destructive: 0 75% 42%;\n  --destructive-foreground: 0 75% 98%;\n  --input: 0 0% 75%;\n  --ring: 142 65% 38%;\n  --chart-1: 142 65% 35%;\n  --chart-2: 28 75% 42%;\n  --chart-3: 210 75% 38%;\n  --chart-4: 280 60% 40%;\n  --chart-5: 340 70% 42%;\n  --font-sans: 'IBM Plex Sans', sans-serif;\n  --font-serif: Georgia, serif;\n  --font-mono: 'IBM Plex Mono', monospace;\n  --radius: .5rem;\n  --shadow-2xs: 0px 2px 0px 0px hsl(0 0% 0% / 0.00);\n  --shadow-xs: 0px 2px 0px 0px hsl(0 0% 0% / 0.00);\n  --shadow-sm: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 1px 2px -1px hsl(0 0% 0% / 0.00);\n  --shadow: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 1px 2px -1px hsl(0 0% 0% / 0.00);\n  --shadow-md: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 2px 4px -1px hsl(0 0% 0% / 0.00);\n  --shadow-lg: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 4px 6px -1px hsl(0 0% 0% / 0.00);\n  --shadow-xl: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 8px 10px -1px hsl(0 0% 0% / 0.00);\n  --shadow-2xl: 0px 2px 0px 0px hsl(0 0% 0% / 0.00);\n  --tracking-normal: 0em;\n  --spacing: 0.25rem;\n\n/* Fallback for older browsers */\n  --sidebar-primary-border: hsl(var(--sidebar-primary));\n  --sidebar-primary-border: hsl(from hsl(var(--sidebar-primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --sidebar-accent-border: hsl(var(--sidebar-accent));\n  --sidebar-accent-border: hsl(from hsl(var(--sidebar-accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --primary-border: hsl(var(--primary));\n  --primary-border: hsl(from hsl(var(--primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --secondary-border: hsl(var(--secondary));\n  --secondary-border: hsl(from hsl(var(--secondary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --muted-border: hsl(var(--muted));\n  --muted-border: hsl(from hsl(var(--muted)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --accent-border: hsl(var(--accent));\n  --accent-border: hsl(from hsl(var(--accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --destructive-border: hsl(var(--destructive));\n  --destructive-border: hsl(from hsl(var(--destructive)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n}\n\n.dark {\n  --button-outline: rgba(255,255,255, .10);\n  --badge-outline: rgba(255,255,255, .05);\n  --opaque-button-border-intensity: 9;\n  --elevate-1: rgba(255,255,255, .04);\n  --elevate-2: rgba(255,255,255, .09);\n  --background: 0 0% 8%;\n  --foreground: 0 0% 95%;\n  --border: 0 0% 18%;\n  --card: 0 0% 10%;\n  --card-foreground: 0 0% 95%;\n  --card-border: 0 0% 13%;\n  --sidebar: 0 0% 12%;\n  --sidebar-foreground: 0 0% 95%;\n  --sidebar-border: 0 0% 15%;\n  --sidebar-primary: 142 60% 45%;\n  --sidebar-primary-foreground: 142 60% 98%;\n  --sidebar-accent: 0 0% 16%;\n  --sidebar-accent-foreground: 0 0% 95%;\n  --sidebar-ring: 142 60% 45%;\n  --popover: 0 0% 14%;\n  --popover-foreground: 0 0% 95%;\n  --popover-border: 0 0% 17%;\n  --primary: 142 60% 45%;\n  --primary-foreground: 142 60% 98%;\n  --secondary: 0 0% 18%;\n  --secondary-foreground: 0 0% 95%;\n  --muted: 0 0% 17%;\n  --muted-foreground: 0 0% 65%;\n  --accent: 142 15% 16%;\n  --accent-foreground: 142 15% 90%;\n  --destructive: 0 70% 42%;\n  --destructive-foreground: 0 70% 98%;\n  --input: 0 0% 30%;\n  --ring: 142 60% 45%;\n  --chart-1: 142 60% 65%;\n  --chart-2: 28 70% 62%;\n  --chart-3: 210 70% 60%;\n  --chart-4: 280 55% 65%;\n  --chart-5: 340 65% 62%;\n  --shadow-2xs: 0px 2px 0px 0px hsl(0 0% 0% / 0.00);\n  --shadow-xs: 0px 2px 0px 0px hsl(0 0% 0% / 0.00);\n  --shadow-sm: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 1px 2px -1px hsl(0 0% 0% / 0.00);\n  --shadow: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 1px 2px -1px hsl(0 0% 0% / 0.00);\n  --shadow-md: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 2px 4px -1px hsl(0 0% 0% / 0.00);\n  --shadow-lg: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 4px 6px -1px hsl(0 0% 0% / 0.00);\n  --shadow-xl: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 8px 10px -1px hsl(0 0% 0% / 0.00);\n  --shadow-2xl: 0px 2px 0px 0px hsl(0 0% 0% / 0.00);\n\n/* Fallback for older browsers */\n  --sidebar-primary-border: hsl(var(--sidebar-primary));\n  --sidebar-primary-border: hsl(from hsl(var(--sidebar-primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --sidebar-accent-border: hsl(var(--sidebar-accent));\n  --sidebar-accent-border: hsl(from hsl(var(--sidebar-accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --primary-border: hsl(var(--primary));\n  --primary-border: hsl(from hsl(var(--primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --secondary-border: hsl(var(--secondary));\n  --secondary-border: hsl(from hsl(var(--secondary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --muted-border: hsl(var(--muted));\n  --muted-border: hsl(from hsl(var(--muted)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --accent-border: hsl(var(--accent));\n  --accent-border: hsl(from hsl(var(--accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --destructive-border: hsl(var(--destructive));\n  --destructive-border: hsl(from hsl(var(--destructive)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n}\n\n@layer base {\n  * {\n    @apply border-border;\n  }\n\n  body {\n    @apply font-sans antialiased bg-background text-foreground;\n  }\n}\n\n/**\n * Using the elevate system.\n * Automatic contrast adjustment.\n *\n * <element className=\"hover-elevate\" />\n * <element className=\"active-elevate-2\" />\n *\n * // Using the tailwind utility when a data attribute is \"on\"\n * <element className=\"toggle-elevate data-[state=on]:toggle-elevated\" />\n * // Or manually controlling the toggle state\n * <element className=\"toggle-elevate toggle-elevated\" />\n *\n * Elevation systems have to handle many states.\n * - not-hovered, vs. hovered vs. active  (three mutually exclusive states)\n * - toggled or not\n * - focused or not (this is not handled with these utilities)\n *\n * Even without handling focused or not, this is six possible combinations that\n * need to be distinguished from eachother visually.\n */\n@layer utilities {\n\n  /* Hide ugly search cancel button in Chrome until we can style it properly */\n  input[type=\"search\"]::-webkit-search-cancel-button {\n    @apply hidden;\n  }\n\n  /* Placeholder styling for contentEditable div */\n  [contenteditable][data-placeholder]:empty::before {\n    content: attr(data-placeholder);\n    color: hsl(var(--muted-foreground));\n    pointer-events: none;\n  }\n\n  /* .no-default-hover-elevate/no-default-active-elevate is an escape hatch so consumers of\n   * buttons/badges can remove the automatic brightness adjustment on interactions\n   * and program their own. */\n  .no-default-hover-elevate {}\n\n  .no-default-active-elevate {}\n\n\n  /**\n   * Toggleable backgrounds go behind the content. Hoverable/active goes on top.\n   * This way they can stack/compound. Both will overlap the parent's borders!\n   * So borders will be automatically adjusted both on toggle, and hover/active,\n   * and they will be compounded.\n   */\n  .toggle-elevate::before,\n  .toggle-elevate-2::before {\n    content: \"\";\n    pointer-events: none;\n    position: absolute;\n    inset: 0px;\n    /*border-radius: inherit;   match rounded corners */\n    border-radius: inherit;\n    z-index: -1;\n    /* sits behind content but above backdrop */\n  }\n\n  .toggle-elevate.toggle-elevated::before {\n    background-color: var(--elevate-2);\n  }\n\n  /* If there's a 1px border, adjust the inset so that it covers that parent's border */\n  .border.toggle-elevate::before {\n    inset: -1px;\n  }\n\n  /* Does not work on elements with overflow:hidden! */\n  .hover-elevate:not(.no-default-hover-elevate),\n  .active-elevate:not(.no-default-active-elevate),\n  .hover-elevate-2:not(.no-default-hover-elevate),\n  .active-elevate-2:not(.no-default-active-elevate) {\n    position: relative;\n    z-index: 0;\n  }\n\n  .hover-elevate:not(.no-default-hover-elevate)::after,\n  .active-elevate:not(.no-default-active-elevate)::after,\n  .hover-elevate-2:not(.no-default-hover-elevate)::after,\n  .active-elevate-2:not(.no-default-active-elevate)::after {\n    content: \"\";\n    pointer-events: none;\n    position: absolute;\n    inset: 0px;\n    /*border-radius: inherit;   match rounded corners */\n    border-radius: inherit;\n    z-index: 999;\n    /* sits in front of content */\n  }\n\n  .hover-elevate:hover:not(.no-default-hover-elevate)::after,\n  .active-elevate:active:not(.no-default-active-elevate)::after {\n    background-color: var(--elevate-1);\n  }\n\n  .hover-elevate-2:hover:not(.no-default-hover-elevate)::after,\n  .active-elevate-2:active:not(.no-default-active-elevate)::after {\n    background-color: var(--elevate-2);\n  }\n\n  /* If there's a 1px border, adjust the inset so that it covers that parent's border */\n  .border.hover-elevate:not(.no-hover-interaction-elevate)::after,\n  .border.active-elevate:not(.no-active-interaction-elevate)::after,\n  .border.hover-elevate-2:not(.no-hover-interaction-elevate)::after,\n  .border.active-elevate-2:not(.no-active-interaction-elevate)::after,\n  .border.hover-elevate:not(.no-hover-interaction-elevate)::after {\n    inset: -1px;\n  }\n}\n","path":null,"size_bytes":10575,"size_tokens":null},"client/src/pages/payments.tsx":{"content":"import { useState, useEffect, useMemo } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n  DialogDescription,\n} from \"@/components/ui/dialog\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { Plus, CreditCard, Wallet, Trash2, ChevronRight, Edit, Save, X, Printer, CheckCircle } from \"lucide-react\";\nimport type { Vendor, Customer, VendorPayment, CustomerPayment, HamaliCashPayment, Invoice, InvoiceItem, Product } from \"@shared/schema\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\n\ntype VendorWithBalance = Vendor & { totalPurchases: number; totalPayments: number; balance: number };\ntype CustomerWithBalance = Customer & { totalInvoices: number; totalPayments: number; balance: number };\ntype CustomerPaymentWithInvoice = CustomerPayment & { invoiceNumber?: string | null };\n\ninterface InvoiceWithItems extends Invoice {\n  items: (InvoiceItem & { product?: Product })[];\n  originalSubtotal: number;\n  originalHamali: number;\n  originalGrandTotal: number;\n}\n\ninterface EditedItem {\n  itemId: string;\n  unitPrice: number;\n  quantity: number;\n  total: number;\n}\n\ninterface EditedInvoice {\n  invoiceId: string;\n  bags: number;\n  ratePerBag: number;\n  hamaliChargeAmount: number;\n  items: EditedItem[];\n}\n\nexport default function Payments() {\n  const { toast } = useToast();\n  const [vendorDialogOpen, setVendorDialogOpen] = useState(false);\n  const [customerDialogOpen, setCustomerDialogOpen] = useState(false);\n  const [selectedVendor, setSelectedVendor] = useState<string>(\"\");\n  const [selectedCustomer, setSelectedCustomer] = useState<string>(\"\");\n  const [vendorPaymentAmount, setVendorPaymentAmount] = useState(\"\");\n  const [customerPaymentAmount, setCustomerPaymentAmount] = useState(\"\");\n  const [vendorPaymentMethod, setVendorPaymentMethod] = useState(\"cash\");\n  const [customerPaymentMethod, setCustomerPaymentMethod] = useState(\"cash\");\n  const [hamaliDialogOpen, setHamaliDialogOpen] = useState(false);\n  const [hamaliAmount, setHamaliAmount] = useState(\"\");\n  const [historyCustomerFilter, setHistoryCustomerFilter] = useState<string>(\"all\");\n  const [hamaliCustomerId, setHamaliCustomerId] = useState<string>(\"none\");\n  const [hamaliNotes, setHamaliNotes] = useState(\"\");\n  \n  const [customerInvoices, setCustomerInvoices] = useState<InvoiceWithItems[]>([]);\n  const [editedInvoices, setEditedInvoices] = useState<Record<string, EditedInvoice>>({});\n  const [loadingInvoices, setLoadingInvoices] = useState(false);\n  const [customerSummary, setCustomerSummary] = useState<{\n    totalInvoices: number;\n    totalPayments: number;\n    remainingBalance: number;\n  } | null>(null);\n  const [step, setStep] = useState<'select' | 'review' | 'completed'>('select');\n  const [completedPaymentData, setCompletedPaymentData] = useState<{\n    customerName: string;\n    amount: number;\n    grandTotal: number;\n    previouslyPaid: number;\n    paymentMethod: string;\n    date: string;\n    invoices: InvoiceWithItems[];\n    editedInvoices: Record<string, EditedInvoice>;\n  } | null>(null);\n\n  const { data: vendors = [], isLoading: vendorsLoading } = useQuery<Vendor[]>({\n    queryKey: [\"/api/vendors\"],\n  });\n\n  const { data: customers = [], isLoading: customersLoading } = useQuery<Customer[]>({\n    queryKey: [\"/api/customers\"],\n  });\n\n  const { data: products = [] } = useQuery<Product[]>({\n    queryKey: [\"/api/products\"],\n  });\n\n  const { data: vendorBalances = [], isLoading: vendorBalancesLoading } = useQuery<VendorWithBalance[]>({\n    queryKey: [\"/api/reports/vendor-balances\"],\n  });\n\n  const { data: customerBalances = [], isLoading: customerBalancesLoading } = useQuery<CustomerWithBalance[]>({\n    queryKey: [\"/api/reports/customer-balances\"],\n  });\n\n  const { data: vendorPayments = [] } = useQuery<VendorPayment[]>({\n    queryKey: [\"/api/vendor-payments\"],\n  });\n\n  const { data: customerPayments = [] } = useQuery<CustomerPaymentWithInvoice[]>({\n    queryKey: [\"/api/customer-payments\"],\n  });\n  \n  const filteredCustomerPayments = useMemo(() => {\n    if (historyCustomerFilter === \"all\") return customerPayments;\n    return customerPayments.filter(p => p.customerId === historyCustomerFilter);\n  }, [customerPayments, historyCustomerFilter]);\n\n  const { data: hamaliCashPayments = [] } = useQuery<HamaliCashPayment[]>({\n    queryKey: [\"/api/hamali-cash\"],\n  });\n\n  const loadCustomerInvoices = async (customerId: string) => {\n    setLoadingInvoices(true);\n    try {\n      const invoicesRes = await fetch(`/api/customers/${customerId}/invoices`);\n      const data = await invoicesRes.json();\n      const invoices: Invoice[] = data.invoices;\n      const summary = data.summary;\n      \n      setCustomerSummary(summary);\n      setCustomerPaymentAmount(summary.remainingBalance > 0 ? String(summary.remainingBalance) : \"\");\n      \n      const invoicesWithItems: InvoiceWithItems[] = await Promise.all(\n        invoices.map(async (invoice) => {\n          const itemsRes = await fetch(`/api/invoices/${invoice.id}/items`);\n          const items: InvoiceItem[] = await itemsRes.json();\n          const itemsWithProducts = items.map(item => ({\n            ...item,\n            product: products.find(p => p.id === item.productId),\n          }));\n          return {\n            ...invoice,\n            items: itemsWithProducts,\n            originalSubtotal: invoice.subtotal,\n            originalHamali: invoice.hamaliChargeAmount || 0,\n            originalGrandTotal: invoice.grandTotal,\n          };\n        })\n      );\n      \n      setCustomerInvoices(invoicesWithItems);\n      \n      const initialEdited: Record<string, EditedInvoice> = {};\n      invoicesWithItems.forEach(inv => {\n        const existingBags = (inv as any).bags || 0;\n        const existingRatePerBag = (inv as any).hamaliRatePerBag || 0;\n        const existingHamali = inv.hamaliChargeAmount || 0;\n        initialEdited[inv.id] = {\n          invoiceId: inv.id,\n          bags: existingBags,\n          ratePerBag: existingRatePerBag,\n          hamaliChargeAmount: existingHamali,\n          items: inv.items.map(item => ({\n            itemId: item.id,\n            unitPrice: item.unitPrice,\n            quantity: item.quantity,\n            total: item.total,\n          })),\n        };\n      });\n      setEditedInvoices(initialEdited);\n      setStep('review');\n    } catch (error) {\n      console.error(\"Error loading customer invoices:\", error);\n      toast({ title: \"Error\", description: \"Failed to load customer invoices\", variant: \"destructive\" });\n    } finally {\n      setLoadingInvoices(false);\n    }\n  };\n\n  const handleCustomerSelect = (customerId: string) => {\n    setSelectedCustomer(customerId);\n    if (customerId) {\n      loadCustomerInvoices(customerId);\n    }\n  };\n\n  const updateItemPrice = (invoiceId: string, itemId: string, newPrice: number) => {\n    setEditedInvoices(prev => {\n      const invoice = prev[invoiceId];\n      if (!invoice) return prev;\n      \n      const updatedItems = invoice.items.map(item => {\n        if (item.itemId === itemId) {\n          const newTotal = item.quantity * newPrice;\n          return { ...item, unitPrice: newPrice, total: newTotal };\n        }\n        return item;\n      });\n      \n      return {\n        ...prev,\n        [invoiceId]: { ...invoice, items: updatedItems },\n      };\n    });\n  };\n\n  const updateHamaliBags = (invoiceId: string, newBags: number) => {\n    setEditedInvoices(prev => {\n      const invoice = prev[invoiceId];\n      if (!invoice) return prev;\n      const newHamali = newBags * invoice.ratePerBag;\n      return {\n        ...prev,\n        [invoiceId]: { ...invoice, bags: newBags, hamaliChargeAmount: newHamali },\n      };\n    });\n  };\n\n  const updateHamaliRate = (invoiceId: string, newRate: number) => {\n    setEditedInvoices(prev => {\n      const invoice = prev[invoiceId];\n      if (!invoice) return prev;\n      const newHamali = invoice.bags * newRate;\n      return {\n        ...prev,\n        [invoiceId]: { ...invoice, ratePerBag: newRate, hamaliChargeAmount: newHamali },\n      };\n    });\n  };\n\n  const updateHamaliAmount = (invoiceId: string, newHamali: number) => {\n    setEditedInvoices(prev => {\n      const invoice = prev[invoiceId];\n      if (!invoice) return prev;\n      return {\n        ...prev,\n        [invoiceId]: { ...invoice, hamaliChargeAmount: newHamali },\n      };\n    });\n  };\n\n  const getInvoiceTotal = (invoiceId: string) => {\n    const edited = editedInvoices[invoiceId];\n    if (!edited) return { subtotal: 0, hamali: 0, grandTotal: 0 };\n    \n    const subtotal = edited.items.reduce((sum, item) => sum + item.total, 0);\n    const hamali = edited.hamaliChargeAmount;\n    return { subtotal, hamali, grandTotal: subtotal + hamali };\n  };\n\n  const grandTotalAllInvoices = useMemo(() => {\n    return Object.keys(editedInvoices).reduce((sum, invoiceId) => {\n      return sum + getInvoiceTotal(invoiceId).grandTotal;\n    }, 0);\n  }, [editedInvoices]);\n\n  const saveInvoiceChanges = useMutation({\n    mutationFn: async () => {\n      for (const invoiceId of Object.keys(editedInvoices)) {\n        const edited = editedInvoices[invoiceId];\n        const totals = getInvoiceTotal(invoiceId);\n        \n        await apiRequest(\"PATCH\", `/api/invoices/${invoiceId}`, {\n          subtotal: totals.subtotal,\n          hamaliChargeAmount: edited.hamaliChargeAmount,\n          bags: edited.bags,\n          hamaliRatePerBag: edited.ratePerBag,\n          grandTotal: totals.grandTotal,\n        });\n        \n        for (const item of edited.items) {\n          await apiRequest(\"PATCH\", `/api/invoice-items/${item.itemId}`, {\n            unitPrice: item.unitPrice,\n            total: item.total,\n          });\n        }\n      }\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/invoices\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/reports/customer-balances\"] });\n      toast({ title: \"Changes saved\", description: \"Invoice changes have been saved successfully.\" });\n    },\n    onError: () => {\n      toast({ title: \"Error\", description: \"Failed to save invoice changes.\", variant: \"destructive\" });\n    },\n  });\n\n  const createVendorPayment = useMutation({\n    mutationFn: async (data: { vendorId: string; amount: number; paymentMethod: string; date: string }) => {\n      return apiRequest(\"POST\", \"/api/vendor-payments\", data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/vendor-payments\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/reports/vendor-balances\"] });\n      setVendorDialogOpen(false);\n      setSelectedVendor(\"\");\n      setVendorPaymentAmount(\"\");\n      toast({ title: \"Payment recorded\", description: \"Vendor payment has been recorded successfully.\" });\n    },\n    onError: () => {\n      toast({ title: \"Error\", description: \"Failed to record payment.\", variant: \"destructive\" });\n    },\n  });\n\n  const createCustomerPayment = useMutation({\n    mutationFn: async (data: { customerId: string; invoiceId?: string; amount: number; paymentMethod: string; date: string }) => {\n      return apiRequest(\"POST\", \"/api/customer-payments\", data);\n    },\n    onSuccess: (_, variables) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/customer-payments\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/reports/customer-balances\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/invoices\"] });\n      \n      setCompletedPaymentData({\n        customerName: getCustomerName(variables.customerId),\n        amount: variables.amount,\n        grandTotal: grandTotalAllInvoices,\n        previouslyPaid: customerSummary?.totalPayments ?? 0,\n        paymentMethod: variables.paymentMethod,\n        date: variables.date,\n        invoices: customerInvoices,\n        editedInvoices: editedInvoices,\n      });\n      setStep('completed');\n      toast({ title: \"Payment recorded\", description: \"Customer payment has been recorded successfully.\" });\n    },\n    onError: () => {\n      toast({ title: \"Error\", description: \"Failed to record payment.\", variant: \"destructive\" });\n    },\n  });\n\n  const createHamaliCashPayment = useMutation({\n    mutationFn: async (data: { amount: number; date: string; paymentMethod: string; customerId?: string; notes?: string }) => {\n      return apiRequest(\"POST\", \"/api/hamali-cash\", data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/hamali-cash\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/reports/profit-loss\"] });\n      setHamaliDialogOpen(false);\n      setHamaliAmount(\"\");\n      setHamaliCustomerId(\"none\");\n      setHamaliNotes(\"\");\n      toast({ title: \"Hamali payment recorded\", description: \"Direct Hamali cash payment has been recorded.\" });\n    },\n    onError: () => {\n      toast({ title: \"Error\", description: \"Failed to record Hamali payment.\", variant: \"destructive\" });\n    },\n  });\n\n  const deleteHamaliCashPayment = useMutation({\n    mutationFn: async (id: string) => {\n      return apiRequest(\"DELETE\", `/api/hamali-cash/${id}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/hamali-cash\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/reports/profit-loss\"] });\n      toast({ title: \"Payment deleted\", description: \"Hamali cash payment has been deleted.\" });\n    },\n    onError: () => {\n      toast({ title: \"Error\", description: \"Failed to delete payment.\", variant: \"destructive\" });\n    },\n  });\n\n  const resetCustomerDialog = () => {\n    setSelectedCustomer(\"\");\n    setCustomerPaymentAmount(\"\");\n    setCustomerInvoices([]);\n    setEditedInvoices({});\n    setStep('select');\n    setCompletedPaymentData(null);\n    setCustomerPaymentMethod(\"cash\");\n    setCustomerSummary(null);\n  };\n\n  const handlePrintReceipt = () => {\n    if (!completedPaymentData) return;\n    \n    const printWindow = window.open('', '_blank');\n    if (!printWindow) {\n      toast({ title: \"Error\", description: \"Please allow popups to print receipt\", variant: \"destructive\" });\n      return;\n    }\n\n    const totalHamali = completedPaymentData.invoices.reduce((sum, inv) => {\n      const edited = completedPaymentData.editedInvoices[inv.id];\n      return sum + (edited?.hamaliChargeAmount || inv.hamaliChargeAmount || 0);\n    }, 0);\n\n    const totalBags = completedPaymentData.invoices.reduce((sum, inv) => {\n      const edited = completedPaymentData.editedInvoices[inv.id];\n      return sum + (edited?.bags || 0);\n    }, 0);\n\n    const invoiceSubtotal = completedPaymentData.invoices.reduce((sum, inv) => {\n      const edited = completedPaymentData.editedInvoices[inv.id];\n      const itemsTotal = edited?.items.reduce((s, i) => s + i.total, 0) || inv.subtotal;\n      return sum + itemsTotal;\n    }, 0);\n\n    const grandTotal = invoiceSubtotal + totalHamali;\n    const amountPaid = completedPaymentData.amount;\n    const totalPaidIncludingThis = completedPaymentData.previouslyPaid + amountPaid;\n    const balanceRemaining = grandTotal - totalPaidIncludingThis;\n\n    const invoiceDetails = completedPaymentData.invoices.map(inv => {\n      const edited = completedPaymentData.editedInvoices[inv.id];\n      const itemsHtml = inv.items.map(item => {\n        const editedItem = edited?.items.find(e => e.itemId === item.id);\n        const price = editedItem?.unitPrice ?? item.unitPrice;\n        const total = editedItem?.total ?? item.total;\n        return `\n          <tr>\n            <td style=\"padding: 6px 10px; border-bottom: 1px solid #e0e0e0;\">${item.product?.name || 'Unknown'}</td>\n            <td style=\"padding: 6px 10px; border-bottom: 1px solid #e0e0e0; text-align: center;\">${item.quantity}</td>\n            <td style=\"padding: 6px 10px; border-bottom: 1px solid #e0e0e0; text-align: right;\">₹${price.toFixed(2)}</td>\n            <td style=\"padding: 6px 10px; border-bottom: 1px solid #e0e0e0; text-align: right; font-weight: 500;\">₹${total.toFixed(2)}</td>\n          </tr>\n        `;\n      }).join('');\n      \n      const hamali = edited?.hamaliChargeAmount || inv.hamaliChargeAmount || 0;\n      const bags = edited?.bags || 0;\n      const subtotal = edited?.items.reduce((s, i) => s + i.total, 0) || inv.subtotal;\n      \n      return `\n        <div style=\"margin-bottom: 15px; border: 1px solid #ddd; border-radius: 6px; overflow: hidden;\">\n          <div style=\"display: flex; justify-content: space-between; padding: 8px 12px; background: #f5f5f5; border-bottom: 1px solid #ddd;\">\n            <strong style=\"color: #333;\">${inv.invoiceNumber}</strong>\n            <span style=\"color: #666;\">${inv.date}</span>\n          </div>\n          <table style=\"width: 100%; border-collapse: collapse; font-size: 13px;\">\n            <thead>\n              <tr style=\"background: #fafafa;\">\n                <th style=\"padding: 8px 10px; text-align: left; font-weight: 600; color: #555;\">Product</th>\n                <th style=\"padding: 8px 10px; text-align: center; font-weight: 600; color: #555;\">Qty</th>\n                <th style=\"padding: 8px 10px; text-align: right; font-weight: 600; color: #555;\">Rate</th>\n                <th style=\"padding: 8px 10px; text-align: right; font-weight: 600; color: #555;\">Amount</th>\n              </tr>\n            </thead>\n            <tbody>\n              ${itemsHtml}\n            </tbody>\n          </table>\n          <div style=\"padding: 10px 12px; background: #fafafa; border-top: 1px solid #e0e0e0;\">\n            <div style=\"display: flex; justify-content: space-between; font-size: 12px; color: #666; margin-bottom: 4px;\">\n              <span>Products Total:</span>\n              <span>₹${subtotal.toFixed(2)}</span>\n            </div>\n            <div style=\"display: flex; justify-content: space-between; font-size: 12px; color: #666; margin-bottom: 4px;\">\n              <span>Hamali (${bags} bags):</span>\n              <span>₹${hamali.toFixed(2)}</span>\n            </div>\n            <div style=\"display: flex; justify-content: space-between; font-size: 14px; font-weight: 600; color: #333; padding-top: 6px; border-top: 1px dashed #ddd;\">\n              <span>Invoice Total:</span>\n              <span>₹${(subtotal + hamali).toFixed(2)}</span>\n            </div>\n          </div>\n        </div>\n      `;\n    }).join('');\n\n    const paymentMethodLabel = {\n      cash: 'CASH',\n      bank: 'BANK TRANSFER',\n      upi: 'UPI',\n    }[completedPaymentData.paymentMethod] || completedPaymentData.paymentMethod.toUpperCase();\n\n    printWindow.document.write(`\n      <!DOCTYPE html>\n      <html>\n      <head>\n        <title>Payment Receipt - ${completedPaymentData.customerName}</title>\n        <style>\n          * { box-sizing: border-box; }\n          body { font-family: 'Segoe UI', Arial, sans-serif; padding: 20px; max-width: 800px; margin: 0 auto; color: #333; }\n          .header { text-align: center; margin-bottom: 25px; padding-bottom: 15px; border-bottom: 3px solid #2e7d32; }\n          .header h1 { margin: 0 0 5px 0; color: #2e7d32; font-size: 28px; }\n          .header .business-name { margin: 0; color: #666; font-size: 14px; }\n          .header .receipt-date { margin-top: 8px; font-size: 12px; color: #888; }\n          .customer-info { background: #f8f9fa; border-radius: 8px; padding: 15px; margin-bottom: 20px; }\n          .customer-info h3 { margin: 0 0 12px 0; font-size: 14px; color: #666; text-transform: uppercase; letter-spacing: 1px; }\n          .info-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }\n          .info-item { display: flex; justify-content: space-between; font-size: 14px; }\n          .info-item .label { color: #666; }\n          .info-item .value { font-weight: 600; color: #333; }\n          .payment-method { display: inline-block; background: #2e7d32; color: white; padding: 4px 12px; border-radius: 4px; font-size: 12px; font-weight: 600; }\n          .invoices-section { margin-bottom: 20px; }\n          .invoices-section h3 { margin: 0 0 15px 0; font-size: 16px; color: #333; border-bottom: 1px solid #ddd; padding-bottom: 8px; }\n          .summary-box { background: #f8f9fa; border: 2px solid #2e7d32; border-radius: 8px; padding: 20px; }\n          .summary-row { display: flex; justify-content: space-between; padding: 8px 0; font-size: 14px; }\n          .summary-row.separator { border-top: 1px solid #ddd; margin-top: 8px; padding-top: 12px; }\n          .summary-row .label { color: #666; }\n          .summary-row .value { font-weight: 600; }\n          .summary-row.total { font-size: 16px; border-top: 2px solid #333; margin-top: 10px; padding-top: 12px; }\n          .summary-row.total .label, .summary-row.total .value { font-weight: 700; color: #333; }\n          .summary-row.paid { font-size: 18px; }\n          .summary-row.paid .value { color: #2e7d32; font-size: 20px; }\n          .summary-row.balance .value { color: ${balanceRemaining > 0 ? '#d32f2f' : '#2e7d32'}; }\n          .footer { text-align: center; margin-top: 30px; padding-top: 20px; border-top: 1px solid #ddd; }\n          .footer p { margin: 5px 0; font-size: 12px; color: #888; }\n          @media print { \n            body { print-color-adjust: exact; -webkit-print-color-adjust: exact; } \n            .summary-box { break-inside: avoid; }\n          }\n        </style>\n      </head>\n      <body>\n        <div class=\"header\">\n          <h1>PAYMENT RECEIPT</h1>\n          <p class=\"business-name\">VegWholesale Business</p>\n          <p class=\"receipt-date\">${new Date().toLocaleDateString('en-IN', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}</p>\n        </div>\n        \n        <div class=\"customer-info\">\n          <h3>Customer Details</h3>\n          <div class=\"info-grid\">\n            <div class=\"info-item\">\n              <span class=\"label\">Customer Name:</span>\n              <span class=\"value\">${completedPaymentData.customerName}</span>\n            </div>\n            <div class=\"info-item\">\n              <span class=\"label\">Payment Date:</span>\n              <span class=\"value\">${completedPaymentData.date}</span>\n            </div>\n            <div class=\"info-item\">\n              <span class=\"label\">Payment Method:</span>\n              <span class=\"payment-method\">${paymentMethodLabel}</span>\n            </div>\n            <div class=\"info-item\">\n              <span class=\"label\">Total Invoices:</span>\n              <span class=\"value\">${completedPaymentData.invoices.length}</span>\n            </div>\n          </div>\n        </div>\n        \n        <div class=\"invoices-section\">\n          <h3>Invoice Details</h3>\n          ${invoiceDetails}\n        </div>\n        \n        <div class=\"summary-box\">\n          <div class=\"summary-row\">\n            <span class=\"label\">Products Subtotal:</span>\n            <span class=\"value\">₹${invoiceSubtotal.toFixed(2)}</span>\n          </div>\n          <div class=\"summary-row\">\n            <span class=\"label\">Total Hamali (${totalBags} bags):</span>\n            <span class=\"value\">₹${totalHamali.toFixed(2)}</span>\n          </div>\n          <div class=\"summary-row total\">\n            <span class=\"label\">GRAND TOTAL:</span>\n            <span class=\"value\">₹${grandTotal.toFixed(2)}</span>\n          </div>\n          ${completedPaymentData.previouslyPaid > 0 ? `\n          <div class=\"summary-row\" style=\"font-size: 13px; color: #666;\">\n            <span class=\"label\">Previously Paid:</span>\n            <span class=\"value\">-₹${completedPaymentData.previouslyPaid.toFixed(2)}</span>\n          </div>\n          ` : ''}\n          <div class=\"summary-row separator paid\">\n            <span class=\"label\">THIS PAYMENT:</span>\n            <span class=\"value\">₹${amountPaid.toFixed(2)}</span>\n          </div>\n          ${completedPaymentData.previouslyPaid > 0 ? `\n          <div class=\"summary-row\" style=\"font-size: 13px; color: #666;\">\n            <span class=\"label\">Total Paid:</span>\n            <span class=\"value\">₹${totalPaidIncludingThis.toFixed(2)}</span>\n          </div>\n          ` : ''}\n          <div class=\"summary-row balance\">\n            <span class=\"label\">${balanceRemaining > 0 ? 'BALANCE DUE:' : 'BALANCE:'}</span>\n            <span class=\"value\">${balanceRemaining > 0 ? '₹' + balanceRemaining.toFixed(2) : '₹0.00 (Paid in Full)'}</span>\n          </div>\n        </div>\n        \n        <div class=\"footer\">\n          <p>Thank you for your business!</p>\n          <p>For any queries, please contact us.</p>\n        </div>\n        \n        <script>\n          window.onload = function() { window.print(); }\n        </script>\n      </body>\n      </html>\n    `);\n    printWindow.document.close();\n  };\n\n  const printPaymentHistory = () => {\n    const printWindow = window.open('', '_blank');\n    if (!printWindow) {\n      toast({ title: \"Error\", description: \"Please allow popups to print\", variant: \"destructive\" });\n      return;\n    }\n\n    const customerName = historyCustomerFilter === \"all\" \n      ? \"All Customers\" \n      : getCustomerName(historyCustomerFilter);\n\n    const totalAmount = filteredCustomerPayments.reduce((sum, p) => sum + p.amount, 0);\n\n    const paymentRows = filteredCustomerPayments.map(payment => `\n      <tr>\n        <td style=\"padding: 8px 12px; border-bottom: 1px solid #e0e0e0;\">${payment.date}</td>\n        <td style=\"padding: 8px 12px; border-bottom: 1px solid #e0e0e0;\">${getCustomerName(payment.customerId)}</td>\n        <td style=\"padding: 8px 12px; border-bottom: 1px solid #e0e0e0; font-family: monospace; font-size: 11px;\">${payment.invoiceNumber || '-'}</td>\n        <td style=\"padding: 8px 12px; border-bottom: 1px solid #e0e0e0; text-transform: capitalize;\">${payment.paymentMethod}</td>\n        <td style=\"padding: 8px 12px; border-bottom: 1px solid #e0e0e0; text-align: right; font-family: monospace;\">₹${payment.amount.toLocaleString(\"en-IN\")}</td>\n      </tr>\n    `).join('');\n\n    printWindow.document.write(`\n      <!DOCTYPE html>\n      <html>\n      <head>\n        <title>Payment History - ${customerName}</title>\n        <style>\n          body { \n            font-family: 'IBM Plex Sans', -apple-system, sans-serif; \n            padding: 20px; \n            color: #1a1a1a;\n          }\n          .header {\n            text-align: center;\n            margin-bottom: 24px;\n            padding-bottom: 16px;\n            border-bottom: 2px solid #0f172a;\n          }\n          .header h1 { margin: 0 0 8px 0; font-size: 22px; }\n          .header p { margin: 0; color: #666; font-size: 14px; }\n          table { \n            width: 100%; \n            border-collapse: collapse; \n            margin-top: 16px;\n          }\n          th { \n            background: #f8f9fa; \n            padding: 10px 12px; \n            text-align: left; \n            font-weight: 600;\n            font-size: 12px;\n            border-bottom: 2px solid #e0e0e0;\n          }\n          th:last-child { text-align: right; }\n          .total-row {\n            background: #f0fdf4;\n            font-weight: 600;\n          }\n          .total-row td { padding: 12px; border-top: 2px solid #0f172a; }\n          .footer {\n            margin-top: 24px;\n            text-align: center;\n            color: #666;\n            font-size: 12px;\n          }\n          @media print {\n            body { padding: 0; }\n          }\n        </style>\n      </head>\n      <body>\n        <div class=\"header\">\n          <h1>Payment History</h1>\n          <p>${customerName} | Generated: ${new Date().toLocaleDateString('en-IN')}</p>\n        </div>\n        \n        <table>\n          <thead>\n            <tr>\n              <th>Date</th>\n              <th>Customer</th>\n              <th>Invoice</th>\n              <th>Method</th>\n              <th style=\"text-align: right;\">Amount</th>\n            </tr>\n          </thead>\n          <tbody>\n            ${paymentRows}\n            <tr class=\"total-row\">\n              <td colspan=\"4\"><strong>Total (${filteredCustomerPayments.length} payments)</strong></td>\n              <td style=\"text-align: right; font-family: monospace;\"><strong>₹${totalAmount.toLocaleString(\"en-IN\")}</strong></td>\n            </tr>\n          </tbody>\n        </table>\n        \n        <div class=\"footer\">\n          <p>Printed on ${new Date().toLocaleString('en-IN')}</p>\n        </div>\n        \n        <script>\n          window.onload = function() { window.print(); }\n        </script>\n      </body>\n      </html>\n    `);\n    printWindow.document.close();\n  };\n\n  const handleCustomerDialogClose = (open: boolean) => {\n    setCustomerDialogOpen(open);\n    if (!open) {\n      resetCustomerDialog();\n    }\n  };\n\n  const handleVendorPayment = () => {\n    if (!selectedVendor || !vendorPaymentAmount) return;\n    createVendorPayment.mutate({\n      vendorId: selectedVendor,\n      amount: parseFloat(vendorPaymentAmount),\n      paymentMethod: vendorPaymentMethod,\n      date: new Date().toISOString().split(\"T\")[0],\n    });\n  };\n\n  const handleFinalizeAndPay = async () => {\n    if (!selectedCustomer) return;\n    \n    await saveInvoiceChanges.mutateAsync();\n    \n    const paymentAmount = customerPaymentAmount ? parseFloat(customerPaymentAmount) : grandTotalAllInvoices;\n    \n    // Link payment to the first unpaid/partially paid invoice\n    const invoiceId = customerInvoices.length > 0 ? customerInvoices[0].id : undefined;\n    \n    createCustomerPayment.mutate({\n      customerId: selectedCustomer,\n      invoiceId,\n      amount: paymentAmount,\n      paymentMethod: customerPaymentMethod,\n      date: new Date().toISOString().split(\"T\")[0],\n    });\n  };\n\n  const handleHamaliPayment = () => {\n    if (!hamaliAmount) return;\n    createHamaliCashPayment.mutate({\n      amount: parseFloat(hamaliAmount),\n      date: new Date().toISOString().split(\"T\")[0],\n      paymentMethod: \"cash\",\n      customerId: hamaliCustomerId === \"none\" ? undefined : hamaliCustomerId,\n      notes: hamaliNotes || undefined,\n    });\n  };\n\n  const getVendorName = (id: string) => vendors.find((v) => v.id === id)?.name || \"Unknown\";\n  const getCustomerName = (id: string) => customers.find((c) => c.id === id)?.name || \"Unknown\";\n\n  const totalVendorOutstanding = vendorBalances.reduce((sum, v) => sum + v.balance, 0);\n  const totalCustomerReceivable = customerBalances.reduce((sum, c) => sum + c.balance, 0);\n\n  if (vendorsLoading || customersLoading || vendorBalancesLoading || customerBalancesLoading) {\n    return (\n      <div className=\"p-6 space-y-6\">\n        <Skeleton className=\"h-8 w-48\" />\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n          <Skeleton className=\"h-32\" />\n          <Skeleton className=\"h-32\" />\n        </div>\n        <Skeleton className=\"h-96\" />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"p-6 space-y-6\">\n      <div className=\"flex items-center justify-between gap-4 flex-wrap\">\n        <h1 className=\"text-2xl font-semibold\" data-testid=\"text-page-title\">\n          Payments\n        </h1>\n      </div>\n\n      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between gap-2 pb-2\">\n            <CardTitle className=\"text-sm font-medium text-muted-foreground\">\n              Vendor Outstanding\n            </CardTitle>\n            <Wallet className=\"h-4 w-4 text-destructive\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold font-mono\" data-testid=\"text-vendor-outstanding\">\n              {totalVendorOutstanding.toLocaleString(\"en-IN\", { style: \"currency\", currency: \"INR\" })}\n            </div>\n            <p className=\"text-xs text-muted-foreground\">Amount to pay vendors</p>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between gap-2 pb-2\">\n            <CardTitle className=\"text-sm font-medium text-muted-foreground\">\n              Customer Receivable\n            </CardTitle>\n            <CreditCard className=\"h-4 w-4 text-primary\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold font-mono\" data-testid=\"text-customer-receivable\">\n              {totalCustomerReceivable.toLocaleString(\"en-IN\", { style: \"currency\", currency: \"INR\" })}\n            </div>\n            <p className=\"text-xs text-muted-foreground\">Amount to receive from customers</p>\n          </CardContent>\n        </Card>\n      </div>\n\n      <Tabs defaultValue=\"vendors\" className=\"space-y-4\">\n        <TabsList>\n          <TabsTrigger value=\"vendors\" data-testid=\"tab-vendors\">Vendor Payments</TabsTrigger>\n          <TabsTrigger value=\"customers\" data-testid=\"tab-customers\">Customer Payments</TabsTrigger>\n          <TabsTrigger value=\"hamali\" data-testid=\"tab-hamali\">Hamali Cash</TabsTrigger>\n        </TabsList>\n\n        <TabsContent value=\"vendors\" className=\"space-y-4\">\n          <div className=\"flex justify-end\">\n            <Dialog open={vendorDialogOpen} onOpenChange={setVendorDialogOpen}>\n              <DialogTrigger asChild>\n                <Button data-testid=\"button-add-vendor-payment\">\n                  <Plus className=\"h-4 w-4 mr-2\" />\n                  Record Payment\n                </Button>\n              </DialogTrigger>\n              <DialogContent>\n                <DialogHeader>\n                  <DialogTitle>Record Vendor Payment</DialogTitle>\n                  <DialogDescription>Record a payment made to a vendor</DialogDescription>\n                </DialogHeader>\n                <div className=\"space-y-4 pt-4\">\n                  <div className=\"space-y-2\">\n                    <Label>Vendor</Label>\n                    <Select value={selectedVendor} onValueChange={setSelectedVendor}>\n                      <SelectTrigger data-testid=\"select-vendor\">\n                        <SelectValue placeholder=\"Select vendor\" />\n                      </SelectTrigger>\n                      <SelectContent>\n                        {vendors.map((vendor) => (\n                          <SelectItem key={vendor.id} value={vendor.id}>\n                            {vendor.name}\n                          </SelectItem>\n                        ))}\n                      </SelectContent>\n                    </Select>\n                  </div>\n                  <div className=\"space-y-2\">\n                    <Label>Amount</Label>\n                    <Input\n                      type=\"number\"\n                      value={vendorPaymentAmount}\n                      onChange={(e) => setVendorPaymentAmount(e.target.value)}\n                      placeholder=\"Enter amount\"\n                      data-testid=\"input-vendor-payment-amount\"\n                    />\n                  </div>\n                  <div className=\"space-y-2\">\n                    <Label>Payment Method</Label>\n                    <Select value={vendorPaymentMethod} onValueChange={setVendorPaymentMethod}>\n                      <SelectTrigger data-testid=\"select-payment-method\">\n                        <SelectValue placeholder=\"Select method\" />\n                      </SelectTrigger>\n                      <SelectContent>\n                        <SelectItem value=\"cash\">Cash</SelectItem>\n                        <SelectItem value=\"bank\">Bank Transfer</SelectItem>\n                        <SelectItem value=\"upi\">UPI</SelectItem>\n                        <SelectItem value=\"cheque\">Cheque</SelectItem>\n                      </SelectContent>\n                    </Select>\n                  </div>\n                  <Button\n                    onClick={handleVendorPayment}\n                    disabled={!selectedVendor || !vendorPaymentAmount || createVendorPayment.isPending}\n                    className=\"w-full\"\n                    data-testid=\"button-submit-vendor-payment\"\n                  >\n                    {createVendorPayment.isPending ? \"Recording...\" : \"Record Payment\"}\n                  </Button>\n                </div>\n              </DialogContent>\n            </Dialog>\n          </div>\n\n          <Card>\n            <CardHeader>\n              <CardTitle>Vendor Balances</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead>Vendor</TableHead>\n                    <TableHead className=\"text-right\">Total Purchases</TableHead>\n                    <TableHead className=\"text-right\">Total Paid</TableHead>\n                    <TableHead className=\"text-right\">Balance</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {vendorBalances.length === 0 ? (\n                    <TableRow>\n                      <TableCell colSpan={4} className=\"text-center text-muted-foreground py-8\">\n                        No vendor data available\n                      </TableCell>\n                    </TableRow>\n                  ) : (\n                    vendorBalances.map((vendor) => (\n                      <TableRow key={vendor.id} data-testid={`row-vendor-${vendor.id}`}>\n                        <TableCell className=\"font-medium\">{vendor.name}</TableCell>\n                        <TableCell className=\"text-right font-mono\">\n                          {vendor.totalPurchases.toLocaleString(\"en-IN\", { style: \"currency\", currency: \"INR\" })}\n                        </TableCell>\n                        <TableCell className=\"text-right font-mono\">\n                          {vendor.totalPayments.toLocaleString(\"en-IN\", { style: \"currency\", currency: \"INR\" })}\n                        </TableCell>\n                        <TableCell className=\"text-right font-mono font-semibold\">\n                          {vendor.balance.toLocaleString(\"en-IN\", { style: \"currency\", currency: \"INR\" })}\n                        </TableCell>\n                      </TableRow>\n                    ))\n                  )}\n                </TableBody>\n              </Table>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <CardTitle>Payment History</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead>Date</TableHead>\n                    <TableHead>Vendor</TableHead>\n                    <TableHead>Method</TableHead>\n                    <TableHead className=\"text-right\">Amount</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {vendorPayments.length === 0 ? (\n                    <TableRow>\n                      <TableCell colSpan={4} className=\"text-center text-muted-foreground py-8\">\n                        No payment history\n                      </TableCell>\n                    </TableRow>\n                  ) : (\n                    vendorPayments.map((payment) => (\n                      <TableRow key={payment.id} data-testid={`row-payment-${payment.id}`}>\n                        <TableCell>{payment.date}</TableCell>\n                        <TableCell>{getVendorName(payment.vendorId)}</TableCell>\n                        <TableCell className=\"capitalize\">{payment.paymentMethod}</TableCell>\n                        <TableCell className=\"text-right font-mono\">\n                          {payment.amount.toLocaleString(\"en-IN\", { style: \"currency\", currency: \"INR\" })}\n                        </TableCell>\n                      </TableRow>\n                    ))\n                  )}\n                </TableBody>\n              </Table>\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        <TabsContent value=\"customers\" className=\"space-y-4\">\n          <div className=\"flex justify-end\">\n            <Dialog open={customerDialogOpen} onOpenChange={handleCustomerDialogClose}>\n              <DialogTrigger asChild>\n                <Button data-testid=\"button-add-customer-payment\">\n                  <Plus className=\"h-4 w-4 mr-2\" />\n                  Record Payment\n                </Button>\n              </DialogTrigger>\n              <DialogContent className=\"max-w-4xl max-h-[85vh] overflow-auto\">\n                <DialogHeader>\n                  <DialogTitle>\n                    {step === 'select' && 'Select Customer'}\n                    {step === 'review' && `Review & Finalize - ${getCustomerName(selectedCustomer)}`}\n                    {step === 'completed' && 'Payment Completed'}\n                  </DialogTitle>\n                  <DialogDescription>\n                    {step === 'select' && 'Select a customer to view and edit their invoices'}\n                    {step === 'review' && (customerSummary && customerSummary.totalPayments > 0 \n                      ? 'Review products taken and record remaining payment' \n                      : 'Review invoice details, edit prices if needed, then finalize payment')}\n                    {step === 'completed' && 'Payment has been recorded successfully'}\n                  </DialogDescription>\n                </DialogHeader>\n                \n                {step === 'select' && (\n                  <div className=\"space-y-4 pt-4\">\n                    <div className=\"space-y-2\">\n                      <Label>Customer</Label>\n                      <Select value={selectedCustomer} onValueChange={handleCustomerSelect}>\n                        <SelectTrigger data-testid=\"select-customer\">\n                          <SelectValue placeholder=\"Select customer\" />\n                        </SelectTrigger>\n                        <SelectContent>\n                          {customers.map((customer) => (\n                            <SelectItem key={customer.id} value={customer.id}>\n                              {customer.name}\n                            </SelectItem>\n                          ))}\n                        </SelectContent>\n                      </Select>\n                    </div>\n                    {loadingInvoices && (\n                      <div className=\"flex items-center gap-2 text-muted-foreground\">\n                        <Skeleton className=\"h-4 w-4 animate-spin rounded-full\" />\n                        Loading invoices...\n                      </div>\n                    )}\n                  </div>\n                )}\n\n                {step === 'review' && (\n                  <div className=\"space-y-4\">\n                    <div className=\"flex items-center justify-between gap-2 flex-wrap\">\n                      <div className=\"flex items-center gap-2\">\n                        <Button variant=\"ghost\" size=\"sm\" onClick={() => setStep('select')}>\n                          <X className=\"h-4 w-4 mr-1\" /> Back\n                        </Button>\n                        <Badge variant=\"outline\">{customerInvoices.length} Invoice(s)</Badge>\n                      </div>\n                      {customerSummary && (\n                        <div className=\"flex items-center gap-3 text-sm\">\n                          <span className=\"text-muted-foreground\">\n                            Total: <span className=\"font-mono\">{customerSummary.totalInvoices.toLocaleString(\"en-IN\", { style: \"currency\", currency: \"INR\" })}</span>\n                          </span>\n                          <span className=\"text-muted-foreground\">\n                            Paid: <span className=\"font-mono text-green-600\">{customerSummary.totalPayments.toLocaleString(\"en-IN\", { style: \"currency\", currency: \"INR\" })}</span>\n                          </span>\n                          <span className={customerSummary.remainingBalance > 0 ? \"text-red-600 font-semibold\" : \"text-green-600 font-semibold\"}>\n                            Due: <span className=\"font-mono\">{customerSummary.remainingBalance.toLocaleString(\"en-IN\", { style: \"currency\", currency: \"INR\" })}</span>\n                          </span>\n                        </div>\n                      )}\n                    </div>\n\n                    {customerSummary && customerSummary.totalPayments > 0 ? (\n                      <div className=\"border rounded-md\">\n                        <div className=\"p-4 space-y-4\">\n                          <div className=\"text-sm text-muted-foreground mb-2\">\n                            Products taken by customer (read-only - already invoiced)\n                          </div>\n                          {customerInvoices.map((invoice) => (\n                            <Card key={invoice.id} className=\"overflow-hidden\" data-testid={`card-invoice-${invoice.id}`}>\n                              <CardHeader className=\"py-2 bg-muted/30\">\n                                <div className=\"flex items-center justify-between gap-2 flex-wrap\">\n                                  <div className=\"flex items-center gap-2\">\n                                    <CardTitle className=\"text-sm\">{invoice.invoiceNumber}</CardTitle>\n                                    <Badge variant=\"secondary\" className=\"text-xs\">{invoice.date}</Badge>\n                                  </div>\n                                </div>\n                              </CardHeader>\n                              <CardContent className=\"p-3 space-y-2\">\n                                <Table>\n                                  <TableHeader>\n                                    <TableRow>\n                                      <TableHead className=\"text-xs\">Product</TableHead>\n                                      <TableHead className=\"text-xs text-center\">Qty</TableHead>\n                                      <TableHead className=\"text-xs text-right\">Rate</TableHead>\n                                      <TableHead className=\"text-xs text-right\">Amount</TableHead>\n                                    </TableRow>\n                                  </TableHeader>\n                                  <TableBody>\n                                    {invoice.items.map((item) => (\n                                      <TableRow key={item.id}>\n                                        <TableCell className=\"text-sm\">{item.product?.name || 'Unknown'}</TableCell>\n                                        <TableCell className=\"text-sm text-center\">{item.quantity}</TableCell>\n                                        <TableCell className=\"text-sm text-right font-mono\">₹{item.unitPrice}</TableCell>\n                                        <TableCell className=\"text-sm text-right font-mono\">{item.total.toLocaleString(\"en-IN\", { style: \"currency\", currency: \"INR\" })}</TableCell>\n                                      </TableRow>\n                                    ))}\n                                  </TableBody>\n                                </Table>\n                                <div className=\"flex items-center justify-between pt-2 border-t text-sm\">\n                                  <span className=\"text-muted-foreground\">\n                                    Hamali: {invoice.bags || 0} bags × ₹{invoice.hamaliRatePerBag || 0} = <span className=\"font-mono\">₹{invoice.hamaliChargeAmount || 0}</span>\n                                  </span>\n                                  <span className=\"font-semibold\">\n                                    Total: <span className=\"font-mono text-primary\">{invoice.grandTotal.toLocaleString(\"en-IN\", { style: \"currency\", currency: \"INR\" })}</span>\n                                  </span>\n                                </div>\n                              </CardContent>\n                            </Card>\n                          ))}\n                        </div>\n                      </div>\n                    ) : (\n                      <div className=\"border rounded-md\">\n                        <div className=\"p-4 space-y-6\">\n                          {customerInvoices.length === 0 ? (\n                            <div className=\"text-center text-muted-foreground py-8\">\n                              No invoices found for this customer\n                            </div>\n                          ) : (\n                            customerInvoices.map((invoice) => {\n                              const edited = editedInvoices[invoice.id];\n                              const totals = getInvoiceTotal(invoice.id);\n                              \n                              return (\n                                <Card key={invoice.id} className=\"overflow-hidden\" data-testid={`card-invoice-${invoice.id}`}>\n                                  <CardHeader className=\"py-3 bg-muted/30\">\n                                    <div className=\"flex items-center justify-between gap-2 flex-wrap\">\n                                      <div className=\"flex items-center gap-2\">\n                                        <CardTitle className=\"text-sm\">{invoice.invoiceNumber}</CardTitle>\n                                        <Badge variant=\"secondary\" className=\"text-xs\">{invoice.date}</Badge>\n                                      </div>\n                                      <Badge variant={invoice.status === 'completed' ? 'default' : 'outline'}>\n                                        {invoice.status}\n                                      </Badge>\n                                    </div>\n                                  </CardHeader>\n                                  <CardContent className=\"p-3 space-y-3\">\n                                    <Table>\n                                      <TableHeader>\n                                        <TableRow>\n                                          <TableHead className=\"text-xs\">Product</TableHead>\n                                          <TableHead className=\"text-xs text-center\">Qty</TableHead>\n                                          <TableHead className=\"text-xs text-center\">Price/Unit</TableHead>\n                                          <TableHead className=\"text-xs text-right\">Total</TableHead>\n                                        </TableRow>\n                                      </TableHeader>\n                                      <TableBody>\n                                        {invoice.items.map((item) => {\n                                          const editedItem = edited?.items.find(e => e.itemId === item.id);\n                                          const currentPrice = editedItem?.unitPrice ?? item.unitPrice;\n                                          const currentTotal = editedItem?.total ?? item.total;\n                                          \n                                          return (\n                                            <TableRow key={item.id} data-testid={`row-item-${item.id}`}>\n                                              <TableCell className=\"text-sm\">{item.product?.name || 'Unknown'}</TableCell>\n                                              <TableCell className=\"text-sm text-center\">{item.quantity}</TableCell>\n                                              <TableCell className=\"text-center\">\n                                                <Input\n                                                  type=\"number\"\n                                                  className=\"h-7 w-20 text-center text-sm mx-auto\"\n                                                  value={currentPrice}\n                                                  onChange={(e) => updateItemPrice(invoice.id, item.id, parseFloat(e.target.value) || 0)}\n                                                  data-testid={`input-price-${item.id}`}\n                                                />\n                                              </TableCell>\n                                              <TableCell className=\"text-sm text-right font-mono\">\n                                                {currentTotal.toLocaleString(\"en-IN\", { style: \"currency\", currency: \"INR\" })}\n                                              </TableCell>\n                                            </TableRow>\n                                          );\n                                        })}\n                                      </TableBody>\n                                    </Table>\n                                  </CardContent>\n                                </Card>\n                              );\n                            })\n                          )}\n                        </div>\n                      </div>\n                    )}\n\n                    <div className=\"pt-4 border-t space-y-3\">\n                      {customerSummary && customerSummary.totalPayments > 0 ? (\n                        <div className=\"text-sm text-muted-foreground text-center py-2\">\n                          Invoice details are locked after first payment\n                        </div>\n                      ) : (\n                        customerInvoices.map((invoice) => {\n                          const edited = editedInvoices[invoice.id];\n                          const totals = getInvoiceTotal(invoice.id);\n                          \n                          return (\n                            <div key={invoice.id} className=\"space-y-2 pb-3 border-b last:border-b-0\">\n                              <div className=\"flex items-center gap-2 flex-wrap\">\n                                <span className=\"text-xs text-muted-foreground font-medium\">{invoice.invoiceNumber}:</span>\n                                <span className=\"text-xs text-muted-foreground\">Hamali:</span>\n                                <Input\n                                  type=\"number\"\n                                  className=\"h-7 w-16 text-center text-sm\"\n                                  value={edited?.bags ?? 0}\n                                  onChange={(e) => updateHamaliBags(invoice.id, parseInt(e.target.value) || 0)}\n                                  placeholder=\"Bags\"\n                                  data-testid={`input-bags-fixed-${invoice.id}`}\n                                />\n                                <span className=\"text-xs\">bags ×</span>\n                                <Input\n                                  type=\"number\"\n                                  className=\"h-7 w-16 text-center text-sm\"\n                                  value={edited?.ratePerBag ?? 0}\n                                  onChange={(e) => updateHamaliRate(invoice.id, parseFloat(e.target.value) || 0)}\n                                  placeholder=\"₹/bag\"\n                                  data-testid={`input-rate-fixed-${invoice.id}`}\n                                />\n                                <span className=\"text-xs\">=</span>\n                                <span className=\"text-sm font-medium font-mono\">\n                                  ₹{(edited?.hamaliChargeAmount ?? 0).toFixed(0)}\n                                </span>\n                              </div>\n                              <div className=\"flex items-center justify-end gap-4 text-sm\">\n                                <span className=\"text-muted-foreground\">\n                                  Subtotal: <span className=\"font-mono\">{totals.subtotal.toLocaleString(\"en-IN\", { style: \"currency\", currency: \"INR\" })}</span>\n                                </span>\n                                <span className=\"text-muted-foreground\">\n                                  Hamali: <span className=\"font-mono\">{(edited?.hamaliChargeAmount ?? 0).toLocaleString(\"en-IN\", { style: \"currency\", currency: \"INR\" })}</span>\n                                </span>\n                                <span className=\"font-semibold\">\n                                  Total: <span className=\"font-mono text-primary\">{totals.grandTotal.toLocaleString(\"en-IN\", { style: \"currency\", currency: \"INR\" })}</span>\n                                </span>\n                              </div>\n                            </div>\n                          );\n                        })\n                      )}\n                      \n                      <div className=\"space-y-2 pt-2\">\n                        <div className=\"flex items-center justify-between\">\n                          <span className=\"text-base text-muted-foreground\">Grand Total (All Invoices):</span>\n                          <span className=\"text-lg font-bold font-mono\" data-testid=\"text-grand-total\">\n                            {grandTotalAllInvoices.toLocaleString(\"en-IN\", { style: \"currency\", currency: \"INR\" })}\n                          </span>\n                        </div>\n                        {customerSummary && customerSummary.totalPayments > 0 && (\n                          <div className=\"flex items-center justify-between\">\n                            <span className=\"text-base text-muted-foreground\">Already Paid:</span>\n                            <span className=\"text-lg font-mono text-green-600\">\n                              -{customerSummary.totalPayments.toLocaleString(\"en-IN\", { style: \"currency\", currency: \"INR\" })}\n                            </span>\n                          </div>\n                        )}\n                        <div className=\"flex items-center justify-between border-t pt-2\">\n                          <span className=\"text-lg font-medium\">Remaining Balance:</span>\n                          <span className={`text-2xl font-bold font-mono ${customerSummary && customerSummary.remainingBalance > 0 ? 'text-red-600' : 'text-green-600'}`}>\n                            {(customerSummary?.remainingBalance ?? grandTotalAllInvoices).toLocaleString(\"en-IN\", { style: \"currency\", currency: \"INR\" })}\n                          </span>\n                        </div>\n                      </div>\n\n                      <div className=\"grid grid-cols-2 gap-4\">\n                        <div className=\"space-y-2\">\n                          <Label>Payment Method</Label>\n                          <Select value={customerPaymentMethod} onValueChange={setCustomerPaymentMethod}>\n                            <SelectTrigger data-testid=\"select-customer-payment-method\">\n                              <SelectValue placeholder=\"Select method\" />\n                            </SelectTrigger>\n                            <SelectContent>\n                              <SelectItem value=\"cash\">Cash</SelectItem>\n                              <SelectItem value=\"bank\">Bank Transfer</SelectItem>\n                              <SelectItem value=\"upi\">UPI</SelectItem>\n                              <SelectItem value=\"cheque\">Cheque</SelectItem>\n                            </SelectContent>\n                          </Select>\n                        </div>\n                        <div className=\"space-y-2\">\n                          <Label>Payment Amount (Enter amount to pay now)</Label>\n                          <Input\n                            type=\"number\"\n                            value={customerPaymentAmount}\n                            onChange={(e) => setCustomerPaymentAmount(e.target.value)}\n                            placeholder={`Max: ${(customerSummary?.remainingBalance ?? grandTotalAllInvoices).toLocaleString(\"en-IN\")}`}\n                            data-testid=\"input-customer-payment-amount\"\n                          />\n                        </div>\n                      </div>\n\n                      <div className=\"flex gap-2\">\n                        {(!customerSummary || customerSummary.totalPayments === 0) && (\n                          <Button\n                            variant=\"outline\"\n                            onClick={() => saveInvoiceChanges.mutate()}\n                            disabled={saveInvoiceChanges.isPending}\n                            className=\"flex-1\"\n                            data-testid=\"button-save-changes\"\n                          >\n                            <Save className=\"h-4 w-4 mr-2\" />\n                            {saveInvoiceChanges.isPending ? \"Saving...\" : \"Save Changes Only\"}\n                          </Button>\n                        )}\n                        <Button\n                          onClick={handleFinalizeAndPay}\n                          disabled={customerInvoices.length === 0 || createCustomerPayment.isPending || saveInvoiceChanges.isPending}\n                          className=\"flex-1\"\n                          data-testid=\"button-finalize-payment\"\n                        >\n                          {createCustomerPayment.isPending ? \"Processing...\" : \"Finalize & Record Payment\"}\n                        </Button>\n                      </div>\n                    </div>\n                  </div>\n                )}\n\n                {step === 'completed' && completedPaymentData && (\n                  <ScrollArea className=\"flex-1\">\n                    <div className=\"flex flex-col items-center justify-center space-y-6 py-6 px-4\">\n                      <div className=\"rounded-full bg-primary/10 p-4\">\n                        <CheckCircle className=\"h-12 w-12 text-primary\" />\n                      </div>\n                      \n                      <div className=\"text-center space-y-1\">\n                        <h3 className=\"text-lg font-semibold\">Payment Recorded Successfully</h3>\n                        <p className=\"text-sm text-muted-foreground\">\n                          Payment of {completedPaymentData.amount.toLocaleString(\"en-IN\", { style: \"currency\", currency: \"INR\" })} received from {completedPaymentData.customerName}\n                        </p>\n                      </div>\n\n                      <Card className=\"w-full max-w-sm\">\n                        <CardContent className=\"pt-4 space-y-2\">\n                          <div className=\"flex justify-between text-sm\">\n                            <span className=\"text-muted-foreground\">Customer:</span>\n                            <span className=\"font-medium\">{completedPaymentData.customerName}</span>\n                          </div>\n                          <div className=\"flex justify-between text-sm\">\n                            <span className=\"text-muted-foreground\">Date:</span>\n                            <span className=\"font-medium\">{completedPaymentData.date}</span>\n                          </div>\n                          <div className=\"flex justify-between text-sm\">\n                            <span className=\"text-muted-foreground\">Method:</span>\n                            <span className=\"font-medium capitalize\">{completedPaymentData.paymentMethod}</span>\n                          </div>\n                          <div className=\"flex justify-between text-sm\">\n                            <span className=\"text-muted-foreground\">Invoice{completedPaymentData.invoices.length > 1 ? 's' : ''}:</span>\n                            <span className=\"font-medium font-mono text-xs\">\n                              {completedPaymentData.invoices.map(inv => inv.invoiceNumber).join(', ')}\n                            </span>\n                          </div>\n                          <div className=\"flex justify-between text-sm border-t pt-2\">\n                            <span className=\"text-muted-foreground\">Total Bags:</span>\n                            <span className=\"font-medium font-mono\">\n                              {completedPaymentData.invoices.reduce((sum, inv) => {\n                                const edited = completedPaymentData.editedInvoices[inv.id];\n                                return sum + (edited?.bags || 0);\n                              }, 0)}\n                            </span>\n                          </div>\n                          <div className=\"flex justify-between text-sm\">\n                            <span className=\"text-muted-foreground\">Total Hamali:</span>\n                            <span className=\"font-medium font-mono\">\n                              {completedPaymentData.invoices.reduce((sum, inv) => {\n                                const edited = completedPaymentData.editedInvoices[inv.id];\n                                return sum + (edited?.hamaliChargeAmount || inv.hamaliChargeAmount || 0);\n                              }, 0).toLocaleString(\"en-IN\", { style: \"currency\", currency: \"INR\" })}\n                            </span>\n                          </div>\n                          <div className=\"flex justify-between text-sm border-t pt-2\">\n                            <span className=\"text-muted-foreground\">Grand Total:</span>\n                            <span className=\"font-medium font-mono\">\n                              {completedPaymentData.grandTotal.toLocaleString(\"en-IN\", { style: \"currency\", currency: \"INR\" })}\n                            </span>\n                          </div>\n                          {completedPaymentData.previouslyPaid > 0 && (\n                            <div className=\"flex justify-between text-sm\">\n                              <span className=\"text-muted-foreground\">Previously Paid:</span>\n                              <span className=\"font-medium font-mono text-green-600\">\n                                -{completedPaymentData.previouslyPaid.toLocaleString(\"en-IN\", { style: \"currency\", currency: \"INR\" })}\n                              </span>\n                            </div>\n                          )}\n                          <div className=\"flex justify-between text-sm\">\n                            <span className=\"text-muted-foreground\">This Payment:</span>\n                            <span className=\"font-medium font-mono text-primary\">\n                              {completedPaymentData.amount.toLocaleString(\"en-IN\", { style: \"currency\", currency: \"INR\" })}\n                            </span>\n                          </div>\n                          <div className=\"flex justify-between border-t pt-2\">\n                            <span className=\"font-medium\">Remaining Balance:</span>\n                            <span className={`text-lg font-bold font-mono ${(completedPaymentData.grandTotal - completedPaymentData.previouslyPaid - completedPaymentData.amount) > 0 ? 'text-destructive' : 'text-primary'}`}>\n                              {(completedPaymentData.grandTotal - completedPaymentData.previouslyPaid - completedPaymentData.amount).toLocaleString(\"en-IN\", { style: \"currency\", currency: \"INR\" })}\n                            </span>\n                          </div>\n                        </CardContent>\n                      </Card>\n\n                      <div className=\"flex gap-3\">\n                        <Button\n                          variant=\"outline\"\n                          onClick={handlePrintReceipt}\n                          data-testid=\"button-print-receipt\"\n                        >\n                          <Printer className=\"h-4 w-4 mr-2\" />\n                          Print Receipt\n                        </Button>\n                        <Button\n                          onClick={() => handleCustomerDialogClose(false)}\n                          data-testid=\"button-close-payment\"\n                        >\n                          Done\n                        </Button>\n                      </div>\n                    </div>\n                  </ScrollArea>\n                )}\n              </DialogContent>\n            </Dialog>\n          </div>\n\n          <Card>\n            <CardHeader>\n              <CardTitle>Customer Balances</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead>Customer</TableHead>\n                    <TableHead className=\"text-right\">Total Invoices</TableHead>\n                    <TableHead className=\"text-right\">Total Paid</TableHead>\n                    <TableHead className=\"text-right\">Balance</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {customerBalances.length === 0 ? (\n                    <TableRow>\n                      <TableCell colSpan={4} className=\"text-center text-muted-foreground py-8\">\n                        No customer data available\n                      </TableCell>\n                    </TableRow>\n                  ) : (\n                    customerBalances.map((customer) => (\n                      <TableRow key={customer.id} data-testid={`row-customer-${customer.id}`}>\n                        <TableCell className=\"font-medium\">{customer.name}</TableCell>\n                        <TableCell className=\"text-right font-mono\">\n                          {customer.totalInvoices.toLocaleString(\"en-IN\", { style: \"currency\", currency: \"INR\" })}\n                        </TableCell>\n                        <TableCell className=\"text-right font-mono\">\n                          {customer.totalPayments.toLocaleString(\"en-IN\", { style: \"currency\", currency: \"INR\" })}\n                        </TableCell>\n                        <TableCell className=\"text-right font-mono font-semibold\">\n                          {customer.balance.toLocaleString(\"en-IN\", { style: \"currency\", currency: \"INR\" })}\n                        </TableCell>\n                      </TableRow>\n                    ))\n                  )}\n                </TableBody>\n              </Table>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader className=\"flex flex-row items-center justify-between gap-2 flex-wrap\">\n              <CardTitle>Payment History</CardTitle>\n              <div className=\"flex items-center gap-2 flex-wrap\">\n                <Select value={historyCustomerFilter} onValueChange={setHistoryCustomerFilter}>\n                  <SelectTrigger className=\"w-48\" data-testid=\"select-history-customer\">\n                    <SelectValue placeholder=\"Filter by customer\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"all\">All Customers</SelectItem>\n                    {customers.map((customer) => (\n                      <SelectItem key={customer.id} value={customer.id}>\n                        {customer.name}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n                <Button\n                  variant=\"outline\"\n                  size=\"sm\"\n                  onClick={() => printPaymentHistory()}\n                  disabled={filteredCustomerPayments.length === 0}\n                  data-testid=\"button-print-payment-history\"\n                >\n                  <Printer className=\"h-4 w-4 mr-2\" />\n                  Print\n                </Button>\n              </div>\n            </CardHeader>\n            <CardContent>\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead>Date</TableHead>\n                    <TableHead>Customer</TableHead>\n                    <TableHead>Invoice</TableHead>\n                    <TableHead>Method</TableHead>\n                    <TableHead className=\"text-right\">Amount</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {filteredCustomerPayments.length === 0 ? (\n                    <TableRow>\n                      <TableCell colSpan={5} className=\"text-center text-muted-foreground py-8\">\n                        No payment history\n                      </TableCell>\n                    </TableRow>\n                  ) : (\n                    filteredCustomerPayments.map((payment) => (\n                      <TableRow key={payment.id} data-testid={`row-customer-payment-${payment.id}`}>\n                        <TableCell>{payment.date}</TableCell>\n                        <TableCell>{getCustomerName(payment.customerId)}</TableCell>\n                        <TableCell>\n                          {payment.invoiceNumber ? (\n                            <Badge variant=\"outline\" className=\"font-mono text-xs\">\n                              {payment.invoiceNumber}\n                            </Badge>\n                          ) : (\n                            <span className=\"text-muted-foreground\">-</span>\n                          )}\n                        </TableCell>\n                        <TableCell className=\"capitalize\">{payment.paymentMethod}</TableCell>\n                        <TableCell className=\"text-right font-mono\">\n                          {payment.amount.toLocaleString(\"en-IN\", { style: \"currency\", currency: \"INR\" })}\n                        </TableCell>\n                      </TableRow>\n                    ))\n                  )}\n                </TableBody>\n              </Table>\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        <TabsContent value=\"hamali\" className=\"space-y-4\">\n          <div className=\"flex justify-end\">\n            <Dialog open={hamaliDialogOpen} onOpenChange={setHamaliDialogOpen}>\n              <DialogTrigger asChild>\n                <Button data-testid=\"button-add-hamali-payment\">\n                  <Plus className=\"h-4 w-4 mr-2\" />\n                  Record Hamali Cash\n                </Button>\n              </DialogTrigger>\n              <DialogContent>\n                <DialogHeader>\n                  <DialogTitle>Record Hamali Cash Payment</DialogTitle>\n                  <DialogDescription>Record direct cash given for Hamali (not through invoice)</DialogDescription>\n                </DialogHeader>\n                <div className=\"space-y-4 pt-4\">\n                  <div className=\"space-y-2\">\n                    <Label>Amount</Label>\n                    <Input\n                      type=\"number\"\n                      value={hamaliAmount}\n                      onChange={(e) => setHamaliAmount(e.target.value)}\n                      placeholder=\"Enter amount\"\n                      data-testid=\"input-hamali-amount\"\n                    />\n                  </div>\n                  <div className=\"space-y-2\">\n                    <Label>Customer (Optional)</Label>\n                    <Select value={hamaliCustomerId} onValueChange={setHamaliCustomerId}>\n                      <SelectTrigger data-testid=\"select-hamali-customer\">\n                        <SelectValue placeholder=\"Select customer (optional)\" />\n                      </SelectTrigger>\n                      <SelectContent>\n                        <SelectItem value=\"none\">No customer</SelectItem>\n                        {customers.map((customer) => (\n                          <SelectItem key={customer.id} value={customer.id}>\n                            {customer.name}\n                          </SelectItem>\n                        ))}\n                      </SelectContent>\n                    </Select>\n                  </div>\n                  <div className=\"space-y-2\">\n                    <Label>Notes (Optional)</Label>\n                    <Input\n                      value={hamaliNotes}\n                      onChange={(e) => setHamaliNotes(e.target.value)}\n                      placeholder=\"Add notes\"\n                      data-testid=\"input-hamali-notes\"\n                    />\n                  </div>\n                  <Button\n                    onClick={handleHamaliPayment}\n                    disabled={!hamaliAmount || createHamaliCashPayment.isPending}\n                    className=\"w-full\"\n                    data-testid=\"button-submit-hamali-payment\"\n                  >\n                    {createHamaliCashPayment.isPending ? \"Recording...\" : \"Record Payment\"}\n                  </Button>\n                </div>\n              </DialogContent>\n            </Dialog>\n          </div>\n\n          <Card>\n            <CardHeader>\n              <CardTitle>Direct Hamali Cash Payments</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead>Date</TableHead>\n                    <TableHead>Customer</TableHead>\n                    <TableHead>Notes</TableHead>\n                    <TableHead className=\"text-right\">Amount</TableHead>\n                    <TableHead className=\"w-12\"></TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {hamaliCashPayments.length === 0 ? (\n                    <TableRow>\n                      <TableCell colSpan={5} className=\"text-center text-muted-foreground py-8\">\n                        No direct Hamali cash payments recorded\n                      </TableCell>\n                    </TableRow>\n                  ) : (\n                    hamaliCashPayments.map((payment) => (\n                      <TableRow key={payment.id} data-testid={`row-hamali-payment-${payment.id}`}>\n                        <TableCell>{payment.date}</TableCell>\n                        <TableCell>{payment.customerId ? getCustomerName(payment.customerId) : \"-\"}</TableCell>\n                        <TableCell className=\"text-muted-foreground\">{payment.notes || \"-\"}</TableCell>\n                        <TableCell className=\"text-right font-mono\">\n                          {payment.amount.toLocaleString(\"en-IN\", { style: \"currency\", currency: \"INR\" })}\n                        </TableCell>\n                        <TableCell>\n                          <Button\n                            size=\"icon\"\n                            variant=\"ghost\"\n                            onClick={() => deleteHamaliCashPayment.mutate(payment.id)}\n                            disabled={deleteHamaliCashPayment.isPending}\n                            data-testid={`button-delete-hamali-${payment.id}`}\n                          >\n                            <Trash2 className=\"h-4 w-4 text-destructive\" />\n                          </Button>\n                        </TableCell>\n                      </TableRow>\n                    ))\n                  )}\n                </TableBody>\n              </Table>\n              {hamaliCashPayments.length > 0 && (\n                <div className=\"mt-4 pt-4 border-t flex justify-between items-center\">\n                  <span className=\"text-muted-foreground\">Total Direct Hamali Cash:</span>\n                  <span className=\"text-xl font-bold font-mono\" data-testid=\"text-hamali-cash-total\">\n                    {hamaliCashPayments.reduce((sum, p) => sum + p.amount, 0).toLocaleString(\"en-IN\", { style: \"currency\", currency: \"INR\" })}\n                  </span>\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        </TabsContent>\n      </Tabs>\n    </div>\n  );\n}\n","path":null,"size_bytes":78886,"size_tokens":null},"client/src/components/ui/menubar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as MenubarPrimitive from \"@radix-ui/react-menubar\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction MenubarMenu({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Menu>) {\n  return <MenubarPrimitive.Menu {...props} />\n}\n\nfunction MenubarGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Group>) {\n  return <MenubarPrimitive.Group {...props} />\n}\n\nfunction MenubarPortal({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Portal>) {\n  return <MenubarPrimitive.Portal {...props} />\n}\n\nfunction MenubarRadioGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.RadioGroup>) {\n  return <MenubarPrimitive.RadioGroup {...props} />\n}\n\nfunction MenubarSub({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Sub>) {\n  return <MenubarPrimitive.Sub data-slot=\"menubar-sub\" {...props} />\n}\n\nconst Menubar = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"flex h-10 items-center space-x-1 rounded-md border bg-background p-1\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubar.displayName = MenubarPrimitive.Root.displayName\n\nconst MenubarTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-3 py-1.5 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName\n\nconst MenubarSubTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <MenubarPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </MenubarPrimitive.SubTrigger>\n))\nMenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName\n\nconst MenubarSubContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName\n\nconst MenubarContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>\n>(\n  (\n    { className, align = \"start\", alignOffset = -4, sideOffset = 8, ...props },\n    ref\n  ) => (\n    <MenubarPrimitive.Portal>\n      <MenubarPrimitive.Content\n        ref={ref}\n        align={align}\n        alignOffset={alignOffset}\n        sideOffset={sideOffset}\n        className={cn(\n          \"z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n          className\n        )}\n        {...props}\n      />\n    </MenubarPrimitive.Portal>\n  )\n)\nMenubarContent.displayName = MenubarPrimitive.Content.displayName\n\nconst MenubarItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarItem.displayName = MenubarPrimitive.Item.displayName\n\nconst MenubarCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <MenubarPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.CheckboxItem>\n))\nMenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName\n\nconst MenubarRadioItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <MenubarPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.RadioItem>\n))\nMenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName\n\nconst MenubarLabel = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarLabel.displayName = MenubarPrimitive.Label.displayName\n\nconst MenubarSeparator = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nMenubarSeparator.displayName = MenubarPrimitive.Separator.displayName\n\nconst MenubarShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nMenubarShortcut.displayname = \"MenubarShortcut\"\n\nexport {\n  Menubar,\n  MenubarMenu,\n  MenubarTrigger,\n  MenubarContent,\n  MenubarItem,\n  MenubarSeparator,\n  MenubarLabel,\n  MenubarCheckboxItem,\n  MenubarRadioGroup,\n  MenubarRadioItem,\n  MenubarPortal,\n  MenubarSubContent,\n  MenubarSubTrigger,\n  MenubarGroup,\n  MenubarSub,\n  MenubarShortcut,\n}\n","path":null,"size_bytes":8605,"size_tokens":null},"client/src/components/ui/badge.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  // Whitespace-nowrap: Badges should never wrap.\n  \"whitespace-nowrap inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\" +\n  \" hover-elevate \" ,\n  {\n    variants: {\n      variant: {\n        default:\n          \"border-transparent bg-primary text-primary-foreground shadow-xs\",\n        secondary: \"border-transparent bg-secondary text-secondary-foreground\",\n        destructive:\n          \"border-transparent bg-destructive text-destructive-foreground shadow-xs\",\n\n        outline: \" border [border-color:var(--badge-outline)] shadow-xs\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  },\n)\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  );\n}\n\nexport { Badge, badgeVariants }\n","path":null,"size_bytes":1202,"size_tokens":null},"vite.config.ts":{"content":"import { defineConfig } from \"vite\";\nimport react from \"@vitejs/plugin-react\";\nimport path from \"path\";\nimport runtimeErrorOverlay from \"@replit/vite-plugin-runtime-error-modal\";\n\nexport default defineConfig({\n  plugins: [\n    react(),\n    runtimeErrorOverlay(),\n    ...(process.env.NODE_ENV !== \"production\" &&\n    process.env.REPL_ID !== undefined\n      ? [\n          await import(\"@replit/vite-plugin-cartographer\").then((m) =>\n            m.cartographer(),\n          ),\n          await import(\"@replit/vite-plugin-dev-banner\").then((m) =>\n            m.devBanner(),\n          ),\n        ]\n      : []),\n  ],\n  resolve: {\n    alias: {\n      \"@\": path.resolve(import.meta.dirname, \"client\", \"src\"),\n      \"@shared\": path.resolve(import.meta.dirname, \"shared\"),\n      \"@assets\": path.resolve(import.meta.dirname, \"attached_assets\"),\n    },\n  },\n  root: path.resolve(import.meta.dirname, \"client\"),\n  build: {\n    outDir: path.resolve(import.meta.dirname, \"dist/public\"),\n    emptyOutDir: true,\n  },\n  server: {\n    fs: {\n      strict: true,\n      deny: [\"**/.*\"],\n    },\n  },\n});\n","path":null,"size_bytes":1080,"size_tokens":null},"client/src/pages/not-found.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { AlertCircle } from \"lucide-react\";\n\nexport default function NotFound() {\n  return (\n    <div className=\"min-h-screen w-full flex items-center justify-center bg-gray-50\">\n      <Card className=\"w-full max-w-md mx-4\">\n        <CardContent className=\"pt-6\">\n          <div className=\"flex mb-4 gap-2\">\n            <AlertCircle className=\"h-8 w-8 text-red-500\" />\n            <h1 className=\"text-2xl font-bold text-gray-900\">404 Page Not Found</h1>\n          </div>\n\n          <p className=\"mt-4 text-sm text-gray-600\">\n            Did you forget to add the page to the router?\n          </p>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":711,"size_tokens":null},"client/src/components/ui/dialog.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Dialog = DialogPrimitive.Root\n\nconst DialogTrigger = DialogPrimitive.Trigger\n\nconst DialogPortal = DialogPrimitive.Portal\n\nconst DialogClose = DialogPrimitive.Close\n\nconst DialogOverlay = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Overlay\n    ref={ref}\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogOverlay.displayName = DialogPrimitive.Overlay.displayName\n\nconst DialogContent = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DialogPortal>\n    <DialogOverlay />\n    <DialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <DialogPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </DialogPrimitive.Close>\n    </DialogPrimitive.Content>\n  </DialogPortal>\n))\nDialogContent.displayName = DialogPrimitive.Content.displayName\n\nconst DialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-1.5 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogHeader.displayName = \"DialogHeader\"\n\nconst DialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogFooter.displayName = \"DialogFooter\"\n\nconst DialogTitle = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogTitle.displayName = DialogPrimitive.Title.displayName\n\nconst DialogDescription = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDialogDescription.displayName = DialogPrimitive.Description.displayName\n\nexport {\n  Dialog,\n  DialogPortal,\n  DialogOverlay,\n  DialogClose,\n  DialogTrigger,\n  DialogContent,\n  DialogHeader,\n  DialogFooter,\n  DialogTitle,\n  DialogDescription,\n}\n","path":null,"size_bytes":3848,"size_tokens":null},"client/src/pages/reports.tsx":{"content":"import { useState, useMemo } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Button } from \"@/components/ui/button\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { TrendingUp, Package, ArrowUpRight, Receipt, CreditCard, Download, Calendar, Filter, Truck, Users, Scale, ShoppingBag, FileText, BarChart3 } from \"lucide-react\";\nimport type { Product, Invoice, Customer, Vehicle, InvoiceItem } from \"@shared/schema\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport {\n  BarChart,\n  Bar,\n  XAxis,\n  YAxis,\n  Tooltip,\n  ResponsiveContainer,\n  PieChart,\n  Pie,\n  Cell,\n  Legend,\n} from \"recharts\";\n\ntype PeriodType = \"today\" | \"week\" | \"month\" | \"custom\";\n\ntype DailySummary = {\n  date: string;\n  sales: number;\n  invoiceCount: number;\n  hamaliTotal: number;\n  totalWeight: number;\n};\n\nfunction formatCurrency(amount: number): string {\n  return amount.toLocaleString(\"en-IN\", { style: \"currency\", currency: \"INR\" });\n}\n\nfunction formatWeight(weight: number): string {\n  return `${weight.toFixed(2)} KG`;\n}\n\nfunction downloadCSV(data: string[][], filename: string) {\n  const csvContent = data.map(row => row.map(cell => `\"${cell}\"`).join(\",\")).join(\"\\n\");\n  const blob = new Blob([csvContent], { type: \"text/csv;charset=utf-8;\" });\n  const link = document.createElement(\"a\");\n  link.href = URL.createObjectURL(blob);\n  link.download = filename;\n  link.click();\n  URL.revokeObjectURL(link.href);\n}\n\nexport default function Reports() {\n  const today = new Date().toISOString().split(\"T\")[0];\n  const weekAgo = new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString().split(\"T\")[0];\n  const monthAgo = new Date(Date.now() - 30 * 24 * 60 * 60 * 1000).toISOString().split(\"T\")[0];\n  \n  const [periodType, setPeriodType] = useState<PeriodType>(\"today\");\n  const [customStartDate, setCustomStartDate] = useState(monthAgo);\n  const [customEndDate, setCustomEndDate] = useState(today);\n  const [selectedVehicleId, setSelectedVehicleId] = useState<string>(\"all\");\n  const [selectedCustomerId, setSelectedCustomerId] = useState<string>(\"all\");\n\n  const { startDate, endDate } = useMemo(() => {\n    switch (periodType) {\n      case \"today\":\n        return { startDate: today, endDate: today };\n      case \"week\":\n        return { startDate: weekAgo, endDate: today };\n      case \"month\":\n        return { startDate: monthAgo, endDate: today };\n      case \"custom\":\n        return { startDate: customStartDate, endDate: customEndDate };\n      default:\n        return { startDate: today, endDate: today };\n    }\n  }, [periodType, customStartDate, customEndDate, today, weekAgo, monthAgo]);\n\n  const { data: products = [] } = useQuery<Product[]>({\n    queryKey: [\"/api/products\"],\n  });\n\n  const { data: invoices = [], isLoading: invoicesLoading } = useQuery<Invoice[]>({\n    queryKey: [\"/api/invoices\"],\n  });\n\n  const { data: invoiceItems = [] } = useQuery<InvoiceItem[]>({\n    queryKey: [\"/api/invoice-items\"],\n  });\n\n  const { data: customers = [] } = useQuery<Customer[]>({\n    queryKey: [\"/api/customers\"],\n  });\n\n  const { data: vehicles = [] } = useQuery<Vehicle[]>({\n    queryKey: [\"/api/vehicles\"],\n  });\n\n  const getCustomerName = (id: string) => customers.find((c) => c.id === id)?.name || \"Unknown\";\n  const getProductName = (id: string) => products.find((p) => p.id === id)?.name || \"Unknown\";\n  const getVehicleNumber = (id: string | null) => vehicles.find((v) => v.id === id)?.number || \"-\";\n\n  const filteredInvoices = useMemo(() => {\n    return invoices.filter((inv) => {\n      if (startDate && inv.date < startDate) return false;\n      if (endDate && inv.date > endDate) return false;\n      if (selectedVehicleId !== \"all\" && inv.vehicleId !== selectedVehicleId) return false;\n      if (selectedCustomerId !== \"all\" && inv.customerId !== selectedCustomerId) return false;\n      return true;\n    }).sort((a, b) => b.date.localeCompare(a.date) || b.invoiceNumber.localeCompare(a.invoiceNumber));\n  }, [invoices, startDate, endDate, selectedVehicleId, selectedCustomerId]);\n\n  const summary = useMemo(() => {\n    const totalSales = filteredInvoices.reduce((sum, inv) => sum + (inv.grandTotal || 0), 0);\n    const totalSubtotal = filteredInvoices.reduce((sum, inv) => sum + (inv.subtotal || 0), 0);\n    const totalHamali = filteredInvoices.reduce((sum, inv) => sum + (inv.hamaliChargeAmount || 0), 0);\n    const totalWeight = filteredInvoices.reduce((sum, inv) => sum + (inv.totalKgWeight || 0), 0);\n    const invoiceCount = filteredInvoices.length;\n    const invoicesWithHamali = filteredInvoices.filter(inv => inv.includeHamaliCharge && (inv.hamaliChargeAmount || 0) > 0).length;\n\n    return {\n      totalSales,\n      totalSubtotal,\n      totalHamali,\n      totalWeight,\n      invoiceCount,\n      invoicesWithHamali,\n    };\n  }, [filteredInvoices]);\n\n  const dailySummary = useMemo((): DailySummary[] => {\n    const dateMap = new Map<string, DailySummary>();\n\n    filteredInvoices.forEach((inv) => {\n      const existing = dateMap.get(inv.date) || {\n        date: inv.date,\n        sales: 0,\n        invoiceCount: 0,\n        hamaliTotal: 0,\n        totalWeight: 0,\n      };\n      existing.sales += inv.grandTotal || 0;\n      existing.invoiceCount += 1;\n      existing.hamaliTotal += inv.hamaliChargeAmount || 0;\n      existing.totalWeight += inv.totalKgWeight || 0;\n      dateMap.set(inv.date, existing);\n    });\n\n    return Array.from(dateMap.values()).sort((a, b) => b.date.localeCompare(a.date));\n  }, [filteredInvoices]);\n\n  const chartData = useMemo(() => {\n    return [...dailySummary].reverse().slice(-14).map((day) => ({\n      date: new Date(day.date).toLocaleDateString(\"en-IN\", { day: \"2-digit\", month: \"short\" }),\n      sales: day.sales,\n      hamali: day.hamaliTotal,\n    }));\n  }, [dailySummary]);\n\n  const salesBreakdownData = useMemo(() => {\n    return [\n      { name: \"Product Sales\", value: summary.totalSubtotal },\n      { name: \"Hamali Charges\", value: summary.totalHamali },\n    ].filter((d) => d.value > 0);\n  }, [summary]);\n\n  const CHART_COLORS = [\n    \"hsl(var(--chart-1))\",\n    \"hsl(var(--chart-2))\",\n    \"hsl(var(--chart-3))\",\n    \"hsl(var(--chart-4))\",\n    \"hsl(var(--chart-5))\",\n  ];\n\n  const downloadSalesReport = () => {\n    const headers = [\"Invoice #\", \"Date\", \"Vehicle\", \"Customer\", \"Weight (KG)\", \"Subtotal\", \"Hamali\", \"Grand Total\"];\n    const rows = filteredInvoices.map((inv) => [\n      inv.invoiceNumber || \"\",\n      inv.date || \"\",\n      getVehicleNumber(inv.vehicleId),\n      getCustomerName(inv.customerId),\n      (inv.totalKgWeight || 0).toFixed(2),\n      (inv.subtotal || 0).toFixed(2),\n      (inv.hamaliChargeAmount || 0).toFixed(2),\n      (inv.grandTotal || 0).toFixed(2),\n    ]);\n    const totals = [\n      \"TOTAL\",\n      \"\",\n      \"\",\n      `${filteredInvoices.length} sales`,\n      summary.totalWeight.toFixed(2),\n      summary.totalSubtotal.toFixed(2),\n      summary.totalHamali.toFixed(2),\n      summary.totalSales.toFixed(2),\n    ];\n    downloadCSV([headers, ...rows, totals], `sales-report-${startDate}-to-${endDate}.csv`);\n  };\n\n  const downloadDailySummaryReport = () => {\n    const headers = [\"Date\", \"Total Sales\", \"Invoice Count\", \"Total Hamali\", \"Total Weight (KG)\"];\n    const rows = dailySummary.map((day) => [\n      day.date,\n      day.sales.toFixed(2),\n      day.invoiceCount.toString(),\n      day.hamaliTotal.toFixed(2),\n      day.totalWeight.toFixed(2),\n    ]);\n    const totals = [\n      \"TOTAL\",\n      dailySummary.reduce((sum, d) => sum + d.sales, 0).toFixed(2),\n      dailySummary.reduce((sum, d) => sum + d.invoiceCount, 0).toString(),\n      dailySummary.reduce((sum, d) => sum + d.hamaliTotal, 0).toFixed(2),\n      dailySummary.reduce((sum, d) => sum + d.totalWeight, 0).toFixed(2),\n    ];\n    downloadCSV([headers, ...rows, totals], `daily-summary-${startDate}-to-${endDate}.csv`);\n  };\n\n  const FilterSection = () => (\n    <Card className=\"mb-4\">\n      <CardHeader className=\"pb-3\">\n        <CardTitle className=\"text-base flex items-center gap-2\">\n          <Filter className=\"h-4 w-4\" />\n          Filters\n        </CardTitle>\n      </CardHeader>\n      <CardContent>\n        <div className=\"flex items-end gap-4 flex-wrap\">\n          <div className=\"space-y-2\">\n            <Label>Quick Select</Label>\n            <Select value={periodType} onValueChange={(v) => setPeriodType(v as PeriodType)}>\n              <SelectTrigger className=\"w-40\" data-testid=\"select-period-type\">\n                <SelectValue placeholder=\"Select period\" />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"today\">Today</SelectItem>\n                <SelectItem value=\"week\">Last 7 Days</SelectItem>\n                <SelectItem value=\"month\">Last 30 Days</SelectItem>\n                <SelectItem value=\"custom\">Custom Range</SelectItem>\n              </SelectContent>\n            </Select>\n          </div>\n          {periodType === \"custom\" && (\n            <>\n              <div className=\"space-y-2\">\n                <Label>From Date</Label>\n                <Input\n                  type=\"date\"\n                  value={customStartDate}\n                  onChange={(e) => setCustomStartDate(e.target.value)}\n                  data-testid=\"input-filter-start-date\"\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label>To Date</Label>\n                <Input\n                  type=\"date\"\n                  value={customEndDate}\n                  onChange={(e) => setCustomEndDate(e.target.value)}\n                  data-testid=\"input-filter-end-date\"\n                />\n              </div>\n            </>\n          )}\n          <div className=\"space-y-2\">\n            <Label>Vehicle</Label>\n            <Select value={selectedVehicleId} onValueChange={setSelectedVehicleId}>\n              <SelectTrigger className=\"w-44\" data-testid=\"select-filter-vehicle\">\n                <Truck className=\"h-4 w-4 mr-1\" />\n                <SelectValue placeholder=\"All Vehicles\" />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"all\">All Vehicles</SelectItem>\n                {vehicles.map((v) => (\n                  <SelectItem key={v.id} value={v.id}>{v.number}</SelectItem>\n                ))}\n              </SelectContent>\n            </Select>\n          </div>\n          <div className=\"space-y-2\">\n            <Label>Customer</Label>\n            <Select value={selectedCustomerId} onValueChange={setSelectedCustomerId}>\n              <SelectTrigger className=\"w-44\" data-testid=\"select-filter-customer\">\n                <Users className=\"h-4 w-4 mr-1\" />\n                <SelectValue placeholder=\"All Customers\" />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"all\">All Customers</SelectItem>\n                {customers.map((c) => (\n                  <SelectItem key={c.id} value={c.id}>{c.name}</SelectItem>\n                ))}\n              </SelectContent>\n            </Select>\n          </div>\n          {(selectedVehicleId !== \"all\" || selectedCustomerId !== \"all\") && (\n            <Button \n              variant=\"ghost\" \n              size=\"sm\"\n              onClick={() => {\n                setSelectedVehicleId(\"all\");\n                setSelectedCustomerId(\"all\");\n              }}\n              data-testid=\"button-clear-filters\"\n            >\n              Clear Filters\n            </Button>\n          )}\n        </div>\n      </CardContent>\n    </Card>\n  );\n\n  if (invoicesLoading) {\n    return (\n      <div className=\"p-6 space-y-6\">\n        <Skeleton className=\"h-8 w-48\" />\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4\">\n          <Skeleton className=\"h-32\" />\n          <Skeleton className=\"h-32\" />\n          <Skeleton className=\"h-32\" />\n          <Skeleton className=\"h-32\" />\n          <Skeleton className=\"h-32\" />\n        </div>\n        <Skeleton className=\"h-96\" />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"p-6 space-y-6\">\n      <div className=\"flex items-center justify-between gap-4 flex-wrap\">\n        <h1 className=\"text-2xl font-semibold\" data-testid=\"text-page-title\">\n          Sales Reports\n        </h1>\n        <div className=\"flex items-center gap-2\">\n          <Button variant=\"outline\" size=\"sm\" onClick={downloadSalesReport} data-testid=\"button-download-sales\">\n            <Download className=\"h-4 w-4 mr-1\" />\n            Sales CSV\n          </Button>\n          <Button variant=\"outline\" size=\"sm\" onClick={downloadDailySummaryReport} data-testid=\"button-download-daily\">\n            <Download className=\"h-4 w-4 mr-1\" />\n            Daily CSV\n          </Button>\n        </div>\n      </div>\n\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4\">\n        <Card className=\"border-primary/30 bg-primary/5\">\n          <CardHeader className=\"flex flex-row items-center justify-between gap-2 pb-2\">\n            <CardTitle className=\"text-sm font-medium text-primary\">\n              Total Sales\n            </CardTitle>\n            <TrendingUp className=\"h-4 w-4 text-primary\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold font-mono text-primary\" data-testid=\"text-total-sales\">\n              {formatCurrency(summary.totalSales)}\n            </div>\n            <p className=\"text-xs text-muted-foreground\">{summary.invoiceCount} sales</p>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between gap-2 pb-2\">\n            <CardTitle className=\"text-sm font-medium text-muted-foreground\">\n              Product Sales\n            </CardTitle>\n            <ShoppingBag className=\"h-4 w-4 text-muted-foreground\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold font-mono\" data-testid=\"text-product-sales\">\n              {formatCurrency(summary.totalSubtotal)}\n            </div>\n            <p className=\"text-xs text-muted-foreground\">Without Hamali</p>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between gap-2 pb-2\">\n            <CardTitle className=\"text-sm font-medium text-muted-foreground\">\n              Hamali Charges\n            </CardTitle>\n            <CreditCard className=\"h-4 w-4 text-muted-foreground\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold font-mono\" data-testid=\"text-hamali-total\">\n              {formatCurrency(summary.totalHamali)}\n            </div>\n            <p className=\"text-xs text-muted-foreground\">{summary.invoicesWithHamali} sales with Hamali</p>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between gap-2 pb-2\">\n            <CardTitle className=\"text-sm font-medium text-muted-foreground\">\n              Total Weight\n            </CardTitle>\n            <Scale className=\"h-4 w-4 text-muted-foreground\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold font-mono\" data-testid=\"text-total-weight\">\n              {formatWeight(summary.totalWeight)}\n            </div>\n            <p className=\"text-xs text-muted-foreground\">Sold</p>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between gap-2 pb-2\">\n            <CardTitle className=\"text-sm font-medium text-muted-foreground\">\n              Avg per Sale\n            </CardTitle>\n            <Receipt className=\"h-4 w-4 text-muted-foreground\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold font-mono\" data-testid=\"text-avg-sale\">\n              {formatCurrency(summary.invoiceCount > 0 ? summary.totalSales / summary.invoiceCount : 0)}\n            </div>\n            <p className=\"text-xs text-muted-foreground\">Per transaction</p>\n          </CardContent>\n        </Card>\n      </div>\n\n      <Tabs defaultValue=\"sales\" className=\"space-y-4\">\n        <TabsList>\n          <TabsTrigger value=\"sales\" data-testid=\"tab-sales\">\n            <FileText className=\"h-4 w-4 mr-1\" />\n            Sales Details\n          </TabsTrigger>\n          <TabsTrigger value=\"daily\" data-testid=\"tab-daily\">\n            <Calendar className=\"h-4 w-4 mr-1\" />\n            Daily Summary\n          </TabsTrigger>\n          <TabsTrigger value=\"charts\" data-testid=\"tab-charts\">\n            <BarChart3 className=\"h-4 w-4 mr-1\" />\n            Charts\n          </TabsTrigger>\n        </TabsList>\n\n        <TabsContent value=\"sales\" className=\"space-y-4\">\n          <FilterSection />\n          <Card>\n            <CardHeader className=\"pb-3\">\n              <CardTitle className=\"text-base flex items-center gap-2\">\n                <Receipt className=\"h-4 w-4\" />\n                Sales List ({filteredInvoices.length})\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              {filteredInvoices.length === 0 ? (\n                <div className=\"text-center py-8 text-muted-foreground\">\n                  <ShoppingBag className=\"h-12 w-12 mx-auto mb-2 opacity-50\" />\n                  <p>No sales found for this period</p>\n                  <p className=\"text-sm\">Create sales from the Sell tab</p>\n                </div>\n              ) : (\n                <div className=\"overflow-x-auto\">\n                  <Table>\n                    <TableHeader>\n                      <TableRow>\n                        <TableHead>Invoice</TableHead>\n                        <TableHead>Date</TableHead>\n                        <TableHead>Vehicle</TableHead>\n                        <TableHead>Customer</TableHead>\n                        <TableHead className=\"text-right\">Weight</TableHead>\n                        <TableHead className=\"text-right\">Subtotal</TableHead>\n                        <TableHead className=\"text-right\">Hamali</TableHead>\n                        <TableHead className=\"text-right\">Total</TableHead>\n                      </TableRow>\n                    </TableHeader>\n                    <TableBody>\n                      {filteredInvoices.map((inv) => (\n                        <TableRow key={inv.id} data-testid={`row-sale-${inv.id}`}>\n                          <TableCell className=\"font-mono text-sm\">\n                            {inv.invoiceNumber}\n                          </TableCell>\n                          <TableCell>{inv.date}</TableCell>\n                          <TableCell>\n                            <div className=\"flex items-center gap-1\">\n                              <Truck className=\"h-3 w-3 text-muted-foreground\" />\n                              <span className=\"text-sm\">{getVehicleNumber(inv.vehicleId)}</span>\n                            </div>\n                          </TableCell>\n                          <TableCell>\n                            <div className=\"flex items-center gap-1\">\n                              <Users className=\"h-3 w-3 text-muted-foreground\" />\n                              <span className=\"text-sm\">{getCustomerName(inv.customerId)}</span>\n                            </div>\n                          </TableCell>\n                          <TableCell className=\"text-right font-mono text-sm\">\n                            {(inv.totalKgWeight || 0).toFixed(2)} KG\n                          </TableCell>\n                          <TableCell className=\"text-right font-mono text-sm\">\n                            {formatCurrency(inv.subtotal)}\n                          </TableCell>\n                          <TableCell className=\"text-right font-mono text-sm\">\n                            {(inv.hamaliChargeAmount || 0) > 0 ? (\n                              <Badge variant=\"secondary\" className=\"font-mono\">\n                                {formatCurrency(inv.hamaliChargeAmount || 0)}\n                              </Badge>\n                            ) : (\n                              <span className=\"text-muted-foreground\">-</span>\n                            )}\n                          </TableCell>\n                          <TableCell className=\"text-right font-mono font-semibold\">\n                            {formatCurrency(inv.grandTotal)}\n                          </TableCell>\n                        </TableRow>\n                      ))}\n                      <TableRow className=\"bg-muted/50 font-semibold\">\n                        <TableCell colSpan={4}>TOTAL</TableCell>\n                        <TableCell className=\"text-right font-mono\">\n                          {summary.totalWeight.toFixed(2)} KG\n                        </TableCell>\n                        <TableCell className=\"text-right font-mono\">\n                          {formatCurrency(summary.totalSubtotal)}\n                        </TableCell>\n                        <TableCell className=\"text-right font-mono\">\n                          {formatCurrency(summary.totalHamali)}\n                        </TableCell>\n                        <TableCell className=\"text-right font-mono text-primary\">\n                          {formatCurrency(summary.totalSales)}\n                        </TableCell>\n                      </TableRow>\n                    </TableBody>\n                  </Table>\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        <TabsContent value=\"daily\" className=\"space-y-4\">\n          <FilterSection />\n          <Card>\n            <CardHeader className=\"pb-3\">\n              <CardTitle className=\"text-base flex items-center gap-2\">\n                <Calendar className=\"h-4 w-4\" />\n                Daily Summary\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              {dailySummary.length === 0 ? (\n                <div className=\"text-center py-8 text-muted-foreground\">\n                  <Calendar className=\"h-12 w-12 mx-auto mb-2 opacity-50\" />\n                  <p>No data for this period</p>\n                </div>\n              ) : (\n                <div className=\"overflow-x-auto\">\n                  <Table>\n                    <TableHeader>\n                      <TableRow>\n                        <TableHead>Date</TableHead>\n                        <TableHead className=\"text-right\">Sales Count</TableHead>\n                        <TableHead className=\"text-right\">Total Weight</TableHead>\n                        <TableHead className=\"text-right\">Hamali</TableHead>\n                        <TableHead className=\"text-right\">Total Sales</TableHead>\n                      </TableRow>\n                    </TableHeader>\n                    <TableBody>\n                      {dailySummary.map((day) => (\n                        <TableRow key={day.date} data-testid={`row-daily-${day.date}`}>\n                          <TableCell className=\"font-medium\">\n                            {new Date(day.date).toLocaleDateString(\"en-IN\", {\n                              weekday: \"short\",\n                              day: \"2-digit\",\n                              month: \"short\",\n                              year: \"numeric\",\n                            })}\n                          </TableCell>\n                          <TableCell className=\"text-right\">\n                            <Badge variant=\"outline\">{day.invoiceCount}</Badge>\n                          </TableCell>\n                          <TableCell className=\"text-right font-mono text-sm\">\n                            {day.totalWeight.toFixed(2)} KG\n                          </TableCell>\n                          <TableCell className=\"text-right font-mono text-sm\">\n                            {formatCurrency(day.hamaliTotal)}\n                          </TableCell>\n                          <TableCell className=\"text-right font-mono font-semibold\">\n                            {formatCurrency(day.sales)}\n                          </TableCell>\n                        </TableRow>\n                      ))}\n                      <TableRow className=\"bg-muted/50 font-semibold\">\n                        <TableCell>TOTAL</TableCell>\n                        <TableCell className=\"text-right\">\n                          {dailySummary.reduce((sum, d) => sum + d.invoiceCount, 0)}\n                        </TableCell>\n                        <TableCell className=\"text-right font-mono\">\n                          {dailySummary.reduce((sum, d) => sum + d.totalWeight, 0).toFixed(2)} KG\n                        </TableCell>\n                        <TableCell className=\"text-right font-mono\">\n                          {formatCurrency(dailySummary.reduce((sum, d) => sum + d.hamaliTotal, 0))}\n                        </TableCell>\n                        <TableCell className=\"text-right font-mono text-primary\">\n                          {formatCurrency(dailySummary.reduce((sum, d) => sum + d.sales, 0))}\n                        </TableCell>\n                      </TableRow>\n                    </TableBody>\n                  </Table>\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        <TabsContent value=\"charts\" className=\"space-y-4\">\n          <FilterSection />\n          <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-4\">\n            <Card>\n              <CardHeader className=\"pb-3\">\n                <CardTitle className=\"text-base\">Sales Trend</CardTitle>\n              </CardHeader>\n              <CardContent>\n                {chartData.length === 0 ? (\n                  <div className=\"h-64 flex items-center justify-center text-muted-foreground\">\n                    No data to display\n                  </div>\n                ) : (\n                  <ResponsiveContainer width=\"100%\" height={280}>\n                    <BarChart data={chartData}>\n                      <XAxis dataKey=\"date\" fontSize={11} />\n                      <YAxis fontSize={11} tickFormatter={(v) => `₹${(v/1000).toFixed(0)}k`} />\n                      <Tooltip\n                        formatter={(value: number) => formatCurrency(value)}\n                        contentStyle={{\n                          backgroundColor: \"hsl(var(--card))\",\n                          border: \"1px solid hsl(var(--border))\",\n                          borderRadius: \"8px\",\n                        }}\n                      />\n                      <Bar dataKey=\"sales\" fill={CHART_COLORS[0]} name=\"Sales\" radius={[4, 4, 0, 0]} />\n                      <Bar dataKey=\"hamali\" fill={CHART_COLORS[1]} name=\"Hamali\" radius={[4, 4, 0, 0]} />\n                    </BarChart>\n                  </ResponsiveContainer>\n                )}\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardHeader className=\"pb-3\">\n                <CardTitle className=\"text-base\">Sales Breakdown</CardTitle>\n              </CardHeader>\n              <CardContent>\n                {salesBreakdownData.length === 0 ? (\n                  <div className=\"h-64 flex items-center justify-center text-muted-foreground\">\n                    No data to display\n                  </div>\n                ) : (\n                  <ResponsiveContainer width=\"100%\" height={280}>\n                    <PieChart>\n                      <Pie\n                        data={salesBreakdownData}\n                        cx=\"50%\"\n                        cy=\"50%\"\n                        innerRadius={60}\n                        outerRadius={100}\n                        paddingAngle={2}\n                        dataKey=\"value\"\n                        label={({ name, percent }) => `${name} ${(percent * 100).toFixed(0)}%`}\n                        labelLine={false}\n                      >\n                        {salesBreakdownData.map((_, index) => (\n                          <Cell key={`cell-${index}`} fill={CHART_COLORS[index % CHART_COLORS.length]} />\n                        ))}\n                      </Pie>\n                      <Tooltip\n                        formatter={(value: number) => formatCurrency(value)}\n                        contentStyle={{\n                          backgroundColor: \"hsl(var(--card))\",\n                          border: \"1px solid hsl(var(--border))\",\n                          borderRadius: \"8px\",\n                        }}\n                      />\n                      <Legend />\n                    </PieChart>\n                  </ResponsiveContainer>\n                )}\n              </CardContent>\n            </Card>\n          </div>\n        </TabsContent>\n      </Tabs>\n    </div>\n  );\n}\n","path":null,"size_bytes":29026,"size_tokens":null},"client/src/components/ui/radio-group.tsx":{"content":"import * as React from \"react\"\nimport * as RadioGroupPrimitive from \"@radix-ui/react-radio-group\"\nimport { Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst RadioGroup = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Root\n      className={cn(\"grid gap-2\", className)}\n      {...props}\n      ref={ref}\n    />\n  )\n})\nRadioGroup.displayName = RadioGroupPrimitive.Root.displayName\n\nconst RadioGroupItem = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        \"aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    >\n      <RadioGroupPrimitive.Indicator className=\"flex items-center justify-center\">\n        <Circle className=\"h-2.5 w-2.5 fill-current text-current\" />\n      </RadioGroupPrimitive.Indicator>\n    </RadioGroupPrimitive.Item>\n  )\n})\nRadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName\n\nexport { RadioGroup, RadioGroupItem }\n","path":null,"size_bytes":1467,"size_tokens":null},"client/src/components/ui/resizable.tsx":{"content":"\"use client\"\n\nimport { GripVertical } from \"lucide-react\"\nimport * as ResizablePrimitive from \"react-resizable-panels\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ResizablePanelGroup = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) => (\n  <ResizablePrimitive.PanelGroup\n    className={cn(\n      \"flex h-full w-full data-[panel-group-direction=vertical]:flex-col\",\n      className\n    )}\n    {...props}\n  />\n)\n\nconst ResizablePanel = ResizablePrimitive.Panel\n\nconst ResizableHandle = ({\n  withHandle,\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {\n  withHandle?: boolean\n}) => (\n  <ResizablePrimitive.PanelResizeHandle\n    className={cn(\n      \"relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90\",\n      className\n    )}\n    {...props}\n  >\n    {withHandle && (\n      <div className=\"z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border\">\n        <GripVertical className=\"h-2.5 w-2.5\" />\n      </div>\n    )}\n  </ResizablePrimitive.PanelResizeHandle>\n)\n\nexport { ResizablePanelGroup, ResizablePanel, ResizableHandle }\n","path":null,"size_bytes":1723,"size_tokens":null},"client/src/lib/utils.ts":{"content":"import { clsx, type ClassValue } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n","path":null,"size_bytes":166,"size_tokens":null},"client/src/pages/vehicles.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { Card, CardContent, CardHeader } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from \"@/components/ui/dialog\";\nimport {\n  Form,\n  FormControl,\n  FormField,\n  FormItem,\n  FormLabel,\n  FormMessage,\n} from \"@/components/ui/form\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { Plus, Search, Pencil, Trash2, Truck, Phone, User } from \"lucide-react\";\nimport { insertVehicleSchema, type Vehicle, type InsertVehicle } from \"@shared/schema\";\n\nexport default function Vehicles() {\n  const { toast } = useToast();\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [isDialogOpen, setIsDialogOpen] = useState(false);\n  const [editingVehicle, setEditingVehicle] = useState<Vehicle | null>(null);\n  const [deleteVehicle, setDeleteVehicle] = useState<Vehicle | null>(null);\n\n  const { data: vehicles = [], isLoading } = useQuery<Vehicle[]>({\n    queryKey: [\"/api/vehicles\"],\n  });\n\n  const form = useForm<InsertVehicle>({\n    resolver: zodResolver(insertVehicleSchema),\n    defaultValues: {\n      number: \"\",\n      type: \"\",\n      capacity: \"\",\n      driverName: \"\",\n      driverPhone: \"\",\n    },\n  });\n\n  const createMutation = useMutation({\n    mutationFn: async (data: InsertVehicle) => {\n      return apiRequest(\"POST\", \"/api/vehicles\", data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/vehicles\"] });\n      setIsDialogOpen(false);\n      form.reset();\n      toast({ title: \"Vehicle added successfully\" });\n    },\n    onError: () => {\n      toast({ title: \"Failed to add vehicle\", variant: \"destructive\" });\n    },\n  });\n\n  const updateMutation = useMutation({\n    mutationFn: async ({ id, data }: { id: string; data: InsertVehicle }) => {\n      return apiRequest(\"PATCH\", `/api/vehicles/${id}`, data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/vehicles\"] });\n      setIsDialogOpen(false);\n      setEditingVehicle(null);\n      form.reset();\n      toast({ title: \"Vehicle updated successfully\" });\n    },\n    onError: () => {\n      toast({ title: \"Failed to update vehicle\", variant: \"destructive\" });\n    },\n  });\n\n  const deleteMutation = useMutation({\n    mutationFn: async (id: string) => {\n      return apiRequest(\"DELETE\", `/api/vehicles/${id}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/vehicles\"] });\n      setDeleteVehicle(null);\n      toast({ title: \"Vehicle deleted successfully\" });\n    },\n    onError: () => {\n      toast({ title: \"Failed to delete vehicle\", variant: \"destructive\" });\n    },\n  });\n\n  const filteredVehicles = vehicles.filter(\n    (vehicle) =>\n      vehicle.number.toLowerCase().includes(searchQuery.toLowerCase()) ||\n      vehicle.type.toLowerCase().includes(searchQuery.toLowerCase()) ||\n      (vehicle.driverName?.toLowerCase().includes(searchQuery.toLowerCase()))\n  );\n\n  const openEditDialog = (vehicle: Vehicle) => {\n    setEditingVehicle(vehicle);\n    form.reset({\n      number: vehicle.number,\n      type: vehicle.type,\n      capacity: vehicle.capacity || \"\",\n      driverName: vehicle.driverName || \"\",\n      driverPhone: vehicle.driverPhone || \"\",\n    });\n    setIsDialogOpen(true);\n  };\n\n  const openCreateDialog = () => {\n    setEditingVehicle(null);\n    form.reset({\n      number: \"\",\n      type: \"\",\n      capacity: \"\",\n      driverName: \"\",\n      driverPhone: \"\",\n    });\n    setIsDialogOpen(true);\n  };\n\n  const onSubmit = (data: InsertVehicle) => {\n    if (editingVehicle) {\n      updateMutation.mutate({ id: editingVehicle.id, data });\n    } else {\n      createMutation.mutate(data);\n    }\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"p-6 space-y-6\">\n        <div className=\"flex items-center justify-between gap-4\">\n          <Skeleton className=\"h-8 w-32\" />\n          <Skeleton className=\"h-9 w-32\" />\n        </div>\n        <Card>\n          <CardContent className=\"p-6\">\n            <div className=\"space-y-4\">\n              {[1, 2, 3].map((i) => (\n                <Skeleton key={i} className=\"h-16 w-full\" />\n              ))}\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"p-6 space-y-6\">\n      <div className=\"flex items-center justify-between gap-4 flex-wrap\">\n        <div>\n          <h1 className=\"text-2xl font-semibold\" data-testid=\"text-page-title\">Vehicles</h1>\n          <p className=\"text-sm text-muted-foreground\">\n            Manage vehicles for stock receiving\n          </p>\n        </div>\n        <Dialog open={isDialogOpen} onOpenChange={setIsDialogOpen}>\n          <DialogTrigger asChild>\n            <Button onClick={openCreateDialog} data-testid=\"button-add-vehicle\">\n              <Plus className=\"h-4 w-4 mr-2\" />\n              Add Vehicle\n            </Button>\n          </DialogTrigger>\n          <DialogContent>\n            <DialogHeader>\n              <DialogTitle>\n                {editingVehicle ? \"Edit Vehicle\" : \"Add New Vehicle\"}\n              </DialogTitle>\n            </DialogHeader>\n            <Form {...form}>\n              <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  <FormField\n                    control={form.control}\n                    name=\"number\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Vehicle Number *</FormLabel>\n                        <FormControl>\n                          <Input\n                            placeholder=\"e.g., MH12AB1234\"\n                            {...field}\n                            data-testid=\"input-vehicle-number\"\n                          />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  <FormField\n                    control={form.control}\n                    name=\"type\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Type *</FormLabel>\n                        <FormControl>\n                          <Input\n                            placeholder=\"e.g., Truck, Tempo, Van\"\n                            {...field}\n                            data-testid=\"input-vehicle-type\"\n                          />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                </div>\n                <FormField\n                  control={form.control}\n                  name=\"capacity\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Capacity</FormLabel>\n                      <FormControl>\n                        <Input\n                          placeholder=\"e.g., 2 Tons\"\n                          {...field}\n                          value={field.value || \"\"}\n                          data-testid=\"input-vehicle-capacity\"\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  <FormField\n                    control={form.control}\n                    name=\"driverName\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Driver Name</FormLabel>\n                        <FormControl>\n                          <Input\n                            placeholder=\"Driver's name\"\n                            {...field}\n                            value={field.value || \"\"}\n                            data-testid=\"input-driver-name\"\n                          />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  <FormField\n                    control={form.control}\n                    name=\"driverPhone\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Driver Phone</FormLabel>\n                        <FormControl>\n                          <Input\n                            placeholder=\"Driver's phone\"\n                            {...field}\n                            value={field.value || \"\"}\n                            data-testid=\"input-driver-phone\"\n                          />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                </div>\n                <div className=\"flex justify-end gap-2\">\n                  <Button\n                    type=\"button\"\n                    variant=\"outline\"\n                    onClick={() => setIsDialogOpen(false)}\n                  >\n                    Cancel\n                  </Button>\n                  <Button\n                    type=\"submit\"\n                    disabled={createMutation.isPending || updateMutation.isPending}\n                    data-testid=\"button-submit-vehicle\"\n                  >\n                    {createMutation.isPending || updateMutation.isPending\n                      ? \"Saving...\"\n                      : editingVehicle\n                      ? \"Update\"\n                      : \"Add Vehicle\"}\n                  </Button>\n                </div>\n              </form>\n            </Form>\n          </DialogContent>\n        </Dialog>\n      </div>\n\n      <Card>\n        <CardHeader>\n          <div className=\"flex items-center gap-4\">\n            <div className=\"relative flex-1 max-w-sm\">\n              <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n              <Input\n                placeholder=\"Search vehicles...\"\n                value={searchQuery}\n                onChange={(e) => setSearchQuery(e.target.value)}\n                className=\"pl-9\"\n                data-testid=\"input-search-vehicles\"\n              />\n            </div>\n          </div>\n        </CardHeader>\n        <CardContent>\n          {filteredVehicles.length === 0 ? (\n            <div className=\"flex flex-col items-center justify-center py-12 text-muted-foreground\">\n              <Truck className=\"h-12 w-12 mb-4\" />\n              <p className=\"text-lg font-medium\">No vehicles found</p>\n              <p className=\"text-sm\">\n                {searchQuery\n                  ? \"Try a different search term\"\n                  : \"Add your first vehicle to get started\"}\n              </p>\n              {!searchQuery && (\n                <Button\n                  variant=\"outline\"\n                  className=\"mt-4\"\n                  onClick={openCreateDialog}\n                >\n                  <Plus className=\"h-4 w-4 mr-2\" />\n                  Add Vehicle\n                </Button>\n              )}\n            </div>\n          ) : (\n            <Table>\n              <TableHeader>\n                <TableRow>\n                  <TableHead>Vehicle Number</TableHead>\n                  <TableHead>Type</TableHead>\n                  <TableHead>Capacity</TableHead>\n                  <TableHead>Driver</TableHead>\n                  <TableHead>Driver Phone</TableHead>\n                  <TableHead className=\"text-right\">Actions</TableHead>\n                </TableRow>\n              </TableHeader>\n              <TableBody>\n                {filteredVehicles.map((vehicle) => (\n                  <TableRow key={vehicle.id} data-testid={`row-vehicle-${vehicle.id}`}>\n                    <TableCell className=\"font-medium font-mono\">\n                      {vehicle.number}\n                    </TableCell>\n                    <TableCell>{vehicle.type}</TableCell>\n                    <TableCell>\n                      {vehicle.capacity || (\n                        <span className=\"text-muted-foreground\">-</span>\n                      )}\n                    </TableCell>\n                    <TableCell>\n                      {vehicle.driverName ? (\n                        <div className=\"flex items-center gap-2\">\n                          <User className=\"h-3 w-3 text-muted-foreground\" />\n                          {vehicle.driverName}\n                        </div>\n                      ) : (\n                        <span className=\"text-muted-foreground\">-</span>\n                      )}\n                    </TableCell>\n                    <TableCell>\n                      {vehicle.driverPhone ? (\n                        <div className=\"flex items-center gap-2\">\n                          <Phone className=\"h-3 w-3 text-muted-foreground\" />\n                          {vehicle.driverPhone}\n                        </div>\n                      ) : (\n                        <span className=\"text-muted-foreground\">-</span>\n                      )}\n                    </TableCell>\n                    <TableCell className=\"text-right\">\n                      <div className=\"flex items-center justify-end gap-1\">\n                        <Button\n                          variant=\"ghost\"\n                          size=\"icon\"\n                          onClick={() => openEditDialog(vehicle)}\n                          data-testid={`button-edit-vehicle-${vehicle.id}`}\n                        >\n                          <Pencil className=\"h-4 w-4\" />\n                        </Button>\n                        <Button\n                          variant=\"ghost\"\n                          size=\"icon\"\n                          onClick={() => setDeleteVehicle(vehicle)}\n                          data-testid={`button-delete-vehicle-${vehicle.id}`}\n                        >\n                          <Trash2 className=\"h-4 w-4\" />\n                        </Button>\n                      </div>\n                    </TableCell>\n                  </TableRow>\n                ))}\n              </TableBody>\n            </Table>\n          )}\n        </CardContent>\n      </Card>\n\n      <AlertDialog open={!!deleteVehicle} onOpenChange={() => setDeleteVehicle(null)}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>Delete Vehicle</AlertDialogTitle>\n            <AlertDialogDescription>\n              Are you sure you want to delete vehicle \"{deleteVehicle?.number}\"? This\n              action cannot be undone.\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel>Cancel</AlertDialogCancel>\n            <AlertDialogAction\n              onClick={() => deleteVehicle && deleteMutation.mutate(deleteVehicle.id)}\n              className=\"bg-destructive text-destructive-foreground\"\n            >\n              Delete\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":15765,"size_tokens":null},"client/src/components/ui/separator.tsx":{"content":"import * as React from \"react\"\nimport * as SeparatorPrimitive from \"@radix-ui/react-separator\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Separator = React.forwardRef<\n  React.ElementRef<typeof SeparatorPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>\n>(\n  (\n    { className, orientation = \"horizontal\", decorative = true, ...props },\n    ref\n  ) => (\n    <SeparatorPrimitive.Root\n      ref={ref}\n      decorative={decorative}\n      orientation={orientation}\n      className={cn(\n        \"shrink-0 bg-border\",\n        orientation === \"horizontal\" ? \"h-[1px] w-full\" : \"h-full w-[1px]\",\n        className\n      )}\n      {...props}\n    />\n  )\n)\nSeparator.displayName = SeparatorPrimitive.Root.displayName\n\nexport { Separator }\n","path":null,"size_bytes":756,"size_tokens":null},"client/src/components/ui/toggle.tsx":{"content":"import * as React from \"react\"\nimport * as TogglePrimitive from \"@radix-ui/react-toggle\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst toggleVariants = cva(\n  \"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 gap-2\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        outline:\n          \"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground\",\n      },\n      size: {\n        default: \"h-10 px-3 min-w-10\",\n        sm: \"h-9 px-2.5 min-w-9\",\n        lg: \"h-11 px-5 min-w-11\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst Toggle = React.forwardRef<\n  React.ElementRef<typeof TogglePrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, ...props }, ref) => (\n  <TogglePrimitive.Root\n    ref={ref}\n    className={cn(toggleVariants({ variant, size, className }))}\n    {...props}\n  />\n))\n\nToggle.displayName = TogglePrimitive.Root.displayName\n\nexport { Toggle, toggleVariants }\n","path":null,"size_bytes":1527,"size_tokens":null},"server/db.ts":{"content":"import { drizzle } from \"drizzle-orm/node-postgres\";\nimport pg from \"pg\";\nimport * as schema from \"@shared/schema\";\n\nconst { Pool } = pg;\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\n    \"DATABASE_URL must be set. Did you forget to provision a database?\",\n  );\n}\n\nexport const pool = new Pool({ connectionString: process.env.DATABASE_URL });\nexport const db = drizzle(pool, { schema });\n","path":null,"size_bytes":395,"size_tokens":null},"client/src/components/ui/tabs.tsx":{"content":"import * as React from \"react\"\nimport * as TabsPrimitive from \"@radix-ui/react-tabs\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Tabs = TabsPrimitive.Root\n\nconst TabsList = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.List\n    ref={ref}\n    className={cn(\n      \"inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsList.displayName = TabsPrimitive.List.displayName\n\nconst TabsTrigger = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsTrigger.displayName = TabsPrimitive.Trigger.displayName\n\nconst TabsContent = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsContent.displayName = TabsPrimitive.Content.displayName\n\nexport { Tabs, TabsList, TabsTrigger, TabsContent }\n","path":null,"size_bytes":1883,"size_tokens":null},"client/src/components/ui/calendar.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight } from \"lucide-react\"\nimport { DayPicker } from \"react-day-picker\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nexport type CalendarProps = React.ComponentProps<typeof DayPicker>\n\nfunction Calendar({\n  className,\n  classNames,\n  showOutsideDays = true,\n  ...props\n}: CalendarProps) {\n  return (\n    <DayPicker\n      showOutsideDays={showOutsideDays}\n      className={cn(\"p-3\", className)}\n      classNames={{\n        months: \"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0\",\n        month: \"space-y-4\",\n        caption: \"flex justify-center pt-1 relative items-center\",\n        caption_label: \"text-sm font-medium\",\n        nav: \"space-x-1 flex items-center\",\n        nav_button: cn(\n          buttonVariants({ variant: \"outline\" }),\n          \"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100\"\n        ),\n        nav_button_previous: \"absolute left-1\",\n        nav_button_next: \"absolute right-1\",\n        table: \"w-full border-collapse space-y-1\",\n        head_row: \"flex\",\n        head_cell:\n          \"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]\",\n        row: \"flex w-full mt-2\",\n        cell: \"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20\",\n        day: cn(\n          buttonVariants({ variant: \"ghost\" }),\n          \"h-9 w-9 p-0 font-normal aria-selected:opacity-100\"\n        ),\n        day_range_end: \"day-range-end\",\n        day_selected:\n          \"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground\",\n        day_today: \"bg-accent text-accent-foreground\",\n        day_outside:\n          \"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground\",\n        day_disabled: \"text-muted-foreground opacity-50\",\n        day_range_middle:\n          \"aria-selected:bg-accent aria-selected:text-accent-foreground\",\n        day_hidden: \"invisible\",\n        ...classNames,\n      }}\n      components={{\n        IconLeft: ({ className, ...props }) => (\n          <ChevronLeft className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n        IconRight: ({ className, ...props }) => (\n          <ChevronRight className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n      }}\n      {...props}\n    />\n  )\n}\nCalendar.displayName = \"Calendar\"\n\nexport { Calendar }\n","path":null,"size_bytes":2695,"size_tokens":null},"client/src/components/ui/hover-card.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as HoverCardPrimitive from \"@radix-ui/react-hover-card\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst HoverCard = HoverCardPrimitive.Root\n\nconst HoverCardTrigger = HoverCardPrimitive.Trigger\n\nconst HoverCardContent = React.forwardRef<\n  React.ElementRef<typeof HoverCardPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof HoverCardPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <HoverCardPrimitive.Content\n    ref={ref}\n    align={align}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-hover-card-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nHoverCardContent.displayName = HoverCardPrimitive.Content.displayName\n\nexport { HoverCard, HoverCardTrigger, HoverCardContent }\n","path":null,"size_bytes":1251,"size_tokens":null},"client/src/pages/customers.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from \"@/components/ui/dialog\";\nimport {\n  Form,\n  FormControl,\n  FormField,\n  FormItem,\n  FormLabel,\n  FormMessage,\n} from \"@/components/ui/form\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { Plus, Search, Pencil, Trash2, UserCheck, Phone, Mail, MapPin } from \"lucide-react\";\nimport { insertCustomerSchema, type Customer, type InsertCustomer } from \"@shared/schema\";\n\nexport default function Customers() {\n  const { toast } = useToast();\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [isDialogOpen, setIsDialogOpen] = useState(false);\n  const [editingCustomer, setEditingCustomer] = useState<Customer | null>(null);\n  const [deleteCustomer, setDeleteCustomer] = useState<Customer | null>(null);\n\n  const { data: customers = [], isLoading } = useQuery<Customer[]>({\n    queryKey: [\"/api/customers\"],\n  });\n\n  const form = useForm<InsertCustomer>({\n    resolver: zodResolver(insertCustomerSchema),\n    defaultValues: {\n      name: \"\",\n      phone: \"\",\n      address: \"\",\n      email: \"\",\n    },\n  });\n\n  const createMutation = useMutation({\n    mutationFn: async (data: InsertCustomer) => {\n      return apiRequest(\"POST\", \"/api/customers\", data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/customers\"] });\n      setIsDialogOpen(false);\n      form.reset();\n      toast({ title: \"Customer added successfully\" });\n    },\n    onError: () => {\n      toast({ title: \"Failed to add customer\", variant: \"destructive\" });\n    },\n  });\n\n  const updateMutation = useMutation({\n    mutationFn: async ({ id, data }: { id: string; data: InsertCustomer }) => {\n      return apiRequest(\"PATCH\", `/api/customers/${id}`, data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/customers\"] });\n      setIsDialogOpen(false);\n      setEditingCustomer(null);\n      form.reset();\n      toast({ title: \"Customer updated successfully\" });\n    },\n    onError: () => {\n      toast({ title: \"Failed to update customer\", variant: \"destructive\" });\n    },\n  });\n\n  const deleteMutation = useMutation({\n    mutationFn: async (id: string) => {\n      return apiRequest(\"DELETE\", `/api/customers/${id}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/customers\"] });\n      setDeleteCustomer(null);\n      toast({ title: \"Customer deleted successfully\" });\n    },\n    onError: () => {\n      toast({ title: \"Failed to delete customer\", variant: \"destructive\" });\n    },\n  });\n\n  const filteredCustomers = customers.filter(\n    (customer) =>\n      customer.name.toLowerCase().includes(searchQuery.toLowerCase()) ||\n      customer.phone.includes(searchQuery)\n  );\n\n  const openEditDialog = (customer: Customer) => {\n    setEditingCustomer(customer);\n    form.reset({\n      name: customer.name,\n      phone: customer.phone,\n      address: customer.address || \"\",\n      email: customer.email || \"\",\n    });\n    setIsDialogOpen(true);\n  };\n\n  const openCreateDialog = () => {\n    setEditingCustomer(null);\n    form.reset({\n      name: \"\",\n      phone: \"\",\n      address: \"\",\n      email: \"\",\n    });\n    setIsDialogOpen(true);\n  };\n\n  const onSubmit = (data: InsertCustomer) => {\n    if (editingCustomer) {\n      updateMutation.mutate({ id: editingCustomer.id, data });\n    } else {\n      createMutation.mutate(data);\n    }\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"p-6 space-y-6\">\n        <div className=\"flex items-center justify-between gap-4\">\n          <Skeleton className=\"h-8 w-32\" />\n          <Skeleton className=\"h-9 w-32\" />\n        </div>\n        <Card>\n          <CardContent className=\"p-6\">\n            <div className=\"space-y-4\">\n              {[1, 2, 3].map((i) => (\n                <Skeleton key={i} className=\"h-16 w-full\" />\n              ))}\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"p-6 space-y-6\">\n      <div className=\"flex items-center justify-between gap-4 flex-wrap\">\n        <div>\n          <h1 className=\"text-2xl font-semibold\" data-testid=\"text-page-title\">Customers</h1>\n          <p className=\"text-sm text-muted-foreground\">\n            Manage your buyers and retailers\n          </p>\n        </div>\n        <Dialog open={isDialogOpen} onOpenChange={setIsDialogOpen}>\n          <DialogTrigger asChild>\n            <Button onClick={openCreateDialog} data-testid=\"button-add-customer\">\n              <Plus className=\"h-4 w-4 mr-2\" />\n              Add Customer\n            </Button>\n          </DialogTrigger>\n          <DialogContent>\n            <DialogHeader>\n              <DialogTitle>\n                {editingCustomer ? \"Edit Customer\" : \"Add New Customer\"}\n              </DialogTitle>\n            </DialogHeader>\n            <Form {...form}>\n              <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  <FormField\n                    control={form.control}\n                    name=\"name\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Name *</FormLabel>\n                        <FormControl>\n                          <Input\n                            placeholder=\"Customer name\"\n                            {...field}\n                            data-testid=\"input-customer-name\"\n                          />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  <FormField\n                    control={form.control}\n                    name=\"phone\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Phone *</FormLabel>\n                        <FormControl>\n                          <Input\n                            placeholder=\"Phone number\"\n                            {...field}\n                            data-testid=\"input-customer-phone\"\n                          />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                </div>\n                <FormField\n                  control={form.control}\n                  name=\"email\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Email</FormLabel>\n                      <FormControl>\n                        <Input\n                          placeholder=\"Email address\"\n                          type=\"email\"\n                          {...field}\n                          value={field.value || \"\"}\n                          data-testid=\"input-customer-email\"\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                <FormField\n                  control={form.control}\n                  name=\"address\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Address</FormLabel>\n                      <FormControl>\n                        <Input\n                          placeholder=\"Full address\"\n                          {...field}\n                          value={field.value || \"\"}\n                          data-testid=\"input-customer-address\"\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                <div className=\"flex justify-end gap-2\">\n                  <Button\n                    type=\"button\"\n                    variant=\"outline\"\n                    onClick={() => setIsDialogOpen(false)}\n                  >\n                    Cancel\n                  </Button>\n                  <Button\n                    type=\"submit\"\n                    disabled={createMutation.isPending || updateMutation.isPending}\n                    data-testid=\"button-submit-customer\"\n                  >\n                    {createMutation.isPending || updateMutation.isPending\n                      ? \"Saving...\"\n                      : editingCustomer\n                      ? \"Update\"\n                      : \"Add Customer\"}\n                  </Button>\n                </div>\n              </form>\n            </Form>\n          </DialogContent>\n        </Dialog>\n      </div>\n\n      <Card>\n        <CardHeader>\n          <div className=\"flex items-center gap-4\">\n            <div className=\"relative flex-1 max-w-sm\">\n              <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n              <Input\n                placeholder=\"Search customers...\"\n                value={searchQuery}\n                onChange={(e) => setSearchQuery(e.target.value)}\n                className=\"pl-9\"\n                data-testid=\"input-search-customers\"\n              />\n            </div>\n          </div>\n        </CardHeader>\n        <CardContent>\n          {filteredCustomers.length === 0 ? (\n            <div className=\"flex flex-col items-center justify-center py-12 text-muted-foreground\">\n              <UserCheck className=\"h-12 w-12 mb-4\" />\n              <p className=\"text-lg font-medium\">No customers found</p>\n              <p className=\"text-sm\">\n                {searchQuery\n                  ? \"Try a different search term\"\n                  : \"Add your first customer to get started\"}\n              </p>\n              {!searchQuery && (\n                <Button\n                  variant=\"outline\"\n                  className=\"mt-4\"\n                  onClick={openCreateDialog}\n                >\n                  <Plus className=\"h-4 w-4 mr-2\" />\n                  Add Customer\n                </Button>\n              )}\n            </div>\n          ) : (\n            <Table>\n              <TableHeader>\n                <TableRow>\n                  <TableHead>Name</TableHead>\n                  <TableHead>Phone</TableHead>\n                  <TableHead>Email</TableHead>\n                  <TableHead>Address</TableHead>\n                  <TableHead className=\"text-right\">Actions</TableHead>\n                </TableRow>\n              </TableHeader>\n              <TableBody>\n                {filteredCustomers.map((customer) => (\n                  <TableRow key={customer.id} data-testid={`row-customer-${customer.id}`}>\n                    <TableCell className=\"font-medium\">{customer.name}</TableCell>\n                    <TableCell>\n                      <div className=\"flex items-center gap-2\">\n                        <Phone className=\"h-3 w-3 text-muted-foreground\" />\n                        {customer.phone}\n                      </div>\n                    </TableCell>\n                    <TableCell>\n                      {customer.email ? (\n                        <div className=\"flex items-center gap-2\">\n                          <Mail className=\"h-3 w-3 text-muted-foreground\" />\n                          {customer.email}\n                        </div>\n                      ) : (\n                        <span className=\"text-muted-foreground\">-</span>\n                      )}\n                    </TableCell>\n                    <TableCell>\n                      {customer.address ? (\n                        <div className=\"flex items-center gap-2\">\n                          <MapPin className=\"h-3 w-3 text-muted-foreground\" />\n                          <span className=\"truncate max-w-[200px]\">\n                            {customer.address}\n                          </span>\n                        </div>\n                      ) : (\n                        <span className=\"text-muted-foreground\">-</span>\n                      )}\n                    </TableCell>\n                    <TableCell className=\"text-right\">\n                      <div className=\"flex items-center justify-end gap-1\">\n                        <Button\n                          variant=\"ghost\"\n                          size=\"icon\"\n                          onClick={() => openEditDialog(customer)}\n                          data-testid={`button-edit-customer-${customer.id}`}\n                        >\n                          <Pencil className=\"h-4 w-4\" />\n                        </Button>\n                        <Button\n                          variant=\"ghost\"\n                          size=\"icon\"\n                          onClick={() => setDeleteCustomer(customer)}\n                          data-testid={`button-delete-customer-${customer.id}`}\n                        >\n                          <Trash2 className=\"h-4 w-4\" />\n                        </Button>\n                      </div>\n                    </TableCell>\n                  </TableRow>\n                ))}\n              </TableBody>\n            </Table>\n          )}\n        </CardContent>\n      </Card>\n\n      <AlertDialog open={!!deleteCustomer} onOpenChange={() => setDeleteCustomer(null)}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>Delete Customer</AlertDialogTitle>\n            <AlertDialogDescription>\n              Are you sure you want to delete \"{deleteCustomer?.name}\"? This action\n              cannot be undone.\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel>Cancel</AlertDialogCancel>\n            <AlertDialogAction\n              onClick={() => deleteCustomer && deleteMutation.mutate(deleteCustomer.id)}\n              className=\"bg-destructive text-destructive-foreground\"\n            >\n              Delete\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":14768,"size_tokens":null},"client/src/components/ui/collapsible.tsx":{"content":"\"use client\"\n\nimport * as CollapsiblePrimitive from \"@radix-ui/react-collapsible\"\n\nconst Collapsible = CollapsiblePrimitive.Root\n\nconst CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger\n\nconst CollapsibleContent = CollapsiblePrimitive.CollapsibleContent\n\nexport { Collapsible, CollapsibleTrigger, CollapsibleContent }\n","path":null,"size_bytes":329,"size_tokens":null},"client/src/components/ui/input.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Input = React.forwardRef<HTMLInputElement, React.ComponentProps<\"input\">>(\n  ({ className, type, ...props }, ref) => {\n    // h-9 to match icon buttons and default buttons.\n    return (\n      <input\n        type={type}\n        className={cn(\n          \"flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nInput.displayName = \"Input\"\n\nexport { Input }\n","path":null,"size_bytes":844,"size_tokens":null},"client/src/pages/dashboard.tsx":{"content":"import { useMemo } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport { Link } from \"wouter\";\nimport {\n  Users,\n  UserCheck,\n  Package,\n  IndianRupee,\n  ShoppingCart,\n  Receipt,\n  AlertTriangle,\n  TrendingUp,\n  TrendingDown,\n} from \"lucide-react\";\nimport {\n  BarChart,\n  Bar,\n  XAxis,\n  YAxis,\n  Tooltip,\n  ResponsiveContainer,\n  PieChart,\n  Pie,\n  Cell,\n  AreaChart,\n  Area,\n  Legend,\n} from \"recharts\";\nimport type { Vendor, Customer, Product, Invoice, Purchase } from \"@shared/schema\";\n\nfunction MetricCard({\n  title,\n  value,\n  subtitle,\n  icon: Icon,\n  trend,\n}: {\n  title: string;\n  value: string | number;\n  subtitle?: string;\n  icon: typeof Users;\n  trend?: \"up\" | \"down\";\n}) {\n  return (\n    <Card>\n      <CardHeader className=\"flex flex-row items-center justify-between gap-2 space-y-0 pb-2\">\n        <CardTitle className=\"text-sm font-medium text-muted-foreground\">\n          {title}\n        </CardTitle>\n        <Icon className=\"h-4 w-4 text-muted-foreground\" />\n      </CardHeader>\n      <CardContent>\n        <div className=\"flex items-center gap-2\">\n          <div className=\"text-2xl font-semibold font-mono\" data-testid={`text-metric-${title.toLowerCase().replace(/\\s/g, '-')}`}>\n            {value}\n          </div>\n          {trend && (\n            <div className={trend === \"up\" ? \"text-primary\" : \"text-destructive\"}>\n              {trend === \"up\" ? (\n                <TrendingUp className=\"h-4 w-4\" />\n              ) : (\n                <TrendingDown className=\"h-4 w-4\" />\n              )}\n            </div>\n          )}\n        </div>\n        {subtitle && (\n          <p className=\"text-xs text-muted-foreground mt-1\">{subtitle}</p>\n        )}\n      </CardContent>\n    </Card>\n  );\n}\n\nfunction LowStockAlert({ products }: { products: Product[] }) {\n  const lowStockProducts = products.filter(\n    (p) => p.currentStock <= (p.reorderLevel || 10)\n  );\n\n  if (lowStockProducts.length === 0) {\n    return (\n      <div className=\"flex flex-col items-center justify-center py-8 text-muted-foreground\">\n        <Package className=\"h-8 w-8 mb-2\" />\n        <p className=\"text-sm\">All stock levels are healthy</p>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-2\">\n      {lowStockProducts.slice(0, 5).map((product) => (\n        <div\n          key={product.id}\n          className=\"flex items-center justify-between p-3 rounded-md bg-muted/50\"\n          data-testid={`alert-low-stock-${product.id}`}\n        >\n          <div className=\"flex items-center gap-3\">\n            <AlertTriangle className=\"h-4 w-4 text-chart-2\" />\n            <div>\n              <p className=\"text-sm font-medium\">{product.name}</p>\n              <p className=\"text-xs text-muted-foreground\">\n                {product.currentStock} {product.unit} remaining\n              </p>\n            </div>\n          </div>\n          <Badge variant=\"outline\" className=\"text-xs\">\n            Reorder\n          </Badge>\n        </div>\n      ))}\n    </div>\n  );\n}\n\nexport default function Dashboard() {\n  const { data: vendors = [], isLoading: vendorsLoading } = useQuery<Vendor[]>({\n    queryKey: [\"/api/vendors\"],\n  });\n\n  const { data: customers = [], isLoading: customersLoading } = useQuery<Customer[]>({\n    queryKey: [\"/api/customers\"],\n  });\n\n  const { data: products = [], isLoading: productsLoading } = useQuery<Product[]>({\n    queryKey: [\"/api/products\"],\n  });\n\n  const { data: invoices = [], isLoading: invoicesLoading } = useQuery<Invoice[]>({\n    queryKey: [\"/api/invoices\"],\n  });\n\n  const { data: purchases = [], isLoading: purchasesLoading } = useQuery<Purchase[]>({\n    queryKey: [\"/api/purchases\"],\n  });\n\n  const isLoading = vendorsLoading || customersLoading || productsLoading || invoicesLoading || purchasesLoading;\n\n  const totalStockValue = products.reduce(\n    (acc, p) => acc + p.currentStock * p.purchasePrice,\n    0\n  );\n\n  const todaySales = invoices\n    .filter((i) => i.date === new Date().toISOString().split(\"T\")[0])\n    .reduce((acc, i) => acc + i.grandTotal, 0);\n\n  const recentInvoices = [...invoices]\n    .sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime())\n    .slice(0, 5);\n\n  const recentPurchases = [...purchases]\n    .sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime())\n    .slice(0, 5);\n\n  // Chart data: Top products by stock value\n  const stockValueData = useMemo(() => {\n    return products\n      .map((p) => ({\n        name: p.name.length > 12 ? p.name.slice(0, 12) + \"...\" : p.name,\n        fullName: p.name,\n        value: p.currentStock * p.purchasePrice,\n        stock: p.currentStock,\n        unit: p.unit,\n      }))\n      .sort((a, b) => b.value - a.value)\n      .slice(0, 6);\n  }, [products]);\n\n  // Chart data: Last 7 days sales trend - single pass aggregation for O(n) performance\n  const salesTrendData = useMemo(() => {\n    // First, aggregate all invoices by date in a single pass\n    const salesByDate = new Map<string, { sales: number; count: number }>();\n    invoices.forEach((inv) => {\n      const existing = salesByDate.get(inv.date) || { sales: 0, count: 0 };\n      existing.sales += inv.grandTotal;\n      existing.count += 1;\n      salesByDate.set(inv.date, existing);\n    });\n\n    // Then build the 7-day array using the pre-aggregated map\n    const days: { date: string; sales: number; invoices: number }[] = [];\n    for (let i = 6; i >= 0; i--) {\n      const d = new Date();\n      d.setDate(d.getDate() - i);\n      const dateStr = d.toISOString().split(\"T\")[0];\n      const dayData = salesByDate.get(dateStr) || { sales: 0, count: 0 };\n      days.push({\n        date: d.toLocaleDateString(\"en-IN\", { day: \"2-digit\", month: \"short\" }),\n        sales: dayData.sales,\n        invoices: dayData.count,\n      });\n    }\n    return days;\n  }, [invoices]);\n\n  // Chart data: Stock distribution by product (pie chart)\n  const stockDistributionData = useMemo(() => {\n    return products\n      .filter((p) => p.currentStock > 0)\n      .map((p) => ({\n        name: p.name,\n        value: p.currentStock,\n        unit: p.unit,\n      }))\n      .sort((a, b) => b.value - a.value)\n      .slice(0, 5);\n  }, [products]);\n\n  // Chart colors matching the design system\n  const CHART_COLORS = [\n    \"hsl(var(--chart-1))\",\n    \"hsl(var(--chart-2))\",\n    \"hsl(var(--chart-3))\",\n    \"hsl(var(--chart-4))\",\n    \"hsl(var(--chart-5))\",\n    \"hsl(var(--primary))\",\n  ];\n\n  if (isLoading) {\n    return (\n      <div className=\"p-6 space-y-6\">\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n          {[1, 2, 3, 4].map((i) => (\n            <Card key={i}>\n              <CardHeader className=\"pb-2\">\n                <Skeleton className=\"h-4 w-24\" />\n              </CardHeader>\n              <CardContent>\n                <Skeleton className=\"h-8 w-20\" />\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"p-6 space-y-6\">\n      <div className=\"flex items-center justify-between gap-4 flex-wrap\">\n        <div>\n          <h1 className=\"text-2xl font-semibold\" data-testid=\"text-page-title\">Dashboard</h1>\n          <p className=\"text-sm text-muted-foreground\">\n            Overview of your wholesale business\n          </p>\n        </div>\n        <div className=\"flex items-center gap-2 flex-wrap\">\n          <Button asChild data-testid=\"button-new-purchase\">\n            <Link href=\"/purchases\">\n              <ShoppingCart className=\"h-4 w-4 mr-2\" />\n              New Purchase\n            </Link>\n          </Button>\n          <Button asChild variant=\"default\" data-testid=\"button-new-invoice\">\n            <Link href=\"/weighing\">\n              <Receipt className=\"h-4 w-4 mr-2\" />\n              New Invoice\n            </Link>\n          </Button>\n        </div>\n      </div>\n\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n        <MetricCard\n          title=\"Stock Value\"\n          value={`₹${totalStockValue.toLocaleString(\"en-IN\", { minimumFractionDigits: 2 })}`}\n          subtitle={`${products.length} products`}\n          icon={IndianRupee}\n        />\n        <MetricCard\n          title=\"Active Vendors\"\n          value={vendors.length}\n          subtitle=\"Suppliers\"\n          icon={Users}\n        />\n        <MetricCard\n          title=\"Customers\"\n          value={customers.length}\n          subtitle=\"Registered buyers\"\n          icon={UserCheck}\n        />\n        <MetricCard\n          title=\"Today's Sales\"\n          value={`₹${todaySales.toLocaleString(\"en-IN\", { minimumFractionDigits: 2 })}`}\n          subtitle={`${invoices.filter((i) => i.date === new Date().toISOString().split(\"T\")[0]).length} invoices`}\n          icon={TrendingUp}\n          trend=\"up\"\n        />\n      </div>\n\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between gap-2\">\n            <CardTitle className=\"text-lg font-semibold\">7-Day Sales Trend</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"h-64\" data-testid=\"chart-sales-trend\">\n              <ResponsiveContainer width=\"100%\" height=\"100%\">\n                <AreaChart data={salesTrendData}>\n                  <defs>\n                    <linearGradient id=\"salesGradient\" x1=\"0\" y1=\"0\" x2=\"0\" y2=\"1\">\n                      <stop offset=\"5%\" stopColor=\"hsl(var(--primary))\" stopOpacity={0.3} />\n                      <stop offset=\"95%\" stopColor=\"hsl(var(--primary))\" stopOpacity={0} />\n                    </linearGradient>\n                  </defs>\n                  <XAxis \n                    dataKey=\"date\" \n                    tick={{ fontSize: 12 }}\n                    tickLine={false}\n                    axisLine={false}\n                  />\n                  <YAxis \n                    tick={{ fontSize: 12 }}\n                    tickLine={false}\n                    axisLine={false}\n                    tickFormatter={(v) => `₹${(v / 1000).toFixed(0)}k`}\n                  />\n                  <Tooltip \n                    formatter={(value: number) => [`₹${value.toLocaleString(\"en-IN\")}`, \"Sales\"]}\n                    contentStyle={{ \n                      backgroundColor: \"hsl(var(--card))\",\n                      border: \"1px solid hsl(var(--border))\",\n                      borderRadius: \"6px\",\n                    }}\n                  />\n                  <Area\n                    type=\"monotone\"\n                    dataKey=\"sales\"\n                    stroke=\"hsl(var(--primary))\"\n                    strokeWidth={2}\n                    fill=\"url(#salesGradient)\"\n                  />\n                </AreaChart>\n              </ResponsiveContainer>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between gap-2\">\n            <CardTitle className=\"text-lg font-semibold\">Stock Value by Product</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"h-64\" data-testid=\"chart-stock-value\">\n              <ResponsiveContainer width=\"100%\" height=\"100%\">\n                <BarChart data={stockValueData} layout=\"vertical\">\n                  <XAxis \n                    type=\"number\" \n                    tick={{ fontSize: 12 }}\n                    tickLine={false}\n                    axisLine={false}\n                    tickFormatter={(v) => `₹${(v / 1000).toFixed(0)}k`}\n                  />\n                  <YAxis \n                    type=\"category\" \n                    dataKey=\"name\" \n                    tick={{ fontSize: 11 }}\n                    tickLine={false}\n                    axisLine={false}\n                    width={80}\n                  />\n                  <Tooltip \n                    formatter={(value: number) => [`₹${value.toLocaleString(\"en-IN\")}`, \"Value\"]}\n                    contentStyle={{ \n                      backgroundColor: \"hsl(var(--card))\",\n                      border: \"1px solid hsl(var(--border))\",\n                      borderRadius: \"6px\",\n                    }}\n                  />\n                  <Bar \n                    dataKey=\"value\" \n                    fill=\"hsl(var(--primary))\"\n                    radius={[0, 4, 4, 0]}\n                  />\n                </BarChart>\n              </ResponsiveContainer>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\n        <Card className=\"lg:col-span-2\">\n          <CardHeader className=\"flex flex-row items-center justify-between gap-2\">\n            <CardTitle className=\"text-lg font-semibold\">Recent Invoices</CardTitle>\n            <Button variant=\"ghost\" size=\"sm\" asChild>\n              <Link href=\"/print\">View All</Link>\n            </Button>\n          </CardHeader>\n          <CardContent>\n            {recentInvoices.length === 0 ? (\n              <div className=\"flex flex-col items-center justify-center py-8 text-muted-foreground\">\n                <Receipt className=\"h-8 w-8 mb-2\" />\n                <p className=\"text-sm\">No invoices yet</p>\n                <Button variant=\"outline\" size=\"sm\" className=\"mt-2\" asChild>\n                  <Link href=\"/weighing\">Create First Invoice</Link>\n                </Button>\n              </div>\n            ) : (\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead>Invoice #</TableHead>\n                    <TableHead>Date</TableHead>\n                    <TableHead className=\"text-right\">Amount</TableHead>\n                    <TableHead>Status</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {recentInvoices.map((invoice) => (\n                    <TableRow key={invoice.id} data-testid={`row-invoice-${invoice.id}`}>\n                      <TableCell className=\"font-mono text-sm\">\n                        {invoice.invoiceNumber}\n                      </TableCell>\n                      <TableCell className=\"text-sm\">{invoice.date}</TableCell>\n                      <TableCell className=\"text-right font-mono\">\n                        ₹{invoice.grandTotal.toLocaleString(\"en-IN\", { minimumFractionDigits: 2 })}\n                      </TableCell>\n                      <TableCell>\n                        <Badge\n                          variant={invoice.status === \"completed\" ? \"default\" : \"secondary\"}\n                          className=\"text-xs\"\n                        >\n                          {invoice.status}\n                        </Badge>\n                      </TableCell>\n                    </TableRow>\n                  ))}\n                </TableBody>\n              </Table>\n            )}\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between gap-2\">\n            <CardTitle className=\"text-lg font-semibold\">Low Stock Alerts</CardTitle>\n            <Button variant=\"ghost\" size=\"sm\" asChild>\n              <Link href=\"/stock\">View Stock</Link>\n            </Button>\n          </CardHeader>\n          <CardContent>\n            <LowStockAlert products={products} />\n          </CardContent>\n        </Card>\n      </div>\n\n      <Card>\n        <CardHeader className=\"flex flex-row items-center justify-between gap-2\">\n          <CardTitle className=\"text-lg font-semibold\">Recent Purchases</CardTitle>\n          <Button variant=\"ghost\" size=\"sm\" asChild>\n            <Link href=\"/purchases\">View All</Link>\n          </Button>\n        </CardHeader>\n        <CardContent>\n          {recentPurchases.length === 0 ? (\n            <div className=\"flex flex-col items-center justify-center py-8 text-muted-foreground\">\n              <ShoppingCart className=\"h-8 w-8 mb-2\" />\n              <p className=\"text-sm\">No purchases yet</p>\n              <Button variant=\"outline\" size=\"sm\" className=\"mt-2\" asChild>\n                <Link href=\"/purchases\">Create First Purchase</Link>\n              </Button>\n            </div>\n          ) : (\n            <Table>\n              <TableHeader>\n                <TableRow>\n                  <TableHead>Purchase ID</TableHead>\n                  <TableHead>Date</TableHead>\n                  <TableHead className=\"text-right\">Amount</TableHead>\n                  <TableHead>Status</TableHead>\n                </TableRow>\n              </TableHeader>\n              <TableBody>\n                {recentPurchases.map((purchase) => (\n                  <TableRow key={purchase.id} data-testid={`row-purchase-${purchase.id}`}>\n                    <TableCell className=\"font-mono text-sm\">\n                      {purchase.id.slice(0, 8)}...\n                    </TableCell>\n                    <TableCell className=\"text-sm\">{purchase.date}</TableCell>\n                    <TableCell className=\"text-right font-mono\">\n                      ₹{purchase.totalAmount.toLocaleString(\"en-IN\", { minimumFractionDigits: 2 })}\n                    </TableCell>\n                    <TableCell>\n                      <Badge\n                        variant={purchase.status === \"completed\" ? \"default\" : \"secondary\"}\n                        className=\"text-xs\"\n                      >\n                        {purchase.status}\n                      </Badge>\n                    </TableCell>\n                  </TableRow>\n                ))}\n              </TableBody>\n            </Table>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":17883,"size_tokens":null},"client/src/components/ui/tooltip.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as TooltipPrimitive from \"@radix-ui/react-tooltip\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst TooltipProvider = TooltipPrimitive.Provider\n\nconst Tooltip = TooltipPrimitive.Root\n\nconst TooltipTrigger = TooltipPrimitive.Trigger\n\nconst TooltipContent = React.forwardRef<\n  React.ElementRef<typeof TooltipPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <TooltipPrimitive.Content\n    ref={ref}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nTooltipContent.displayName = TooltipPrimitive.Content.displayName\n\nexport { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }\n","path":null,"size_bytes":1209,"size_tokens":null},"client/src/components/ui/avatar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as AvatarPrimitive from \"@radix-ui/react-avatar\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Avatar = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Root\n    ref={ref}\n    className={cn(`\n      after:content-[''] after:block after:absolute after:inset-0 after:rounded-full after:pointer-events-none after:border after:border-black/10 dark:after:border-white/10\n      relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full`,\n      className\n    )}\n    {...props}\n  />\n))\nAvatar.displayName = AvatarPrimitive.Root.displayName\n\nconst AvatarImage = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Image>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Image\n    ref={ref}\n    className={cn(\"aspect-square h-full w-full\", className)}\n    {...props}\n  />\n))\nAvatarImage.displayName = AvatarPrimitive.Image.displayName\n\nconst AvatarFallback = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Fallback>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Fallback\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full items-center justify-center rounded-full bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatarFallback.displayName = AvatarPrimitive.Fallback.displayName\n\nexport { Avatar, AvatarImage, AvatarFallback }\n","path":null,"size_bytes":1592,"size_tokens":null},"client/src/components/ui/sheet.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SheetPrimitive from \"@radix-ui/react-dialog\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Sheet = SheetPrimitive.Root\n\nconst SheetTrigger = SheetPrimitive.Trigger\n\nconst SheetClose = SheetPrimitive.Close\n\nconst SheetPortal = SheetPrimitive.Portal\n\nconst SheetOverlay = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nSheetOverlay.displayName = SheetPrimitive.Overlay.displayName\n\nconst sheetVariants = cva(\n  \"fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500\",\n  {\n    variants: {\n      side: {\n        top: \"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top\",\n        bottom:\n          \"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom\",\n        left: \"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm\",\n        right:\n          \"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm\",\n      },\n    },\n    defaultVariants: {\n      side: \"right\",\n    },\n  }\n)\n\ninterface SheetContentProps\n  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,\n    VariantProps<typeof sheetVariants> {}\n\nconst SheetContent = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Content>,\n  SheetContentProps\n>(({ side = \"right\", className, children, ...props }, ref) => (\n  <SheetPortal>\n    <SheetOverlay />\n    <SheetPrimitive.Content\n      ref={ref}\n      className={cn(sheetVariants({ side }), className)}\n      {...props}\n    >\n      {children}\n      <SheetPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </SheetPrimitive.Close>\n    </SheetPrimitive.Content>\n  </SheetPortal>\n))\nSheetContent.displayName = SheetPrimitive.Content.displayName\n\nconst SheetHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetHeader.displayName = \"SheetHeader\"\n\nconst SheetFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetFooter.displayName = \"SheetFooter\"\n\nconst SheetTitle = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold text-foreground\", className)}\n    {...props}\n  />\n))\nSheetTitle.displayName = SheetPrimitive.Title.displayName\n\nconst SheetDescription = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nSheetDescription.displayName = SheetPrimitive.Description.displayName\n\nexport {\n  Sheet,\n  SheetPortal,\n  SheetOverlay,\n  SheetTrigger,\n  SheetClose,\n  SheetContent,\n  SheetHeader,\n  SheetFooter,\n  SheetTitle,\n  SheetDescription,\n}\n","path":null,"size_bytes":4281,"size_tokens":null},"tailwind.config.ts":{"content":"import type { Config } from \"tailwindcss\";\n\nexport default {\n  darkMode: [\"class\"],\n  content: [\"./client/index.html\", \"./client/src/**/*.{js,jsx,ts,tsx}\"],\n  theme: {\n    extend: {\n      borderRadius: {\n        lg: \".5625rem\", /* 9px */\n        md: \".375rem\", /* 6px */\n        sm: \".1875rem\", /* 3px */\n      },\n      colors: {\n        // Flat / base colors (regular buttons)\n        background: \"hsl(var(--background) / <alpha-value>)\",\n        foreground: \"hsl(var(--foreground) / <alpha-value>)\",\n        border: \"hsl(var(--border) / <alpha-value>)\",\n        input: \"hsl(var(--input) / <alpha-value>)\",\n        card: {\n          DEFAULT: \"hsl(var(--card) / <alpha-value>)\",\n          foreground: \"hsl(var(--card-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--card-border) / <alpha-value>)\",\n        },\n        popover: {\n          DEFAULT: \"hsl(var(--popover) / <alpha-value>)\",\n          foreground: \"hsl(var(--popover-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--popover-border) / <alpha-value>)\",\n        },\n        primary: {\n          DEFAULT: \"hsl(var(--primary) / <alpha-value>)\",\n          foreground: \"hsl(var(--primary-foreground) / <alpha-value>)\",\n          border: \"var(--primary-border)\",\n        },\n        secondary: {\n          DEFAULT: \"hsl(var(--secondary) / <alpha-value>)\",\n          foreground: \"hsl(var(--secondary-foreground) / <alpha-value>)\",\n          border: \"var(--secondary-border)\",\n        },\n        muted: {\n          DEFAULT: \"hsl(var(--muted) / <alpha-value>)\",\n          foreground: \"hsl(var(--muted-foreground) / <alpha-value>)\",\n          border: \"var(--muted-border)\",\n        },\n        accent: {\n          DEFAULT: \"hsl(var(--accent) / <alpha-value>)\",\n          foreground: \"hsl(var(--accent-foreground) / <alpha-value>)\",\n          border: \"var(--accent-border)\",\n        },\n        destructive: {\n          DEFAULT: \"hsl(var(--destructive) / <alpha-value>)\",\n          foreground: \"hsl(var(--destructive-foreground) / <alpha-value>)\",\n          border: \"var(--destructive-border)\",\n        },\n        ring: \"hsl(var(--ring) / <alpha-value>)\",\n        chart: {\n          \"1\": \"hsl(var(--chart-1) / <alpha-value>)\",\n          \"2\": \"hsl(var(--chart-2) / <alpha-value>)\",\n          \"3\": \"hsl(var(--chart-3) / <alpha-value>)\",\n          \"4\": \"hsl(var(--chart-4) / <alpha-value>)\",\n          \"5\": \"hsl(var(--chart-5) / <alpha-value>)\",\n        },\n        sidebar: {\n          ring: \"hsl(var(--sidebar-ring) / <alpha-value>)\",\n          DEFAULT: \"hsl(var(--sidebar) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--sidebar-border) / <alpha-value>)\",\n        },\n        \"sidebar-primary\": {\n          DEFAULT: \"hsl(var(--sidebar-primary) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-primary-foreground) / <alpha-value>)\",\n          border: \"var(--sidebar-primary-border)\",\n        },\n        \"sidebar-accent\": {\n          DEFAULT: \"hsl(var(--sidebar-accent) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-accent-foreground) / <alpha-value>)\",\n          border: \"var(--sidebar-accent-border)\"\n        },\n        status: {\n          online: \"rgb(34 197 94)\",\n          away: \"rgb(245 158 11)\",\n          busy: \"rgb(239 68 68)\",\n          offline: \"rgb(156 163 175)\",\n        },\n      },\n      fontFamily: {\n        sans: [\"var(--font-sans)\"],\n        serif: [\"var(--font-serif)\"],\n        mono: [\"var(--font-mono)\"],\n      },\n      keyframes: {\n        \"accordion-down\": {\n          from: { height: \"0\" },\n          to: { height: \"var(--radix-accordion-content-height)\" },\n        },\n        \"accordion-up\": {\n          from: { height: \"var(--radix-accordion-content-height)\" },\n          to: { height: \"0\" },\n        },\n      },\n      animation: {\n        \"accordion-down\": \"accordion-down 0.2s ease-out\",\n        \"accordion-up\": \"accordion-up 0.2s ease-out\",\n      },\n    },\n  },\n  plugins: [require(\"tailwindcss-animate\"), require(\"@tailwindcss/typography\")],\n} satisfies Config;\n","path":null,"size_bytes":4050,"size_tokens":null},"client/src/components/ui/accordion.tsx":{"content":"import * as React from \"react\"\nimport * as AccordionPrimitive from \"@radix-ui/react-accordion\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Accordion = AccordionPrimitive.Root\n\nconst AccordionItem = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <AccordionPrimitive.Item\n    ref={ref}\n    className={cn(\"border-b\", className)}\n    {...props}\n  />\n))\nAccordionItem.displayName = \"AccordionItem\"\n\nconst AccordionTrigger = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Header className=\"flex\">\n    <AccordionPrimitive.Trigger\n      ref={ref}\n      className={cn(\n        \"flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <ChevronDown className=\"h-4 w-4 shrink-0 transition-transform duration-200\" />\n    </AccordionPrimitive.Trigger>\n  </AccordionPrimitive.Header>\n))\nAccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName\n\nconst AccordionContent = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Content\n    ref={ref}\n    className=\"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down\"\n    {...props}\n  >\n    <div className={cn(\"pb-4 pt-0\", className)}>{children}</div>\n  </AccordionPrimitive.Content>\n))\n\nAccordionContent.displayName = AccordionPrimitive.Content.displayName\n\nexport { Accordion, AccordionItem, AccordionTrigger, AccordionContent }\n","path":null,"size_bytes":1977,"size_tokens":null},"server/static.ts":{"content":"import express, { type Express } from \"express\";\nimport fs from \"fs\";\nimport path from \"path\";\n\nexport function serveStatic(app: Express) {\n  const distPath = path.resolve(__dirname, \"public\");\n  if (!fs.existsSync(distPath)) {\n    throw new Error(\n      `Could not find the build directory: ${distPath}, make sure to build the client first`,\n    );\n  }\n\n  app.use(express.static(distPath));\n\n  // fall through to index.html if the file doesn't exist\n  app.use(\"*\", (_req, res) => {\n    res.sendFile(path.resolve(distPath, \"index.html\"));\n  });\n}\n","path":null,"size_bytes":547,"size_tokens":null},"shared/schema.ts":{"content":"import { sql } from \"drizzle-orm\";\nimport { pgTable, text, varchar, integer, real, boolean, timestamp, jsonb, index } from \"drizzle-orm/pg-core\";\nimport { createInsertSchema } from \"drizzle-zod\";\nimport { z } from \"zod\";\n\n// Session storage table for Replit Auth\nexport const sessions = pgTable(\n  \"sessions\",\n  {\n    sid: varchar(\"sid\").primaryKey(),\n    sess: jsonb(\"sess\").notNull(),\n    expire: timestamp(\"expire\").notNull(),\n  },\n  (table) => [index(\"IDX_session_expire\").on(table.expire)],\n);\n\n// Vendors - suppliers/farmers who provide vegetables\nexport const vendors = pgTable(\"vendors\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  name: text(\"name\").notNull(),\n  phone: text(\"phone\").notNull(),\n  address: text(\"address\"),\n  email: text(\"email\"),\n});\n\nexport const insertVendorSchema = createInsertSchema(vendors).omit({ id: true });\nexport type InsertVendor = z.infer<typeof insertVendorSchema>;\nexport type Vendor = typeof vendors.$inferSelect;\n\n// Customers - buyers who purchase vegetables\nexport const customers = pgTable(\"customers\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  name: text(\"name\").notNull(),\n  phone: text(\"phone\").notNull(),\n  address: text(\"address\"),\n  email: text(\"email\"),\n});\n\nexport const insertCustomerSchema = createInsertSchema(customers).omit({ id: true });\nexport type InsertCustomer = z.infer<typeof insertCustomerSchema>;\nexport type Customer = typeof customers.$inferSelect;\n\n// Vehicles - used for receiving stock from vendors\nexport const vehicles = pgTable(\"vehicles\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  number: text(\"number\").notNull(),\n  type: text(\"type\").notNull(),\n  capacity: text(\"capacity\"),\n  driverName: text(\"driver_name\"),\n  driverPhone: text(\"driver_phone\"),\n  entryDate: text(\"entry_date\"),\n});\n\nexport const insertVehicleSchema = createInsertSchema(vehicles).omit({ id: true });\nexport type InsertVehicle = z.infer<typeof insertVehicleSchema>;\nexport type Vehicle = typeof vehicles.$inferSelect;\n\n// Products - vegetables and items\nexport const products = pgTable(\"products\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  name: text(\"name\").notNull(),\n  unit: text(\"unit\").notNull(),\n  purchasePrice: real(\"purchase_price\").notNull(),\n  salePrice: real(\"sale_price\").notNull(),\n  currentStock: real(\"current_stock\").notNull().default(0),\n  reorderLevel: real(\"reorder_level\").default(10),\n});\n\nexport const insertProductSchema = createInsertSchema(products).omit({ id: true });\nexport type InsertProduct = z.infer<typeof insertProductSchema>;\nexport type Product = typeof products.$inferSelect;\n\n// Purchase Orders - buying from vendors\nexport const purchases = pgTable(\"purchases\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  vendorId: varchar(\"vendor_id\").notNull(),\n  vehicleId: varchar(\"vehicle_id\"),\n  date: text(\"date\").notNull(),\n  totalAmount: real(\"total_amount\").notNull(),\n  status: text(\"status\").notNull().default(\"pending\"),\n});\n\nexport const insertPurchaseSchema = createInsertSchema(purchases).omit({ id: true });\nexport type InsertPurchase = z.infer<typeof insertPurchaseSchema>;\nexport type Purchase = typeof purchases.$inferSelect;\n\n// Purchase Items\nexport const purchaseItems = pgTable(\"purchase_items\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  purchaseId: varchar(\"purchase_id\").notNull(),\n  productId: varchar(\"product_id\").notNull(),\n  quantity: real(\"quantity\").notNull(),\n  unitPrice: real(\"unit_price\").notNull(),\n  total: real(\"total\").notNull(),\n});\n\nexport const insertPurchaseItemSchema = createInsertSchema(purchaseItems).omit({ id: true });\nexport type InsertPurchaseItem = z.infer<typeof insertPurchaseItemSchema>;\nexport type PurchaseItem = typeof purchaseItems.$inferSelect;\n\n// Invoices - selling to customers\nexport const invoices = pgTable(\"invoices\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  invoiceNumber: text(\"invoice_number\").notNull(),\n  customerId: varchar(\"customer_id\").notNull(),\n  vehicleId: varchar(\"vehicle_id\"),\n  date: text(\"date\").notNull(),\n  subtotal: real(\"subtotal\").notNull(),\n  includeHamaliCharge: boolean(\"include_halal_charge\").notNull().default(false),\n  hamaliRatePerKg: real(\"hamali_rate_per_kg\").default(2),\n  hamaliChargeAmount: real(\"halal_charge_amount\").default(0),\n  hamaliPaidByCash: boolean(\"hamali_paid_by_cash\").notNull().default(false),\n  totalKgWeight: real(\"total_kg_weight\").default(0),\n  bags: integer(\"bags\").default(0),\n  hamaliRatePerBag: real(\"hamali_rate_per_bag\").default(0),\n  grandTotal: real(\"grand_total\").notNull(),\n  status: text(\"status\").notNull().default(\"pending\"),\n});\n\nexport const insertInvoiceSchema = createInsertSchema(invoices).omit({ id: true });\nexport type InsertInvoice = z.infer<typeof insertInvoiceSchema>;\nexport type Invoice = typeof invoices.$inferSelect;\n\n// Invoice Items\nexport const invoiceItems = pgTable(\"invoice_items\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  invoiceId: varchar(\"invoice_id\").notNull(),\n  productId: varchar(\"product_id\").notNull(),\n  quantity: real(\"quantity\").notNull(),\n  unitPrice: real(\"unit_price\").notNull(),\n  total: real(\"total\").notNull(),\n});\n\nexport const insertInvoiceItemSchema = createInsertSchema(invoiceItems).omit({ id: true });\nexport type InsertInvoiceItem = z.infer<typeof insertInvoiceItemSchema>;\nexport type InvoiceItem = typeof invoiceItems.$inferSelect;\n\n// Stock Movements - track stock changes\nexport const stockMovements = pgTable(\"stock_movements\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  productId: varchar(\"product_id\").notNull(),\n  type: text(\"type\").notNull(), // 'in' or 'out'\n  quantity: real(\"quantity\").notNull(),\n  reason: text(\"reason\").notNull(),\n  date: text(\"date\").notNull(),\n  referenceId: varchar(\"reference_id\"),\n});\n\nexport const insertStockMovementSchema = createInsertSchema(stockMovements).omit({ id: true });\nexport type InsertStockMovement = z.infer<typeof insertStockMovementSchema>;\nexport type StockMovement = typeof stockMovements.$inferSelect;\n\n// Vendor Payments - track payments to vendors\nexport const vendorPayments = pgTable(\"vendor_payments\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  vendorId: varchar(\"vendor_id\").notNull(),\n  purchaseId: varchar(\"purchase_id\"),\n  amount: real(\"amount\").notNull(),\n  date: text(\"date\").notNull(),\n  paymentMethod: text(\"payment_method\").notNull(),\n  notes: text(\"notes\"),\n});\n\nexport const insertVendorPaymentSchema = createInsertSchema(vendorPayments).omit({ id: true });\nexport type InsertVendorPayment = z.infer<typeof insertVendorPaymentSchema>;\nexport type VendorPayment = typeof vendorPayments.$inferSelect;\n\n// Customer Payments - track payments from customers\nexport const customerPayments = pgTable(\"customer_payments\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  customerId: varchar(\"customer_id\").notNull(),\n  invoiceId: varchar(\"invoice_id\"),\n  amount: real(\"amount\").notNull(),\n  date: text(\"date\").notNull(),\n  paymentMethod: text(\"payment_method\").notNull(),\n  notes: text(\"notes\"),\n});\n\nexport const insertCustomerPaymentSchema = createInsertSchema(customerPayments).omit({ id: true });\nexport type InsertCustomerPayment = z.infer<typeof insertCustomerPaymentSchema>;\nexport type CustomerPayment = typeof customerPayments.$inferSelect;\n\n// Vehicle Inventory - track products in each vehicle\nexport const vehicleInventory = pgTable(\"vehicle_inventory\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  vehicleId: varchar(\"vehicle_id\").notNull(),\n  productId: varchar(\"product_id\").notNull(),\n  quantity: real(\"quantity\").notNull().default(0),\n});\n\nexport const insertVehicleInventorySchema = createInsertSchema(vehicleInventory).omit({ id: true });\nexport type InsertVehicleInventory = z.infer<typeof insertVehicleInventorySchema>;\nexport type VehicleInventory = typeof vehicleInventory.$inferSelect;\n\n// Vehicle Inventory Movements - track loading and selling from vehicles\nexport const vehicleInventoryMovements = pgTable(\"vehicle_inventory_movements\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  vehicleId: varchar(\"vehicle_id\").notNull(),\n  productId: varchar(\"product_id\").notNull(),\n  type: text(\"type\").notNull(), // 'load' or 'sale' or 'adjustment'\n  quantity: real(\"quantity\").notNull(),\n  referenceId: varchar(\"reference_id\"), // purchase_id or invoice_id\n  referenceType: text(\"reference_type\"), // 'purchase' or 'invoice'\n  date: text(\"date\").notNull(),\n  notes: text(\"notes\"),\n});\n\nexport const insertVehicleInventoryMovementSchema = createInsertSchema(vehicleInventoryMovements).omit({ id: true });\nexport type InsertVehicleInventoryMovement = z.infer<typeof insertVehicleInventoryMovementSchema>;\nexport type VehicleInventoryMovement = typeof vehicleInventoryMovements.$inferSelect;\n\n// Company Settings - for invoice branding\nexport const companySettings = pgTable(\"company_settings\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  name: text(\"name\").notNull(),\n  address: text(\"address\"),\n  phone: text(\"phone\"),\n  email: text(\"email\"),\n  gstNumber: text(\"gst_number\"),\n  bankDetails: text(\"bank_details\"),\n});\n\nexport const insertCompanySettingsSchema = createInsertSchema(companySettings).omit({ id: true });\nexport type InsertCompanySettings = z.infer<typeof insertCompanySettingsSchema>;\nexport type CompanySettings = typeof companySettings.$inferSelect;\n\n// Vendor Returns - returning defective products to vendors\nexport const vendorReturns = pgTable(\"vendor_returns\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  vendorId: varchar(\"vendor_id\").notNull(),\n  purchaseId: varchar(\"purchase_id\"),\n  vehicleId: varchar(\"vehicle_id\"),\n  date: text(\"date\").notNull(),\n  totalAmount: real(\"total_amount\").notNull(),\n  status: text(\"status\").notNull().default(\"completed\"),\n  notes: text(\"notes\"),\n});\n\nexport const insertVendorReturnSchema = createInsertSchema(vendorReturns).omit({ id: true });\nexport type InsertVendorReturn = z.infer<typeof insertVendorReturnSchema>;\nexport type VendorReturn = typeof vendorReturns.$inferSelect;\n\n// Vendor Return Items - individual products being returned\nexport const vendorReturnItems = pgTable(\"vendor_return_items\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  returnId: varchar(\"return_id\").notNull(),\n  productId: varchar(\"product_id\").notNull(),\n  quantity: real(\"quantity\").notNull(),\n  unitPrice: real(\"unit_price\").notNull(),\n  total: real(\"total\").notNull(),\n  reason: text(\"reason\").notNull(),\n});\n\nexport const insertVendorReturnItemSchema = createInsertSchema(vendorReturnItems).omit({ id: true });\nexport type InsertVendorReturnItem = z.infer<typeof insertVendorReturnItemSchema>;\nexport type VendorReturnItem = typeof vendorReturnItems.$inferSelect;\n\n// Hamali Cash Payments - direct cash given to Hamali (not through invoices)\nexport const hamaliCashPayments = pgTable(\"halal_cash_payments\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  amount: real(\"amount\").notNull(),\n  date: text(\"date\").notNull(),\n  paymentMethod: text(\"payment_method\").notNull().default(\"cash\"),\n  customerId: varchar(\"customer_id\"), // optional - which customer gave the cash\n  invoiceId: varchar(\"invoice_id\"), // linked invoice if auto-created from weighing\n  invoiceNumber: text(\"invoice_number\"), // invoice number for easy display\n  totalBillAmount: real(\"total_bill_amount\"), // total bill amount from invoice\n  notes: text(\"notes\"),\n});\n\nexport const insertHamaliCashPaymentSchema = createInsertSchema(hamaliCashPayments).omit({ id: true });\nexport type InsertHamaliCashPayment = z.infer<typeof insertHamaliCashPaymentSchema>;\nexport type HamaliCashPayment = typeof hamaliCashPayments.$inferSelect;\n\n// Users table for Replit Auth\nexport const users = pgTable(\"users\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  email: varchar(\"email\").unique(),\n  firstName: varchar(\"first_name\"),\n  lastName: varchar(\"last_name\"),\n  profileImageUrl: varchar(\"profile_image_url\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\nexport type UpsertUser = typeof users.$inferInsert;\nexport type User = typeof users.$inferSelect;\n","path":null,"size_bytes":12421,"size_tokens":null},"client/src/components/ui/toast.tsx":{"content":"import * as React from \"react\"\nimport * as ToastPrimitives from \"@radix-ui/react-toast\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ToastProvider = ToastPrimitives.Provider\n\nconst ToastViewport = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Viewport>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Viewport\n    ref={ref}\n    className={cn(\n      \"fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]\",\n      className\n    )}\n    {...props}\n  />\n))\nToastViewport.displayName = ToastPrimitives.Viewport.displayName\n\nconst toastVariants = cva(\n  \"group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full\",\n  {\n    variants: {\n      variant: {\n        default: \"border bg-background text-foreground\",\n        destructive:\n          \"destructive group border-destructive bg-destructive text-destructive-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Toast = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &\n    VariantProps<typeof toastVariants>\n>(({ className, variant, ...props }, ref) => {\n  return (\n    <ToastPrimitives.Root\n      ref={ref}\n      className={cn(toastVariants({ variant }), className)}\n      {...props}\n    />\n  )\n})\nToast.displayName = ToastPrimitives.Root.displayName\n\nconst ToastAction = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Action>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Action\n    ref={ref}\n    className={cn(\n      \"inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive\",\n      className\n    )}\n    {...props}\n  />\n))\nToastAction.displayName = ToastPrimitives.Action.displayName\n\nconst ToastClose = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Close>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Close\n    ref={ref}\n    className={cn(\n      \"absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600\",\n      className\n    )}\n    toast-close=\"\"\n    {...props}\n  >\n    <X className=\"h-4 w-4\" />\n  </ToastPrimitives.Close>\n))\nToastClose.displayName = ToastPrimitives.Close.displayName\n\nconst ToastTitle = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Title>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Title\n    ref={ref}\n    className={cn(\"text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nToastTitle.displayName = ToastPrimitives.Title.displayName\n\nconst ToastDescription = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Description>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Description\n    ref={ref}\n    className={cn(\"text-sm opacity-90\", className)}\n    {...props}\n  />\n))\nToastDescription.displayName = ToastPrimitives.Description.displayName\n\ntype ToastProps = React.ComponentPropsWithoutRef<typeof Toast>\n\ntype ToastActionElement = React.ReactElement<typeof ToastAction>\n\nexport {\n  type ToastProps,\n  type ToastActionElement,\n  ToastProvider,\n  ToastViewport,\n  Toast,\n  ToastTitle,\n  ToastDescription,\n  ToastClose,\n  ToastAction,\n}\n","path":null,"size_bytes":4845,"size_tokens":null},"postcss.config.js":{"content":"export default {\n  plugins: {\n    tailwindcss: {},\n    autoprefixer: {},\n  },\n}\n","path":null,"size_bytes":80,"size_tokens":null},"server/routes.ts":{"content":"import type { Express } from \"express\";\nimport { createServer, type Server } from \"http\";\nimport { storage } from \"./storage\";\nimport {\n  insertVendorSchema,\n  insertCustomerSchema,\n  insertVehicleSchema,\n  insertProductSchema,\n  insertStockMovementSchema,\n  insertVendorPaymentSchema,\n  insertCustomerPaymentSchema,\n  insertCompanySettingsSchema,\n  insertVendorReturnSchema,\n  insertVendorReturnItemSchema,\n  insertHamaliCashPaymentSchema,\n} from \"@shared/schema\";\nimport { z } from \"zod\";\n\nexport async function registerRoutes(\n  httpServer: Server,\n  app: Express\n): Promise<Server> {\n  // Vendors\n  app.get(\"/api/vendors\", async (req, res) => {\n    const vendors = await storage.getVendors();\n    res.json(vendors);\n  });\n\n  app.get(\"/api/vendors/:id\", async (req, res) => {\n    const vendor = await storage.getVendor(req.params.id);\n    if (!vendor) {\n      return res.status(404).json({ error: \"Vendor not found\" });\n    }\n    res.json(vendor);\n  });\n\n  app.get(\"/api/vendors/:id/balance\", async (req, res) => {\n    const balance = await storage.getVendorBalance(req.params.id);\n    res.json(balance);\n  });\n\n  app.post(\"/api/vendors\", async (req, res) => {\n    try {\n      const data = insertVendorSchema.parse(req.body);\n      const vendor = await storage.createVendor(data);\n      res.status(201).json(vendor);\n    } catch (error) {\n      res.status(400).json({ error: \"Invalid vendor data\" });\n    }\n  });\n\n  app.patch(\"/api/vendors/:id\", async (req, res) => {\n    try {\n      const data = insertVendorSchema.partial().parse(req.body);\n      const vendor = await storage.updateVendor(req.params.id, data);\n      if (!vendor) {\n        return res.status(404).json({ error: \"Vendor not found\" });\n      }\n      res.json(vendor);\n    } catch (error) {\n      res.status(400).json({ error: \"Invalid vendor data\" });\n    }\n  });\n\n  app.delete(\"/api/vendors/:id\", async (req, res) => {\n    const success = await storage.deleteVendor(req.params.id);\n    if (!success) {\n      return res.status(404).json({ error: \"Vendor not found\" });\n    }\n    res.status(204).send();\n  });\n\n  // Customers\n  app.get(\"/api/customers\", async (req, res) => {\n    const customers = await storage.getCustomers();\n    res.json(customers);\n  });\n\n  app.get(\"/api/customers/:id\", async (req, res) => {\n    const customer = await storage.getCustomer(req.params.id);\n    if (!customer) {\n      return res.status(404).json({ error: \"Customer not found\" });\n    }\n    res.json(customer);\n  });\n\n  app.get(\"/api/customers/:id/balance\", async (req, res) => {\n    const balance = await storage.getCustomerBalance(req.params.id);\n    res.json(balance);\n  });\n\n  app.post(\"/api/customers\", async (req, res) => {\n    try {\n      const data = insertCustomerSchema.parse(req.body);\n      const customer = await storage.createCustomer(data);\n      res.status(201).json(customer);\n    } catch (error) {\n      res.status(400).json({ error: \"Invalid customer data\" });\n    }\n  });\n\n  app.patch(\"/api/customers/:id\", async (req, res) => {\n    try {\n      const data = insertCustomerSchema.partial().parse(req.body);\n      const customer = await storage.updateCustomer(req.params.id, data);\n      if (!customer) {\n        return res.status(404).json({ error: \"Customer not found\" });\n      }\n      res.json(customer);\n    } catch (error) {\n      res.status(400).json({ error: \"Invalid customer data\" });\n    }\n  });\n\n  app.delete(\"/api/customers/:id\", async (req, res) => {\n    const success = await storage.deleteCustomer(req.params.id);\n    if (!success) {\n      return res.status(404).json({ error: \"Customer not found\" });\n    }\n    res.status(204).send();\n  });\n\n  // Vehicles\n  app.get(\"/api/vehicles\", async (req, res) => {\n    const vehicles = await storage.getVehicles();\n    res.json(vehicles);\n  });\n\n  app.get(\"/api/vehicles/:id\", async (req, res) => {\n    const vehicle = await storage.getVehicle(req.params.id);\n    if (!vehicle) {\n      return res.status(404).json({ error: \"Vehicle not found\" });\n    }\n    res.json(vehicle);\n  });\n\n  app.post(\"/api/vehicles\", async (req, res) => {\n    try {\n      const data = insertVehicleSchema.parse(req.body);\n      const vehicle = await storage.createVehicle(data);\n      res.status(201).json(vehicle);\n    } catch (error) {\n      res.status(400).json({ error: \"Invalid vehicle data\" });\n    }\n  });\n\n  app.patch(\"/api/vehicles/:id\", async (req, res) => {\n    try {\n      const data = insertVehicleSchema.partial().parse(req.body);\n      const vehicle = await storage.updateVehicle(req.params.id, data);\n      if (!vehicle) {\n        return res.status(404).json({ error: \"Vehicle not found\" });\n      }\n      res.json(vehicle);\n    } catch (error) {\n      res.status(400).json({ error: \"Invalid vehicle data\" });\n    }\n  });\n\n  app.delete(\"/api/vehicles/:id\", async (req, res) => {\n    const success = await storage.deleteVehicle(req.params.id);\n    if (!success) {\n      return res.status(404).json({ error: \"Vehicle not found\" });\n    }\n    res.status(204).send();\n  });\n\n  // Products\n  app.get(\"/api/products\", async (req, res) => {\n    const products = await storage.getProducts();\n    res.json(products);\n  });\n\n  app.get(\"/api/products/:id\", async (req, res) => {\n    const product = await storage.getProduct(req.params.id);\n    if (!product) {\n      return res.status(404).json({ error: \"Product not found\" });\n    }\n    res.json(product);\n  });\n\n  app.post(\"/api/products\", async (req, res) => {\n    try {\n      const data = insertProductSchema.parse(req.body);\n      const product = await storage.createProduct(data);\n      res.status(201).json(product);\n    } catch (error) {\n      res.status(400).json({ error: \"Invalid product data\" });\n    }\n  });\n\n  app.patch(\"/api/products/:id\", async (req, res) => {\n    try {\n      const data = insertProductSchema.partial().parse(req.body);\n      const product = await storage.updateProduct(req.params.id, data);\n      if (!product) {\n        return res.status(404).json({ error: \"Product not found\" });\n      }\n      res.json(product);\n    } catch (error) {\n      res.status(400).json({ error: \"Invalid product data\" });\n    }\n  });\n\n  app.delete(\"/api/products/:id\", async (req, res) => {\n    const success = await storage.deleteProduct(req.params.id);\n    if (!success) {\n      return res.status(404).json({ error: \"Product not found\" });\n    }\n    res.status(204).send();\n  });\n\n  // Stock Movements\n  app.get(\"/api/stock-movements\", async (req, res) => {\n    const { startDate, endDate } = req.query;\n    const movements = await storage.getStockMovements(\n      startDate as string | undefined,\n      endDate as string | undefined\n    );\n    res.json(movements);\n  });\n\n  app.post(\"/api/stock-movements\", async (req, res) => {\n    try {\n      const data = insertStockMovementSchema.parse(req.body);\n      const movement = await storage.createStockMovement(data);\n      res.status(201).json(movement);\n    } catch (error) {\n      res.status(400).json({ error: \"Invalid stock movement data\" });\n    }\n  });\n\n  // Purchases\n  app.get(\"/api/purchases\", async (req, res) => {\n    const purchases = await storage.getPurchases();\n    res.json(purchases);\n  });\n\n  app.get(\"/api/purchases/:id\", async (req, res) => {\n    const purchase = await storage.getPurchase(req.params.id);\n    if (!purchase) {\n      return res.status(404).json({ error: \"Purchase not found\" });\n    }\n    res.json(purchase);\n  });\n\n  app.get(\"/api/purchases/:id/items\", async (req, res) => {\n    const items = await storage.getPurchaseItems(req.params.id);\n    res.json(items);\n  });\n\n  const purchaseSchema = z.object({\n    vendorId: z.string(),\n    vehicleId: z.string().optional(),\n    date: z.string(),\n    totalAmount: z.number(),\n    status: z.string().optional(),\n    items: z.array(\n      z.object({\n        productId: z.string(),\n        quantity: z.number(),\n        unitPrice: z.number(),\n        total: z.number(),\n      })\n    ),\n  });\n\n  app.post(\"/api/purchases\", async (req, res) => {\n    try {\n      const data = purchaseSchema.parse(req.body);\n      const { items, ...purchaseData } = data;\n      const purchase = await storage.createPurchase(\n        purchaseData,\n        items.map((item) => ({ ...item, purchaseId: \"\" }))\n      );\n      res.status(201).json(purchase);\n    } catch (error) {\n      console.error(\"Purchase error:\", error);\n      res.status(400).json({ error: \"Invalid purchase data\" });\n    }\n  });\n\n  // Invoices\n  app.get(\"/api/invoices\", async (req, res) => {\n    const invoices = await storage.getInvoices();\n    res.json(invoices);\n  });\n\n  app.get(\"/api/invoices/:id\", async (req, res) => {\n    const invoice = await storage.getInvoice(req.params.id);\n    if (!invoice) {\n      return res.status(404).json({ error: \"Invoice not found\" });\n    }\n    res.json(invoice);\n  });\n\n  app.get(\"/api/invoices/:id/items\", async (req, res) => {\n    const items = await storage.getInvoiceItems(req.params.id);\n    res.json(items);\n  });\n\n  const invoiceSchema = z.object({\n    customerId: z.string(),\n    vehicleId: z.string().optional(),\n    invoiceNumber: z.string(),\n    date: z.string(),\n    subtotal: z.number(),\n    includeHamaliCharge: z.boolean(),\n    hamaliRatePerKg: z.number().optional(),\n    hamaliChargeAmount: z.number().optional(),\n    hamaliPaidByCash: z.boolean().optional(),\n    totalKgWeight: z.number().optional(),\n    bags: z.number().optional(),\n    hamaliRatePerBag: z.number().optional(),\n    grandTotal: z.number(),\n    status: z.string().optional(),\n    items: z.array(\n      z.object({\n        productId: z.string(),\n        quantity: z.number(),\n        unitPrice: z.number(),\n        total: z.number(),\n      })\n    ),\n  });\n\n  app.post(\"/api/invoices\", async (req, res) => {\n    try {\n      const data = invoiceSchema.parse(req.body);\n      const { items, ...invoiceData } = data;\n      const invoice = await storage.createInvoice(\n        invoiceData,\n        items.map((item) => ({ ...item, invoiceId: \"\" }))\n      );\n      res.status(201).json(invoice);\n    } catch (error) {\n      console.error(\"Invoice error:\", error);\n      res.status(400).json({ error: \"Invalid invoice data\" });\n    }\n  });\n\n  app.get(\"/api/customers/:id/invoices\", async (req, res) => {\n    try {\n      const invoices = await storage.getInvoicesByCustomer(req.params.id);\n      const balance = await storage.getCustomerBalance(req.params.id);\n      res.json({\n        invoices,\n        summary: {\n          totalInvoices: balance.totalInvoices,\n          totalPayments: balance.totalPayments,\n          remainingBalance: balance.balance,\n        }\n      });\n    } catch (error) {\n      console.error(\"Error getting customer invoices:\", error);\n      res.status(500).json({ error: \"Failed to get customer invoices\" });\n    }\n  });\n\n  app.patch(\"/api/invoices/:id\", async (req, res) => {\n    try {\n      const updates = req.body;\n      const invoice = await storage.updateInvoice(req.params.id, updates);\n      if (!invoice) {\n        return res.status(404).json({ error: \"Invoice not found\" });\n      }\n      res.json(invoice);\n    } catch (error) {\n      console.error(\"Error updating invoice:\", error);\n      res.status(400).json({ error: \"Failed to update invoice\" });\n    }\n  });\n\n  app.patch(\"/api/invoice-items/:id\", async (req, res) => {\n    try {\n      const updates = req.body;\n      const item = await storage.updateInvoiceItem(req.params.id, updates);\n      if (!item) {\n        return res.status(404).json({ error: \"Invoice item not found\" });\n      }\n      res.json(item);\n    } catch (error) {\n      console.error(\"Error updating invoice item:\", error);\n      res.status(400).json({ error: \"Failed to update invoice item\" });\n    }\n  });\n\n  // Vendor Payments\n  app.get(\"/api/vendor-payments\", async (req, res) => {\n    const { vendorId } = req.query;\n    const payments = await storage.getVendorPayments(vendorId as string | undefined);\n    res.json(payments);\n  });\n\n  app.post(\"/api/vendor-payments\", async (req, res) => {\n    try {\n      const data = insertVendorPaymentSchema.parse(req.body);\n      const payment = await storage.createVendorPayment(data);\n      res.status(201).json(payment);\n    } catch (error) {\n      res.status(400).json({ error: \"Invalid payment data\" });\n    }\n  });\n\n  // Customer Payments\n  app.get(\"/api/customer-payments\", async (req, res) => {\n    const { customerId } = req.query;\n    const payments = await storage.getCustomerPayments(customerId as string | undefined);\n    \n    // Enrich payments with invoice numbers\n    const allInvoices = await storage.getInvoices();\n    const enrichedPayments = payments.map(payment => {\n      const invoice = payment.invoiceId ? allInvoices.find(inv => inv.id === payment.invoiceId) : null;\n      return {\n        ...payment,\n        invoiceNumber: invoice?.invoiceNumber || null,\n      };\n    });\n    \n    res.json(enrichedPayments);\n  });\n\n  app.post(\"/api/customer-payments\", async (req, res) => {\n    try {\n      const data = insertCustomerPaymentSchema.parse(req.body);\n      const payment = await storage.createCustomerPayment(data);\n      res.status(201).json(payment);\n    } catch (error) {\n      res.status(400).json({ error: \"Invalid payment data\" });\n    }\n  });\n\n  // Company Settings\n  app.get(\"/api/company-settings\", async (req, res) => {\n    const settings = await storage.getCompanySettings();\n    res.json(settings || null);\n  });\n\n  app.post(\"/api/company-settings\", async (req, res) => {\n    try {\n      const data = insertCompanySettingsSchema.parse(req.body);\n      const settings = await storage.upsertCompanySettings(data);\n      res.status(201).json(settings);\n    } catch (error) {\n      res.status(400).json({ error: \"Invalid company settings\" });\n    }\n  });\n\n  // Vehicle Inventory\n  app.get(\"/api/vehicles/:id/inventory\", async (req, res) => {\n    try {\n      const vehicle = await storage.getVehicle(req.params.id);\n      if (!vehicle) {\n        return res.status(404).json({ error: \"Vehicle not found\" });\n      }\n      const inventory = await storage.getVehicleInventory(req.params.id);\n      res.json(inventory);\n    } catch (error) {\n      console.error(\"Error getting vehicle inventory:\", error);\n      res.status(500).json({ error: \"Failed to get vehicle inventory\" });\n    }\n  });\n\n  app.get(\"/api/vehicles/:id/inventory/movements\", async (req, res) => {\n    try {\n      const vehicle = await storage.getVehicle(req.params.id);\n      if (!vehicle) {\n        return res.status(404).json({ error: \"Vehicle not found\" });\n      }\n      const movements = await storage.getVehicleInventoryMovements(req.params.id);\n      res.json(movements);\n    } catch (error) {\n      console.error(\"Error getting inventory movements:\", error);\n      res.status(500).json({ error: \"Failed to get inventory movements\" });\n    }\n  });\n\n  // All vehicle inventory movements (for Stock page)\n  app.get(\"/api/vehicle-inventory-movements\", async (req, res) => {\n    try {\n      const movements = await storage.getAllVehicleInventoryMovements();\n      res.json(movements);\n    } catch (error) {\n      console.error(\"Error getting all inventory movements:\", error);\n      res.status(500).json({ error: \"Failed to get inventory movements\" });\n    }\n  });\n\n  // All vehicle inventories (for Stock page)\n  app.get(\"/api/all-vehicle-inventories\", async (req, res) => {\n    try {\n      const inventories = await storage.getAllVehicleInventories();\n      res.json(inventories);\n    } catch (error) {\n      console.error(\"Error getting all vehicle inventories:\", error);\n      res.status(500).json({ error: \"Failed to get vehicle inventories\" });\n    }\n  });\n\n  const loadInventorySchema = z.object({\n    productId: z.string(),\n    quantity: z.number().positive(),\n    purchaseId: z.string().optional(),\n  });\n\n  app.post(\"/api/vehicles/:id/inventory/load\", async (req, res) => {\n    try {\n      const vehicle = await storage.getVehicle(req.params.id);\n      if (!vehicle) {\n        return res.status(404).json({ error: \"Vehicle not found\" });\n      }\n      \n      const data = loadInventorySchema.parse(req.body);\n      const inventory = await storage.loadVehicleInventory(\n        req.params.id,\n        data.productId,\n        data.quantity,\n        data.purchaseId\n      );\n      res.status(201).json(inventory);\n    } catch (error) {\n      console.error(\"Error loading inventory:\", error);\n      res.status(400).json({ error: \"Invalid inventory data\" });\n    }\n  });\n\n  // Vendor Returns\n  app.get(\"/api/vendor-returns\", async (req, res) => {\n    const { vendorId } = req.query;\n    const returns = await storage.getVendorReturns(vendorId as string | undefined);\n    res.json(returns);\n  });\n\n  app.get(\"/api/vendor-returns/:id\", async (req, res) => {\n    const vendorReturn = await storage.getVendorReturn(req.params.id);\n    if (!vendorReturn) {\n      return res.status(404).json({ error: \"Vendor return not found\" });\n    }\n    res.json(vendorReturn);\n  });\n\n  app.get(\"/api/vendor-returns/:id/items\", async (req, res) => {\n    const items = await storage.getVendorReturnItems(req.params.id);\n    res.json(items);\n  });\n\n  const vendorReturnSchema = z.object({\n    vendorId: z.string(),\n    purchaseId: z.string().optional(),\n    vehicleId: z.string().optional(),\n    date: z.string(),\n    totalAmount: z.number(),\n    status: z.string().optional(),\n    notes: z.string().optional(),\n    items: z.array(\n      z.object({\n        productId: z.string(),\n        quantity: z.number(),\n        unitPrice: z.number(),\n        total: z.number(),\n        reason: z.string(),\n      })\n    ),\n  });\n\n  app.post(\"/api/vendor-returns\", async (req, res) => {\n    try {\n      const data = vendorReturnSchema.parse(req.body);\n      const { items, ...returnData } = data;\n      const vendorReturn = await storage.createVendorReturn(\n        returnData,\n        items.map((item) => ({ ...item, returnId: \"\" }))\n      );\n      res.status(201).json(vendorReturn);\n    } catch (error) {\n      console.error(\"Vendor return error:\", error);\n      res.status(400).json({ error: \"Invalid vendor return data\" });\n    }\n  });\n\n  // Hamali Cash Payments (direct cash payments not through invoices)\n  app.get(\"/api/hamali-cash\", async (req, res) => {\n    const payments = await storage.getHamaliCashPayments();\n    res.json(payments);\n  });\n\n  app.post(\"/api/hamali-cash\", async (req, res) => {\n    try {\n      const data = insertHamaliCashPaymentSchema.parse(req.body);\n      const payment = await storage.createHamaliCashPayment(data);\n      res.status(201).json(payment);\n    } catch (error) {\n      console.error(\"Hamali cash payment error:\", error);\n      res.status(400).json({ error: \"Invalid Hamali cash payment data\" });\n    }\n  });\n\n  app.delete(\"/api/hamali-cash/:id\", async (req, res) => {\n    try {\n      const deleted = await storage.deleteHamaliCashPayment(req.params.id);\n      if (!deleted) {\n        return res.status(404).json({ error: \"Hamali cash payment not found\" });\n      }\n      res.json({ success: true });\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to delete Hamali cash payment\" });\n    }\n  });\n\n  // Reports\n  app.get(\"/api/reports/profit-loss\", async (req, res) => {\n    try {\n      const products = await storage.getProducts();\n      const invoices = await storage.getInvoices();\n      const purchases = await storage.getPurchases();\n      const vendorReturns = await storage.getVendorReturns();\n      const customers = await storage.getCustomers();\n      const allCustomerPayments = await storage.getCustomerPayments();\n      const hamaliCashPayments = await storage.getHamaliCashPayments();\n\n      let totalPurchases = 0;\n      let totalSales = 0;\n      let totalReturns = 0;\n\n      for (const purchase of purchases) {\n        totalPurchases += purchase.totalAmount;\n      }\n\n      for (const invoice of invoices) {\n        totalSales += invoice.grandTotal;\n      }\n\n      for (const vendorReturn of vendorReturns) {\n        totalReturns += vendorReturn.totalAmount;\n      }\n\n      // Net purchases = purchases - returns (returns reduce cost of goods)\n      const netPurchases = totalPurchases - totalReturns;\n\n      const productProfits = products.map((p) => ({\n        id: p.id,\n        name: p.name,\n        purchasePrice: p.purchasePrice,\n        salePrice: p.salePrice,\n        margin: p.salePrice - p.purchasePrice,\n        marginPercent: ((p.salePrice - p.purchasePrice) / p.purchasePrice) * 100,\n      }));\n\n      // Hamali charge breakdown\n      let invoiceHamaliTotal = 0;  // Hamali from invoices\n      let invoicesWithHamali = 0;\n      let invoicesWithoutHamali = 0;\n      let salesWithHamali = 0;  // Grand total of invoices WITH Hamali charge\n      let salesWithoutHamali = 0;  // Grand total of invoices WITHOUT Hamali charge\n      \n      // Direct cash payments to Hamali\n      const directCashHamaliTotal = hamaliCashPayments.reduce((sum, p) => sum + p.amount, 0);\n\n      // Build invoice details with payment info\n      const invoiceDetails = invoices.map((invoice) => {\n        const customer = customers.find((c) => c.id === invoice.customerId);\n        const customerName = customer?.name || \"Unknown\";\n        \n        // Track Hamali amounts - only count actual Hamali charge amount\n        if (invoice.includeHamaliCharge) {\n          invoicesWithHamali++;\n          invoiceHamaliTotal += invoice.hamaliChargeAmount || 0;\n          salesWithHamali += invoice.grandTotal;\n        } else {\n          invoicesWithoutHamali++;\n          salesWithoutHamali += invoice.grandTotal;\n        }\n\n        return {\n          id: invoice.id,\n          invoiceNumber: invoice.invoiceNumber,\n          date: invoice.date,\n          customerName,\n          customerId: invoice.customerId,\n          subtotal: invoice.subtotal,\n          includeHamaliCharge: invoice.includeHamaliCharge,\n          hamaliRatePerKg: invoice.hamaliRatePerKg,\n          hamaliChargeAmount: invoice.hamaliChargeAmount || 0,\n          hamaliPaidByCash: invoice.hamaliPaidByCash,\n          totalKgWeight: invoice.totalKgWeight,\n          grandTotal: invoice.grandTotal,\n        };\n      });\n\n      // Calculate customer-wise payment summary\n      const customerPaymentSummary = customers.map((customer) => {\n        const customerInvoices = invoices.filter((i) => i.customerId === customer.id);\n        const customerPayments = allCustomerPayments.filter((p) => p.customerId === customer.id);\n        \n        const totalInvoiced = customerInvoices.reduce((sum, i) => sum + i.grandTotal, 0);\n        const totalPaid = customerPayments.reduce((sum, p) => sum + p.amount, 0);\n        const balance = totalInvoiced - totalPaid;\n\n        const hamaliAmount = customerInvoices\n          .filter((i) => i.includeHamaliCharge)\n          .reduce((sum, i) => sum + (i.hamaliChargeAmount || 0), 0);\n\n        return {\n          customerId: customer.id,\n          customerName: customer.name,\n          totalInvoiced,\n          totalPaid,\n          balance,\n          hamaliAmount,\n          paymentStatus: balance <= 0 ? \"paid\" : balance < totalInvoiced ? \"partial\" : \"unpaid\",\n        };\n      }).filter((c) => c.totalInvoiced > 0); // Only show customers with invoices\n\n      res.json({\n        totalPurchases,\n        totalReturns,\n        netPurchases,\n        totalSales,\n        grossProfit: totalSales - netPurchases,\n        productProfits,\n        // Hamali charge data\n        hamaliSummary: {\n          invoiceHamaliTotal,\n          directCashHamaliTotal,\n          totalHamaliCollected: invoiceHamaliTotal + directCashHamaliTotal,\n          invoicesWithHamali,\n          invoicesWithoutHamali,\n          salesWithHamali,\n          salesWithoutHamali,\n        },\n        invoiceDetails,\n        customerPaymentSummary,\n        hamaliCashPayments,\n      });\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to generate report\" });\n    }\n  });\n\n  app.get(\"/api/reports/vendor-balances\", async (req, res) => {\n    try {\n      const vendors = await storage.getVendors();\n      const balances = await Promise.all(\n        vendors.map(async (vendor) => {\n          const balance = await storage.getVendorBalance(vendor.id);\n          return {\n            ...vendor,\n            ...balance,\n          };\n        })\n      );\n      res.json(balances);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to generate report\" });\n    }\n  });\n\n  app.get(\"/api/reports/customer-balances\", async (req, res) => {\n    try {\n      const customers = await storage.getCustomers();\n      const balances = await Promise.all(\n        customers.map(async (customer) => {\n          const balance = await storage.getCustomerBalance(customer.id);\n          return {\n            ...customer,\n            ...balance,\n          };\n        })\n      );\n      res.json(balances);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to generate report\" });\n    }\n  });\n\n  return httpServer;\n}\n","path":null,"size_bytes":24797,"size_tokens":null},"client/src/components/ui/pagination.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { ButtonProps, buttonVariants } from \"@/components/ui/button\"\n\nconst Pagination = ({ className, ...props }: React.ComponentProps<\"nav\">) => (\n  <nav\n    role=\"navigation\"\n    aria-label=\"pagination\"\n    className={cn(\"mx-auto flex w-full justify-center\", className)}\n    {...props}\n  />\n)\nPagination.displayName = \"Pagination\"\n\nconst PaginationContent = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    className={cn(\"flex flex-row items-center gap-1\", className)}\n    {...props}\n  />\n))\nPaginationContent.displayName = \"PaginationContent\"\n\nconst PaginationItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li ref={ref} className={cn(\"\", className)} {...props} />\n))\nPaginationItem.displayName = \"PaginationItem\"\n\ntype PaginationLinkProps = {\n  isActive?: boolean\n} & Pick<ButtonProps, \"size\"> &\n  React.ComponentProps<\"a\">\n\nconst PaginationLink = ({\n  className,\n  isActive,\n  size = \"icon\",\n  ...props\n}: PaginationLinkProps) => (\n  <a\n    aria-current={isActive ? \"page\" : undefined}\n    className={cn(\n      buttonVariants({\n        variant: isActive ? \"outline\" : \"ghost\",\n        size,\n      }),\n      className\n    )}\n    {...props}\n  />\n)\nPaginationLink.displayName = \"PaginationLink\"\n\nconst PaginationPrevious = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to previous page\"\n    size=\"default\"\n    className={cn(\"gap-1 pl-2.5\", className)}\n    {...props}\n  >\n    <ChevronLeft className=\"h-4 w-4\" />\n    <span>Previous</span>\n  </PaginationLink>\n)\nPaginationPrevious.displayName = \"PaginationPrevious\"\n\nconst PaginationNext = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to next page\"\n    size=\"default\"\n    className={cn(\"gap-1 pr-2.5\", className)}\n    {...props}\n  >\n    <span>Next</span>\n    <ChevronRight className=\"h-4 w-4\" />\n  </PaginationLink>\n)\nPaginationNext.displayName = \"PaginationNext\"\n\nconst PaginationEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    aria-hidden\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More pages</span>\n  </span>\n)\nPaginationEllipsis.displayName = \"PaginationEllipsis\"\n\nexport {\n  Pagination,\n  PaginationContent,\n  PaginationEllipsis,\n  PaginationItem,\n  PaginationLink,\n  PaginationNext,\n  PaginationPrevious,\n}\n","path":null,"size_bytes":2751,"size_tokens":null},"server/replitAuth.ts":{"content":"import * as client from \"openid-client\";\nimport { Strategy, type VerifyFunction } from \"openid-client/passport\";\n\nimport passport from \"passport\";\nimport session from \"express-session\";\nimport type { Express, RequestHandler } from \"express\";\nimport memoize from \"memoizee\";\nimport connectPg from \"connect-pg-simple\";\nimport { storage } from \"./storage\";\n\nconst getOidcConfig = memoize(\n  async () => {\n    return await client.discovery(\n      new URL(process.env.ISSUER_URL ?? \"https://replit.com/oidc\"),\n      process.env.REPL_ID!\n    );\n  },\n  { maxAge: 3600 * 1000 }\n);\n\nexport function getSession() {\n  const sessionTtl = 7 * 24 * 60 * 60 * 1000; // 1 week\n  const pgStore = connectPg(session);\n  const sessionStore = new pgStore({\n    conString: process.env.DATABASE_URL,\n    createTableIfMissing: false,\n    ttl: sessionTtl,\n    tableName: \"sessions\",\n  });\n  const isProduction = process.env.NODE_ENV === \"production\";\n  return session({\n    secret: process.env.SESSION_SECRET!,\n    store: sessionStore,\n    resave: false,\n    saveUninitialized: false,\n    cookie: {\n      httpOnly: true,\n      secure: isProduction,\n      sameSite: \"lax\",\n      maxAge: sessionTtl,\n    },\n  });\n}\n\nfunction updateUserSession(\n  user: any,\n  tokens: client.TokenEndpointResponse & client.TokenEndpointResponseHelpers\n) {\n  user.claims = tokens.claims();\n  user.access_token = tokens.access_token;\n  user.refresh_token = tokens.refresh_token;\n  user.expires_at = user.claims?.exp;\n}\n\nasync function upsertUser(\n  claims: any,\n) {\n  await storage.upsertUser({\n    id: claims[\"sub\"],\n    email: claims[\"email\"],\n    firstName: claims[\"first_name\"],\n    lastName: claims[\"last_name\"],\n    profileImageUrl: claims[\"profile_image_url\"],\n  });\n}\n\nexport async function setupAuth(app: Express) {\n  app.set(\"trust proxy\", 1);\n  app.use(getSession());\n  app.use(passport.initialize());\n  app.use(passport.session());\n\n  const config = await getOidcConfig();\n\n  const verify: VerifyFunction = async (\n    tokens: client.TokenEndpointResponse & client.TokenEndpointResponseHelpers,\n    verified: passport.AuthenticateCallback\n  ) => {\n    const user = {};\n    updateUserSession(user, tokens);\n    await upsertUser(tokens.claims());\n    verified(null, user);\n  };\n\n  const registeredStrategies = new Set<string>();\n\n  const ensureStrategy = (domain: string) => {\n    const strategyName = `replitauth:${domain}`;\n    if (!registeredStrategies.has(strategyName)) {\n      const strategy = new Strategy(\n        {\n          name: strategyName,\n          config,\n          scope: \"openid email profile offline_access\",\n          callbackURL: `https://${domain}/api/callback`,\n        },\n        verify,\n      );\n      passport.use(strategy);\n      registeredStrategies.add(strategyName);\n    }\n  };\n\n  passport.serializeUser((user: Express.User, cb) => cb(null, user));\n  passport.deserializeUser((user: Express.User, cb) => cb(null, user));\n\n  app.get(\"/api/login\", (req, res, next) => {\n    ensureStrategy(req.hostname);\n    passport.authenticate(`replitauth:${req.hostname}`, {\n      prompt: \"login consent\",\n      scope: [\"openid\", \"email\", \"profile\", \"offline_access\"],\n    })(req, res, next);\n  });\n\n  app.get(\"/api/callback\", (req, res, next) => {\n    ensureStrategy(req.hostname);\n    passport.authenticate(`replitauth:${req.hostname}`, {\n      successReturnToOrRedirect: \"/\",\n      failureRedirect: \"/api/login\",\n    })(req, res, next);\n  });\n\n  app.get(\"/api/logout\", (req, res) => {\n    req.logout(() => {\n      res.redirect(\n        client.buildEndSessionUrl(config, {\n          client_id: process.env.REPL_ID!,\n          post_logout_redirect_uri: `${req.protocol}://${req.hostname}`,\n        }).href\n      );\n    });\n  });\n}\n\nexport const isAuthenticated: RequestHandler = async (req, res, next) => {\n  const user = req.user as any;\n\n  if (!req.isAuthenticated() || !user.expires_at) {\n    return res.status(401).json({ message: \"Unauthorized\" });\n  }\n\n  const now = Math.floor(Date.now() / 1000);\n  if (now <= user.expires_at) {\n    return next();\n  }\n\n  const refreshToken = user.refresh_token;\n  if (!refreshToken) {\n    res.status(401).json({ message: \"Unauthorized\" });\n    return;\n  }\n\n  try {\n    const config = await getOidcConfig();\n    const tokenResponse = await client.refreshTokenGrant(config, refreshToken);\n    updateUserSession(user, tokenResponse);\n    return next();\n  } catch (error) {\n    res.status(401).json({ message: \"Unauthorized\" });\n    return;\n  }\n};\n","path":null,"size_bytes":4464,"size_tokens":null},"client/src/pages/weighing.tsx":{"content":"import { useState, useEffect, useRef } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { Scale, Plus, Trash2, Truck, User, FileText, Wifi, WifiOff, RefreshCw, HandCoins, Settings } from \"lucide-react\";\nimport type { Vehicle, Customer, Product, VehicleInventory } from \"@shared/schema\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { Package } from \"lucide-react\";\nimport { useScale, isWebSerialSupported } from \"@/hooks/use-scale\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\n\ntype WeighingItem = {\n  id: string;\n  productId: string;\n  productName: string;\n  quantity: number;\n  unit: string;\n  unitPrice: number;\n  total: number;\n};\n\n// Unit classification helpers\nconst WEIGHT_UNITS = [\"KG\", \"Kg\", \"kg\"];\nconst COUNT_UNITS = [\"Box\", \"Bag\", \"Crate\", \"Piece\", \"Dozen\", \"Bundle\"];\n\nconst isWeightBasedUnit = (unit: string): boolean => {\n  return WEIGHT_UNITS.some(u => u.toLowerCase() === unit.toLowerCase());\n};\n\nconst getUnitLabel = (unit: string): string => {\n  if (isWeightBasedUnit(unit)) return \"Weight\";\n  return \"Quantity\";\n};\n\nexport default function Weighing() {\n  const { toast } = useToast();\n  const [selectedVehicle, setSelectedVehicle] = useState<string>(\"\");\n  const [selectedCustomer, setSelectedCustomer] = useState<string>(\"\");\n  const [selectedProduct, setSelectedProduct] = useState<string>(\"\");\n  const [quantity, setQuantity] = useState<string>(\"\");\n  const [weighingItems, setWeighingItems] = useState<WeighingItem[]>([]);\n  // Hamali charge state - simplified with rate per KG and two checkboxes\n  const [includeHamali, setIncludeHamali] = useState(false);\n  const [hamaliRatePerKg, setHamaliRatePerKg] = useState(\"2\"); // Rate per KG\n  const [hamaliPaidByCash, setHamaliPaidByCash] = useState(false);\n  \n  // Scale connection state\n  const [scaleConnected, setScaleConnected] = useState(false);\n  const [liveWeight, setLiveWeight] = useState<number>(0);\n  const [weightStable, setWeightStable] = useState(false);\n  const [demoMode, setDemoMode] = useState(true);\n  const demoIntervalRef = useRef<NodeJS.Timeout | null>(null);\n  const [scaleSettingsOpen, setScaleSettingsOpen] = useState(false);\n  \n  // Real scale connection using Web Serial API\n  const scale = useScale();\n\n  const { data: vehicles = [], isLoading: vehiclesLoading } = useQuery<Vehicle[]>({\n    queryKey: [\"/api/vehicles\"],\n  });\n\n  const { data: customers = [], isLoading: customersLoading } = useQuery<Customer[]>({\n    queryKey: [\"/api/customers\"],\n  });\n\n  const { data: products = [], isLoading: productsLoading } = useQuery<Product[]>({\n    queryKey: [\"/api/products\"],\n  });\n\n  // Vehicle inventory query\n  const { data: vehicleInventoryData = [], isLoading: inventoryLoading } = useQuery<VehicleInventory[]>({\n    queryKey: [\"/api/vehicles\", selectedVehicle, \"inventory\"],\n    queryFn: async () => {\n      if (!selectedVehicle) return [];\n      const res = await fetch(`/api/vehicles/${selectedVehicle}/inventory`);\n      return res.json();\n    },\n    enabled: !!selectedVehicle,\n  });\n\n  // Calculate remaining inventory (account for items added to current bill)\n  const getVehicleStock = (productId: string): number => {\n    const inventoryItem = vehicleInventoryData.find(inv => inv.productId === productId);\n    const baseQty = inventoryItem?.quantity || 0;\n    const usedQty = weighingItems\n      .filter(item => item.productId === productId)\n      .reduce((sum, item) => sum + item.quantity, 0);\n    return Math.max(0, baseQty - usedQty);\n  };\n\n  // Get selected product details\n  const selectedProductData = products.find(p => p.id === selectedProduct);\n  const isWeightBased = selectedProductData ? isWeightBasedUnit(selectedProductData.unit) : true;\n\n  // Demo mode: simulate weight changes\n  useEffect(() => {\n    if (demoMode && scaleConnected) {\n      demoIntervalRef.current = setInterval(() => {\n        // Simulate fluctuating weight that stabilizes\n        const baseWeight = Math.random() * 50 + 10;\n        const fluctuation = Math.random() * 0.5 - 0.25;\n        setLiveWeight(parseFloat((baseWeight + fluctuation).toFixed(2)));\n        setWeightStable(Math.random() > 0.3);\n      }, 500);\n    } else {\n      if (demoIntervalRef.current) {\n        clearInterval(demoIntervalRef.current);\n      }\n    }\n    return () => {\n      if (demoIntervalRef.current) {\n        clearInterval(demoIntervalRef.current);\n      }\n    };\n  }, [demoMode, scaleConnected]);\n\n  // Sync real scale state to local state when not in demo mode\n  useEffect(() => {\n    if (!demoMode) {\n      // In real mode, use scale hook state\n      setScaleConnected(scale.isConnected);\n      if (scale.isConnected && scale.currentWeight !== null) {\n        setLiveWeight(scale.currentWeight);\n        setWeightStable(true); // Real scale provides stable readings\n      } else if (!scale.isConnected) {\n        setLiveWeight(0);\n        setWeightStable(false);\n      }\n    }\n  }, [demoMode, scale.isConnected, scale.currentWeight]);\n\n  // When switching from demo mode to real mode, disconnect demo\n  useEffect(() => {\n    if (!demoMode && scaleConnected && !scale.isConnected) {\n      // We're switching from demo mode while \"connected\" - reset local state\n      setScaleConnected(false);\n      setLiveWeight(0);\n      setWeightStable(false);\n    }\n  }, [demoMode]);\n\n  const toggleScaleConnection = async () => {\n    if (demoMode) {\n      // Demo mode: toggle simulated connection\n      if (scaleConnected) {\n        setScaleConnected(false);\n        setLiveWeight(0);\n        setWeightStable(false);\n      } else {\n        setScaleConnected(true);\n        toast({\n          title: \"Demo Mode Active\",\n          description: \"Simulating weight readings. Turn off Demo Mode to connect real scale.\",\n        });\n      }\n    } else {\n      // Real scale mode: use Web Serial API\n      if (scale.isConnected) {\n        await scale.disconnect();\n        toast({ title: \"Scale Disconnected\" });\n      } else {\n        if (!isWebSerialSupported()) {\n          toast({\n            title: \"Browser Not Supported\",\n            description: \"Please use Chrome or Edge browser to connect to weighing machine.\",\n            variant: \"destructive\",\n          });\n          return;\n        }\n        const success = await scale.connect();\n        if (success) {\n          toast({ title: \"Scale Connected\", description: \"Weighing machine connected successfully.\" });\n        } else if (scale.error) {\n          toast({ title: \"Connection Failed\", description: scale.error, variant: \"destructive\" });\n        }\n      }\n    }\n  };\n\n  const captureWeight = () => {\n    // Only allow weight capture for weight-based products\n    if (!isWeightBased) {\n      toast({\n        title: \"Scale Not Applicable\",\n        description: \"This product uses count-based units. Please enter quantity manually.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    \n    if (weightStable && liveWeight > 0) {\n      setQuantity(liveWeight.toFixed(2));\n      toast({\n        title: \"Weight Captured\",\n        description: `Captured ${liveWeight.toFixed(2)} KG from scale`,\n      });\n    } else {\n      toast({\n        title: \"Weight Not Stable\",\n        description: \"Please wait for the weight to stabilize before capturing.\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const createInvoice = useMutation({\n    mutationFn: async (data: {\n      customerId: string;\n      vehicleId?: string;\n      invoiceNumber: string;\n      date: string;\n      subtotal: number;\n      includeHamaliCharge: boolean;\n      hamaliRatePerKg: number;\n      hamaliChargeAmount: number;\n      hamaliPaidByCash: boolean;\n      totalKgWeight: number;\n      grandTotal: number;\n      items: { productId: string; quantity: number; unitPrice: number; total: number }[];\n    }) => {\n      return apiRequest(\"POST\", \"/api/invoices\", data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/invoices\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/products\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/vehicles\", selectedVehicle, \"inventory\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/hamali-cash\"] });\n      setWeighingItems([]);\n      setSelectedCustomer(\"\");\n      setSelectedVehicle(\"\");\n      setIncludeHamali(false);\n      setHamaliPaidByCash(false);\n      toast({ title: \"Invoice Created\", description: \"Weighing completed and invoice generated successfully.\" });\n    },\n    onError: () => {\n      toast({ title: \"Error\", description: \"Failed to create invoice.\", variant: \"destructive\" });\n    },\n  });\n\n  const getProduct = (id: string) => products.find((p) => p.id === id);\n\n  const addWeighingItem = () => {\n    if (!selectedProduct || !quantity || parseFloat(quantity) <= 0) {\n      const productUnit = selectedProductData?.unit || \"KG\";\n      const label = isWeightBasedUnit(productUnit) ? \"weight\" : \"quantity\";\n      toast({ title: \"Invalid Entry\", description: `Please select a product and enter a valid ${label}.`, variant: \"destructive\" });\n      return;\n    }\n\n    const product = getProduct(selectedProduct);\n    if (!product) return;\n\n    const qtyNum = parseFloat(quantity);\n    \n    // Check vehicle inventory if a vehicle is selected\n    if (selectedVehicle && vehicleInventoryData.length > 0) {\n      const remainingStock = getVehicleStock(selectedProduct);\n      if (qtyNum > remainingStock) {\n        toast({ \n          title: \"Insufficient Stock\", \n          description: `Only ${remainingStock.toFixed(2)} ${product.unit} available in the selected vehicle.`, \n          variant: \"destructive\" \n        });\n        return;\n      }\n    }\n    \n    const total = qtyNum * product.salePrice;\n\n    const newItem: WeighingItem = {\n      id: Date.now().toString(),\n      productId: product.id,\n      productName: product.name,\n      quantity: qtyNum,\n      unit: product.unit,\n      unitPrice: product.salePrice,\n      total,\n    };\n\n    setWeighingItems([...weighingItems, newItem]);\n    setSelectedProduct(\"\");\n    setQuantity(\"\");\n  };\n\n  const incrementQuantity = () => {\n    const current = parseFloat(quantity) || 0;\n    setQuantity((current + 1).toString());\n  };\n\n  const decrementQuantity = () => {\n    const current = parseFloat(quantity) || 0;\n    if (current > 0) {\n      setQuantity(Math.max(0, current - 1).toString());\n    }\n  };\n\n  const removeWeighingItem = (id: string) => {\n    setWeighingItems(weighingItems.filter((item) => item.id !== id));\n  };\n\n  const subtotal = weighingItems.reduce((sum, item) => sum + item.total, 0);\n  \n  // Calculate total KG weight from weight-based items only\n  const totalKgWeight = weighingItems\n    .filter(item => isWeightBasedUnit(item.unit))\n    .reduce((sum, item) => sum + item.quantity, 0);\n  \n  // Calculate Hamali amount based on rate per KG\n  const hamaliAmount = includeHamali ? totalKgWeight * parseFloat(hamaliRatePerKg || \"0\") : 0;\n  \n  // Grand total: Add hamali only if NOT paid by cash\n  // If paid by cash, hamali is recorded separately and not added to invoice\n  const grandTotal = subtotal + (includeHamali && !hamaliPaidByCash ? hamaliAmount : 0);\n\n  const handleGenerateInvoice = () => {\n    if (!selectedCustomer) {\n      toast({ title: \"Select Customer\", description: \"Please select a customer for this invoice.\", variant: \"destructive\" });\n      return;\n    }\n\n    if (weighingItems.length === 0) {\n      toast({ title: \"No Items\", description: \"Please add at least one item to the invoice.\", variant: \"destructive\" });\n      return;\n    }\n\n    const invoiceNumber = `INV-${Date.now().toString().slice(-8)}`;\n    const today = new Date().toISOString().split(\"T\")[0];\n\n    createInvoice.mutate({\n      customerId: selectedCustomer,\n      vehicleId: selectedVehicle || undefined,\n      invoiceNumber,\n      date: today,\n      subtotal,\n      includeHamaliCharge: includeHamali,\n      hamaliRatePerKg: parseFloat(hamaliRatePerKg || \"0\"),\n      hamaliChargeAmount: hamaliAmount,\n      hamaliPaidByCash,\n      totalKgWeight,\n      grandTotal,\n      items: weighingItems.map((item) => ({\n        productId: item.productId,\n        quantity: item.quantity,\n        unitPrice: item.unitPrice,\n        total: item.total,\n      })),\n    });\n  };\n\n  if (vehiclesLoading || customersLoading || productsLoading) {\n    return (\n      <div className=\"p-6 space-y-6\">\n        <Skeleton className=\"h-8 w-48\" />\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n          <Skeleton className=\"h-32\" />\n          <Skeleton className=\"h-32\" />\n        </div>\n        <Skeleton className=\"h-96\" />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"p-6 space-y-6\">\n      <div className=\"flex items-center justify-between gap-4 flex-wrap\">\n        <div className=\"flex items-center gap-3\">\n          <Scale className=\"h-6 w-6 text-primary\" />\n          <div>\n            <h1 className=\"text-2xl font-semibold\" data-testid=\"text-page-title\">\n              Weighing Station\n            </h1>\n            <p className=\"text-sm text-muted-foreground\">Take products from vehicle, weigh, and bill customer</p>\n          </div>\n        </div>\n        <div className=\"flex items-center gap-4\">\n          <div className=\"flex items-center gap-2\">\n            <Label htmlFor=\"demo-mode\" className=\"text-sm text-muted-foreground\">Demo Mode</Label>\n            <Switch\n              id=\"demo-mode\"\n              checked={demoMode}\n              onCheckedChange={setDemoMode}\n              data-testid=\"switch-demo-mode\"\n            />\n          </div>\n          <Badge variant={scaleConnected ? \"default\" : \"secondary\"} className=\"gap-1\">\n            {scaleConnected ? <Wifi className=\"h-3 w-3\" /> : <WifiOff className=\"h-3 w-3\" />}\n            {scaleConnected ? \"Scale Connected\" : \"Scale Disconnected\"}\n          </Badge>\n        </div>\n      </div>\n\n      <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\n        <div className=\"lg:col-span-2 space-y-6\">\n          {/* Live Scale Display */}\n          <Card className={scaleConnected ? \"border-primary\" : \"\"}>\n            <CardHeader className=\"pb-2\">\n              <CardTitle className=\"flex items-center justify-between gap-2 flex-wrap\">\n                <div className=\"flex items-center gap-2\">\n                  <Scale className=\"h-4 w-4\" />\n                  Live Scale Reading\n                  {demoMode && <Badge variant=\"outline\" className=\"text-xs\">Demo</Badge>}\n                </div>\n                <div className=\"flex items-center gap-2\">\n                  {!demoMode && !scaleConnected && (\n                    <Dialog open={scaleSettingsOpen} onOpenChange={setScaleSettingsOpen}>\n                      <DialogTrigger asChild>\n                        <Button variant=\"outline\" size=\"icon\" data-testid=\"button-scale-settings\">\n                          <Settings className=\"h-4 w-4\" />\n                        </Button>\n                      </DialogTrigger>\n                      <DialogContent>\n                        <DialogHeader>\n                          <DialogTitle>Scale Settings</DialogTitle>\n                        </DialogHeader>\n                        <div className=\"space-y-4\">\n                          <p className=\"text-sm text-muted-foreground\">\n                            Configure your weighing machine connection settings. Check your scale manual for correct values.\n                          </p>\n                          <div className=\"grid gap-4\">\n                            <div className=\"flex items-center justify-between\">\n                              <Label>Baud Rate</Label>\n                              <Select value={scale.settings.baudRate.toString()} onValueChange={(v) => scale.updateSettings({ baudRate: parseInt(v) })}>\n                                <SelectTrigger className=\"w-40\" data-testid=\"select-baud-rate\">\n                                  <SelectValue />\n                                </SelectTrigger>\n                                <SelectContent>\n                                  <SelectItem value=\"9600\">9600 (Common)</SelectItem>\n                                  <SelectItem value=\"4800\">4800</SelectItem>\n                                  <SelectItem value=\"19200\">19200</SelectItem>\n                                  <SelectItem value=\"115200\">115200</SelectItem>\n                                </SelectContent>\n                              </Select>\n                            </div>\n                            <div className=\"flex items-center justify-between\">\n                              <Label>Data Bits</Label>\n                              <Select value={scale.settings.dataBits.toString()} onValueChange={(v) => scale.updateSettings({ dataBits: parseInt(v) as 7 | 8 })}>\n                                <SelectTrigger className=\"w-40\" data-testid=\"select-data-bits\">\n                                  <SelectValue />\n                                </SelectTrigger>\n                                <SelectContent>\n                                  <SelectItem value=\"8\">8 (Common)</SelectItem>\n                                  <SelectItem value=\"7\">7</SelectItem>\n                                </SelectContent>\n                              </Select>\n                            </div>\n                            <div className=\"flex items-center justify-between\">\n                              <Label>Parity</Label>\n                              <Select value={scale.settings.parity} onValueChange={(v) => scale.updateSettings({ parity: v as \"none\" | \"even\" | \"odd\" })}>\n                                <SelectTrigger className=\"w-40\" data-testid=\"select-parity\">\n                                  <SelectValue />\n                                </SelectTrigger>\n                                <SelectContent>\n                                  <SelectItem value=\"none\">None (Common)</SelectItem>\n                                  <SelectItem value=\"even\">Even</SelectItem>\n                                  <SelectItem value=\"odd\">Odd</SelectItem>\n                                </SelectContent>\n                              </Select>\n                            </div>\n                          </div>\n                          <p className=\"text-xs text-muted-foreground\">\n                            Settings are saved automatically. Works with USB/Serial scales in Chrome/Edge browsers.\n                          </p>\n                        </div>\n                      </DialogContent>\n                    </Dialog>\n                  )}\n                  <Button\n                    variant={scaleConnected ? \"destructive\" : \"default\"}\n                    size=\"sm\"\n                    onClick={toggleScaleConnection}\n                    disabled={!demoMode && scale.isConnecting}\n                    data-testid=\"button-toggle-scale\"\n                  >\n                    {!demoMode && scale.isConnecting ? \"Connecting...\" : scaleConnected ? \"Disconnect\" : \"Connect Scale\"}\n                  </Button>\n                </div>\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"flex items-center justify-between gap-4 flex-wrap\">\n                <div className=\"flex-1 min-w-[200px]\">\n                  <div className={`text-5xl font-mono font-bold text-center py-6 rounded-md ${\n                    scaleConnected \n                      ? weightStable \n                        ? \"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400\" \n                        : \"bg-yellow-100 dark:bg-yellow-900/30 text-yellow-700 dark:text-yellow-400\"\n                      : \"bg-muted text-muted-foreground\"\n                  }`} data-testid=\"display-live-weight\">\n                    {scaleConnected ? `${liveWeight.toFixed(2)} KG` : \"-- KG\"}\n                  </div>\n                  <div className=\"text-center mt-2 text-sm\">\n                    {scaleConnected ? (\n                      weightStable ? (\n                        <span className=\"text-green-600 dark:text-green-400\">Weight Stable</span>\n                      ) : (\n                        <span className=\"text-yellow-600 dark:text-yellow-400 flex items-center justify-center gap-1\">\n                          <RefreshCw className=\"h-3 w-3 animate-spin\" />\n                          Stabilizing...\n                        </span>\n                      )\n                    ) : (\n                      <span className=\"text-muted-foreground\">Scale not connected</span>\n                    )}\n                  </div>\n                </div>\n                <Button\n                  size=\"lg\"\n                  onClick={captureWeight}\n                  disabled={!scaleConnected || !weightStable || liveWeight <= 0 || !isWeightBased}\n                  className=\"min-w-[150px]\"\n                  data-testid=\"button-capture-weight\"\n                >\n                  <Scale className=\"h-4 w-4 mr-2\" />\n                  Capture Weight\n                </Button>\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <Truck className=\"h-4 w-4\" />\n                Step 1: Select Vehicle & Customer\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                <div className=\"space-y-2\">\n                  <Label>Vehicle (Parked Near Shop)</Label>\n                  <Select value={selectedVehicle} onValueChange={setSelectedVehicle}>\n                    <SelectTrigger data-testid=\"select-vehicle\">\n                      <SelectValue placeholder=\"Select vehicle\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      {vehicles.map((vehicle) => (\n                        <SelectItem key={vehicle.id} value={vehicle.id}>\n                          {vehicle.number} - {vehicle.driverName || vehicle.type}\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n                <div className=\"space-y-2\">\n                  <Label>Customer</Label>\n                  <Select value={selectedCustomer} onValueChange={setSelectedCustomer}>\n                    <SelectTrigger data-testid=\"select-customer\">\n                      <SelectValue placeholder=\"Select customer\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      {customers.map((customer) => (\n                        <SelectItem key={customer.id} value={customer.id}>\n                          {customer.name}\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n              </div>\n\n              {/* Vehicle Inventory Display */}\n              {selectedVehicle && (\n                <div className=\"mt-4 pt-4 border-t\">\n                  <div className=\"flex items-center justify-between gap-2 mb-3\">\n                    <div className=\"flex items-center gap-2\">\n                      <Package className=\"h-4 w-4 text-primary\" />\n                      <span className=\"font-medium\">Products Available in Vehicle</span>\n                    </div>\n                    {inventoryLoading && <Badge variant=\"outline\">Loading...</Badge>}\n                  </div>\n                  {vehicleInventoryData.length === 0 && !inventoryLoading ? (\n                    <div className=\"text-center py-4 bg-muted/50 rounded-md\">\n                      <Package className=\"h-8 w-8 mx-auto text-muted-foreground mb-2\" />\n                      <p className=\"text-sm text-muted-foreground\">No products loaded in this vehicle</p>\n                      <p className=\"text-xs text-muted-foreground mt-1\">Create a purchase order with this vehicle to load products</p>\n                    </div>\n                  ) : (\n                    <div className=\"rounded-md border\">\n                      <Table>\n                        <TableHeader>\n                          <TableRow>\n                            <TableHead>Product</TableHead>\n                            <TableHead className=\"text-right\">Available Qty</TableHead>\n                            <TableHead className=\"text-right\">Unit</TableHead>\n                            <TableHead className=\"text-right\">Status</TableHead>\n                          </TableRow>\n                        </TableHeader>\n                        <TableBody>\n                          {vehicleInventoryData.map((inv) => {\n                            const product = products.find(p => p.id === inv.productId);\n                            const remaining = getVehicleStock(inv.productId);\n                            return (\n                              <TableRow \n                                key={inv.id}\n                                data-testid={`vehicle-stock-${inv.productId}`}\n                              >\n                                <TableCell className=\"font-medium\">{product?.name || \"Unknown Product\"}</TableCell>\n                                <TableCell className=\"text-right font-mono text-lg font-semibold\">\n                                  {remaining.toFixed(2)}\n                                </TableCell>\n                                <TableCell className=\"text-right text-muted-foreground\">\n                                  {product?.unit || \"KG\"}\n                                </TableCell>\n                                <TableCell className=\"text-right\">\n                                  {remaining > (product?.reorderLevel || 10) ? (\n                                    <Badge variant=\"default\" className=\"bg-green-600\">In Stock</Badge>\n                                  ) : remaining > 0 ? (\n                                    <Badge variant=\"secondary\" className=\"bg-yellow-500 text-yellow-950\">Low Stock</Badge>\n                                  ) : (\n                                    <Badge variant=\"destructive\">Out of Stock</Badge>\n                                  )}\n                                </TableCell>\n                              </TableRow>\n                            );\n                          })}\n                        </TableBody>\n                      </Table>\n                    </div>\n                  )}\n                </div>\n              )}\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <Scale className=\"h-4 w-4\" />\n                Step 2: Add Products to Bill\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4 items-end\">\n                <div className=\"space-y-2 md:col-span-2\">\n                  <Label>Product</Label>\n                  <Select value={selectedProduct} onValueChange={(val) => { setSelectedProduct(val); setQuantity(\"\"); }}>\n                    <SelectTrigger data-testid=\"select-product\">\n                      <SelectValue placeholder=\"Select product\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      {products.map((product) => (\n                        <SelectItem key={product.id} value={product.id}>\n                          {product.name} - {product.salePrice.toLocaleString(\"en-IN\", { style: \"currency\", currency: \"INR\" })}/{product.unit}\n                          {!isWeightBasedUnit(product.unit) && <Badge variant=\"outline\" className=\"ml-2 text-xs\">{product.unit}</Badge>}\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n                <div className=\"space-y-2\">\n                  <Label>\n                    {selectedProductData ? getUnitLabel(selectedProductData.unit) : \"Quantity\"} ({selectedProductData?.unit || \"KG\"})\n                  </Label>\n                  {isWeightBased ? (\n                    <Input\n                      type=\"number\"\n                      step=\"0.01\"\n                      value={quantity}\n                      onChange={(e) => setQuantity(e.target.value)}\n                      placeholder={scaleConnected ? \"From scale\" : \"Enter weight\"}\n                      data-testid=\"input-quantity\"\n                    />\n                  ) : (\n                    <div className=\"flex items-center gap-2\">\n                      <Button \n                        variant=\"outline\" \n                        size=\"icon\" \n                        onClick={decrementQuantity}\n                        data-testid=\"button-decrement\"\n                      >\n                        -\n                      </Button>\n                      <Input\n                        type=\"number\"\n                        step=\"1\"\n                        min=\"0\"\n                        value={quantity}\n                        onChange={(e) => setQuantity(e.target.value)}\n                        placeholder=\"0\"\n                        className=\"text-center\"\n                        data-testid=\"input-quantity\"\n                      />\n                      <Button \n                        variant=\"outline\" \n                        size=\"icon\" \n                        onClick={incrementQuantity}\n                        data-testid=\"button-increment\"\n                      >\n                        +\n                      </Button>\n                    </div>\n                  )}\n                </div>\n                <Button onClick={addWeighingItem} data-testid=\"button-add-item\">\n                  <Plus className=\"h-4 w-4 mr-2\" />\n                  Add\n                </Button>\n              </div>\n\n              {/* Show scale capture hint for weight-based products */}\n              {isWeightBased && selectedProduct && (\n                <p className=\"text-sm text-muted-foreground mt-2\">\n                  {scaleConnected \n                    ? \"Use 'Capture Weight' button above to get weight from scale, or enter manually.\" \n                    : \"Connect scale to capture weight automatically, or enter weight manually.\"}\n                </p>\n              )}\n              \n              {/* Show count hint for count-based products */}\n              {!isWeightBased && selectedProduct && (\n                <p className=\"text-sm text-muted-foreground mt-2\">\n                  Enter the number of {selectedProductData?.unit.toLowerCase()}s for this product.\n                </p>\n              )}\n\n              <div className=\"mt-6\">\n                <Table>\n                  <TableHeader>\n                    <TableRow>\n                      <TableHead>Product</TableHead>\n                      <TableHead className=\"text-right\">Qty</TableHead>\n                      <TableHead className=\"text-right\">Rate</TableHead>\n                      <TableHead className=\"text-right\">Amount</TableHead>\n                      <TableHead className=\"w-12\"></TableHead>\n                    </TableRow>\n                  </TableHeader>\n                  <TableBody>\n                    {weighingItems.length === 0 ? (\n                      <TableRow>\n                        <TableCell colSpan={5} className=\"text-center text-muted-foreground py-8\">\n                          No items added yet. Select a product and enter quantity to add.\n                        </TableCell>\n                      </TableRow>\n                    ) : (\n                      weighingItems.map((item) => (\n                        <TableRow key={item.id} data-testid={`row-item-${item.id}`}>\n                          <TableCell className=\"font-medium\">{item.productName}</TableCell>\n                          <TableCell className=\"text-right font-mono\">\n                            {isWeightBasedUnit(item.unit) ? item.quantity.toFixed(2) : item.quantity} {item.unit}\n                          </TableCell>\n                          <TableCell className=\"text-right font-mono\">\n                            {item.unitPrice.toLocaleString(\"en-IN\", { style: \"currency\", currency: \"INR\" })}\n                          </TableCell>\n                          <TableCell className=\"text-right font-mono font-semibold\">\n                            {item.total.toLocaleString(\"en-IN\", { style: \"currency\", currency: \"INR\" })}\n                          </TableCell>\n                          <TableCell>\n                            <Button\n                              size=\"icon\"\n                              variant=\"ghost\"\n                              onClick={() => removeWeighingItem(item.id)}\n                              data-testid={`button-remove-${item.id}`}\n                            >\n                              <Trash2 className=\"h-4 w-4 text-destructive\" />\n                            </Button>\n                          </TableCell>\n                        </TableRow>\n                      ))\n                    )}\n                  </TableBody>\n                </Table>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n\n        <div className=\"space-y-6\">\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <User className=\"h-4 w-4\" />\n                Customer Details\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              {selectedCustomer ? (\n                <div className=\"space-y-2\">\n                  <p className=\"font-medium\">\n                    {customers.find((c) => c.id === selectedCustomer)?.name}\n                  </p>\n                  <p className=\"text-sm text-muted-foreground\">\n                    {customers.find((c) => c.id === selectedCustomer)?.phone}\n                  </p>\n                  <p className=\"text-sm text-muted-foreground\">\n                    {customers.find((c) => c.id === selectedCustomer)?.address}\n                  </p>\n                </div>\n              ) : (\n                <p className=\"text-muted-foreground text-sm\">Select a customer</p>\n              )}\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <FileText className=\"h-4 w-4\" />\n                Invoice Summary\n              </CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <div className=\"space-y-2\">\n                <div className=\"flex justify-between gap-2 text-sm\">\n                  <span>Items</span>\n                  <Badge variant=\"secondary\">{weighingItems.length}</Badge>\n                </div>\n                <div className=\"flex justify-between gap-2 text-sm\">\n                  <span>Subtotal</span>\n                  <span className=\"font-mono\" data-testid=\"text-subtotal\">\n                    {subtotal.toLocaleString(\"en-IN\", { style: \"currency\", currency: \"INR\" })}\n                  </span>\n                </div>\n              </div>\n\n              {/* Hamali Charge Section */}\n              <div className=\"space-y-3 pt-3 border-t\">\n                <div className=\"flex items-center gap-2\">\n                  <input\n                    type=\"checkbox\"\n                    id=\"includeHamali\"\n                    checked={includeHamali}\n                    onChange={(e) => {\n                      setIncludeHamali(e.target.checked);\n                      if (!e.target.checked) {\n                        setHamaliPaidByCash(false);\n                      }\n                    }}\n                    className=\"rounded\"\n                    data-testid=\"checkbox-include-hamali\"\n                  />\n                  <Label htmlFor=\"includeHamali\" className=\"text-sm\">Include Hamali</Label>\n                </div>\n                \n                {includeHamali && (\n                  <div className=\"space-y-3 pl-5\">\n                    <div className=\"flex justify-between gap-2 text-sm\">\n                      <span className=\"text-muted-foreground\">Total Weight:</span>\n                      <span className=\"font-mono font-medium\" data-testid=\"text-total-kg\">\n                        {totalKgWeight.toFixed(2)} KG\n                      </span>\n                    </div>\n                    \n                    <div className=\"flex items-center gap-2\">\n                      <span className=\"text-sm text-muted-foreground\">Rate:</span>\n                      <Input\n                        type=\"number\"\n                        step=\"0.01\"\n                        value={hamaliRatePerKg}\n                        onChange={(e) => setHamaliRatePerKg(e.target.value)}\n                        className=\"w-20\"\n                        data-testid=\"input-hamali-rate-per-kg\"\n                      />\n                      <span className=\"text-sm text-muted-foreground\">per KG</span>\n                    </div>\n                    \n                    <div className=\"flex justify-between gap-2 text-sm\">\n                      <span className=\"font-medium\">Hamali Amount:</span>\n                      <span className=\"font-mono font-semibold\" data-testid=\"text-hamali-amount\">\n                        {hamaliAmount.toLocaleString(\"en-IN\", { style: \"currency\", currency: \"INR\" })}\n                      </span>\n                    </div>\n                    \n                    <p className=\"text-xs text-muted-foreground\">\n                      {totalKgWeight.toFixed(2)} KG x ₹{hamaliRatePerKg}/KG = ₹{hamaliAmount.toFixed(2)}\n                    </p>\n                    \n                    <div className=\"flex items-center gap-2 pt-2 border-t border-dashed\">\n                      <input\n                        type=\"checkbox\"\n                        id=\"hamaliPaidByCash\"\n                        checked={hamaliPaidByCash}\n                        onChange={(e) => setHamaliPaidByCash(e.target.checked)}\n                        className=\"rounded\"\n                        data-testid=\"checkbox-hamali-paid-cash\"\n                      />\n                      <Label htmlFor=\"hamaliPaidByCash\" className=\"text-sm flex items-center gap-1\">\n                        <HandCoins className=\"h-3 w-3\" />\n                        Paid by Cash\n                      </Label>\n                    </div>\n                    \n                    {hamaliPaidByCash && (\n                      <p className=\"text-xs text-muted-foreground pl-5\">\n                        Hamali will be recorded as cash payment (not added to invoice total)\n                      </p>\n                    )}\n                  </div>\n                )}\n              </div>\n\n              <div className=\"pt-3 border-t\">\n                <div className=\"flex justify-between gap-2 text-lg font-bold\">\n                  <span>Grand Total</span>\n                  <span className=\"font-mono\" data-testid=\"text-grand-total\">\n                    {grandTotal.toLocaleString(\"en-IN\", { style: \"currency\", currency: \"INR\" })}\n                  </span>\n                </div>\n              </div>\n\n              <Button\n                onClick={handleGenerateInvoice}\n                disabled={weighingItems.length === 0 || !selectedCustomer || createInvoice.isPending}\n                className=\"w-full\"\n                data-testid=\"button-generate-invoice\"\n              >\n                {createInvoice.isPending ? \"Generating...\" : \"Generate Invoice\"}\n              </Button>\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":40301,"size_tokens":null},"client/src/components/ui/toaster.tsx":{"content":"import { useToast } from \"@/hooks/use-toast\"\nimport {\n  Toast,\n  ToastClose,\n  ToastDescription,\n  ToastProvider,\n  ToastTitle,\n  ToastViewport,\n} from \"@/components/ui/toast\"\n\nexport function Toaster() {\n  const { toasts } = useToast()\n\n  return (\n    <ToastProvider>\n      {toasts.map(function ({ id, title, description, action, ...props }) {\n        return (\n          <Toast key={id} {...props}>\n            <div className=\"grid gap-1\">\n              {title && <ToastTitle>{title}</ToastTitle>}\n              {description && (\n                <ToastDescription>{description}</ToastDescription>\n              )}\n            </div>\n            {action}\n            <ToastClose />\n          </Toast>\n        )\n      })}\n      <ToastViewport />\n    </ToastProvider>\n  )\n}\n","path":null,"size_bytes":772,"size_tokens":null},"client/src/components/ui/sidebar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, VariantProps } from \"class-variance-authority\"\nimport { PanelLeftIcon } from \"lucide-react\"\n\nimport { useIsMobile } from \"@/hooks/use-mobile\"\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Separator } from \"@/components/ui/separator\"\nimport {\n  Sheet,\n  SheetContent,\n  SheetDescription,\n  SheetHeader,\n  SheetTitle,\n} from \"@/components/ui/sheet\"\nimport { Skeleton } from \"@/components/ui/skeleton\"\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\"\n\nconst SIDEBAR_COOKIE_NAME = \"sidebar_state\"\nconst SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7\nconst SIDEBAR_WIDTH = \"16rem\"\nconst SIDEBAR_WIDTH_MOBILE = \"18rem\"\nconst SIDEBAR_WIDTH_ICON = \"3rem\"\nconst SIDEBAR_KEYBOARD_SHORTCUT = \"b\"\n\ntype SidebarContextProps = {\n  state: \"expanded\" | \"collapsed\"\n  open: boolean\n  setOpen: (open: boolean) => void\n  openMobile: boolean\n  setOpenMobile: (open: boolean) => void\n  isMobile: boolean\n  toggleSidebar: () => void\n}\n\nconst SidebarContext = React.createContext<SidebarContextProps | null>(null)\n\nfunction useSidebar() {\n  const context = React.useContext(SidebarContext)\n  if (!context) {\n    throw new Error(\"useSidebar must be used within a SidebarProvider.\")\n  }\n\n  return context\n}\n\nfunction SidebarProvider({\n  defaultOpen = true,\n  open: openProp,\n  onOpenChange: setOpenProp,\n  className,\n  style,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  defaultOpen?: boolean\n  open?: boolean\n  onOpenChange?: (open: boolean) => void\n}) {\n  const isMobile = useIsMobile()\n  const [openMobile, setOpenMobile] = React.useState(false)\n\n  // This is the internal state of the sidebar.\n  // We use openProp and setOpenProp for control from outside the component.\n  const [_open, _setOpen] = React.useState(defaultOpen)\n  const open = openProp ?? _open\n  const setOpen = React.useCallback(\n    (value: boolean | ((value: boolean) => boolean)) => {\n      const openState = typeof value === \"function\" ? value(open) : value\n      if (setOpenProp) {\n        setOpenProp(openState)\n      } else {\n        _setOpen(openState)\n      }\n\n      // This sets the cookie to keep the sidebar state.\n      document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`\n    },\n    [setOpenProp, open]\n  )\n\n  // Helper to toggle the sidebar.\n  const toggleSidebar = React.useCallback(() => {\n    return isMobile ? setOpenMobile((open) => !open) : setOpen((open) => !open)\n  }, [isMobile, setOpen, setOpenMobile])\n\n  // Adds a keyboard shortcut to toggle the sidebar.\n  React.useEffect(() => {\n    const handleKeyDown = (event: KeyboardEvent) => {\n      if (\n        event.key === SIDEBAR_KEYBOARD_SHORTCUT &&\n        (event.metaKey || event.ctrlKey)\n      ) {\n        event.preventDefault()\n        toggleSidebar()\n      }\n    }\n\n    window.addEventListener(\"keydown\", handleKeyDown)\n    return () => window.removeEventListener(\"keydown\", handleKeyDown)\n  }, [toggleSidebar])\n\n  // We add a state so that we can do data-state=\"expanded\" or \"collapsed\".\n  // This makes it easier to style the sidebar with Tailwind classes.\n  const state = open ? \"expanded\" : \"collapsed\"\n\n  const contextValue = React.useMemo<SidebarContextProps>(\n    () => ({\n      state,\n      open,\n      setOpen,\n      isMobile,\n      openMobile,\n      setOpenMobile,\n      toggleSidebar,\n    }),\n    [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar]\n  )\n\n  return (\n    <SidebarContext.Provider value={contextValue}>\n      <TooltipProvider delayDuration={0}>\n        <div\n          data-slot=\"sidebar-wrapper\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH,\n              \"--sidebar-width-icon\": SIDEBAR_WIDTH_ICON,\n              ...style,\n            } as React.CSSProperties\n          }\n          className={cn(\n            \"group/sidebar-wrapper has-data-[variant=inset]:bg-sidebar flex min-h-svh w-full\",\n            className\n          )}\n          {...props}\n        >\n          {children}\n        </div>\n      </TooltipProvider>\n    </SidebarContext.Provider>\n  )\n}\n\nfunction Sidebar({\n  side = \"left\",\n  variant = \"sidebar\",\n  collapsible = \"offcanvas\",\n  className,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  side?: \"left\" | \"right\"\n  variant?: \"sidebar\" | \"floating\" | \"inset\"\n  collapsible?: \"offcanvas\" | \"icon\" | \"none\"\n}) {\n  const { isMobile, state, openMobile, setOpenMobile } = useSidebar()\n\n  if (collapsible === \"none\") {\n    return (\n      <div\n        data-slot=\"sidebar\"\n        className={cn(\n          \"bg-sidebar text-sidebar-foreground flex h-full w-[var(--sidebar-width)] flex-col\",\n          className\n        )}\n        {...props}\n      >\n        {children}\n      </div>\n    )\n  }\n\n  if (isMobile) {\n    return (\n      <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>\n        <SheetContent\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar\"\n          data-mobile=\"true\"\n          className=\"bg-sidebar text-sidebar-foreground w-[var(--sidebar-width)] p-0 [&>button]:hidden\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH_MOBILE,\n            } as React.CSSProperties\n          }\n          side={side}\n        >\n          <SheetHeader className=\"sr-only\">\n            <SheetTitle>Sidebar</SheetTitle>\n            <SheetDescription>Displays the mobile sidebar.</SheetDescription>\n          </SheetHeader>\n          <div className=\"flex h-full w-full flex-col\">{children}</div>\n        </SheetContent>\n      </Sheet>\n    )\n  }\n\n  return (\n    <div\n      className=\"group peer text-sidebar-foreground hidden md:block\"\n      data-state={state}\n      data-collapsible={state === \"collapsed\" ? collapsible : \"\"}\n      data-variant={variant}\n      data-side={side}\n      data-slot=\"sidebar\"\n    >\n      {/* This is what handles the sidebar gap on desktop */}\n      <div\n        data-slot=\"sidebar-gap\"\n        className={cn(\n          \"relative w-[var(--sidebar-width)] bg-transparent transition-[width] duration-200 ease-linear\",\n          \"group-data-[collapsible=offcanvas]:w-0\",\n          \"group-data-[side=right]:rotate-180\",\n          variant === \"floating\" || variant === \"inset\"\n            ? \"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4))]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)]\"\n        )}\n      />\n      <div\n        data-slot=\"sidebar-container\"\n        className={cn(\n          \"fixed inset-y-0 z-10 hidden h-svh w-[var(--sidebar-width)] transition-[left,right,width] duration-200 ease-linear md:flex\",\n          side === \"left\"\n            ? \"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]\"\n            : \"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]\",\n          // Adjust the padding for floating and inset variants.\n          variant === \"floating\" || variant === \"inset\"\n            ? \"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4)+2px)]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)] group-data-[side=left]:border-r group-data-[side=right]:border-l\",\n          className\n        )}\n        {...props}\n      >\n        <div\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar-inner\"\n          className=\"bg-sidebar group-data-[variant=floating]:border-sidebar-border flex h-full w-full flex-col group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:shadow-sm\"\n        >\n          {children}\n        </div>\n      </div>\n    </div>\n  )\n}\n\nfunction SidebarTrigger({\n  className,\n  onClick,\n  ...props\n}: React.ComponentProps<typeof Button>) {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <Button\n      data-sidebar=\"trigger\"\n      data-slot=\"sidebar-trigger\"\n      variant=\"ghost\"\n      size=\"icon\"\n      className={cn(\"h-7 w-7\", className)}\n      onClick={(event) => {\n        onClick?.(event)\n        toggleSidebar()\n      }}\n      {...props}\n    >\n      <PanelLeftIcon />\n      <span className=\"sr-only\">Toggle Sidebar</span>\n    </Button>\n  )\n}\n\nfunction SidebarRail({ className, ...props }: React.ComponentProps<\"button\">) {\n  const { toggleSidebar } = useSidebar()\n\n  // Note: Tailwind v3.4 doesn't support \"in-\" selectors. So the rail won't work perfectly.\n  return (\n    <button\n      data-sidebar=\"rail\"\n      data-slot=\"sidebar-rail\"\n      aria-label=\"Toggle Sidebar\"\n      tabIndex={-1}\n      onClick={toggleSidebar}\n      title=\"Toggle Sidebar\"\n      className={cn(\n        \"hover:after:bg-sidebar-border absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear group-data-[side=left]:-right-4 group-data-[side=right]:left-0 after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] sm:flex\",\n        \"in-data-[side=left]:cursor-w-resize in-data-[side=right]:cursor-e-resize\",\n        \"[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize\",\n        \"hover:group-data-[collapsible=offcanvas]:bg-sidebar group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full\",\n        \"[[data-side=left][data-collapsible=offcanvas]_&]:-right-2\",\n        \"[[data-side=right][data-collapsible=offcanvas]_&]:-left-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInset({ className, ...props }: React.ComponentProps<\"main\">) {\n  return (\n    <main\n      data-slot=\"sidebar-inset\"\n      className={cn(\n        \"bg-background relative flex w-full flex-1 flex-col\",\n        \"md:peer-data-[variant=inset]:m-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow-sm md:peer-data-[variant=inset]:peer-data-[state=collapsed]:ml-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInput({\n  className,\n  ...props\n}: React.ComponentProps<typeof Input>) {\n  return (\n    <Input\n      data-slot=\"sidebar-input\"\n      data-sidebar=\"input\"\n      className={cn(\"bg-background h-8 w-full shadow-none\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarHeader({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-header\"\n      data-sidebar=\"header\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarFooter({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-footer\"\n      data-sidebar=\"footer\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarSeparator({\n  className,\n  ...props\n}: React.ComponentProps<typeof Separator>) {\n  return (\n    <Separator\n      data-slot=\"sidebar-separator\"\n      data-sidebar=\"separator\"\n      className={cn(\"bg-sidebar-border mx-2 w-auto\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarContent({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-content\"\n      data-sidebar=\"content\"\n      className={cn(\n        \"flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroup({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group\"\n      data-sidebar=\"group\"\n      className={cn(\"relative flex w-full min-w-0 flex-col p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupLabel({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"div\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"div\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-label\"\n      data-sidebar=\"group-label\"\n      className={cn(\n        \"text-sidebar-foreground/70 ring-sidebar-ring flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium outline-hidden transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:h-4 [&>svg]:w-4 [&>svg]:shrink-0\",\n        \"group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupAction({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"button\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-action\"\n      data-sidebar=\"group-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground absolute top-3.5 right-3 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupContent({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group-content\"\n      data-sidebar=\"group-content\"\n      className={cn(\"w-full text-sm\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenu({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu\"\n      data-sidebar=\"menu\"\n      className={cn(\"flex w-full min-w-0 flex-col gap-1\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuItem({ className, ...props }: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-item\"\n      data-sidebar=\"menu-item\"\n      className={cn(\"group/menu-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nconst sidebarMenuButtonVariants = cva(\n  \"peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-hidden ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-data-[sidebar=menu-action]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:w-8! group-data-[collapsible=icon]:h-8! group-data-[collapsible=icon]:p-2! [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground\",\n        outline:\n          \"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]\",\n      },\n      size: {\n        default: \"h-8 text-sm\",\n        sm: \"h-7 text-xs\",\n        lg: \"h-12 text-sm group-data-[collapsible=icon]:p-0!\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nfunction SidebarMenuButton({\n  asChild = false,\n  isActive = false,\n  variant = \"default\",\n  size = \"default\",\n  tooltip,\n  className,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  isActive?: boolean\n  tooltip?: string | React.ComponentProps<typeof TooltipContent>\n} & VariantProps<typeof sidebarMenuButtonVariants>) {\n  const Comp = asChild ? Slot : \"button\"\n  const { isMobile, state } = useSidebar()\n\n  const button = (\n    <Comp\n      data-slot=\"sidebar-menu-button\"\n      data-sidebar=\"menu-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(sidebarMenuButtonVariants({ variant, size }), className)}\n      {...props}\n    />\n  )\n\n  if (!tooltip) {\n    return button\n  }\n\n  if (typeof tooltip === \"string\") {\n    tooltip = {\n      children: tooltip,\n    }\n  }\n\n  return (\n    <Tooltip>\n      <TooltipTrigger asChild>{button}</TooltipTrigger>\n      <TooltipContent\n        side=\"right\"\n        align=\"center\"\n        hidden={state !== \"collapsed\" || isMobile}\n        {...tooltip}\n      />\n    </Tooltip>\n  )\n}\n\nfunction SidebarMenuAction({\n  className,\n  asChild = false,\n  showOnHover = false,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  showOnHover?: boolean\n}) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-action\"\n      data-sidebar=\"menu-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground peer-hover/menu-button:text-sidebar-accent-foreground absolute top-1.5 right-1 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        showOnHover &&\n          \"peer-data-[active=true]/menu-button:text-sidebar-accent-foreground group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 md:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuBadge({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-menu-badge\"\n      data-sidebar=\"menu-badge\"\n      className={cn(\n        \"text-sidebar-foreground pointer-events-none absolute right-1 flex h-5 min-w-5 items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums select-none\",\n        \"peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSkeleton({\n  className,\n  showIcon = false,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  showIcon?: boolean\n}) {\n  // Random width between 50 to 90%.\n  const width = React.useMemo(() => {\n    return `${Math.floor(Math.random() * 40) + 50}%`\n  }, [])\n\n  return (\n    <div\n      data-slot=\"sidebar-menu-skeleton\"\n      data-sidebar=\"menu-skeleton\"\n      className={cn(\"flex h-8 items-center gap-2 rounded-md px-2\", className)}\n      {...props}\n    >\n      {showIcon && (\n        <Skeleton\n          className=\"size-4 rounded-md\"\n          data-sidebar=\"menu-skeleton-icon\"\n        />\n      )}\n      <Skeleton\n        className=\"h-4 max-w-[var(--skeleton-width)] flex-1\"\n        data-sidebar=\"menu-skeleton-text\"\n        style={\n          {\n            \"--skeleton-width\": width,\n          } as React.CSSProperties\n        }\n      />\n    </div>\n  )\n}\n\nfunction SidebarMenuSub({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu-sub\"\n      data-sidebar=\"menu-sub\"\n      className={cn(\n        \"border-sidebar-border mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l px-2.5 py-0.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubItem({\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-sub-item\"\n      data-sidebar=\"menu-sub-item\"\n      className={cn(\"group/menu-sub-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubButton({\n  asChild = false,\n  size = \"md\",\n  isActive = false,\n  className,\n  ...props\n}: React.ComponentProps<\"a\"> & {\n  asChild?: boolean\n  size?: \"sm\" | \"md\"\n  isActive?: boolean\n}) {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-sub-button\"\n      data-sidebar=\"menu-sub-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground active:bg-sidebar-accent active:text-sidebar-accent-foreground [&>svg]:text-sidebar-accent-foreground flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 outline outline-2 outline-transparent outline-offset-2 focus-visible:ring-2 disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n        \"data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground\",\n        size === \"sm\" && \"text-xs\",\n        size === \"md\" && \"text-sm\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport {\n  Sidebar,\n  SidebarContent,\n  SidebarFooter,\n  SidebarGroup,\n  SidebarGroupAction,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarHeader,\n  SidebarInput,\n  SidebarInset,\n  SidebarMenu,\n  SidebarMenuAction,\n  SidebarMenuBadge,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarMenuSkeleton,\n  SidebarMenuSub,\n  SidebarMenuSubButton,\n  SidebarMenuSubItem,\n  SidebarProvider,\n  SidebarRail,\n  SidebarSeparator,\n  SidebarTrigger,\n  useSidebar,\n}\n","path":null,"size_bytes":21846,"size_tokens":null},"client/src/hooks/use-toast.ts":{"content":"import * as React from \"react\"\n\nimport type {\n  ToastActionElement,\n  ToastProps,\n} from \"@/components/ui/toast\"\n\nconst TOAST_LIMIT = 1\nconst TOAST_REMOVE_DELAY = 1000000\n\ntype ToasterToast = ToastProps & {\n  id: string\n  title?: React.ReactNode\n  description?: React.ReactNode\n  action?: ToastActionElement\n}\n\nconst actionTypes = {\n  ADD_TOAST: \"ADD_TOAST\",\n  UPDATE_TOAST: \"UPDATE_TOAST\",\n  DISMISS_TOAST: \"DISMISS_TOAST\",\n  REMOVE_TOAST: \"REMOVE_TOAST\",\n} as const\n\nlet count = 0\n\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\n  return count.toString()\n}\n\ntype ActionType = typeof actionTypes\n\ntype Action =\n  | {\n      type: ActionType[\"ADD_TOAST\"]\n      toast: ToasterToast\n    }\n  | {\n      type: ActionType[\"UPDATE_TOAST\"]\n      toast: Partial<ToasterToast>\n    }\n  | {\n      type: ActionType[\"DISMISS_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n  | {\n      type: ActionType[\"REMOVE_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n\ninterface State {\n  toasts: ToasterToast[]\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) {\n    return\n  }\n\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId)\n    dispatch({\n      type: \"REMOVE_TOAST\",\n      toastId: toastId,\n    })\n  }, TOAST_REMOVE_DELAY)\n\n  toastTimeouts.set(toastId, timeout)\n}\n\nexport const reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case \"ADD_TOAST\":\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      }\n\n    case \"UPDATE_TOAST\":\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === action.toast.id ? { ...t, ...action.toast } : t\n        ),\n      }\n\n    case \"DISMISS_TOAST\": {\n      const { toastId } = action\n\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\n      // but I'll keep it here for simplicity\n      if (toastId) {\n        addToRemoveQueue(toastId)\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id)\n        })\n      }\n\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false,\n              }\n            : t\n        ),\n      }\n    }\n    case \"REMOVE_TOAST\":\n      if (action.toastId === undefined) {\n        return {\n          ...state,\n          toasts: [],\n        }\n      }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      }\n  }\n}\n\nconst listeners: Array<(state: State) => void> = []\n\nlet memoryState: State = { toasts: [] }\n\nfunction dispatch(action: Action) {\n  memoryState = reducer(memoryState, action)\n  listeners.forEach((listener) => {\n    listener(memoryState)\n  })\n}\n\ntype Toast = Omit<ToasterToast, \"id\">\n\nfunction toast({ ...props }: Toast) {\n  const id = genId()\n\n  const update = (props: ToasterToast) =>\n    dispatch({\n      type: \"UPDATE_TOAST\",\n      toast: { ...props, id },\n    })\n  const dismiss = () => dispatch({ type: \"DISMISS_TOAST\", toastId: id })\n\n  dispatch({\n    type: \"ADD_TOAST\",\n    toast: {\n      ...props,\n      id,\n      open: true,\n      onOpenChange: (open) => {\n        if (!open) dismiss()\n      },\n    },\n  })\n\n  return {\n    id: id,\n    dismiss,\n    update,\n  }\n}\n\nfunction useToast() {\n  const [state, setState] = React.useState<State>(memoryState)\n\n  React.useEffect(() => {\n    listeners.push(setState)\n    return () => {\n      const index = listeners.indexOf(setState)\n      if (index > -1) {\n        listeners.splice(index, 1)\n      }\n    }\n  }, [state])\n\n  return {\n    ...state,\n    toast,\n    dismiss: (toastId?: string) => dispatch({ type: \"DISMISS_TOAST\", toastId }),\n  }\n}\n\nexport { useToast, toast }\n","path":null,"size_bytes":3895,"size_tokens":null},"client/src/components/ui/card.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"shadcn-card rounded-xl border bg-card border-card-border text-card-foreground shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n));\nCard.displayName = \"Card\"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n));\nCardHeader.displayName = \"CardHeader\"\n\nconst CardTitle = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"text-2xl font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nCardTitle.displayName = \"CardTitle\"\n\nconst CardDescription = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n));\nCardDescription.displayName = \"CardDescription\"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n))\nCardContent.displayName = \"CardContent\"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = \"CardFooter\"\nexport {\n  Card,\n  CardHeader,\n  CardFooter,\n  CardTitle,\n  CardDescription,\n  CardContent,\n}\n","path":null,"size_bytes":1904,"size_tokens":null},"client/src/components/ui/switch.tsx":{"content":"import * as React from \"react\"\nimport * as SwitchPrimitives from \"@radix-ui/react-switch\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Switch = React.forwardRef<\n  React.ElementRef<typeof SwitchPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>\n>(({ className, ...props }, ref) => (\n  <SwitchPrimitives.Root\n    className={cn(\n      \"peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  >\n    <SwitchPrimitives.Thumb\n      className={cn(\n        \"pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0\"\n      )}\n    />\n  </SwitchPrimitives.Root>\n))\nSwitch.displayName = SwitchPrimitives.Root.displayName\n\nexport { Switch }\n","path":null,"size_bytes":1139,"size_tokens":null},"client/src/components/app-sidebar.tsx":{"content":"import { Link, useLocation } from \"wouter\";\nimport {\n  Sidebar,\n  SidebarContent,\n  SidebarGroup,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarMenu,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarHeader,\n  SidebarFooter,\n} from \"@/components/ui/sidebar\";\nimport {\n  LayoutDashboard,\n  Users,\n  UserCheck,\n  Truck,\n  Package,\n  Warehouse,\n  ShoppingCart,\n  Leaf,\n  CreditCard,\n  BarChart3,\n  FileText,\n  Settings,\n  Scale,\n  RotateCcw,\n  ShoppingBag,\n} from \"lucide-react\";\n\nconst navigationItems = [\n  {\n    title: \"Sell\",\n    url: \"/sell\",\n    icon: ShoppingBag,\n  },\n  {\n    title: \"Dashboard\",\n    url: \"/\",\n    icon: LayoutDashboard,\n  },\n  {\n    title: \"Vendors\",\n    url: \"/vendors\",\n    icon: Users,\n  },\n  {\n    title: \"Customers\",\n    url: \"/customers\",\n    icon: UserCheck,\n  },\n  {\n    title: \"Vehicles\",\n    url: \"/vehicles\",\n    icon: Truck,\n  },\n  {\n    title: \"Products\",\n    url: \"/products\",\n    icon: Package,\n  },\n  {\n    title: \"Stock\",\n    url: \"/stock\",\n    icon: Warehouse,\n  },\n];\n\nconst transactionItems = [\n  {\n    title: \"Purchases\",\n    url: \"/purchases\",\n    icon: ShoppingCart,\n  },\n  {\n    title: \"Returns\",\n    url: \"/vendor-returns\",\n    icon: RotateCcw,\n  },\n  {\n    title: \"Weighing\",\n    url: \"/weighing\",\n    icon: Scale,\n  },\n  {\n    title: \"Payments\",\n    url: \"/payments\",\n    icon: CreditCard,\n  },\n];\n\nconst reportItems = [\n  {\n    title: \"Reports\",\n    url: \"/reports\",\n    icon: BarChart3,\n  },\n  {\n    title: \"Print Center\",\n    url: \"/print\",\n    icon: FileText,\n  },\n  {\n    title: \"Settings\",\n    url: \"/settings\",\n    icon: Settings,\n  },\n];\n\nexport function AppSidebar() {\n  const [location] = useLocation();\n\n  return (\n    <Sidebar>\n      <SidebarHeader className=\"p-4 border-b border-sidebar-border\">\n        <div className=\"flex items-center gap-3\">\n          <div className=\"flex h-10 w-10 items-center justify-center rounded-md bg-primary\">\n            <Leaf className=\"h-5 w-5 text-primary-foreground\" />\n          </div>\n          <div>\n            <h1 className=\"text-base font-semibold text-sidebar-foreground\" data-testid=\"text-app-title\">\n              VegWholesale\n            </h1>\n            <p className=\"text-xs text-muted-foreground\">Business Manager</p>\n          </div>\n        </div>\n      </SidebarHeader>\n      <SidebarContent>\n        <SidebarGroup>\n          <SidebarGroupLabel>Management</SidebarGroupLabel>\n          <SidebarGroupContent>\n            <SidebarMenu>\n              {navigationItems.map((item) => (\n                <SidebarMenuItem key={item.title}>\n                  <SidebarMenuButton\n                    asChild\n                    isActive={location === item.url}\n                    data-testid={`link-nav-${item.title.toLowerCase()}`}\n                  >\n                    <Link href={item.url}>\n                      <item.icon className=\"h-4 w-4\" />\n                      <span>{item.title}</span>\n                    </Link>\n                  </SidebarMenuButton>\n                </SidebarMenuItem>\n              ))}\n            </SidebarMenu>\n          </SidebarGroupContent>\n        </SidebarGroup>\n        <SidebarGroup>\n          <SidebarGroupLabel>Transactions</SidebarGroupLabel>\n          <SidebarGroupContent>\n            <SidebarMenu>\n              {transactionItems.map((item) => (\n                <SidebarMenuItem key={item.title}>\n                  <SidebarMenuButton\n                    asChild\n                    isActive={location === item.url}\n                    data-testid={`link-nav-${item.title.toLowerCase()}`}\n                  >\n                    <Link href={item.url}>\n                      <item.icon className=\"h-4 w-4\" />\n                      <span>{item.title}</span>\n                    </Link>\n                  </SidebarMenuButton>\n                </SidebarMenuItem>\n              ))}\n            </SidebarMenu>\n          </SidebarGroupContent>\n        </SidebarGroup>\n        <SidebarGroup>\n          <SidebarGroupLabel>Reports & Settings</SidebarGroupLabel>\n          <SidebarGroupContent>\n            <SidebarMenu>\n              {reportItems.map((item) => (\n                <SidebarMenuItem key={item.title}>\n                  <SidebarMenuButton\n                    asChild\n                    isActive={location === item.url}\n                    data-testid={`link-nav-${item.title.toLowerCase()}`}\n                  >\n                    <Link href={item.url}>\n                      <item.icon className=\"h-4 w-4\" />\n                      <span>{item.title}</span>\n                    </Link>\n                  </SidebarMenuButton>\n                </SidebarMenuItem>\n              ))}\n            </SidebarMenu>\n          </SidebarGroupContent>\n        </SidebarGroup>\n      </SidebarContent>\n      <SidebarFooter className=\"p-4 border-t border-sidebar-border\">\n        <p className=\"text-xs text-muted-foreground text-center\">\n          Version 1.0.0\n        </p>\n      </SidebarFooter>\n    </Sidebar>\n  );\n}\n","path":null,"size_bytes":4963,"size_tokens":null},"client/src/lib/queryClient.ts":{"content":"import { QueryClient, QueryFunction } from \"@tanstack/react-query\";\n\nasync function throwIfResNotOk(res: Response) {\n  if (!res.ok) {\n    const text = (await res.text()) || res.statusText;\n    throw new Error(`${res.status}: ${text}`);\n  }\n}\n\nexport async function apiRequest(\n  method: string,\n  url: string,\n  data?: unknown | undefined,\n): Promise<Response> {\n  const res = await fetch(url, {\n    method,\n    headers: data ? { \"Content-Type\": \"application/json\" } : {},\n    body: data ? JSON.stringify(data) : undefined,\n    credentials: \"include\",\n  });\n\n  await throwIfResNotOk(res);\n  return res;\n}\n\ntype UnauthorizedBehavior = \"returnNull\" | \"throw\";\nexport const getQueryFn: <T>(options: {\n  on401: UnauthorizedBehavior;\n}) => QueryFunction<T> =\n  ({ on401: unauthorizedBehavior }) =>\n  async ({ queryKey }) => {\n    const res = await fetch(queryKey.join(\"/\") as string, {\n      credentials: \"include\",\n    });\n\n    if (unauthorizedBehavior === \"returnNull\" && res.status === 401) {\n      return null;\n    }\n\n    await throwIfResNotOk(res);\n    return await res.json();\n  };\n\nexport const queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      queryFn: getQueryFn({ on401: \"throw\" }),\n      refetchInterval: false,\n      refetchOnWindowFocus: false,\n      staleTime: Infinity,\n      retry: false,\n    },\n    mutations: {\n      retry: false,\n    },\n  },\n});\n","path":null,"size_bytes":1383,"size_tokens":null},"client/src/main.tsx":{"content":"import { createRoot } from \"react-dom/client\";\nimport App from \"./App\";\nimport \"./index.css\";\n\ncreateRoot(document.getElementById(\"root\")!).render(<App />);\n","path":null,"size_bytes":157,"size_tokens":null},"client/src/pages/products.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { Card, CardContent, CardHeader } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from \"@/components/ui/dialog\";\nimport {\n  Form,\n  FormControl,\n  FormField,\n  FormItem,\n  FormLabel,\n  FormMessage,\n} from \"@/components/ui/form\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { Plus, Search, Pencil, Trash2, Package, AlertTriangle } from \"lucide-react\";\nimport { insertProductSchema, type Product, type InsertProduct } from \"@shared/schema\";\nimport { z } from \"zod\";\n\nconst formSchema = insertProductSchema.extend({\n  purchasePrice: z.coerce.number().min(0, \"Price must be positive\"),\n  salePrice: z.coerce.number().min(0, \"Price must be positive\"),\n  currentStock: z.coerce.number().min(0, \"Stock must be positive\"),\n  reorderLevel: z.coerce.number().min(0, \"Reorder level must be positive\").optional(),\n});\n\ntype FormData = z.infer<typeof formSchema>;\n\nconst units = [\"KG\", \"Dozen\", \"Piece\", \"Bundle\", \"Crate\", \"Box\", \"Bag\"];\n\nexport default function Products() {\n  const { toast } = useToast();\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [isDialogOpen, setIsDialogOpen] = useState(false);\n  const [editingProduct, setEditingProduct] = useState<Product | null>(null);\n  const [deleteProduct, setDeleteProduct] = useState<Product | null>(null);\n\n  const { data: products = [], isLoading } = useQuery<Product[]>({\n    queryKey: [\"/api/products\"],\n  });\n\n  const form = useForm<FormData>({\n    resolver: zodResolver(formSchema),\n    defaultValues: {\n      name: \"\",\n      unit: \"KG\",\n      purchasePrice: 0,\n      salePrice: 0,\n      currentStock: 0,\n      reorderLevel: 10,\n    },\n  });\n\n  const createMutation = useMutation({\n    mutationFn: async (data: FormData) => {\n      return apiRequest(\"POST\", \"/api/products\", data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/products\"] });\n      setIsDialogOpen(false);\n      form.reset();\n      toast({ title: \"Product added successfully\" });\n    },\n    onError: () => {\n      toast({ title: \"Failed to add product\", variant: \"destructive\" });\n    },\n  });\n\n  const updateMutation = useMutation({\n    mutationFn: async ({ id, data }: { id: string; data: FormData }) => {\n      return apiRequest(\"PATCH\", `/api/products/${id}`, data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/products\"] });\n      setIsDialogOpen(false);\n      setEditingProduct(null);\n      form.reset();\n      toast({ title: \"Product updated successfully\" });\n    },\n    onError: () => {\n      toast({ title: \"Failed to update product\", variant: \"destructive\" });\n    },\n  });\n\n  const deleteMutation = useMutation({\n    mutationFn: async (id: string) => {\n      return apiRequest(\"DELETE\", `/api/products/${id}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/products\"] });\n      setDeleteProduct(null);\n      toast({ title: \"Product deleted successfully\" });\n    },\n    onError: () => {\n      toast({ title: \"Failed to delete product\", variant: \"destructive\" });\n    },\n  });\n\n  const filteredProducts = products.filter((product) =>\n    product.name.toLowerCase().includes(searchQuery.toLowerCase())\n  );\n\n  const openEditDialog = (product: Product) => {\n    setEditingProduct(product);\n    form.reset({\n      name: product.name,\n      unit: product.unit,\n      purchasePrice: product.purchasePrice,\n      salePrice: product.salePrice,\n      currentStock: product.currentStock,\n      reorderLevel: product.reorderLevel || 10,\n    });\n    setIsDialogOpen(true);\n  };\n\n  const openCreateDialog = () => {\n    setEditingProduct(null);\n    form.reset({\n      name: \"\",\n      unit: \"KG\",\n      purchasePrice: 0,\n      salePrice: 0,\n      currentStock: 0,\n      reorderLevel: 10,\n    });\n    setIsDialogOpen(true);\n  };\n\n  const onSubmit = (data: FormData) => {\n    if (editingProduct) {\n      updateMutation.mutate({ id: editingProduct.id, data });\n    } else {\n      createMutation.mutate(data);\n    }\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"p-6 space-y-6\">\n        <div className=\"flex items-center justify-between gap-4\">\n          <Skeleton className=\"h-8 w-32\" />\n          <Skeleton className=\"h-9 w-32\" />\n        </div>\n        <Card>\n          <CardContent className=\"p-6\">\n            <div className=\"space-y-4\">\n              {[1, 2, 3].map((i) => (\n                <Skeleton key={i} className=\"h-16 w-full\" />\n              ))}\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"flex flex-col h-full overflow-hidden\">\n      <div className=\"p-6 pb-4 flex items-center justify-between gap-4 flex-wrap shrink-0\">\n        <div>\n          <h1 className=\"text-2xl font-semibold\" data-testid=\"text-page-title\">Products</h1>\n          <p className=\"text-sm text-muted-foreground\">\n            Manage your vegetable catalog\n          </p>\n        </div>\n        <Dialog open={isDialogOpen} onOpenChange={setIsDialogOpen}>\n          <DialogTrigger asChild>\n            <Button onClick={openCreateDialog} data-testid=\"button-add-product\">\n              <Plus className=\"h-4 w-4 mr-2\" />\n              Add Product\n            </Button>\n          </DialogTrigger>\n          <DialogContent className=\"max-w-lg\">\n            <DialogHeader>\n              <DialogTitle>\n                {editingProduct ? \"Edit Product\" : \"Add New Product\"}\n              </DialogTitle>\n            </DialogHeader>\n            <Form {...form}>\n              <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  <FormField\n                    control={form.control}\n                    name=\"name\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Name *</FormLabel>\n                        <FormControl>\n                          <Input\n                            placeholder=\"e.g., Tomato\"\n                            {...field}\n                            data-testid=\"input-product-name\"\n                          />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  <FormField\n                    control={form.control}\n                    name=\"unit\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Unit *</FormLabel>\n                        <Select\n                          onValueChange={field.onChange}\n                          defaultValue={field.value}\n                        >\n                          <FormControl>\n                            <SelectTrigger data-testid=\"select-product-unit\">\n                              <SelectValue placeholder=\"Select unit\" />\n                            </SelectTrigger>\n                          </FormControl>\n                          <SelectContent>\n                            {units.map((unit) => (\n                              <SelectItem key={unit} value={unit}>\n                                {unit}\n                              </SelectItem>\n                            ))}\n                          </SelectContent>\n                        </Select>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                </div>\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  <FormField\n                    control={form.control}\n                    name=\"purchasePrice\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Purchase Price *</FormLabel>\n                        <FormControl>\n                          <Input\n                            type=\"number\"\n                            step=\"0.01\"\n                            placeholder=\"0.00\"\n                            {...field}\n                            data-testid=\"input-purchase-price\"\n                          />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  <FormField\n                    control={form.control}\n                    name=\"salePrice\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Sale Price *</FormLabel>\n                        <FormControl>\n                          <Input\n                            type=\"number\"\n                            step=\"0.01\"\n                            placeholder=\"0.00\"\n                            {...field}\n                            data-testid=\"input-sale-price\"\n                          />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                </div>\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  <FormField\n                    control={form.control}\n                    name=\"currentStock\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Current Stock</FormLabel>\n                        <FormControl>\n                          <Input\n                            type=\"number\"\n                            step=\"0.01\"\n                            placeholder=\"0\"\n                            {...field}\n                            data-testid=\"input-current-stock\"\n                          />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  <FormField\n                    control={form.control}\n                    name=\"reorderLevel\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Reorder Level</FormLabel>\n                        <FormControl>\n                          <Input\n                            type=\"number\"\n                            step=\"0.01\"\n                            placeholder=\"10\"\n                            {...field}\n                            data-testid=\"input-reorder-level\"\n                          />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                </div>\n                <div className=\"flex justify-end gap-2\">\n                  <Button\n                    type=\"button\"\n                    variant=\"outline\"\n                    onClick={() => setIsDialogOpen(false)}\n                  >\n                    Cancel\n                  </Button>\n                  <Button\n                    type=\"submit\"\n                    disabled={createMutation.isPending || updateMutation.isPending}\n                    data-testid=\"button-submit-product\"\n                  >\n                    {createMutation.isPending || updateMutation.isPending\n                      ? \"Saving...\"\n                      : editingProduct\n                      ? \"Update\"\n                      : \"Add Product\"}\n                  </Button>\n                </div>\n              </form>\n            </Form>\n          </DialogContent>\n        </Dialog>\n      </div>\n\n      <div className=\"flex-1 overflow-hidden px-6 pb-6\">\n        <Card className=\"flex flex-col h-full\">\n          <CardHeader className=\"shrink-0\">\n            <div className=\"flex items-center gap-4\">\n              <div className=\"relative flex-1 max-w-sm\">\n                <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n                <Input\n                  placeholder=\"Search products...\"\n                  value={searchQuery}\n                  onChange={(e) => setSearchQuery(e.target.value)}\n                  className=\"pl-9\"\n                  data-testid=\"input-search-products\"\n                />\n              </div>\n            </div>\n          </CardHeader>\n          <CardContent className=\"flex-1 overflow-hidden\">\n          {filteredProducts.length === 0 ? (\n            <div className=\"flex flex-col items-center justify-center py-12 text-muted-foreground\">\n              <Package className=\"h-12 w-12 mb-4\" />\n              <p className=\"text-lg font-medium\">No products found</p>\n              <p className=\"text-sm\">\n                {searchQuery\n                  ? \"Try a different search term\"\n                  : \"Add your first product to get started\"}\n              </p>\n              {!searchQuery && (\n                <Button\n                  variant=\"outline\"\n                  className=\"mt-4\"\n                  onClick={openCreateDialog}\n                >\n                  <Plus className=\"h-4 w-4 mr-2\" />\n                  Add Product\n                </Button>\n              )}\n            </div>\n          ) : (\n            <ScrollArea className=\"h-full\">\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead>Product</TableHead>\n                    <TableHead>Unit</TableHead>\n                    <TableHead className=\"text-right\">Purchase Price</TableHead>\n                    <TableHead className=\"text-right\">Sale Price</TableHead>\n                    <TableHead className=\"text-right\">Stock</TableHead>\n                    <TableHead>Status</TableHead>\n                    <TableHead className=\"text-right\">Actions</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {filteredProducts.map((product) => {\n                    const isLowStock = product.currentStock <= (product.reorderLevel || 10);\n                    return (\n                      <TableRow key={product.id} data-testid={`row-product-${product.id}`}>\n                        <TableCell className=\"font-medium\">{product.name}</TableCell>\n                        <TableCell>\n                          <Badge variant=\"secondary\" className=\"text-xs\">\n                            {product.unit}\n                          </Badge>\n                        </TableCell>\n                        <TableCell className=\"text-right font-mono\">\n                          ₹{product.purchasePrice.toFixed(2)}\n                        </TableCell>\n                        <TableCell className=\"text-right font-mono\">\n                          ₹{product.salePrice.toFixed(2)}\n                        </TableCell>\n                        <TableCell className=\"text-right font-mono\">\n                          {product.currentStock.toFixed(2)}\n                        </TableCell>\n                        <TableCell>\n                          {isLowStock ? (\n                            <div className=\"flex items-center gap-1 text-chart-2\">\n                              <AlertTriangle className=\"h-3 w-3\" />\n                              <span className=\"text-xs\">Low</span>\n                            </div>\n                          ) : (\n                            <Badge variant=\"outline\" className=\"text-xs\">\n                              OK\n                            </Badge>\n                          )}\n                        </TableCell>\n                        <TableCell className=\"text-right\">\n                          <div className=\"flex items-center justify-end gap-1\">\n                            <Button\n                              variant=\"ghost\"\n                              size=\"icon\"\n                              onClick={() => openEditDialog(product)}\n                              data-testid={`button-edit-product-${product.id}`}\n                            >\n                              <Pencil className=\"h-4 w-4\" />\n                            </Button>\n                            <Button\n                              variant=\"ghost\"\n                              size=\"icon\"\n                              onClick={() => setDeleteProduct(product)}\n                              data-testid={`button-delete-product-${product.id}`}\n                            >\n                              <Trash2 className=\"h-4 w-4\" />\n                            </Button>\n                          </div>\n                        </TableCell>\n                      </TableRow>\n                    );\n                  })}\n                </TableBody>\n              </Table>\n            </ScrollArea>\n          )}\n          </CardContent>\n        </Card>\n      </div>\n\n      <AlertDialog open={!!deleteProduct} onOpenChange={() => setDeleteProduct(null)}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>Delete Product</AlertDialogTitle>\n            <AlertDialogDescription>\n              Are you sure you want to delete \"{deleteProduct?.name}\"? This action\n              cannot be undone.\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel>Cancel</AlertDialogCancel>\n            <AlertDialogAction\n              onClick={() => deleteProduct && deleteMutation.mutate(deleteProduct.id)}\n              className=\"bg-destructive text-destructive-foreground\"\n            >\n              Delete\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":18535,"size_tokens":null},"client/src/components/ui/slider.tsx":{"content":"import * as React from \"react\"\nimport * as SliderPrimitive from \"@radix-ui/react-slider\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Slider = React.forwardRef<\n  React.ElementRef<typeof SliderPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <SliderPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex w-full touch-none select-none items-center\",\n      className\n    )}\n    {...props}\n  >\n    <SliderPrimitive.Track className=\"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary\">\n      <SliderPrimitive.Range className=\"absolute h-full bg-primary\" />\n    </SliderPrimitive.Track>\n    <SliderPrimitive.Thumb className=\"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50\" />\n  </SliderPrimitive.Root>\n))\nSlider.displayName = SliderPrimitive.Root.displayName\n\nexport { Slider }\n","path":null,"size_bytes":1077,"size_tokens":null},"server/index.ts":{"content":"import express, { type Request, Response, NextFunction } from \"express\";\nimport { registerRoutes } from \"./routes\";\nimport { serveStatic } from \"./static\";\nimport { createServer } from \"http\";\n\nconst app = express();\nconst httpServer = createServer(app);\n\ndeclare module \"http\" {\n  interface IncomingMessage {\n    rawBody: unknown;\n  }\n}\n\napp.use(\n  express.json({\n    verify: (req, _res, buf) => {\n      req.rawBody = buf;\n    },\n  }),\n);\n\napp.use(express.urlencoded({ extended: false }));\n\nexport function log(message: string, source = \"express\") {\n  const formattedTime = new Date().toLocaleTimeString(\"en-US\", {\n    hour: \"numeric\",\n    minute: \"2-digit\",\n    second: \"2-digit\",\n    hour12: true,\n  });\n\n  console.log(`${formattedTime} [${source}] ${message}`);\n}\n\napp.use((req, res, next) => {\n  const start = Date.now();\n  const path = req.path;\n  let capturedJsonResponse: Record<string, any> | undefined = undefined;\n\n  const originalResJson = res.json;\n  res.json = function (bodyJson, ...args) {\n    capturedJsonResponse = bodyJson;\n    return originalResJson.apply(res, [bodyJson, ...args]);\n  };\n\n  res.on(\"finish\", () => {\n    const duration = Date.now() - start;\n    if (path.startsWith(\"/api\")) {\n      let logLine = `${req.method} ${path} ${res.statusCode} in ${duration}ms`;\n      if (capturedJsonResponse) {\n        logLine += ` :: ${JSON.stringify(capturedJsonResponse)}`;\n      }\n\n      log(logLine);\n    }\n  });\n\n  next();\n});\n\n(async () => {\n  await registerRoutes(httpServer, app);\n\n  app.use((err: any, _req: Request, res: Response, _next: NextFunction) => {\n    const status = err.status || err.statusCode || 500;\n    const message = err.message || \"Internal Server Error\";\n\n    res.status(status).json({ message });\n    throw err;\n  });\n\n  // importantly only setup vite in development and after\n  // setting up all the other routes so the catch-all route\n  // doesn't interfere with the other routes\n  if (process.env.NODE_ENV === \"production\") {\n    serveStatic(app);\n  } else {\n    const { setupVite } = await import(\"./vite\");\n    await setupVite(httpServer, app);\n  }\n\n  // ALWAYS serve the app on the port specified in the environment variable PORT\n  // Other ports are firewalled. Default to 5000 if not specified.\n  // this serves both the API and the client.\n  // It is the only port that is not firewalled.\n  const port = parseInt(process.env.PORT || \"5000\", 10);\n  httpServer.listen(\n    {\n      port,\n      host: \"0.0.0.0\",\n      reusePort: true,\n    },\n    () => {\n      log(`serving on port ${port}`);\n    },\n  );\n})();\n","path":null,"size_bytes":2560,"size_tokens":null},"client/src/pages/vendors.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from \"@/components/ui/dialog\";\nimport {\n  Form,\n  FormControl,\n  FormField,\n  FormItem,\n  FormLabel,\n  FormMessage,\n} from \"@/components/ui/form\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { Plus, Search, Pencil, Trash2, Users, Phone, Mail, MapPin } from \"lucide-react\";\nimport { insertVendorSchema, type Vendor, type InsertVendor } from \"@shared/schema\";\n\nexport default function Vendors() {\n  const { toast } = useToast();\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [isDialogOpen, setIsDialogOpen] = useState(false);\n  const [editingVendor, setEditingVendor] = useState<Vendor | null>(null);\n  const [deleteVendor, setDeleteVendor] = useState<Vendor | null>(null);\n\n  const { data: vendors = [], isLoading } = useQuery<Vendor[]>({\n    queryKey: [\"/api/vendors\"],\n  });\n\n  const form = useForm<InsertVendor>({\n    resolver: zodResolver(insertVendorSchema),\n    defaultValues: {\n      name: \"\",\n      phone: \"\",\n      address: \"\",\n      email: \"\",\n    },\n  });\n\n  const createMutation = useMutation({\n    mutationFn: async (data: InsertVendor) => {\n      return apiRequest(\"POST\", \"/api/vendors\", data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/vendors\"] });\n      setIsDialogOpen(false);\n      form.reset();\n      toast({ title: \"Vendor added successfully\" });\n    },\n    onError: () => {\n      toast({ title: \"Failed to add vendor\", variant: \"destructive\" });\n    },\n  });\n\n  const updateMutation = useMutation({\n    mutationFn: async ({ id, data }: { id: string; data: InsertVendor }) => {\n      return apiRequest(\"PATCH\", `/api/vendors/${id}`, data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/vendors\"] });\n      setIsDialogOpen(false);\n      setEditingVendor(null);\n      form.reset();\n      toast({ title: \"Vendor updated successfully\" });\n    },\n    onError: () => {\n      toast({ title: \"Failed to update vendor\", variant: \"destructive\" });\n    },\n  });\n\n  const deleteMutation = useMutation({\n    mutationFn: async (id: string) => {\n      return apiRequest(\"DELETE\", `/api/vendors/${id}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/vendors\"] });\n      setDeleteVendor(null);\n      toast({ title: \"Vendor deleted successfully\" });\n    },\n    onError: () => {\n      toast({ title: \"Failed to delete vendor\", variant: \"destructive\" });\n    },\n  });\n\n  const filteredVendors = vendors.filter(\n    (vendor) =>\n      vendor.name.toLowerCase().includes(searchQuery.toLowerCase()) ||\n      vendor.phone.includes(searchQuery)\n  );\n\n  const openEditDialog = (vendor: Vendor) => {\n    setEditingVendor(vendor);\n    form.reset({\n      name: vendor.name,\n      phone: vendor.phone,\n      address: vendor.address || \"\",\n      email: vendor.email || \"\",\n    });\n    setIsDialogOpen(true);\n  };\n\n  const openCreateDialog = () => {\n    setEditingVendor(null);\n    form.reset({\n      name: \"\",\n      phone: \"\",\n      address: \"\",\n      email: \"\",\n    });\n    setIsDialogOpen(true);\n  };\n\n  const onSubmit = (data: InsertVendor) => {\n    if (editingVendor) {\n      updateMutation.mutate({ id: editingVendor.id, data });\n    } else {\n      createMutation.mutate(data);\n    }\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"p-6 space-y-6\">\n        <div className=\"flex items-center justify-between gap-4\">\n          <Skeleton className=\"h-8 w-32\" />\n          <Skeleton className=\"h-9 w-32\" />\n        </div>\n        <Card>\n          <CardContent className=\"p-6\">\n            <div className=\"space-y-4\">\n              {[1, 2, 3].map((i) => (\n                <Skeleton key={i} className=\"h-16 w-full\" />\n              ))}\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"p-6 space-y-6\">\n      <div className=\"flex items-center justify-between gap-4 flex-wrap\">\n        <div>\n          <h1 className=\"text-2xl font-semibold\" data-testid=\"text-page-title\">Vendors</h1>\n          <p className=\"text-sm text-muted-foreground\">\n            Manage your suppliers and farmers\n          </p>\n        </div>\n        <Dialog open={isDialogOpen} onOpenChange={setIsDialogOpen}>\n          <DialogTrigger asChild>\n            <Button onClick={openCreateDialog} data-testid=\"button-add-vendor\">\n              <Plus className=\"h-4 w-4 mr-2\" />\n              Add Vendor\n            </Button>\n          </DialogTrigger>\n          <DialogContent>\n            <DialogHeader>\n              <DialogTitle>\n                {editingVendor ? \"Edit Vendor\" : \"Add New Vendor\"}\n              </DialogTitle>\n            </DialogHeader>\n            <Form {...form}>\n              <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  <FormField\n                    control={form.control}\n                    name=\"name\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Name *</FormLabel>\n                        <FormControl>\n                          <Input\n                            placeholder=\"Vendor name\"\n                            {...field}\n                            data-testid=\"input-vendor-name\"\n                          />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  <FormField\n                    control={form.control}\n                    name=\"phone\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Phone *</FormLabel>\n                        <FormControl>\n                          <Input\n                            placeholder=\"Phone number\"\n                            {...field}\n                            data-testid=\"input-vendor-phone\"\n                          />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                </div>\n                <FormField\n                  control={form.control}\n                  name=\"email\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Email</FormLabel>\n                      <FormControl>\n                        <Input\n                          placeholder=\"Email address\"\n                          type=\"email\"\n                          {...field}\n                          value={field.value || \"\"}\n                          data-testid=\"input-vendor-email\"\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                <FormField\n                  control={form.control}\n                  name=\"address\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Address</FormLabel>\n                      <FormControl>\n                        <Input\n                          placeholder=\"Full address\"\n                          {...field}\n                          value={field.value || \"\"}\n                          data-testid=\"input-vendor-address\"\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                <div className=\"flex justify-end gap-2\">\n                  <Button\n                    type=\"button\"\n                    variant=\"outline\"\n                    onClick={() => setIsDialogOpen(false)}\n                  >\n                    Cancel\n                  </Button>\n                  <Button\n                    type=\"submit\"\n                    disabled={createMutation.isPending || updateMutation.isPending}\n                    data-testid=\"button-submit-vendor\"\n                  >\n                    {createMutation.isPending || updateMutation.isPending\n                      ? \"Saving...\"\n                      : editingVendor\n                      ? \"Update\"\n                      : \"Add Vendor\"}\n                  </Button>\n                </div>\n              </form>\n            </Form>\n          </DialogContent>\n        </Dialog>\n      </div>\n\n      <Card>\n        <CardHeader>\n          <div className=\"flex items-center gap-4\">\n            <div className=\"relative flex-1 max-w-sm\">\n              <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n              <Input\n                placeholder=\"Search vendors...\"\n                value={searchQuery}\n                onChange={(e) => setSearchQuery(e.target.value)}\n                className=\"pl-9\"\n                data-testid=\"input-search-vendors\"\n              />\n            </div>\n          </div>\n        </CardHeader>\n        <CardContent>\n          {filteredVendors.length === 0 ? (\n            <div className=\"flex flex-col items-center justify-center py-12 text-muted-foreground\">\n              <Users className=\"h-12 w-12 mb-4\" />\n              <p className=\"text-lg font-medium\">No vendors found</p>\n              <p className=\"text-sm\">\n                {searchQuery\n                  ? \"Try a different search term\"\n                  : \"Add your first vendor to get started\"}\n              </p>\n              {!searchQuery && (\n                <Button\n                  variant=\"outline\"\n                  className=\"mt-4\"\n                  onClick={openCreateDialog}\n                >\n                  <Plus className=\"h-4 w-4 mr-2\" />\n                  Add Vendor\n                </Button>\n              )}\n            </div>\n          ) : (\n            <Table>\n              <TableHeader>\n                <TableRow>\n                  <TableHead>Name</TableHead>\n                  <TableHead>Phone</TableHead>\n                  <TableHead>Email</TableHead>\n                  <TableHead>Address</TableHead>\n                  <TableHead className=\"text-right\">Actions</TableHead>\n                </TableRow>\n              </TableHeader>\n              <TableBody>\n                {filteredVendors.map((vendor) => (\n                  <TableRow key={vendor.id} data-testid={`row-vendor-${vendor.id}`}>\n                    <TableCell className=\"font-medium\">{vendor.name}</TableCell>\n                    <TableCell>\n                      <div className=\"flex items-center gap-2\">\n                        <Phone className=\"h-3 w-3 text-muted-foreground\" />\n                        {vendor.phone}\n                      </div>\n                    </TableCell>\n                    <TableCell>\n                      {vendor.email ? (\n                        <div className=\"flex items-center gap-2\">\n                          <Mail className=\"h-3 w-3 text-muted-foreground\" />\n                          {vendor.email}\n                        </div>\n                      ) : (\n                        <span className=\"text-muted-foreground\">-</span>\n                      )}\n                    </TableCell>\n                    <TableCell>\n                      {vendor.address ? (\n                        <div className=\"flex items-center gap-2\">\n                          <MapPin className=\"h-3 w-3 text-muted-foreground\" />\n                          <span className=\"truncate max-w-[200px]\">\n                            {vendor.address}\n                          </span>\n                        </div>\n                      ) : (\n                        <span className=\"text-muted-foreground\">-</span>\n                      )}\n                    </TableCell>\n                    <TableCell className=\"text-right\">\n                      <div className=\"flex items-center justify-end gap-1\">\n                        <Button\n                          variant=\"ghost\"\n                          size=\"icon\"\n                          onClick={() => openEditDialog(vendor)}\n                          data-testid={`button-edit-vendor-${vendor.id}`}\n                        >\n                          <Pencil className=\"h-4 w-4\" />\n                        </Button>\n                        <Button\n                          variant=\"ghost\"\n                          size=\"icon\"\n                          onClick={() => setDeleteVendor(vendor)}\n                          data-testid={`button-delete-vendor-${vendor.id}`}\n                        >\n                          <Trash2 className=\"h-4 w-4\" />\n                        </Button>\n                      </div>\n                    </TableCell>\n                  </TableRow>\n                ))}\n              </TableBody>\n            </Table>\n          )}\n        </CardContent>\n      </Card>\n\n      <AlertDialog open={!!deleteVendor} onOpenChange={() => setDeleteVendor(null)}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>Delete Vendor</AlertDialogTitle>\n            <AlertDialogDescription>\n              Are you sure you want to delete \"{deleteVendor?.name}\"? This action\n              cannot be undone.\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel>Cancel</AlertDialogCancel>\n            <AlertDialogAction\n              onClick={() => deleteVendor && deleteMutation.mutate(deleteVendor.id)}\n              className=\"bg-destructive text-destructive-foreground\"\n            >\n              Delete\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":14577,"size_tokens":null},"client/src/components/ui/toggle-group.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ToggleGroupPrimitive from \"@radix-ui/react-toggle-group\"\nimport { type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { toggleVariants } from \"@/components/ui/toggle\"\n\nconst ToggleGroupContext = React.createContext<\n  VariantProps<typeof toggleVariants>\n>({\n  size: \"default\",\n  variant: \"default\",\n})\n\nconst ToggleGroup = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, children, ...props }, ref) => (\n  <ToggleGroupPrimitive.Root\n    ref={ref}\n    className={cn(\"flex items-center justify-center gap-1\", className)}\n    {...props}\n  >\n    <ToggleGroupContext.Provider value={{ variant, size }}>\n      {children}\n    </ToggleGroupContext.Provider>\n  </ToggleGroupPrimitive.Root>\n))\n\nToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName\n\nconst ToggleGroupItem = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &\n    VariantProps<typeof toggleVariants>\n>(({ className, children, variant, size, ...props }, ref) => {\n  const context = React.useContext(ToggleGroupContext)\n\n  return (\n    <ToggleGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        toggleVariants({\n          variant: context.variant || variant,\n          size: context.size || size,\n        }),\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </ToggleGroupPrimitive.Item>\n  )\n})\n\nToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName\n\nexport { ToggleGroup, ToggleGroupItem }\n","path":null,"size_bytes":1753,"size_tokens":null},"client/src/components/ui/carousel.tsx":{"content":"import * as React from \"react\"\nimport useEmblaCarousel, {\n  type UseEmblaCarouselType,\n} from \"embla-carousel-react\"\nimport { ArrowLeft, ArrowRight } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\n\ntype CarouselApi = UseEmblaCarouselType[1]\ntype UseCarouselParameters = Parameters<typeof useEmblaCarousel>\ntype CarouselOptions = UseCarouselParameters[0]\ntype CarouselPlugin = UseCarouselParameters[1]\n\ntype CarouselProps = {\n  opts?: CarouselOptions\n  plugins?: CarouselPlugin\n  orientation?: \"horizontal\" | \"vertical\"\n  setApi?: (api: CarouselApi) => void\n}\n\ntype CarouselContextProps = {\n  carouselRef: ReturnType<typeof useEmblaCarousel>[0]\n  api: ReturnType<typeof useEmblaCarousel>[1]\n  scrollPrev: () => void\n  scrollNext: () => void\n  canScrollPrev: boolean\n  canScrollNext: boolean\n} & CarouselProps\n\nconst CarouselContext = React.createContext<CarouselContextProps | null>(null)\n\nfunction useCarousel() {\n  const context = React.useContext(CarouselContext)\n\n  if (!context) {\n    throw new Error(\"useCarousel must be used within a <Carousel />\")\n  }\n\n  return context\n}\n\nconst Carousel = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & CarouselProps\n>(\n  (\n    {\n      orientation = \"horizontal\",\n      opts,\n      setApi,\n      plugins,\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const [carouselRef, api] = useEmblaCarousel(\n      {\n        ...opts,\n        axis: orientation === \"horizontal\" ? \"x\" : \"y\",\n      },\n      plugins\n    )\n    const [canScrollPrev, setCanScrollPrev] = React.useState(false)\n    const [canScrollNext, setCanScrollNext] = React.useState(false)\n\n    const onSelect = React.useCallback((api: CarouselApi) => {\n      if (!api) {\n        return\n      }\n\n      setCanScrollPrev(api.canScrollPrev())\n      setCanScrollNext(api.canScrollNext())\n    }, [])\n\n    const scrollPrev = React.useCallback(() => {\n      api?.scrollPrev()\n    }, [api])\n\n    const scrollNext = React.useCallback(() => {\n      api?.scrollNext()\n    }, [api])\n\n    const handleKeyDown = React.useCallback(\n      (event: React.KeyboardEvent<HTMLDivElement>) => {\n        if (event.key === \"ArrowLeft\") {\n          event.preventDefault()\n          scrollPrev()\n        } else if (event.key === \"ArrowRight\") {\n          event.preventDefault()\n          scrollNext()\n        }\n      },\n      [scrollPrev, scrollNext]\n    )\n\n    React.useEffect(() => {\n      if (!api || !setApi) {\n        return\n      }\n\n      setApi(api)\n    }, [api, setApi])\n\n    React.useEffect(() => {\n      if (!api) {\n        return\n      }\n\n      onSelect(api)\n      api.on(\"reInit\", onSelect)\n      api.on(\"select\", onSelect)\n\n      return () => {\n        api?.off(\"select\", onSelect)\n      }\n    }, [api, onSelect])\n\n    return (\n      <CarouselContext.Provider\n        value={{\n          carouselRef,\n          api: api,\n          opts,\n          orientation:\n            orientation || (opts?.axis === \"y\" ? \"vertical\" : \"horizontal\"),\n          scrollPrev,\n          scrollNext,\n          canScrollPrev,\n          canScrollNext,\n        }}\n      >\n        <div\n          ref={ref}\n          onKeyDownCapture={handleKeyDown}\n          className={cn(\"relative\", className)}\n          role=\"region\"\n          aria-roledescription=\"carousel\"\n          {...props}\n        >\n          {children}\n        </div>\n      </CarouselContext.Provider>\n    )\n  }\n)\nCarousel.displayName = \"Carousel\"\n\nconst CarouselContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { carouselRef, orientation } = useCarousel()\n\n  return (\n    <div ref={carouselRef} className=\"overflow-hidden\">\n      <div\n        ref={ref}\n        className={cn(\n          \"flex\",\n          orientation === \"horizontal\" ? \"-ml-4\" : \"-mt-4 flex-col\",\n          className\n        )}\n        {...props}\n      />\n    </div>\n  )\n})\nCarouselContent.displayName = \"CarouselContent\"\n\nconst CarouselItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { orientation } = useCarousel()\n\n  return (\n    <div\n      ref={ref}\n      role=\"group\"\n      aria-roledescription=\"slide\"\n      className={cn(\n        \"min-w-0 shrink-0 grow-0 basis-full\",\n        orientation === \"horizontal\" ? \"pl-4\" : \"pt-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nCarouselItem.displayName = \"CarouselItem\"\n\nconst CarouselPrevious = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollPrev, canScrollPrev } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute  h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-left-12 top-1/2 -translate-y-1/2\"\n          : \"-top-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollPrev}\n      onClick={scrollPrev}\n      {...props}\n    >\n      <ArrowLeft className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Previous slide</span>\n    </Button>\n  )\n})\nCarouselPrevious.displayName = \"CarouselPrevious\"\n\nconst CarouselNext = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollNext, canScrollNext } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-right-12 top-1/2 -translate-y-1/2\"\n          : \"-bottom-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollNext}\n      onClick={scrollNext}\n      {...props}\n    >\n      <ArrowRight className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Next slide</span>\n    </Button>\n  )\n})\nCarouselNext.displayName = \"CarouselNext\"\n\nexport {\n  type CarouselApi,\n  Carousel,\n  CarouselContent,\n  CarouselItem,\n  CarouselPrevious,\n  CarouselNext,\n}\n","path":null,"size_bytes":6210,"size_tokens":null},"script/build.ts":{"content":"import { build as esbuild } from \"esbuild\";\nimport { build as viteBuild } from \"vite\";\nimport { rm, readFile } from \"fs/promises\";\n\n// server deps to bundle to reduce openat(2) syscalls\n// which helps cold start times\nconst allowlist = [\n  \"@google/generative-ai\",\n  \"axios\",\n  \"connect-pg-simple\",\n  \"cors\",\n  \"date-fns\",\n  \"drizzle-orm\",\n  \"drizzle-zod\",\n  \"express\",\n  \"express-rate-limit\",\n  \"express-session\",\n  \"jsonwebtoken\",\n  \"memorystore\",\n  \"multer\",\n  \"nanoid\",\n  \"nodemailer\",\n  \"openai\",\n  \"passport\",\n  \"passport-local\",\n  \"pg\",\n  \"stripe\",\n  \"uuid\",\n  \"ws\",\n  \"xlsx\",\n  \"zod\",\n  \"zod-validation-error\",\n];\n\nasync function buildAll() {\n  await rm(\"dist\", { recursive: true, force: true });\n\n  console.log(\"building client...\");\n  await viteBuild();\n\n  console.log(\"building server...\");\n  const pkg = JSON.parse(await readFile(\"package.json\", \"utf-8\"));\n  const allDeps = [\n    ...Object.keys(pkg.dependencies || {}),\n    ...Object.keys(pkg.devDependencies || {}),\n  ];\n  const externals = allDeps.filter((dep) => !allowlist.includes(dep));\n\n  await esbuild({\n    entryPoints: [\"server/index.ts\"],\n    platform: \"node\",\n    bundle: true,\n    format: \"cjs\",\n    outfile: \"dist/index.cjs\",\n    define: {\n      \"process.env.NODE_ENV\": '\"production\"',\n    },\n    minify: true,\n    external: externals,\n    logLevel: \"info\",\n  });\n}\n\nbuildAll().catch((err) => {\n  console.error(err);\n  process.exit(1);\n});\n","path":null,"size_bytes":1417,"size_tokens":null},"client/src/pages/stock.tsx":{"content":"import { useMemo } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport {\n  Truck,\n  Package,\n  Scale,\n  ShoppingBag,\n  TrendingUp,\n  TrendingDown,\n  ArrowRight,\n} from \"lucide-react\";\nimport type { Product, Vehicle, Invoice } from \"@shared/schema\";\n\ntype VehicleInventory = {\n  vehicleId: string;\n  productId: string;\n  quantity: number;\n};\n\ntype VehicleInventoryMovement = {\n  id: string;\n  vehicleId: string;\n  productId: string;\n  type: string;\n  quantity: number;\n  date: string;\n  notes?: string;\n};\n\nfunction formatCurrency(amount: number): string {\n  return amount.toLocaleString(\"en-IN\", { style: \"currency\", currency: \"INR\" });\n}\n\nexport default function Stock() {\n  const { data: products = [], isLoading: productsLoading } = useQuery<Product[]>({\n    queryKey: [\"/api/products\"],\n  });\n\n  const { data: vehicles = [], isLoading: vehiclesLoading } = useQuery<Vehicle[]>({\n    queryKey: [\"/api/vehicles\"],\n  });\n\n  const { data: allInventories = [] } = useQuery<VehicleInventory[]>({\n    queryKey: [\"/api/all-vehicle-inventories\"],\n  });\n\n  const { data: movements = [] } = useQuery<VehicleInventoryMovement[]>({\n    queryKey: [\"/api/vehicle-inventory-movements\"],\n  });\n\n  const { data: invoices = [] } = useQuery<Invoice[]>({\n    queryKey: [\"/api/invoices\"],\n  });\n\n  const getProductName = (id: string) => products.find((p) => p.id === id)?.name || \"Unknown\";\n  const getProductUnit = (id: string) => products.find((p) => p.id === id)?.unit || \"KG\";\n  const getVehicleNumber = (id: string) => vehicles.find((v) => v.id === id)?.number || \"Unknown\";\n\n  const productSummary = useMemo(() => {\n    const summary = new Map<string, {\n      productId: string;\n      loaded: number;\n      sold: number;\n      remaining: number;\n    }>();\n\n    allInventories.forEach((inv) => {\n      const existing = summary.get(inv.productId) || {\n        productId: inv.productId,\n        loaded: 0,\n        sold: 0,\n        remaining: 0,\n      };\n      existing.remaining += inv.quantity;\n      summary.set(inv.productId, existing);\n    });\n\n    movements.forEach((mov) => {\n      const existing = summary.get(mov.productId) || {\n        productId: mov.productId,\n        loaded: 0,\n        sold: 0,\n        remaining: 0,\n      };\n      if (mov.type === \"load\") {\n        existing.loaded += mov.quantity;\n      } else if (mov.type === \"sale\") {\n        existing.sold += mov.quantity;\n      }\n      summary.set(mov.productId, existing);\n    });\n\n    return Array.from(summary.values()).filter(s => s.loaded > 0 || s.remaining > 0);\n  }, [allInventories, movements]);\n\n  const vehicleSummary = useMemo(() => {\n    const summary = new Map<string, {\n      vehicleId: string;\n      productCount: number;\n      totalQuantity: number;\n      totalLoaded: number;\n      totalSold: number;\n    }>();\n\n    allInventories.forEach((inv) => {\n      const existing = summary.get(inv.vehicleId) || {\n        vehicleId: inv.vehicleId,\n        productCount: 0,\n        totalQuantity: 0,\n        totalLoaded: 0,\n        totalSold: 0,\n      };\n      if (inv.quantity > 0) {\n        existing.productCount += 1;\n        existing.totalQuantity += inv.quantity;\n      }\n      summary.set(inv.vehicleId, existing);\n    });\n\n    movements.forEach((mov) => {\n      const existing = summary.get(mov.vehicleId);\n      if (existing) {\n        if (mov.type === \"load\") {\n          existing.totalLoaded += mov.quantity;\n        } else if (mov.type === \"sale\") {\n          existing.totalSold += mov.quantity;\n        }\n      }\n    });\n\n    return Array.from(summary.values()).filter(v => v.totalQuantity > 0 || v.totalLoaded > 0);\n  }, [allInventories, movements]);\n\n  const recentMovements = useMemo(() => {\n    return [...movements]\n      .sort((a, b) => b.date.localeCompare(a.date))\n      .slice(0, 15);\n  }, [movements]);\n\n  const totals = useMemo(() => {\n    const totalLoaded = productSummary.reduce((sum, p) => sum + p.loaded, 0);\n    const totalSold = productSummary.reduce((sum, p) => sum + p.sold, 0);\n    const totalRemaining = productSummary.reduce((sum, p) => sum + p.remaining, 0);\n    const todaysSales = invoices\n      .filter(inv => inv.date === new Date().toISOString().split(\"T\")[0])\n      .reduce((sum, inv) => sum + (inv.grandTotal || 0), 0);\n\n    return { totalLoaded, totalSold, totalRemaining, todaysSales };\n  }, [productSummary, invoices]);\n\n  if (productsLoading || vehiclesLoading) {\n    return (\n      <div className=\"p-6 space-y-6\">\n        <Skeleton className=\"h-8 w-48\" />\n        <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n          {[1, 2, 3, 4].map((i) => (\n            <Skeleton key={i} className=\"h-32\" />\n          ))}\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"p-6 space-y-6\">\n      <div className=\"flex items-center justify-between gap-4 flex-wrap\">\n        <div>\n          <h1 className=\"text-2xl font-semibold\" data-testid=\"text-page-title\">Stock Tracking</h1>\n          <p className=\"text-sm text-muted-foreground\">\n            Track products loaded onto vehicles and sales\n          </p>\n        </div>\n      </div>\n\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between gap-2 pb-2\">\n            <CardTitle className=\"text-sm font-medium text-muted-foreground\">\n              Total Loaded\n            </CardTitle>\n            <TrendingUp className=\"h-4 w-4 text-primary\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold font-mono\" data-testid=\"text-total-loaded\">\n              {totals.totalLoaded.toFixed(2)} KG\n            </div>\n            <p className=\"text-xs text-muted-foreground\">Products loaded to vehicles</p>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between gap-2 pb-2\">\n            <CardTitle className=\"text-sm font-medium text-muted-foreground\">\n              Total Sold\n            </CardTitle>\n            <ShoppingBag className=\"h-4 w-4 text-muted-foreground\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold font-mono\" data-testid=\"text-total-sold\">\n              {totals.totalSold.toFixed(2)} KG\n            </div>\n            <p className=\"text-xs text-muted-foreground\">Products sold from vehicles</p>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between gap-2 pb-2\">\n            <CardTitle className=\"text-sm font-medium text-muted-foreground\">\n              Remaining Stock\n            </CardTitle>\n            <Package className=\"h-4 w-4 text-muted-foreground\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold font-mono\" data-testid=\"text-total-remaining\">\n              {totals.totalRemaining.toFixed(2)} KG\n            </div>\n            <p className=\"text-xs text-muted-foreground\">On vehicles, ready to sell</p>\n          </CardContent>\n        </Card>\n\n        <Card className=\"border-primary/30 bg-primary/5\">\n          <CardHeader className=\"flex flex-row items-center justify-between gap-2 pb-2\">\n            <CardTitle className=\"text-sm font-medium text-primary\">\n              Today's Sales\n            </CardTitle>\n            <Scale className=\"h-4 w-4 text-primary\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold font-mono text-primary\" data-testid=\"text-todays-sales\">\n              {formatCurrency(totals.todaysSales)}\n            </div>\n            <p className=\"text-xs text-muted-foreground\">From all vehicles</p>\n          </CardContent>\n        </Card>\n      </div>\n\n      <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\n        <Card className=\"lg:col-span-2\">\n          <CardHeader>\n            <CardTitle className=\"text-lg flex items-center gap-2\">\n              <Package className=\"h-5 w-5\" />\n              Product Summary\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            {productSummary.length === 0 ? (\n              <div className=\"text-center py-8 text-muted-foreground\">\n                <Package className=\"h-12 w-12 mx-auto mb-2 opacity-50\" />\n                <p>No products loaded yet</p>\n                <p className=\"text-sm\">Go to Sell tab to add vehicles with products</p>\n              </div>\n            ) : (\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead>Product</TableHead>\n                    <TableHead>Unit</TableHead>\n                    <TableHead className=\"text-right\">Loaded</TableHead>\n                    <TableHead className=\"text-right\">Sold</TableHead>\n                    <TableHead className=\"text-right\">Remaining</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {productSummary.map((item) => (\n                    <TableRow key={item.productId} data-testid={`row-product-${item.productId}`}>\n                      <TableCell className=\"font-medium\">\n                        {getProductName(item.productId)}\n                      </TableCell>\n                      <TableCell>\n                        <Badge variant=\"secondary\">{getProductUnit(item.productId)}</Badge>\n                      </TableCell>\n                      <TableCell className=\"text-right font-mono text-muted-foreground\">\n                        {item.loaded.toFixed(2)}\n                      </TableCell>\n                      <TableCell className=\"text-right font-mono text-muted-foreground\">\n                        {item.sold.toFixed(2)}\n                      </TableCell>\n                      <TableCell className=\"text-right font-mono font-semibold\">\n                        {item.remaining.toFixed(2)}\n                      </TableCell>\n                    </TableRow>\n                  ))}\n                  <TableRow className=\"bg-muted/50 font-semibold\">\n                    <TableCell colSpan={2}>TOTAL</TableCell>\n                    <TableCell className=\"text-right font-mono\">\n                      {totals.totalLoaded.toFixed(2)}\n                    </TableCell>\n                    <TableCell className=\"text-right font-mono\">\n                      {totals.totalSold.toFixed(2)}\n                    </TableCell>\n                    <TableCell className=\"text-right font-mono text-primary\">\n                      {totals.totalRemaining.toFixed(2)}\n                    </TableCell>\n                  </TableRow>\n                </TableBody>\n              </Table>\n            )}\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"text-lg flex items-center gap-2\">\n              <Truck className=\"h-5 w-5\" />\n              Vehicle Stock\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            {vehicleSummary.length === 0 ? (\n              <div className=\"text-center py-8 text-muted-foreground\">\n                <Truck className=\"h-12 w-12 mx-auto mb-2 opacity-50\" />\n                <p>No vehicles with stock</p>\n              </div>\n            ) : (\n              <div className=\"space-y-3\">\n                {vehicleSummary.map((v) => (\n                  <div\n                    key={v.vehicleId}\n                    className=\"flex items-center justify-between p-3 rounded-md bg-muted/50\"\n                    data-testid={`vehicle-stock-${v.vehicleId}`}\n                  >\n                    <div className=\"flex items-center gap-2\">\n                      <Truck className=\"h-4 w-4 text-muted-foreground\" />\n                      <div>\n                        <p className=\"font-medium text-sm\">{getVehicleNumber(v.vehicleId)}</p>\n                        <p className=\"text-xs text-muted-foreground\">{v.productCount} products</p>\n                      </div>\n                    </div>\n                    <div className=\"text-right\">\n                      <p className=\"font-mono font-semibold\">{v.totalQuantity.toFixed(2)} KG</p>\n                      <div className=\"flex items-center gap-1 text-xs text-muted-foreground\">\n                        <span className=\"text-primary\">{v.totalLoaded.toFixed(0)}</span>\n                        <ArrowRight className=\"h-3 w-3\" />\n                        <span className=\"text-destructive\">{v.totalSold.toFixed(0)}</span>\n                      </div>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            )}\n          </CardContent>\n        </Card>\n      </div>\n\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"text-lg flex items-center gap-2\">\n            <TrendingDown className=\"h-5 w-5\" />\n            Recent Activity\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          {recentMovements.length === 0 ? (\n            <div className=\"text-center py-8 text-muted-foreground\">\n              <TrendingUp className=\"h-12 w-12 mx-auto mb-2 opacity-50\" />\n              <p>No activity yet</p>\n              <p className=\"text-sm\">Load products onto vehicles and create sales to see activity</p>\n            </div>\n          ) : (\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3\">\n              {recentMovements.map((mov) => (\n                <div\n                  key={mov.id}\n                  className=\"flex items-center justify-between p-3 rounded-md bg-muted/50\"\n                  data-testid={`movement-${mov.id}`}\n                >\n                  <div className=\"flex items-center gap-2\">\n                    {mov.type === \"load\" ? (\n                      <TrendingUp className=\"h-4 w-4 text-primary\" />\n                    ) : (\n                      <TrendingDown className=\"h-4 w-4 text-destructive\" />\n                    )}\n                    <div>\n                      <p className=\"text-sm font-medium\">{getProductName(mov.productId)}</p>\n                      <p className=\"text-xs text-muted-foreground\">\n                        {getVehicleNumber(mov.vehicleId)} - {mov.type === \"load\" ? \"Loaded\" : \"Sold\"}\n                      </p>\n                    </div>\n                  </div>\n                  <div className=\"text-right\">\n                    <p className={`font-mono text-sm ${mov.type === \"load\" ? \"text-primary\" : \"text-destructive\"}`}>\n                      {mov.type === \"load\" ? \"+\" : \"-\"}{mov.quantity.toFixed(2)}\n                    </p>\n                    <p className=\"text-xs text-muted-foreground\">{mov.date}</p>\n                  </div>\n                </div>\n              ))}\n            </div>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":15060,"size_tokens":null},"client/src/components/ui/context-menu.tsx":{"content":"import * as React from \"react\"\nimport * as ContextMenuPrimitive from \"@radix-ui/react-context-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ContextMenu = ContextMenuPrimitive.Root\n\nconst ContextMenuTrigger = ContextMenuPrimitive.Trigger\n\nconst ContextMenuGroup = ContextMenuPrimitive.Group\n\nconst ContextMenuPortal = ContextMenuPrimitive.Portal\n\nconst ContextMenuSub = ContextMenuPrimitive.Sub\n\nconst ContextMenuRadioGroup = ContextMenuPrimitive.RadioGroup\n\nconst ContextMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <ContextMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </ContextMenuPrimitive.SubTrigger>\n))\nContextMenuSubTrigger.displayName = ContextMenuPrimitive.SubTrigger.displayName\n\nconst ContextMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuSubContent.displayName = ContextMenuPrimitive.SubContent.displayName\n\nconst ContextMenuContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Portal>\n    <ContextMenuPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"z-50 max-h-[--radix-context-menu-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in fade-in-80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </ContextMenuPrimitive.Portal>\n))\nContextMenuContent.displayName = ContextMenuPrimitive.Content.displayName\n\nconst ContextMenuItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuItem.displayName = ContextMenuPrimitive.Item.displayName\n\nconst ContextMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <ContextMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.CheckboxItem>\n))\nContextMenuCheckboxItem.displayName =\n  ContextMenuPrimitive.CheckboxItem.displayName\n\nconst ContextMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <ContextMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.RadioItem>\n))\nContextMenuRadioItem.displayName = ContextMenuPrimitive.RadioItem.displayName\n\nconst ContextMenuLabel = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold text-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuLabel.displayName = ContextMenuPrimitive.Label.displayName\n\nconst ContextMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nContextMenuSeparator.displayName = ContextMenuPrimitive.Separator.displayName\n\nconst ContextMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nContextMenuShortcut.displayName = \"ContextMenuShortcut\"\n\nexport {\n  ContextMenu,\n  ContextMenuTrigger,\n  ContextMenuContent,\n  ContextMenuItem,\n  ContextMenuCheckboxItem,\n  ContextMenuRadioItem,\n  ContextMenuLabel,\n  ContextMenuSeparator,\n  ContextMenuShortcut,\n  ContextMenuGroup,\n  ContextMenuPortal,\n  ContextMenuSub,\n  ContextMenuSubContent,\n  ContextMenuSubTrigger,\n  ContextMenuRadioGroup,\n}\n","path":null,"size_bytes":7428,"size_tokens":null},"client/src/components/ui/navigation-menu.tsx":{"content":"import * as React from \"react\"\nimport * as NavigationMenuPrimitive from \"@radix-ui/react-navigation-menu\"\nimport { cva } from \"class-variance-authority\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst NavigationMenu = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative z-10 flex max-w-max flex-1 items-center justify-center\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <NavigationMenuViewport />\n  </NavigationMenuPrimitive.Root>\n))\nNavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName\n\nconst NavigationMenuList = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.List\n    ref={ref}\n    className={cn(\n      \"group flex flex-1 list-none items-center justify-center space-x-1\",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName\n\nconst NavigationMenuItem = NavigationMenuPrimitive.Item\n\nconst navigationMenuTriggerStyle = cva(\n  \"group inline-flex h-10 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[state=open]:text-accent-foreground data-[state=open]:bg-accent/50 data-[state=open]:hover:bg-accent data-[state=open]:focus:bg-accent\"\n)\n\nconst NavigationMenuTrigger = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Trigger\n    ref={ref}\n    className={cn(navigationMenuTriggerStyle(), \"group\", className)}\n    {...props}\n  >\n    {children}{\" \"}\n    <ChevronDown\n      className=\"relative top-[1px] ml-1 h-3 w-3 transition duration-200 group-data-[state=open]:rotate-180\"\n      aria-hidden=\"true\"\n    />\n  </NavigationMenuPrimitive.Trigger>\n))\nNavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName\n\nconst NavigationMenuContent = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto \",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName\n\nconst NavigationMenuLink = NavigationMenuPrimitive.Link\n\nconst NavigationMenuViewport = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>\n>(({ className, ...props }, ref) => (\n  <div className={cn(\"absolute left-0 top-full flex justify-center\")}>\n    <NavigationMenuPrimitive.Viewport\n      className={cn(\n        \"origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  </div>\n))\nNavigationMenuViewport.displayName =\n  NavigationMenuPrimitive.Viewport.displayName\n\nconst NavigationMenuIndicator = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Indicator\n    ref={ref}\n    className={cn(\n      \"top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in\",\n      className\n    )}\n    {...props}\n  >\n    <div className=\"relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md\" />\n  </NavigationMenuPrimitive.Indicator>\n))\nNavigationMenuIndicator.displayName =\n  NavigationMenuPrimitive.Indicator.displayName\n\nexport {\n  navigationMenuTriggerStyle,\n  NavigationMenu,\n  NavigationMenuList,\n  NavigationMenuItem,\n  NavigationMenuContent,\n  NavigationMenuTrigger,\n  NavigationMenuLink,\n  NavigationMenuIndicator,\n  NavigationMenuViewport,\n}\n","path":null,"size_bytes":5128,"size_tokens":null},"client/src/components/ui/alert-dialog.tsx":{"content":"import * as React from \"react\"\nimport * as AlertDialogPrimitive from \"@radix-ui/react-alert-dialog\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nconst AlertDialog = AlertDialogPrimitive.Root\n\nconst AlertDialogTrigger = AlertDialogPrimitive.Trigger\n\nconst AlertDialogPortal = AlertDialogPrimitive.Portal\n\nconst AlertDialogOverlay = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nAlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName\n\nconst AlertDialogContent = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPortal>\n    <AlertDialogOverlay />\n    <AlertDialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    />\n  </AlertDialogPortal>\n))\nAlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName\n\nconst AlertDialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogHeader.displayName = \"AlertDialogHeader\"\n\nconst AlertDialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogFooter.displayName = \"AlertDialogFooter\"\n\nconst AlertDialogTitle = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold\", className)}\n    {...props}\n  />\n))\nAlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName\n\nconst AlertDialogDescription = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nAlertDialogDescription.displayName =\n  AlertDialogPrimitive.Description.displayName\n\nconst AlertDialogAction = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Action>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Action\n    ref={ref}\n    className={cn(buttonVariants(), className)}\n    {...props}\n  />\n))\nAlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName\n\nconst AlertDialogCancel = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Cancel\n    ref={ref}\n    className={cn(\n      buttonVariants({ variant: \"outline\" }),\n      \"mt-2 sm:mt-0\",\n      className\n    )}\n    {...props}\n  />\n))\nAlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName\n\nexport {\n  AlertDialog,\n  AlertDialogPortal,\n  AlertDialogOverlay,\n  AlertDialogTrigger,\n  AlertDialogContent,\n  AlertDialogHeader,\n  AlertDialogFooter,\n  AlertDialogTitle,\n  AlertDialogDescription,\n  AlertDialogAction,\n  AlertDialogCancel,\n}\n","path":null,"size_bytes":4420,"size_tokens":null},"client/src/components/ui/command.tsx":{"content":"import * as React from \"react\"\nimport { type DialogProps } from \"@radix-ui/react-dialog\"\nimport { Command as CommandPrimitive } from \"cmdk\"\nimport { Search } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Dialog, DialogContent } from \"@/components/ui/dialog\"\n\nconst Command = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nCommand.displayName = CommandPrimitive.displayName\n\nconst CommandDialog = ({ children, ...props }: DialogProps) => {\n  return (\n    <Dialog {...props}>\n      <DialogContent className=\"overflow-hidden p-0 shadow-lg\">\n        <Command className=\"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5\">\n          {children}\n        </Command>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\nconst CommandInput = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Input>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>\n>(({ className, ...props }, ref) => (\n  <div className=\"flex items-center border-b px-3\" cmdk-input-wrapper=\"\">\n    <Search className=\"mr-2 h-4 w-4 shrink-0 opacity-50\" />\n    <CommandPrimitive.Input\n      ref={ref}\n      className={cn(\n        \"flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    />\n  </div>\n))\n\nCommandInput.displayName = CommandPrimitive.Input.displayName\n\nconst CommandList = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.List\n    ref={ref}\n    className={cn(\"max-h-[300px] overflow-y-auto overflow-x-hidden\", className)}\n    {...props}\n  />\n))\n\nCommandList.displayName = CommandPrimitive.List.displayName\n\nconst CommandEmpty = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Empty>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>\n>((props, ref) => (\n  <CommandPrimitive.Empty\n    ref={ref}\n    className=\"py-6 text-center text-sm\"\n    {...props}\n  />\n))\n\nCommandEmpty.displayName = CommandPrimitive.Empty.displayName\n\nconst CommandGroup = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Group>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Group\n    ref={ref}\n    className={cn(\n      \"overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandGroup.displayName = CommandPrimitive.Group.displayName\n\nconst CommandSeparator = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nCommandSeparator.displayName = CommandPrimitive.Separator.displayName\n\nconst CommandItem = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandItem.displayName = CommandPrimitive.Item.displayName\n\nconst CommandShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nCommandShortcut.displayName = \"CommandShortcut\"\n\nexport {\n  Command,\n  CommandDialog,\n  CommandInput,\n  CommandList,\n  CommandEmpty,\n  CommandGroup,\n  CommandItem,\n  CommandShortcut,\n  CommandSeparator,\n}\n","path":null,"size_bytes":4885,"size_tokens":null},"client/src/pages/settings.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { Building2, Save } from \"lucide-react\";\nimport type { CompanySettings } from \"@shared/schema\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\n\nexport default function Settings() {\n  const { toast } = useToast();\n  const [formData, setFormData] = useState({\n    name: \"\",\n    address: \"\",\n    phone: \"\",\n    email: \"\",\n    gstNumber: \"\",\n    bankDetails: \"\",\n  });\n\n  const { data: companySettings, isLoading } = useQuery<CompanySettings | null>({\n    queryKey: [\"/api/company-settings\"],\n  });\n\n  useEffect(() => {\n    if (companySettings) {\n      setFormData({\n        name: companySettings.name || \"\",\n        address: companySettings.address || \"\",\n        phone: companySettings.phone || \"\",\n        email: companySettings.email || \"\",\n        gstNumber: companySettings.gstNumber || \"\",\n        bankDetails: companySettings.bankDetails || \"\",\n      });\n    }\n  }, [companySettings]);\n\n  const saveSettings = useMutation({\n    mutationFn: async (data: typeof formData) => {\n      return apiRequest(\"POST\", \"/api/company-settings\", data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/company-settings\"] });\n      toast({ title: \"Settings saved\", description: \"Company settings have been updated successfully.\" });\n    },\n    onError: () => {\n      toast({ title: \"Error\", description: \"Failed to save settings.\", variant: \"destructive\" });\n    },\n  });\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!formData.name) {\n      toast({ title: \"Validation Error\", description: \"Company name is required.\", variant: \"destructive\" });\n      return;\n    }\n    saveSettings.mutate(formData);\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"p-6 space-y-6\">\n        <Skeleton className=\"h-8 w-48\" />\n        <Skeleton className=\"h-96\" />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"p-6 space-y-6\">\n      <div className=\"flex items-center justify-between gap-4 flex-wrap\">\n        <h1 className=\"text-2xl font-semibold\" data-testid=\"text-page-title\">\n          Settings\n        </h1>\n      </div>\n\n      <Card>\n        <CardHeader>\n          <div className=\"flex items-center gap-3\">\n            <Building2 className=\"h-5 w-5 text-primary\" />\n            <div>\n              <CardTitle>Company Information</CardTitle>\n              <CardDescription>This information will appear on printed invoices and documents</CardDescription>\n            </div>\n          </div>\n        </CardHeader>\n        <CardContent>\n          <form onSubmit={handleSubmit} className=\"space-y-6\">\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"name\">Company Name *</Label>\n                <Input\n                  id=\"name\"\n                  value={formData.name}\n                  onChange={(e) => setFormData({ ...formData, name: e.target.value })}\n                  placeholder=\"Your Company Name\"\n                  data-testid=\"input-company-name\"\n                />\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"phone\">Phone Number</Label>\n                <Input\n                  id=\"phone\"\n                  value={formData.phone}\n                  onChange={(e) => setFormData({ ...formData, phone: e.target.value })}\n                  placeholder=\"+91 98765 43210\"\n                  data-testid=\"input-company-phone\"\n                />\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"email\">Email Address</Label>\n                <Input\n                  id=\"email\"\n                  type=\"email\"\n                  value={formData.email}\n                  onChange={(e) => setFormData({ ...formData, email: e.target.value })}\n                  placeholder=\"company@example.com\"\n                  data-testid=\"input-company-email\"\n                />\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"gstNumber\">GST Number</Label>\n                <Input\n                  id=\"gstNumber\"\n                  value={formData.gstNumber}\n                  onChange={(e) => setFormData({ ...formData, gstNumber: e.target.value })}\n                  placeholder=\"22AAAAA0000A1Z5\"\n                  data-testid=\"input-gst-number\"\n                />\n              </div>\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"address\">Business Address</Label>\n              <Textarea\n                id=\"address\"\n                value={formData.address}\n                onChange={(e) => setFormData({ ...formData, address: e.target.value })}\n                placeholder=\"Enter your complete business address\"\n                rows={3}\n                data-testid=\"input-company-address\"\n              />\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"bankDetails\">Bank Details</Label>\n              <Textarea\n                id=\"bankDetails\"\n                value={formData.bankDetails}\n                onChange={(e) => setFormData({ ...formData, bankDetails: e.target.value })}\n                placeholder=\"Bank Name: ABC Bank&#10;Account No: 1234567890&#10;IFSC: ABCD0001234\"\n                rows={4}\n                data-testid=\"input-bank-details\"\n              />\n              <p className=\"text-xs text-muted-foreground\">\n                This will appear on invoices for payment reference\n              </p>\n            </div>\n\n            <div className=\"flex justify-end\">\n              <Button type=\"submit\" disabled={saveSettings.isPending} data-testid=\"button-save-settings\">\n                <Save className=\"h-4 w-4 mr-2\" />\n                {saveSettings.isPending ? \"Saving...\" : \"Save Settings\"}\n              </Button>\n            </div>\n          </form>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":6428,"size_tokens":null},"client/src/components/ui/button.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\" +\n  \" hover-elevate active-elevate-2\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"bg-primary text-primary-foreground border border-primary-border\",\n        destructive:\n          \"bg-destructive text-destructive-foreground border border-destructive-border\",\n        outline:\n          // Shows the background color of whatever card / sidebar / accent background it is inside of.\n          // Inherits the current text color.\n          \" border [border-color:var(--button-outline)]  shadow-xs active:shadow-none \",\n        secondary: \"border bg-secondary text-secondary-foreground border border-secondary-border \",\n        // Add a transparent border so that when someone toggles a border on later, it doesn't shift layout/size.\n        ghost: \"border border-transparent\",\n      },\n      // Heights are set as \"min\" heights, because sometimes Ai will place large amount of content\n      // inside buttons. With a min-height they will look appropriate with small amounts of content,\n      // but will expand to fit large amounts of content.\n      size: {\n        default: \"min-h-9 px-4 py-2\",\n        sm: \"min-h-8 rounded-md px-3 text-xs\",\n        lg: \"min-h-10 rounded-md px-8\",\n        icon: \"h-9 w-9\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  },\n)\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\"\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    )\n  },\n)\nButton.displayName = \"Button\"\n\nexport { Button, buttonVariants }\n","path":null,"size_bytes":2359,"size_tokens":null},"replit.md":{"content":"# VegWholesale - Vegetable Wholesale Business Manager\n\n## Overview\nVegWholesale is a comprehensive business management system designed for vegetable wholesale operations. It streamlines the entire workflow from procurement (buying from vendors/farmers) to sales (selling to customers). The system aims to provide robust management for vendor and customer relations, inventory, purchases, sales, and financial tracking, ultimately enhancing efficiency and profitability for wholesale businesses.\n\n## User Preferences\n- Currency: Indian Rupees (₹)\n- Date format: YYYY-MM-DD\n- Business focused, minimal UI\n\n## System Architecture\nThe application is built with a modern web stack:\n-   **Frontend**: React with TypeScript, utilizing TailwindCSS for styling and Shadcn UI for componentry. Wouter handles client-side routing, and TanStack Query manages state.\n-   **Backend**: Express.js with TypeScript provides the API endpoints.\n-   **Database**: PostgreSQL is used for data persistence, managed with Drizzle ORM.\n\n**Key Features & Design Decisions:**\n-   **Comprehensive Workflow**: Manages vendors, customers, products, stock, purchases, sales (invoicing), payments, and vehicle tracking.\n-   **Inventory Management**: Real-time stock tracking with movement history, reorder level alerts, and a dedicated \"Returned\" column for vendor returns.\n-   **Vendor Returns**: Supports returning defective products with detailed reason tracking, automatic stock deduction, and vendor balance adjustments.\n-   **Weighing Station**: Features multi-unit support (weight-based/count-based), auto-detection of product units, and quick invoice generation.\n    -   **Weighing Machine Integration**: Direct connectivity with USB/Serial weighing scales via Web Serial API (Chrome/Edge), with configurable settings and a demo mode.\n    -   **Hamali Charge System**: Configurable rate per KG, inclusion/exclusion from invoice, and separate cash payment tracking.\n-   **Billing/Invoicing**: Automated calculations, stock deduction, and integrated Hamali charge management.\n-   **Payment Tracking**: Records vendor and customer payments, tracks outstanding balances, and maintains payment history.\n-   **Reporting & Analytics**:\n    -   Date range filtering and \"View By\" options (All Data, Day-wise, Monthly).\n    -   CSV export for all reports including totals.\n    -   Graphical analytics (Recharts) for sales trends, revenue breakdown, Hamali collection, stock value, and profit margins, adhering to Carbon Design System color tokens.\n-   **Sell Page (Fleet View)**: Visual representation of vehicles as cards, showing loaded products and quantities, with direct navigation to the weighing station for sales.\n-   **Dashboard**: Provides quick actions, key metrics, outstanding balances, 7-day sales trend, and stock value distribution charts.\n-   **Print Center**: Generates print-ready tax invoices and delivery challans with company branding.\n-   **User Interface**: Employs IBM Plex Sans and IBM Plex Mono fonts. A green primary color (142 hue) is used for a vegetable/organic theme, with dark/light mode support, following Carbon Design System principles.\n-   **Database Schema**: A normalized PostgreSQL schema supports all core entities (users, vendors, customers, products, vehicles, stock, purchases, invoices, payments, returns, Hamali cash, company settings, vehicle inventory, etc.).\n\n## External Dependencies\n-   **Replit Auth**: For user authentication.\n-   **PostgreSQL**: Relational database.\n-   **Drizzle ORM**: ORM for database interaction.\n-   **React**: Frontend library.\n-   **TailwindCSS**: CSS framework.\n-   **Shadcn UI**: UI component library.\n-   **Wouter**: Client-side router.\n-   **TanStack Query (React Query)**: Data fetching and state management.\n-   **Express.js**: Backend web framework.\n-   **Web Serial API**: For direct integration with USB/Serial weighing scales (browser-specific).\n-   **Recharts**: Charting library for data visualization in reports and dashboard.\n\n## Recent Changes\n- December 10, 2025: Customer payment enhancement with invoice editing\n  - Two-step payment dialog: Select customer → Review/edit invoices → Finalize payment\n  - View all customer invoices with line items in payment dialog\n  - Inline editing of product prices per item\n  - Inline editing of Hamali charge per invoice\n  - Automatic total recalculation as prices are modified\n  - \"Save Changes Only\" option to persist edits without recording payment\n  - \"Finalize & Record Payment\" to save edits and record full payment\n  - New API endpoints: GET /api/customers/:id/invoices, PATCH /api/invoices/:id, PATCH /api/invoice-items/:id\n\n- December 10, 2025: Product stock synchronization with vehicle operations\n  - Loading products onto vehicles (Sell page) now increases product.currentStock\n  - Sales from vehicles now decrease product.currentStock\n  - Products tab reflects real-time stock levels after vehicle loading/sales\n  - Stock validation prevents sales when product stock is 0 or insufficient\n  - Clear error messages show available vs requested quantities\n  - Frontend cache invalidates products after sales for immediate UI refresh\n\n- December 9, 2025: Multi-vehicle selection on Sell page\n  - Select multiple vehicles simultaneously (click to toggle selection)\n  - Each selected vehicle shows independent Customer Sale form (VehicleSalePane component)\n  - Vehicle cards show \"Selected\" badge with check icon when active\n  - Sale panes render in responsive 2-column grid\n  - \"Clear All\" button to deselect all vehicles at once\n  - Each sale has independent state: products, customer, hamali rate\n  - Creating sale on one vehicle doesn't affect others","path":null,"size_bytes":5665,"size_tokens":null},"client/src/components/ui/alert.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst alertVariants = cva(\n  \"relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-background text-foreground\",\n        destructive:\n          \"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Alert = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>\n>(({ className, variant, ...props }, ref) => (\n  <div\n    ref={ref}\n    role=\"alert\"\n    className={cn(alertVariants({ variant }), className)}\n    {...props}\n  />\n))\nAlert.displayName = \"Alert\"\n\nconst AlertTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h5\n    ref={ref}\n    className={cn(\"mb-1 font-medium leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nAlertTitle.displayName = \"AlertTitle\"\n\nconst AlertDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm [&_p]:leading-relaxed\", className)}\n    {...props}\n  />\n))\nAlertDescription.displayName = \"AlertDescription\"\n\nexport { Alert, AlertTitle, AlertDescription }\n","path":null,"size_bytes":1584,"size_tokens":null},"client/src/components/ui/progress.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ProgressPrimitive from \"@radix-ui/react-progress\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Progress = React.forwardRef<\n  React.ElementRef<typeof ProgressPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>\n>(({ className, value, ...props }, ref) => (\n  <ProgressPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative h-4 w-full overflow-hidden rounded-full bg-secondary\",\n      className\n    )}\n    {...props}\n  >\n    <ProgressPrimitive.Indicator\n      className=\"h-full w-full flex-1 bg-primary transition-all\"\n      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}\n    />\n  </ProgressPrimitive.Root>\n))\nProgress.displayName = ProgressPrimitive.Root.displayName\n\nexport { Progress }\n","path":null,"size_bytes":791,"size_tokens":null},"client/src/components/scale-connection.tsx":{"content":"import { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { Scale, Plug, Unplug, Settings, RefreshCw, AlertCircle, Check } from \"lucide-react\";\nimport { useScale, isWebSerialSupported, type ScaleSettings } from \"@/hooks/use-scale\";\nimport { useState } from \"react\";\n\ntype ScaleConnectionProps = {\n  onWeightCapture?: (weight: number) => void;\n  showCaptureButton?: boolean;\n};\n\nexport function ScaleConnection({ onWeightCapture, showCaptureButton = true }: ScaleConnectionProps) {\n  const scale = useScale();\n  const [settingsOpen, setSettingsOpen] = useState(false);\n\n  const handleCapture = () => {\n    if (scale.currentWeight !== null && onWeightCapture) {\n      onWeightCapture(scale.currentWeight);\n    }\n  };\n\n  if (!isWebSerialSupported()) {\n    return (\n      <Card className=\"border-destructive/50\">\n        <CardContent className=\"p-4\">\n          <div className=\"flex items-center gap-2 text-destructive\">\n            <AlertCircle className=\"h-5 w-5\" />\n            <span className=\"text-sm\">Weighing machine connection requires Chrome or Edge browser</span>\n          </div>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  return (\n    <Card>\n      <CardHeader className=\"pb-2\">\n        <CardTitle className=\"text-base flex items-center gap-2\">\n          <Scale className=\"h-5 w-5\" />\n          Weighing Machine\n          {scale.isConnected ? (\n            <Badge variant=\"default\" className=\"ml-auto\">Connected</Badge>\n          ) : (\n            <Badge variant=\"secondary\" className=\"ml-auto\">Disconnected</Badge>\n          )}\n        </CardTitle>\n      </CardHeader>\n      <CardContent className=\"space-y-4\">\n        {scale.error && (\n          <div className=\"flex items-center gap-2 text-destructive text-sm bg-destructive/10 p-2 rounded-md\">\n            <AlertCircle className=\"h-4 w-4 flex-shrink-0\" />\n            <span>{scale.error}</span>\n            <Button variant=\"ghost\" size=\"sm\" className=\"ml-auto\" onClick={scale.clearError}>\n              Dismiss\n            </Button>\n          </div>\n        )}\n\n        {scale.isConnected ? (\n          <>\n            <div className=\"bg-muted/50 rounded-lg p-4 text-center\">\n              <div className=\"text-xs text-muted-foreground mb-1\">Current Reading</div>\n              <div className=\"text-3xl font-mono font-bold text-primary\" data-testid=\"text-scale-weight\">\n                {scale.currentWeight !== null ? `${scale.currentWeight.toFixed(3)} KG` : \"---\"}\n              </div>\n              {scale.rawData && (\n                <div className=\"text-xs text-muted-foreground mt-2 font-mono\">\n                  Raw: {scale.rawData}\n                </div>\n              )}\n            </div>\n\n            <div className=\"flex flex-wrap gap-2\">\n              {showCaptureButton && (\n                <Button\n                  onClick={handleCapture}\n                  disabled={scale.currentWeight === null}\n                  className=\"flex-1\"\n                  data-testid=\"button-capture-weight\"\n                >\n                  <Check className=\"h-4 w-4 mr-1\" />\n                  Capture Weight\n                </Button>\n              )}\n              <Button\n                variant=\"outline\"\n                size=\"icon\"\n                onClick={scale.requestWeight}\n                title=\"Request weight reading\"\n                data-testid=\"button-request-weight\"\n              >\n                <RefreshCw className=\"h-4 w-4\" />\n              </Button>\n              <Button\n                variant=\"destructive\"\n                size=\"icon\"\n                onClick={scale.disconnect}\n                title=\"Disconnect scale\"\n                data-testid=\"button-disconnect-scale\"\n              >\n                <Unplug className=\"h-4 w-4\" />\n              </Button>\n            </div>\n          </>\n        ) : (\n          <div className=\"flex gap-2\">\n            <Button\n              onClick={scale.connect}\n              disabled={scale.isConnecting}\n              className=\"flex-1\"\n              data-testid=\"button-connect-scale\"\n            >\n              <Plug className=\"h-4 w-4 mr-2\" />\n              {scale.isConnecting ? \"Connecting...\" : \"Connect Scale\"}\n            </Button>\n            <Dialog open={settingsOpen} onOpenChange={setSettingsOpen}>\n              <DialogTrigger asChild>\n                <Button variant=\"outline\" size=\"icon\" data-testid=\"button-scale-settings\">\n                  <Settings className=\"h-4 w-4\" />\n                </Button>\n              </DialogTrigger>\n              <DialogContent>\n                <DialogHeader>\n                  <DialogTitle>Scale Settings</DialogTitle>\n                </DialogHeader>\n                <ScaleSettingsForm\n                  settings={scale.settings}\n                  onSave={(newSettings) => {\n                    scale.updateSettings(newSettings);\n                    setSettingsOpen(false);\n                  }}\n                />\n              </DialogContent>\n            </Dialog>\n          </div>\n        )}\n\n        <p className=\"text-xs text-muted-foreground\">\n          Connect your USB/Serial weighing scale to capture weight readings directly into the app.\n          Works with most scales that output via serial/COM port.\n        </p>\n      </CardContent>\n    </Card>\n  );\n}\n\ntype ScaleSettingsFormProps = {\n  settings: ScaleSettings;\n  onSave: (settings: Partial<ScaleSettings>) => void;\n};\n\nfunction ScaleSettingsForm({ settings, onSave }: ScaleSettingsFormProps) {\n  const [baudRate, setBaudRate] = useState(settings.baudRate.toString());\n  const [dataBits, setDataBits] = useState(settings.dataBits.toString());\n  const [stopBits, setStopBits] = useState(settings.stopBits.toString());\n  const [parity, setParity] = useState<string>(settings.parity);\n\n  const handleSave = () => {\n    onSave({\n      baudRate: parseInt(baudRate),\n      dataBits: parseInt(dataBits) as 7 | 8,\n      stopBits: parseInt(stopBits) as 1 | 2,\n      parity: parity as \"none\" | \"even\" | \"odd\",\n    });\n  };\n\n  return (\n    <div className=\"space-y-4\">\n      <p className=\"text-sm text-muted-foreground\">\n        Configure these settings to match your weighing scale. Check your scale manual for the correct values.\n      </p>\n\n      <div className=\"grid gap-4\">\n        <div className=\"space-y-2\">\n          <Label htmlFor=\"baudRate\">Baud Rate</Label>\n          <Select value={baudRate} onValueChange={setBaudRate}>\n            <SelectTrigger id=\"baudRate\" data-testid=\"select-baud-rate\">\n              <SelectValue />\n            </SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"1200\">1200</SelectItem>\n              <SelectItem value=\"2400\">2400</SelectItem>\n              <SelectItem value=\"4800\">4800</SelectItem>\n              <SelectItem value=\"9600\">9600 (Most Common)</SelectItem>\n              <SelectItem value=\"19200\">19200</SelectItem>\n              <SelectItem value=\"38400\">38400</SelectItem>\n              <SelectItem value=\"57600\">57600</SelectItem>\n              <SelectItem value=\"115200\">115200</SelectItem>\n            </SelectContent>\n          </Select>\n        </div>\n\n        <div className=\"space-y-2\">\n          <Label htmlFor=\"dataBits\">Data Bits</Label>\n          <Select value={dataBits} onValueChange={setDataBits}>\n            <SelectTrigger id=\"dataBits\" data-testid=\"select-data-bits\">\n              <SelectValue />\n            </SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"7\">7</SelectItem>\n              <SelectItem value=\"8\">8 (Most Common)</SelectItem>\n            </SelectContent>\n          </Select>\n        </div>\n\n        <div className=\"space-y-2\">\n          <Label htmlFor=\"stopBits\">Stop Bits</Label>\n          <Select value={stopBits} onValueChange={setStopBits}>\n            <SelectTrigger id=\"stopBits\" data-testid=\"select-stop-bits\">\n              <SelectValue />\n            </SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"1\">1 (Most Common)</SelectItem>\n              <SelectItem value=\"2\">2</SelectItem>\n            </SelectContent>\n          </Select>\n        </div>\n\n        <div className=\"space-y-2\">\n          <Label htmlFor=\"parity\">Parity</Label>\n          <Select value={parity} onValueChange={setParity}>\n            <SelectTrigger id=\"parity\" data-testid=\"select-parity\">\n              <SelectValue />\n            </SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"none\">None (Most Common)</SelectItem>\n              <SelectItem value=\"even\">Even</SelectItem>\n              <SelectItem value=\"odd\">Odd</SelectItem>\n            </SelectContent>\n          </Select>\n        </div>\n      </div>\n\n      <div className=\"flex justify-end gap-2\">\n        <Button onClick={handleSave} data-testid=\"button-save-settings\">\n          Save Settings\n        </Button>\n      </div>\n    </div>\n  );\n}\n\n// Compact inline scale display for use in forms\nexport function ScaleWeightDisplay({ \n  weight, \n  onCapture \n}: { \n  weight: number | null; \n  onCapture?: () => void;\n}) {\n  return (\n    <div className=\"flex items-center gap-2 bg-muted/50 rounded-md px-3 py-2\">\n      <Scale className=\"h-4 w-4 text-muted-foreground\" />\n      <span className=\"font-mono font-semibold text-lg\" data-testid=\"text-inline-weight\">\n        {weight !== null ? `${weight.toFixed(3)} KG` : \"---\"}\n      </span>\n      {onCapture && weight !== null && (\n        <Button variant=\"ghost\" size=\"sm\" onClick={onCapture} className=\"ml-auto\">\n          Use\n        </Button>\n      )}\n    </div>\n  );\n}\n","path":null,"size_bytes":9923,"size_tokens":null},"client/src/hooks/use-scale.ts":{"content":"import { useState, useCallback, useRef, useEffect } from \"react\";\n\n// Type declarations for Web Serial API\ndeclare global {\n  interface Navigator {\n    serial: Serial;\n  }\n  interface Serial {\n    requestPort(): Promise<SerialPort>;\n    getPorts(): Promise<SerialPort[]>;\n  }\n  interface SerialPort {\n    readable: ReadableStream<Uint8Array> | null;\n    writable: WritableStream<Uint8Array> | null;\n    open(options: SerialOptions): Promise<void>;\n    close(): Promise<void>;\n  }\n  interface SerialOptions {\n    baudRate: number;\n    dataBits?: 7 | 8;\n    stopBits?: 1 | 2;\n    parity?: \"none\" | \"even\" | \"odd\";\n  }\n}\n\nexport type ScaleSettings = {\n  baudRate: number;\n  dataBits: 7 | 8;\n  stopBits: 1 | 2;\n  parity: \"none\" | \"even\" | \"odd\";\n};\n\nconst DEFAULT_SETTINGS: ScaleSettings = {\n  baudRate: 9600,\n  dataBits: 8,\n  stopBits: 1,\n  parity: \"none\",\n};\n\n// Load settings from localStorage\nfunction loadSettings(): ScaleSettings {\n  try {\n    const saved = localStorage.getItem(\"scaleSettings\");\n    if (saved) {\n      return { ...DEFAULT_SETTINGS, ...JSON.parse(saved) };\n    }\n  } catch (e) {\n    console.error(\"Failed to load scale settings:\", e);\n  }\n  return DEFAULT_SETTINGS;\n}\n\n// Save settings to localStorage\nfunction saveSettings(settings: ScaleSettings) {\n  try {\n    localStorage.setItem(\"scaleSettings\", JSON.stringify(settings));\n  } catch (e) {\n    console.error(\"Failed to save scale settings:\", e);\n  }\n}\n\n// Check if Web Serial API is supported\nexport function isWebSerialSupported(): boolean {\n  return \"serial\" in navigator;\n}\n\nexport function useScale() {\n  const [isConnected, setIsConnected] = useState(false);\n  const [isConnecting, setIsConnecting] = useState(false);\n  const [currentWeight, setCurrentWeight] = useState<number | null>(null);\n  const [rawData, setRawData] = useState<string>(\"\");\n  const [error, setError] = useState<string | null>(null);\n  const [settings, setSettingsState] = useState<ScaleSettings>(loadSettings);\n\n  const portRef = useRef<SerialPort | null>(null);\n  const readerRef = useRef<ReadableStreamDefaultReader<Uint8Array> | null>(null);\n  const isReadingRef = useRef(false);\n\n  // Update and save settings\n  const updateSettings = useCallback((newSettings: Partial<ScaleSettings>) => {\n    setSettingsState((prev) => {\n      const updated = { ...prev, ...newSettings };\n      saveSettings(updated);\n      return updated;\n    });\n  }, []);\n\n  // Parse weight from scale output\n  // Common formats: \"ST,NT, +000.125kg\", \"  12.50 kg\", \"12.5\", etc.\n  const parseWeight = useCallback((data: string): number | null => {\n    // Remove control characters and trim\n    const cleaned = data.replace(/[\\x00-\\x1F\\x7F]/g, \" \").trim();\n    \n    if (!cleaned) return null;\n\n    // Try to extract numeric value\n    // Pattern 1: Standard format with sign and unit\n    let match = cleaned.match(/([+-]?\\d+\\.?\\d*)\\s*(kg|g|lb)?/i);\n    if (match) {\n      let value = parseFloat(match[1]);\n      const unit = match[2]?.toLowerCase();\n      \n      // Convert to KG if needed\n      if (unit === \"g\") {\n        value = value / 1000;\n      } else if (unit === \"lb\") {\n        value = value * 0.453592;\n      }\n      \n      return isNaN(value) ? null : value;\n    }\n\n    return null;\n  }, []);\n\n  // Read data from scale\n  const readLoop = useCallback(async () => {\n    if (!portRef.current?.readable || isReadingRef.current) return;\n    \n    isReadingRef.current = true;\n    let buffer = \"\";\n\n    try {\n      readerRef.current = portRef.current.readable.getReader();\n\n      while (true) {\n        const { value, done } = await readerRef.current.read();\n        \n        if (done) {\n          break;\n        }\n\n        if (value) {\n          const text = new TextDecoder().decode(value);\n          buffer += text;\n          \n          // Look for complete readings (usually end with newline or carriage return)\n          const lines = buffer.split(/[\\r\\n]+/);\n          \n          // Keep the last incomplete line in buffer\n          buffer = lines.pop() || \"\";\n          \n          for (const line of lines) {\n            if (line.trim()) {\n              setRawData(line);\n              const weight = parseWeight(line);\n              if (weight !== null) {\n                setCurrentWeight(weight);\n              }\n            }\n          }\n        }\n      }\n    } catch (err) {\n      if ((err as Error).name !== \"NetworkError\") {\n        console.error(\"Scale read error:\", err);\n        setError(`Read error: ${(err as Error).message}`);\n      }\n    } finally {\n      isReadingRef.current = false;\n      readerRef.current?.releaseLock();\n      readerRef.current = null;\n    }\n  }, [parseWeight]);\n\n  // Connect to scale\n  const connect = useCallback(async () => {\n    if (!isWebSerialSupported()) {\n      setError(\"Web Serial API is not supported in this browser. Please use Chrome or Edge.\");\n      return false;\n    }\n\n    setIsConnecting(true);\n    setError(null);\n\n    try {\n      // Request port selection from user\n      const port = await navigator.serial.requestPort();\n      \n      // Open with current settings\n      await port.open({\n        baudRate: settings.baudRate,\n        dataBits: settings.dataBits,\n        stopBits: settings.stopBits,\n        parity: settings.parity,\n      });\n\n      portRef.current = port;\n      setIsConnected(true);\n      setCurrentWeight(null);\n      \n      // Start reading\n      readLoop();\n      \n      return true;\n    } catch (err) {\n      const error = err as Error;\n      if (error.name === \"NotFoundError\") {\n        setError(\"No serial port selected.\");\n      } else if (error.name === \"SecurityError\") {\n        setError(\"Permission denied. Please allow access to the serial port.\");\n      } else {\n        setError(`Connection failed: ${error.message}`);\n      }\n      return false;\n    } finally {\n      setIsConnecting(false);\n    }\n  }, [settings, readLoop]);\n\n  // Disconnect from scale\n  const disconnect = useCallback(async () => {\n    try {\n      // Cancel the reader if active\n      if (readerRef.current) {\n        await readerRef.current.cancel();\n        readerRef.current.releaseLock();\n        readerRef.current = null;\n      }\n\n      // Close the port\n      if (portRef.current) {\n        await portRef.current.close();\n        portRef.current = null;\n      }\n\n      setIsConnected(false);\n      setCurrentWeight(null);\n      setRawData(\"\");\n      setError(null);\n    } catch (err) {\n      console.error(\"Disconnect error:\", err);\n    }\n  }, []);\n\n  // Send command to scale (e.g., \"P\" to request weight)\n  const sendCommand = useCallback(async (command: string) => {\n    if (!portRef.current?.writable) {\n      setError(\"Scale not connected\");\n      return false;\n    }\n\n    try {\n      const writer = portRef.current.writable.getWriter();\n      await writer.write(new TextEncoder().encode(command + \"\\r\\n\"));\n      writer.releaseLock();\n      return true;\n    } catch (err) {\n      setError(`Send failed: ${(err as Error).message}`);\n      return false;\n    }\n  }, []);\n\n  // Request weight reading (common command)\n  const requestWeight = useCallback(() => {\n    return sendCommand(\"P\");\n  }, [sendCommand]);\n\n  // Capture current weight for use in form\n  const captureWeight = useCallback((): number | null => {\n    return currentWeight;\n  }, [currentWeight]);\n\n  // Cleanup on unmount\n  useEffect(() => {\n    return () => {\n      disconnect();\n    };\n  }, [disconnect]);\n\n  return {\n    // State\n    isConnected,\n    isConnecting,\n    currentWeight,\n    rawData,\n    error,\n    settings,\n    isSupported: isWebSerialSupported(),\n\n    // Actions\n    connect,\n    disconnect,\n    sendCommand,\n    requestWeight,\n    captureWeight,\n    updateSettings,\n    clearError: () => setError(null),\n  };\n}\n","path":null,"size_bytes":7704,"size_tokens":null},"client/src/pages/sell.tsx":{"content":"import { useState, useEffect, useMemo, useCallback } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useLocation } from \"wouter\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger, DialogDescription } from \"@/components/ui/dialog\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { Input } from \"@/components/ui/input\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport { Truck, Plus, Package, X, Check, Minus, Weight, ShoppingBag } from \"lucide-react\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport type { Vehicle, Product, VehicleInventory, Vendor, Customer } from \"@shared/schema\";\n\nconst productItemSchema = z.object({\n  productId: z.string(),\n  quantity: z.number().min(0),\n  bags: z.number().min(0).optional(),\n});\n\nconst vehicleFormSchema = z.object({\n  vehicleNumber: z.string().min(1, \"Vehicle number is required\"),\n  vehicleType: z.string().min(1, \"Vehicle type is required\"),\n  capacity: z.string().optional(),\n  driverName: z.string().optional(),\n  driverPhone: z.string().optional(),\n  vendorId: z.string().optional(),\n  newVendorName: z.string().optional(),\n});\n\ninterface NewProduct {\n  name: string;\n  unit: string;\n  purchasePrice: number;\n  quantity: number;\n  bags: number;\n}\n\ntype ProductItem = z.infer<typeof productItemSchema>;\ntype VehicleFormValues = z.infer<typeof vehicleFormSchema>;\n\ninterface SaleProduct {\n  productId: string;\n  productName: string;\n  unit: string;\n  weight: number;\n  bags: number;\n  price: number;\n  available: number;\n}\n\ninterface SaleDraft {\n  products: SaleProduct[];\n  customerName: string;\n  selectedCustomerId: string;\n  hamaliCharge: number;\n  hamaliRatePerBag: number;\n}\n\ninterface VehicleSalePaneProps {\n  vehicle: Vehicle;\n  inventory: VehicleInventory[];\n  products: Product[];\n  customers: Customer[];\n  draft: SaleDraft;\n  onUpdateDraft: (draft: SaleDraft) => void;\n  onClose: () => void;\n  onSaleComplete: () => void;\n}\n\nfunction VehicleSalePane({ \n  vehicle, \n  inventory, \n  products, \n  customers, \n  draft, \n  onUpdateDraft, \n  onClose,\n  onSaleComplete \n}: VehicleSalePaneProps) {\n  const { toast } = useToast();\n\n  const availableProducts = useMemo(() => {\n    return inventory\n      .filter(inv => inv.quantity > 0)\n      .map(inv => {\n        const product = products.find(p => p.id === inv.productId);\n        const draftProduct = draft.products.find(p => p.productId === inv.productId);\n        return {\n          ...inv,\n          product,\n          weight: draftProduct?.weight || 0,\n          price: draftProduct?.price || product?.salePrice || 0,\n        };\n      })\n      .filter(item => item.product);\n  }, [inventory, products, draft.products]);\n\n  const updateProductField = (productId: string, field: 'weight' | 'bags' | 'price', value: number) => {\n    const exists = draft.products.find(p => p.productId === productId);\n    const product = products.find(p => p.id === productId);\n    const inv = inventory.find(i => i.productId === productId);\n    \n    if (!product || !inv) return;\n\n    let newProducts: SaleProduct[];\n    if (exists) {\n      newProducts = draft.products.map(p =>\n        p.productId === productId ? { ...p, [field]: Math.max(0, value) } : p\n      );\n    } else {\n      newProducts = [...draft.products, {\n        productId,\n        productName: product.name,\n        unit: product.unit || \"Units\",\n        weight: field === 'weight' ? value : 0,\n        bags: field === 'bags' ? value : 0,\n        price: field === 'price' ? value : (product.salePrice || 0),\n        available: inv.quantity,\n      }];\n    }\n\n    const newTotalBags = newProducts.reduce((sum, p) => sum + (p.bags || 0), 0);\n    const newHamaliCharge = newTotalBags * draft.hamaliRatePerBag;\n\n    onUpdateDraft({\n      ...draft,\n      products: newProducts,\n      hamaliCharge: newHamaliCharge,\n    });\n  };\n\n  const handleCustomerChange = (value: string) => {\n    if (value === \"new\") {\n      onUpdateDraft({ ...draft, selectedCustomerId: \"\", customerName: \"\" });\n    } else {\n      const customer = customers.find(c => c.id === value);\n      onUpdateDraft({ \n        ...draft, \n        selectedCustomerId: value, \n        customerName: customer?.name || \"\" \n      });\n    }\n  };\n\n  const saleTotalWeight = useMemo(() => {\n    return draft.products.reduce((sum, p) => sum + p.weight, 0);\n  }, [draft.products]);\n\n  const saleTotalBags = useMemo(() => {\n    return draft.products.reduce((sum, p) => sum + (p.bags || 0), 0);\n  }, [draft.products]);\n\n  const saleSubtotal = useMemo(() => {\n    return draft.products.reduce((sum, p) => sum + (p.weight * p.price), 0);\n  }, [draft.products]);\n\n  const createSaleMutation = useMutation({\n    mutationKey: ['/api/invoices', 'create', vehicle.id],\n    mutationFn: async () => {\n      if (draft.products.length === 0) {\n        throw new Error(\"Please select products to sell\");\n      }\n\n      // Check if all products have sufficient stock in the vehicle's inventory\n      for (const saleProduct of draft.products) {\n        if (saleProduct.weight <= 0) continue;\n        const product = products.find(p => p.id === saleProduct.productId);\n        const vehicleInventoryItem = inventory.find(i => i.productId === saleProduct.productId);\n        \n        // First check vehicle inventory (primary validation for sales from vehicles)\n        if (vehicleInventoryItem) {\n          if (vehicleInventoryItem.quantity < saleProduct.weight) {\n            throw new Error(`Insufficient stock in vehicle for ${product?.name || 'product'}. Available in vehicle: ${vehicleInventoryItem.quantity} KG, Requested: ${saleProduct.weight} KG`);\n          }\n          if (vehicleInventoryItem.quantity === 0) {\n            throw new Error(`No stock available in vehicle for ${product?.name || 'product'}`);\n          }\n        } else {\n          throw new Error(`${product?.name || 'Product'} is not loaded in this vehicle`);\n        }\n      }\n\n      let customerId = draft.selectedCustomerId;\n      if (!customerId && draft.customerName.trim()) {\n        const customerRes = await apiRequest(\"POST\", \"/api/customers\", {\n          name: draft.customerName.trim(),\n          phone: \"\",\n          address: \"\",\n          email: \"\",\n        });\n        const newCustomer = await customerRes.json();\n        customerId = newCustomer.id;\n      }\n\n      if (!customerId) {\n        throw new Error(\"Please select or enter a customer name\");\n      }\n\n      const subtotal = draft.products.reduce((sum, p) => sum + (p.weight * p.price), 0);\n\n      const today = new Date().toISOString().split('T')[0];\n      const invoiceNumber = `INV-${Date.now()}`;\n\n      const items = draft.products\n        .filter(p => p.weight > 0)\n        .map(saleProduct => ({\n          productId: saleProduct.productId,\n          quantity: saleProduct.weight,\n          unitPrice: saleProduct.price,\n          total: saleProduct.weight * saleProduct.price,\n        }));\n\n      const invoiceRes = await apiRequest(\"POST\", \"/api/invoices\", {\n        invoiceNumber,\n        customerId,\n        vehicleId: vehicle.id,\n        date: today,\n        subtotal,\n        includeHamaliCharge: draft.hamaliCharge > 0,\n        hamaliRatePerKg: 0,\n        hamaliChargeAmount: draft.hamaliCharge,\n        hamaliPaidByCash: false,\n        totalKgWeight: saleTotalWeight,\n        bags: saleTotalBags,\n        hamaliRatePerBag: draft.hamaliRatePerBag,\n        grandTotal: subtotal + draft.hamaliCharge,\n        items,\n      });\n\n      const invoice = await invoiceRes.json();\n\n      for (const saleProduct of draft.products) {\n        const currentInventory = inventory.find(i => i.productId === saleProduct.productId);\n        if (currentInventory) {\n          const newQuantity = Math.max(0, currentInventory.quantity - saleProduct.weight);\n          await apiRequest(\"PATCH\", `/api/vehicles/${vehicle.id}/inventory/${saleProduct.productId}`, {\n            quantity: newQuantity,\n          });\n\n          await apiRequest(\"POST\", \"/api/vehicle-inventory-movements\", {\n            vehicleId: vehicle.id,\n            productId: saleProduct.productId,\n            type: \"sale\",\n            quantity: saleProduct.weight,\n            date: today,\n            notes: `Sold to ${draft.customerName}`,\n          });\n        }\n      }\n\n      return invoice;\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/vehicles\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/all-vehicle-inventories\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/invoices\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/customers\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/products\"] });\n      \n      toast({\n        title: \"Sale Created\",\n        description: `Invoice created for ${vehicle.number}.`,\n      });\n\n      onSaleComplete();\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to create sale.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const hasProductsWithWeight = draft.products.some(p => p.weight > 0);\n  const grandTotal = saleSubtotal + draft.hamaliCharge;\n  \n  // Check if vehicle is new (today's date)\n  const today = new Date().toISOString().split(\"T\")[0];\n  const isNewVehicle = vehicle.entryDate === today;\n  \n  // Calculate total stock for this vehicle\n  const totalVehicleStock = inventory.reduce((sum, inv) => sum + inv.quantity, 0);\n\n  return (\n    <Card className={`w-80 flex-shrink-0 ${isNewVehicle ? 'border-primary/50 ring-1 ring-primary/30' : 'border-amber-500/50'}`} data-testid={`section-customer-sale-${vehicle.id}`}>\n      <CardHeader className={`p-3 pb-2 ${isNewVehicle ? 'bg-primary/5' : 'bg-amber-50 dark:bg-amber-950/20'}`}>\n        <div className=\"flex items-center justify-between gap-2\">\n          <div className=\"flex items-center gap-2 min-w-0\">\n            <Truck className={`h-5 w-5 flex-shrink-0 ${isNewVehicle ? 'text-primary' : 'text-amber-600'}`} />\n            <div className=\"flex flex-col\">\n              <span className=\"font-semibold text-sm\" data-testid={`text-sale-vehicle-number-${vehicle.id}`}>{vehicle.number}</span>\n              <span className={`text-xs ${isNewVehicle ? 'text-primary' : 'text-amber-600'}`}>\n                Stock: {totalVehicleStock.toFixed(1)} KG\n              </span>\n            </div>\n          </div>\n          <Button variant=\"ghost\" size=\"icon\" className=\"h-6 w-6\" onClick={onClose} data-testid={`button-close-sale-${vehicle.id}`}>\n            <X className=\"h-3 w-3\" />\n          </Button>\n        </div>\n      </CardHeader>\n      <CardContent className=\"p-3 pt-0 space-y-3\">\n        <Select value={draft.selectedCustomerId || \"new\"} onValueChange={handleCustomerChange}>\n          <SelectTrigger className=\"h-8 text-xs\" data-testid={`select-customer-${vehicle.id}`}>\n            <SelectValue placeholder=\"Select customer\" />\n          </SelectTrigger>\n          <SelectContent>\n            <SelectItem value=\"new\">New Customer</SelectItem>\n            {customers.map((customer) => (\n              <SelectItem key={customer.id} value={customer.id}>\n                {customer.name}\n              </SelectItem>\n            ))}\n          </SelectContent>\n        </Select>\n        \n        {(!draft.selectedCustomerId || draft.selectedCustomerId === \"\") && (\n          <Input\n            placeholder=\"Customer name\"\n            className=\"h-8 text-xs\"\n            value={draft.customerName}\n            onChange={(e) => onUpdateDraft({ ...draft, customerName: e.target.value })}\n            data-testid={`input-customer-name-${vehicle.id}`}\n          />\n        )}\n\n        <div className=\"space-y-1\">\n          <div className=\"grid grid-cols-12 gap-1 text-[10px] text-muted-foreground font-medium px-1\">\n            <div className=\"col-span-3\">Product</div>\n            <div className=\"col-span-2 text-center\">Weight</div>\n            <div className=\"col-span-2 text-center\">Bags</div>\n            <div className=\"col-span-3 text-center\">Price/KG</div>\n            <div className=\"col-span-2 text-right\">Total</div>\n          </div>\n          <div className=\"space-y-1 max-h-40 overflow-y-auto\">\n            {availableProducts.map((item) => {\n              const draftProduct = draft.products.find(p => p.productId === item.productId);\n              const weight = draftProduct?.weight || 0;\n              const bags = draftProduct?.bags || 0;\n              const price = draftProduct?.price || item.product?.salePrice || 0;\n              const lineTotal = weight * price;\n              \n              return (\n                <div key={item.productId} className=\"grid grid-cols-12 gap-1 items-center\">\n                  <div className=\"col-span-3 text-xs truncate\" title={item.product?.name}>\n                    {item.product?.name}\n                  </div>\n                  <div className=\"col-span-2\">\n                    <Input\n                      type=\"number\"\n                      min=\"0\"\n                      step=\"0.1\"\n                      className=\"h-6 text-xs text-center px-1 [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none\"\n                      value={weight || \"\"}\n                      placeholder=\"0\"\n                      onChange={(e) => updateProductField(item.productId, 'weight', parseFloat(e.target.value) || 0)}\n                      data-testid={`input-weight-${vehicle.id}-${item.productId}`}\n                    />\n                  </div>\n                  <div className=\"col-span-2\">\n                    <Input\n                      type=\"number\"\n                      min=\"0\"\n                      step=\"1\"\n                      className=\"h-6 text-xs text-center px-1 [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none\"\n                      value={bags || \"\"}\n                      placeholder=\"0\"\n                      onChange={(e) => updateProductField(item.productId, 'bags', parseInt(e.target.value) || 0)}\n                      data-testid={`input-bags-${vehicle.id}-${item.productId}`}\n                    />\n                  </div>\n                  <div className=\"col-span-3\">\n                    <Input\n                      type=\"number\"\n                      min=\"0\"\n                      className=\"h-6 text-xs text-center px-1 [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none\"\n                      value={price || \"\"}\n                      placeholder=\"0\"\n                      onChange={(e) => updateProductField(item.productId, 'price', parseFloat(e.target.value) || 0)}\n                      data-testid={`input-price-${vehicle.id}-${item.productId}`}\n                    />\n                  </div>\n                  <div className=\"col-span-2 text-xs text-right font-medium\">\n                    {lineTotal > 0 ? `₹${lineTotal.toFixed(0)}` : \"-\"}\n                  </div>\n                </div>\n              );\n            })}\n            {availableProducts.length === 0 && (\n              <p className=\"text-xs text-muted-foreground text-center py-2\">No products</p>\n            )}\n          </div>\n        </div>\n\n        <div className=\"flex items-center gap-2 flex-wrap\">\n          <span className=\"text-xs text-muted-foreground\">Hamali:</span>\n          <span className=\"text-xs text-muted-foreground\">{saleTotalBags} bags ×</span>\n          <Input\n            type=\"number\"\n            min=\"0\"\n            className=\"h-6 text-xs w-16 px-2 [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none\"\n            value={draft.hamaliRatePerBag || \"\"}\n            placeholder=\"₹/bag\"\n            onChange={(e) => {\n              const rate = parseFloat(e.target.value) || 0;\n              onUpdateDraft({ \n                ...draft, \n                hamaliRatePerBag: rate,\n                hamaliCharge: saleTotalBags * rate\n              });\n            }}\n            data-testid={`input-hamali-rate-${vehicle.id}`}\n          />\n          <span className=\"text-xs\">=</span>\n          <span className=\"text-xs font-medium\">₹{draft.hamaliCharge.toFixed(0)}</span>\n        </div>\n\n        <div className=\"pt-2 border-t space-y-1\">\n          <div className=\"flex items-center justify-between text-xs\">\n            <span className=\"text-muted-foreground\">Weight:</span>\n            <span data-testid={`text-total-weight-${vehicle.id}`}>{saleTotalWeight.toFixed(1)} KG</span>\n          </div>\n          <div className=\"flex items-center justify-between text-xs\">\n            <span className=\"text-muted-foreground\">Bags:</span>\n            <span data-testid={`text-total-bags-${vehicle.id}`}>{saleTotalBags}</span>\n          </div>\n          <div className=\"flex items-center justify-between text-xs\">\n            <span className=\"text-muted-foreground\">Subtotal:</span>\n            <span>₹{saleSubtotal.toFixed(0)}</span>\n          </div>\n          <div className=\"flex items-center justify-between text-xs\">\n            <span className=\"text-muted-foreground\">Hamali:</span>\n            <span>₹{draft.hamaliCharge.toFixed(0)}</span>\n          </div>\n          <div className=\"flex items-center justify-between pt-1 border-t\">\n            <span className=\"text-sm font-medium\">Grand Total:</span>\n            <span className=\"font-bold text-base text-primary\" data-testid={`text-grand-total-${vehicle.id}`}>₹{grandTotal.toFixed(0)}</span>\n          </div>\n        </div>\n\n        <Button \n          size=\"sm\"\n          className=\"w-full h-8\"\n          onClick={() => createSaleMutation.mutate()}\n          disabled={createSaleMutation.isPending || !hasProductsWithWeight || (!draft.selectedCustomerId && !draft.customerName.trim())}\n          data-testid={`button-create-sale-${vehicle.id}`}\n        >\n          {createSaleMutation.isPending ? \"...\" : \"Create Sale\"}\n        </Button>\n      </CardContent>\n    </Card>\n  );\n}\n\nexport default function Sell() {\n  const [, navigate] = useLocation();\n  const { toast } = useToast();\n  const [isDialogOpen, setIsDialogOpen] = useState(false);\n  const [selectedProducts, setSelectedProducts] = useState<ProductItem[]>([]);\n  const [newProducts, setNewProducts] = useState<NewProduct[]>([]);\n  const [showNewProductForm, setShowNewProductForm] = useState(false);\n  const [newProductName, setNewProductName] = useState(\"\");\n  const [newProductUnit, setNewProductUnit] = useState(\"KG\");\n  const [newProductPrice, setNewProductPrice] = useState(\"\");\n  \n  const [selectedVehicleIds, setSelectedVehicleIds] = useState<Set<string>>(new Set());\n  const [saleDrafts, setSaleDrafts] = useState<Record<string, SaleDraft>>({});\n\n  const form = useForm<VehicleFormValues>({\n    resolver: zodResolver(vehicleFormSchema),\n    defaultValues: {\n      vehicleNumber: \"\",\n      vehicleType: \"Truck\",\n      capacity: \"\",\n      driverName: \"\",\n      driverPhone: \"\",\n      vendorId: \"\",\n      newVendorName: \"\",\n    },\n  });\n\n  const { data: vehicles = [], isLoading: vehiclesLoading } = useQuery<Vehicle[]>({\n    queryKey: [\"/api/vehicles\"],\n  });\n\n  const { data: products = [] } = useQuery<Product[]>({\n    queryKey: [\"/api/products\"],\n  });\n\n  const { data: vendors = [] } = useQuery<Vendor[]>({\n    queryKey: [\"/api/vendors\"],\n  });\n\n  const { data: customers = [] } = useQuery<Customer[]>({\n    queryKey: [\"/api/customers\"],\n  });\n\n  const { data: vehicleInventories = {} } = useQuery<Record<string, VehicleInventory[]>>({\n    queryKey: [\"/api/all-vehicle-inventories\", vehicles.map((v) => v.id).join(\",\")],\n    queryFn: async () => {\n      if (vehicles.length === 0) return {};\n      const results: Record<string, VehicleInventory[]> = {};\n      await Promise.all(\n        vehicles.map(async (vehicle) => {\n          try {\n            const res = await fetch(`/api/vehicles/${vehicle.id}/inventory`);\n            if (res.ok) {\n              results[vehicle.id] = await res.json();\n            }\n          } catch {\n            results[vehicle.id] = [];\n          }\n        })\n      );\n      return results;\n    },\n    enabled: vehicles.length > 0,\n  });\n\n  const createVehicleMutation = useMutation({\n    mutationFn: async (data: VehicleFormValues) => {\n      let vendorName = data.vendorId ? vendors.find(v => v.id === data.vendorId)?.name : null;\n      \n      if (data.vendorId === \"new\" && data.newVendorName?.trim()) {\n        const vendorRes = await apiRequest(\"POST\", \"/api/vendors\", {\n          name: data.newVendorName.trim(),\n          phone: \"\",\n          address: \"\",\n          email: \"\",\n        });\n        const newVendor = await vendorRes.json();\n        vendorName = newVendor.name;\n      }\n\n      const createdProductIds: Record<string, string> = {};\n      for (const np of newProducts) {\n        if (np.name.trim() && np.quantity > 0) {\n          const productRes = await apiRequest(\"POST\", \"/api/products\", {\n            name: np.name.trim(),\n            unit: np.unit,\n            category: \"General\",\n            purchasePrice: np.purchasePrice || 0,\n            salePrice: 0,\n            currentStock: 0,\n            reorderLevel: 0,\n          });\n          const createdProduct = await productRes.json();\n          createdProductIds[np.name] = createdProduct.id;\n        }\n      }\n\n      const vehicleResponse = await apiRequest(\"POST\", \"/api/vehicles\", {\n        number: data.vehicleNumber,\n        type: data.vehicleType,\n        capacity: data.capacity || null,\n        driverName: data.driverName || null,\n        driverPhone: data.driverPhone || null,\n        entryDate: new Date().toISOString().split(\"T\")[0],\n      });\n      \n      const vehicle = await vehicleResponse.json();\n      \n      const productsToLoad = selectedProducts.filter(p => p.quantity > 0);\n      if (productsToLoad.length > 0 && vehicle.id) {\n        for (const item of productsToLoad) {\n          await apiRequest(\"POST\", `/api/vehicles/${vehicle.id}/inventory/load`, {\n            productId: item.productId,\n            quantity: item.quantity,\n          });\n        }\n      }\n\n      for (const np of newProducts) {\n        const productId = createdProductIds[np.name];\n        if (productId && np.quantity > 0 && vehicle.id) {\n          await apiRequest(\"POST\", `/api/vehicles/${vehicle.id}/inventory/load`, {\n            productId,\n            quantity: np.quantity,\n          });\n        }\n      }\n      \n      return vehicle;\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/vehicles\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/all-vehicle-inventories\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/vendors\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/products\"] });\n      setIsDialogOpen(false);\n      form.reset();\n      setSelectedProducts([]);\n      setNewProducts([]);\n      setShowNewProductForm(false);\n      setNewProductName(\"\");\n      setNewProductUnit(\"KG\");\n      toast({\n        title: \"Vehicle Created\",\n        description: \"New vehicle has been added with loaded products.\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to create vehicle.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const onSubmit = (data: VehicleFormValues) => {\n    createVehicleMutation.mutate(data);\n  };\n\n  const handleDialogClose = (open: boolean) => {\n    setIsDialogOpen(open);\n    if (!open) {\n      form.reset();\n      setSelectedProducts([]);\n      setNewProducts([]);\n      setShowNewProductForm(false);\n      setNewProductName(\"\");\n      setNewProductUnit(\"KG\");\n      setNewProductPrice(\"\");\n    }\n  };\n\n  const addNewProduct = () => {\n    if (newProductName.trim()) {\n      setNewProducts(prev => [...prev, {\n        name: newProductName.trim(),\n        unit: newProductUnit,\n        purchasePrice: parseFloat(newProductPrice) || 0,\n        quantity: 0,\n        bags: 0,\n      }]);\n      setNewProductName(\"\");\n      setNewProductUnit(\"KG\");\n      setNewProductPrice(\"\");\n      setShowNewProductForm(false);\n    }\n  };\n\n  const updateNewProductQuantity = (index: number, value: number) => {\n    setNewProducts(prev => prev.map((p, i) => \n      i === index ? { ...p, quantity: Math.max(0, value) } : p\n    ));\n  };\n\n  const updateNewProductBags = (index: number, value: number) => {\n    setNewProducts(prev => prev.map((p, i) => \n      i === index ? { ...p, bags: Math.max(0, Math.floor(value)) } : p\n    ));\n  };\n\n  const removeNewProduct = (index: number) => {\n    setNewProducts(prev => prev.filter((_, i) => i !== index));\n  };\n\n  const toggleProduct = (productId: string) => {\n    setSelectedProducts((prev) => {\n      const exists = prev.find((p) => p.productId === productId);\n      if (exists) {\n        return prev.filter((p) => p.productId !== productId);\n      }\n      return [...prev, { productId, quantity: 0, bags: 0 }];\n    });\n  };\n\n  const updateProductQuantity = (productId: string, value: number) => {\n    setSelectedProducts((prev) =>\n      prev.map((p) =>\n        p.productId === productId ? { ...p, quantity: Math.max(0, value) } : p\n      )\n    );\n  };\n\n  const updateProductBags = (productId: string, value: number) => {\n    setSelectedProducts((prev) =>\n      prev.map((p) =>\n        p.productId === productId ? { ...p, bags: Math.max(0, Math.floor(value)) } : p\n      )\n    );\n  };\n\n  const getProduct = (productId: string): Product | undefined => {\n    return products.find((p) => p.id === productId);\n  };\n\n  const getProductName = (productId: string): string => {\n    return getProduct(productId)?.name || \"Unknown Product\";\n  };\n\n  const getProductUnit = (productId: string): string => {\n    return getProduct(productId)?.unit || \"Units\";\n  };\n\n  const { totalWeight, totalBags } = useMemo(() => {\n    let weight = 0;\n    let bags = 0;\n    \n    for (const item of selectedProducts) {\n      const product = getProduct(item.productId);\n      if (!product) continue;\n      \n      const unit = product.unit?.toLowerCase() || \"\";\n      if (unit === \"kg\" && item.quantity > 0) {\n        weight += item.quantity;\n      }\n      bags += item.bags || 0;\n    }\n\n    for (const np of newProducts) {\n      const unit = np.unit?.toLowerCase() || \"\";\n      if (unit === \"kg\" && np.quantity > 0) {\n        weight += np.quantity;\n      }\n      bags += np.bags || 0;\n    }\n    \n    return { totalWeight: weight, totalBags: bags };\n  }, [selectedProducts, products, newProducts]);\n\n  useEffect(() => {\n    if (totalWeight > 0) {\n      const tons = (totalWeight / 1000).toFixed(2);\n      form.setValue(\"capacity\", tons);\n    }\n  }, [totalWeight, form]);\n\n  const handleVehicleSelect = useCallback((vehicleId: string) => {\n    const isCurrentlySelected = selectedVehicleIds.has(vehicleId);\n    \n    if (isCurrentlySelected) {\n      setSelectedVehicleIds(prev => {\n        const newSet = new Set(prev);\n        newSet.delete(vehicleId);\n        return newSet;\n      });\n      setSaleDrafts(prevDrafts => {\n        const newDrafts = { ...prevDrafts };\n        delete newDrafts[vehicleId];\n        return newDrafts;\n      });\n    } else {\n      setSelectedVehicleIds(prev => {\n        const newSet = new Set(prev);\n        newSet.add(vehicleId);\n        return newSet;\n      });\n      setSaleDrafts(prevDrafts => ({\n        ...prevDrafts,\n        [vehicleId]: {\n          products: [],\n          customerName: \"\",\n          selectedCustomerId: \"\",\n          hamaliCharge: 0,\n          hamaliRatePerBag: 0,\n        },\n      }));\n    }\n  }, [selectedVehicleIds]);\n\n  const handleUpdateDraft = useCallback((vehicleId: string, draft: SaleDraft) => {\n    setSaleDrafts(prev => ({\n      ...prev,\n      [vehicleId]: draft,\n    }));\n  }, []);\n\n  const handleCloseSale = useCallback((vehicleId: string) => {\n    setSelectedVehicleIds(prev => {\n      const newSet = new Set(prev);\n      newSet.delete(vehicleId);\n      return newSet;\n    });\n    setSaleDrafts(prev => {\n      const newDrafts = { ...prev };\n      delete newDrafts[vehicleId];\n      return newDrafts;\n    });\n  }, []);\n\n  const handleSaleComplete = useCallback((vehicleId: string) => {\n    // Reset the draft instead of closing - pane stays open for more sales\n    setSaleDrafts(prev => ({\n      ...prev,\n      [vehicleId]: {\n        products: [],\n        customerName: \"\",\n        selectedCustomerId: \"\",\n        hamaliCharge: 0,\n        hamaliRatePerBag: 0,\n      },\n    }));\n  }, []);\n\n  if (vehiclesLoading) {\n    return (\n      <div className=\"p-6\">\n        <div className=\"flex items-center justify-between gap-4 mb-6\">\n          <div>\n            <h1 className=\"text-2xl font-semibold\">Sell</h1>\n            <p className=\"text-muted-foreground\">Select vehicles to start selling</p>\n          </div>\n        </div>\n        <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4\">\n          {[1, 2, 3, 4].map((i) => (\n            <Skeleton key={i} className=\"h-48\" />\n          ))}\n        </div>\n      </div>\n    );\n  }\n\n  const selectedVehiclesArray = vehicles.filter(v => selectedVehicleIds.has(v.id));\n\n  return (\n    <div className=\"p-4 space-y-4\">\n      <div className=\"flex items-center justify-between gap-2 flex-wrap\">\n        <div className=\"flex items-center gap-2\">\n          <h1 className=\"text-lg font-semibold\" data-testid=\"text-section-vehicles\">Sell</h1>\n          {selectedVehicleIds.size > 0 && (\n            <Badge variant=\"secondary\" className=\"text-xs\">{selectedVehicleIds.size} selected</Badge>\n          )}\n        </div>\n        {selectedVehicleIds.size > 0 && (\n          <Button \n            variant=\"outline\" \n            size=\"sm\"\n            onClick={() => {\n              setSelectedVehicleIds(new Set());\n              setSaleDrafts({});\n            }}\n            data-testid=\"button-clear-all-sales\"\n          >\n            Clear All\n          </Button>\n        )}\n      </div>\n\n      <div className=\"flex gap-2 overflow-x-auto pb-2\">\n        <Dialog open={isDialogOpen} onOpenChange={handleDialogClose}>\n          <DialogTrigger asChild>\n            <Card \n              className=\"hover-elevate cursor-pointer border-dashed border-2 flex items-center justify-center w-28 h-24 flex-shrink-0\"\n              data-testid=\"button-add-vehicle\"\n            >\n              <CardContent className=\"flex flex-col items-center justify-center p-2 text-center\">\n                <Plus className=\"h-5 w-5 text-primary mb-1\" />\n                <span className=\"text-xs font-medium\">Add</span>\n              </CardContent>\n            </Card>\n          </DialogTrigger>\n            <DialogContent className=\"max-w-4xl max-h-[90vh] overflow-y-auto\">\n              <DialogHeader>\n                <DialogTitle>Add New Vehicle</DialogTitle>\n                <DialogDescription>Enter the vehicle details and select products to load.</DialogDescription>\n              </DialogHeader>\n              <Form {...form}>\n                <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-6\">\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                    <FormField\n                      control={form.control}\n                      name=\"vehicleNumber\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Vehicle Number *</FormLabel>\n                          <FormControl>\n                            <Input placeholder=\"e.g., MH12AB1234\" {...field} data-testid=\"input-vehicle-number\" />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                    <FormField\n                      control={form.control}\n                      name=\"vehicleType\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Vehicle Type *</FormLabel>\n                          <Select onValueChange={field.onChange} defaultValue={field.value}>\n                            <FormControl>\n                              <SelectTrigger data-testid=\"select-vehicle-type\">\n                                <SelectValue placeholder=\"Select type\" />\n                              </SelectTrigger>\n                            </FormControl>\n                            <SelectContent>\n                              <SelectItem value=\"Truck\">Truck</SelectItem>\n                              <SelectItem value=\"Mini Truck\">Mini Truck</SelectItem>\n                              <SelectItem value=\"Tempo\">Tempo</SelectItem>\n                              <SelectItem value=\"Van\">Van</SelectItem>\n                              <SelectItem value=\"Pickup\">Pickup</SelectItem>\n                            </SelectContent>\n                          </Select>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                    <FormField\n                      control={form.control}\n                      name=\"capacity\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Capacity (Tons)</FormLabel>\n                          <FormControl>\n                            <Input placeholder=\"Auto-calculated\" {...field} data-testid=\"input-capacity\" />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                    <FormField\n                      control={form.control}\n                      name=\"vendorId\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Vendor (Source)</FormLabel>\n                          <Select onValueChange={field.onChange} value={field.value}>\n                            <FormControl>\n                              <SelectTrigger data-testid=\"select-vendor\">\n                                <SelectValue placeholder=\"Select vendor\" />\n                              </SelectTrigger>\n                            </FormControl>\n                            <SelectContent>\n                              <SelectItem value=\"new\">+ Add New Vendor</SelectItem>\n                              {vendors.map((vendor) => (\n                                <SelectItem key={vendor.id} value={vendor.id}>\n                                  {vendor.name}\n                                </SelectItem>\n                              ))}\n                            </SelectContent>\n                          </Select>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                    {form.watch(\"vendorId\") === \"new\" && (\n                      <FormField\n                        control={form.control}\n                        name=\"newVendorName\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel>New Vendor Name</FormLabel>\n                            <FormControl>\n                              <Input placeholder=\"Enter vendor name\" {...field} data-testid=\"input-new-vendor-name\" />\n                            </FormControl>\n                            <FormMessage />\n                          </FormItem>\n                        )}\n                      />\n                    )}\n                    <FormField\n                      control={form.control}\n                      name=\"driverName\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Driver Name</FormLabel>\n                          <FormControl>\n                            <Input placeholder=\"Driver name\" {...field} data-testid=\"input-driver-name\" />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                    <FormField\n                      control={form.control}\n                      name=\"driverPhone\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Driver Phone</FormLabel>\n                          <FormControl>\n                            <Input placeholder=\"Driver phone\" {...field} data-testid=\"input-driver-phone\" />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                  </div>\n\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 p-4 bg-muted/50 rounded-md\">\n                    <div className=\"flex items-center gap-3\">\n                      <div className=\"h-10 w-10 rounded-md bg-primary/10 flex items-center justify-center flex-shrink-0\">\n                        <Weight className=\"h-5 w-5 text-primary\" />\n                      </div>\n                      <div>\n                        <p className=\"text-sm text-muted-foreground\">Total Weight</p>\n                        <p className=\"text-lg font-semibold\" data-testid=\"text-total-weight\">\n                          {totalWeight.toFixed(1)} KG\n                        </p>\n                      </div>\n                    </div>\n                    <div className=\"flex items-center gap-3\">\n                      <div className=\"h-10 w-10 rounded-md bg-primary/10 flex items-center justify-center flex-shrink-0\">\n                        <ShoppingBag className=\"h-5 w-5 text-primary\" />\n                      </div>\n                      <div>\n                        <p className=\"text-sm text-muted-foreground\">Total Bags</p>\n                        <p className=\"text-lg font-semibold\" data-testid=\"text-total-bags\">\n                          {totalBags} Bags\n                        </p>\n                      </div>\n                    </div>\n                  </div>\n\n                  <div className=\"space-y-4\">\n                    <div className=\"flex items-center justify-between gap-2 flex-wrap\">\n                      <h3 className=\"text-lg font-medium\">Select Products to Load</h3>\n                      <div className=\"flex items-center gap-2\">\n                        {(selectedProducts.length > 0 || newProducts.length > 0) && (\n                          <Badge variant=\"secondary\">{selectedProducts.length + newProducts.length} selected</Badge>\n                        )}\n                        <Button \n                          type=\"button\" \n                          variant=\"outline\" \n                          size=\"sm\"\n                          onClick={() => setShowNewProductForm(true)}\n                          data-testid=\"button-add-new-product\"\n                        >\n                          <Plus className=\"h-3 w-3 mr-1\" />\n                          Add New\n                        </Button>\n                      </div>\n                    </div>\n\n                    {showNewProductForm && (\n                      <div className=\"p-3 border rounded-md bg-muted/30 space-y-3\">\n                        <div className=\"flex items-center justify-between\">\n                          <span className=\"font-medium text-sm\">Add New Product</span>\n                          <Button\n                            type=\"button\"\n                            variant=\"ghost\"\n                            size=\"icon\"\n                            onClick={() => {\n                              setShowNewProductForm(false);\n                              setNewProductName(\"\");\n                              setNewProductUnit(\"KG\");\n                              setNewProductPrice(\"\");\n                            }}\n                          >\n                            <X className=\"h-4 w-4\" />\n                          </Button>\n                        </div>\n                        <div className=\"grid grid-cols-1 sm:grid-cols-4 gap-2\">\n                          <Input\n                            placeholder=\"Product name\"\n                            value={newProductName}\n                            onChange={(e) => setNewProductName(e.target.value)}\n                            data-testid=\"input-new-product-name\"\n                          />\n                          <Select value={newProductUnit} onValueChange={setNewProductUnit}>\n                            <SelectTrigger data-testid=\"select-new-product-unit\">\n                              <SelectValue />\n                            </SelectTrigger>\n                            <SelectContent>\n                              <SelectItem value=\"KG\">KG</SelectItem>\n                              <SelectItem value=\"Units\">Units</SelectItem>\n                              <SelectItem value=\"Dozen\">Dozen</SelectItem>\n                              <SelectItem value=\"Bundle\">Bundle</SelectItem>\n                            </SelectContent>\n                          </Select>\n                          <Input\n                            type=\"number\"\n                            placeholder=\"Purchase Price (₹)\"\n                            value={newProductPrice}\n                            onChange={(e) => setNewProductPrice(e.target.value)}\n                            data-testid=\"input-new-product-price\"\n                          />\n                          <Button\n                            type=\"button\"\n                            onClick={addNewProduct}\n                            disabled={!newProductName.trim()}\n                            data-testid=\"button-confirm-new-product\"\n                          >\n                            Add Product\n                          </Button>\n                        </div>\n                      </div>\n                    )}\n\n                    {newProducts.length > 0 && (\n                      <div className=\"space-y-2\">\n                        <span className=\"text-sm text-muted-foreground\">New Products (will be created):</span>\n                        {newProducts.map((np, index) => (\n                          <div key={index} className=\"p-3 border rounded-md border-primary/50 bg-primary/5\">\n                            <div className=\"flex items-start gap-3\">\n                              <div className=\"flex-1\">\n                                <div className=\"flex items-center justify-between gap-2 flex-wrap\">\n                                  <div className=\"flex items-center gap-2 flex-wrap\">\n                                    <span className=\"font-medium\">{np.name}</span>\n                                    <Badge variant=\"outline\" className=\"text-xs\">{np.unit}</Badge>\n                                    {np.purchasePrice > 0 && (\n                                      <Badge variant=\"outline\" className=\"text-xs font-mono\">₹{np.purchasePrice}/unit</Badge>\n                                    )}\n                                    <Badge variant=\"secondary\" className=\"text-xs\">New</Badge>\n                                  </div>\n                                  <Button\n                                    type=\"button\"\n                                    variant=\"ghost\"\n                                    size=\"icon\"\n                                    onClick={() => removeNewProduct(index)}\n                                  >\n                                    <X className=\"h-4 w-4\" />\n                                  </Button>\n                                </div>\n                                <div className=\"mt-3 grid grid-cols-1 sm:grid-cols-2 gap-3\">\n                                  <div>\n                                    <label className=\"text-sm text-muted-foreground mb-1 block\">\n                                      Quantity ({np.unit})\n                                    </label>\n                                    <div className=\"flex items-center gap-1\">\n                                      <Button\n                                        type=\"button\"\n                                        size=\"icon\"\n                                        variant=\"outline\"\n                                        onClick={() => updateNewProductQuantity(index, np.quantity - 1)}\n                                        className=\"h-8 w-8\"\n                                      >\n                                        <Minus className=\"h-3 w-3\" />\n                                      </Button>\n                                      <Input\n                                        type=\"number\"\n                                        min=\"0\"\n                                        step={np.unit === \"KG\" ? \"0.1\" : \"1\"}\n                                        value={np.quantity || 0}\n                                        onChange={(e) => updateNewProductQuantity(index, parseFloat(e.target.value) || 0)}\n                                        className=\"text-center h-8 w-20\"\n                                        data-testid={`input-new-product-qty-${index}`}\n                                      />\n                                      <Button\n                                        type=\"button\"\n                                        size=\"icon\"\n                                        variant=\"outline\"\n                                        onClick={() => updateNewProductQuantity(index, np.quantity + 1)}\n                                        className=\"h-8 w-8\"\n                                      >\n                                        <Plus className=\"h-3 w-3\" />\n                                      </Button>\n                                    </div>\n                                  </div>\n                                  <div>\n                                    <label className=\"text-sm text-muted-foreground mb-1 block\">Bags</label>\n                                    <div className=\"flex items-center gap-1\">\n                                      <Button\n                                        type=\"button\"\n                                        size=\"icon\"\n                                        variant=\"outline\"\n                                        onClick={() => updateNewProductBags(index, np.bags - 1)}\n                                        className=\"h-8 w-8\"\n                                      >\n                                        <Minus className=\"h-3 w-3\" />\n                                      </Button>\n                                      <Input\n                                        type=\"number\"\n                                        min=\"0\"\n                                        step=\"1\"\n                                        value={np.bags || 0}\n                                        onChange={(e) => updateNewProductBags(index, parseInt(e.target.value) || 0)}\n                                        className=\"text-center h-8 w-20\"\n                                        data-testid={`input-new-product-bags-${index}`}\n                                      />\n                                      <Button\n                                        type=\"button\"\n                                        size=\"icon\"\n                                        variant=\"outline\"\n                                        onClick={() => updateNewProductBags(index, np.bags + 1)}\n                                        className=\"h-8 w-8\"\n                                      >\n                                        <Plus className=\"h-3 w-3\" />\n                                      </Button>\n                                    </div>\n                                  </div>\n                                </div>\n                              </div>\n                            </div>\n                          </div>\n                        ))}\n                      </div>\n                    )}\n                    \n                    <ScrollArea className=\"h-64 border rounded-md p-4\">\n                      <div className=\"space-y-3\">\n                        {products.map((product) => {\n                          const isSelected = selectedProducts.some((p) => p.productId === product.id);\n                          const productData = selectedProducts.find((p) => p.productId === product.id);\n                          \n                          return (\n                            <div \n                              key={product.id} \n                              className={`p-3 border rounded-md transition-colors ${isSelected ? 'border-primary bg-primary/5' : 'hover:bg-muted/50'}`}\n                            >\n                              <div className=\"flex items-start gap-3\">\n                                <Checkbox\n                                  checked={isSelected}\n                                  onCheckedChange={() => toggleProduct(product.id)}\n                                  data-testid={`checkbox-product-${product.id}`}\n                                />\n                                <div className=\"flex-1\">\n                                  <div className=\"flex items-center justify-between gap-2 flex-wrap\">\n                                    <div className=\"flex items-center gap-2\">\n                                      <span className=\"font-medium\">{product.name}</span>\n                                      <Badge variant=\"outline\" className=\"text-xs\">{product.unit}</Badge>\n                                    </div>\n                                    <span className=\"text-sm text-muted-foreground\">Stock: {product.currentStock}</span>\n                                  </div>\n\n                                  {isSelected && (\n                                    <div className=\"mt-3 grid grid-cols-1 sm:grid-cols-2 gap-3\">\n                                      <div>\n                                        <label className=\"text-sm text-muted-foreground mb-1 block\">\n                                          Quantity ({product.unit})\n                                        </label>\n                                        <div className=\"flex items-center gap-1\">\n                                          <Button\n                                            type=\"button\"\n                                            size=\"icon\"\n                                            variant=\"outline\"\n                                            onClick={() => updateProductQuantity(product.id, (productData?.quantity || 0) - 1)}\n                                            className=\"h-8 w-8\"\n                                          >\n                                            <Minus className=\"h-3 w-3\" />\n                                          </Button>\n                                          <Input\n                                            type=\"number\"\n                                            min=\"0\"\n                                            step={product.unit === \"KG\" ? \"0.1\" : \"1\"}\n                                            value={productData?.quantity || 0}\n                                            onChange={(e) => updateProductQuantity(product.id, parseFloat(e.target.value) || 0)}\n                                            className=\"text-center h-8 w-20\"\n                                            data-testid={`input-quantity-${product.id}`}\n                                          />\n                                          <Button\n                                            type=\"button\"\n                                            size=\"icon\"\n                                            variant=\"outline\"\n                                            onClick={() => updateProductQuantity(product.id, (productData?.quantity || 0) + 1)}\n                                            className=\"h-8 w-8\"\n                                          >\n                                            <Plus className=\"h-3 w-3\" />\n                                          </Button>\n                                        </div>\n                                      </div>\n                                      <div>\n                                        <label className=\"text-sm text-muted-foreground mb-1 block flex items-center gap-1\">\n                                          Bags\n                                          {(productData?.bags || 0) > 0 && (\n                                            <Badge variant=\"secondary\" className=\"text-xs ml-1\">{productData?.bags}</Badge>\n                                          )}\n                                        </label>\n                                        <div className=\"flex items-center gap-1\">\n                                          <Button\n                                            type=\"button\"\n                                            size=\"icon\"\n                                            variant=\"outline\"\n                                            onClick={() => updateProductBags(product.id, (productData?.bags || 0) - 1)}\n                                            className=\"h-8 w-8\"\n                                          >\n                                            <Minus className=\"h-3 w-3\" />\n                                          </Button>\n                                          <Input\n                                            type=\"number\"\n                                            min=\"0\"\n                                            step=\"1\"\n                                            value={productData?.bags || 0}\n                                            onChange={(e) => updateProductBags(product.id, parseInt(e.target.value) || 0)}\n                                            className=\"text-center h-8 w-20\"\n                                            data-testid={`input-bags-${product.id}`}\n                                          />\n                                          <Button\n                                            type=\"button\"\n                                            size=\"icon\"\n                                            variant=\"outline\"\n                                            onClick={() => updateProductBags(product.id, (productData?.bags || 0) + 1)}\n                                            className=\"h-8 w-8\"\n                                          >\n                                            <Plus className=\"h-3 w-3\" />\n                                          </Button>\n                                        </div>\n                                      </div>\n                                    </div>\n                                  )}\n                                </div>\n                              </div>\n                            </div>\n                          );\n                        })}\n                        {products.length === 0 && (\n                          <p className=\"text-center text-muted-foreground py-8\">\n                            No products available. Add products first.\n                          </p>\n                        )}\n                      </div>\n                    </ScrollArea>\n                  </div>\n\n                  <div className=\"flex justify-end gap-2 pt-4 border-t\">\n                    <Button type=\"button\" variant=\"outline\" onClick={() => handleDialogClose(false)} data-testid=\"button-cancel-vehicle\">\n                      Cancel\n                    </Button>\n                    <Button type=\"submit\" disabled={createVehicleMutation.isPending} data-testid=\"button-submit-vehicle\">\n                      {createVehicleMutation.isPending ? \"Creating...\" : \"Create Vehicle\"}\n                    </Button>\n                  </div>\n                </form>\n              </Form>\n            </DialogContent>\n          </Dialog>\n\n        {vehicles.map((vehicle) => {\n          const inventory = vehicleInventories[vehicle.id] || [];\n          const itemsWithStock = inventory.filter((inv) => inv.quantity > 0);\n          const hasInventory = itemsWithStock.length > 0;\n          const isSelected = selectedVehicleIds.has(vehicle.id);\n\n          if (isSelected) {\n            return (\n              <VehicleSalePane\n                key={vehicle.id}\n                vehicle={vehicle}\n                inventory={vehicleInventories[vehicle.id] || []}\n                products={products}\n                customers={customers}\n                draft={saleDrafts[vehicle.id] || { products: [], customerName: \"\", selectedCustomerId: \"\", hamaliCharge: 0 }}\n                onUpdateDraft={(draft) => handleUpdateDraft(vehicle.id, draft)}\n                onClose={() => handleCloseSale(vehicle.id)}\n                onSaleComplete={() => handleSaleComplete(vehicle.id)}\n              />\n            );\n          }\n\n          const totalQty = itemsWithStock.reduce((sum, inv) => sum + inv.quantity, 0);\n          \n          // Check if vehicle is new (today's date)\n          const today = new Date().toISOString().split(\"T\")[0];\n          const isNewVehicle = vehicle.entryDate === today;\n\n          return (\n            <Card\n              key={vehicle.id}\n              className={`hover-elevate cursor-pointer w-48 flex-shrink-0 ${isNewVehicle ? 'ring-2 ring-primary' : ''}`}\n              onClick={() => handleVehicleSelect(vehicle.id)}\n              data-testid={`card-vehicle-${vehicle.id}`}\n            >\n              <CardContent className=\"p-3 flex flex-col gap-2\">\n                <div className=\"flex items-center gap-3\">\n                  <Truck className={`h-10 w-10 flex-shrink-0 ${isNewVehicle ? 'text-primary' : 'text-amber-600'}`} />\n                  <div className=\"flex flex-col min-w-0\">\n                    <span className=\"text-sm font-bold\" data-testid={`text-vehicle-number-${vehicle.id}`}>\n                      {vehicle.number}\n                    </span>\n                    <span className=\"text-xs text-muted-foreground\">{vehicle.type}</span>\n                    {vehicle.entryDate ? (\n                      <span className={`text-xs ${isNewVehicle ? 'text-primary font-medium' : 'text-muted-foreground'}`}>\n                        {vehicle.entryDate} {isNewVehicle && '(New)'}\n                      </span>\n                    ) : (\n                      <span className=\"text-xs text-amber-600\">(Old Vehicle)</span>\n                    )}\n                  </div>\n                </div>\n                <div className=\"flex items-center gap-2 mt-1\">\n                  <span className=\"text-xs text-muted-foreground\">Total:</span>\n                  <span className=\"text-sm font-bold text-primary\" data-testid={`text-vehicle-total-${vehicle.id}`}>\n                    {totalQty.toFixed(1)} KG\n                  </span>\n                </div>\n                {hasInventory ? (\n                  <div className=\"space-y-1 pt-1 border-t\">\n                    {itemsWithStock.map((inv) => {\n                      const product = products.find(p => p.id === inv.productId);\n                      return (\n                        <div key={inv.productId} className=\"flex items-center justify-between text-xs\">\n                          <span className=\"truncate max-w-20\">{product?.name || \"?\"}</span>\n                          <span className=\"font-mono text-muted-foreground\">{inv.quantity}</span>\n                        </div>\n                      );\n                    })}\n                  </div>\n                ) : (\n                  <div className=\"text-xs text-muted-foreground italic\">No products loaded</div>\n                )}\n              </CardContent>\n            </Card>\n          );\n        })}\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":60113,"size_tokens":null}},"version":2}